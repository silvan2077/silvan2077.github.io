<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>è‹ç©¹å¤–å– | Silvan's BlogğŸ³</title><meta name="author" content="SilvanğŸ³"><meta name="copyright" content="SilvanğŸ³"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="day01å‰ç«¯ç¯å¢ƒæ­å»º å‰ç«¯å·¥ç¨‹åŸºäº nginxåœ¨é»‘é©¬æä¾›çš„èµ„æ–™ä¸­æ‰¾åˆ°å‰ç«¯è¿è¡Œçš„nginxï¼Œå°†å…¶ç§»åŠ¨åˆ°ä¸€ä¸ªéä¸­æ–‡ç›®å½•ä¸‹   Nginxç›®å½•å¿…é¡»æ”¾åœ¨æ²¡æœ‰ä¸­æ–‡çš„ç›®å½•ä¸­æ‰èƒ½æ­£å¸¸è¿è¡Œï¼ï¼ å½“å‰çš„Nginxçš„é…ç½®æ–‡ä»¶å·²ç»é…ç½®äº†åå‘ä»£ç†ï¼Œé€šè¿‡æ­¤é…ç½®å¯ä»¥å°†å‰ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚    å¯åŠ¨nginxï¼Œè®¿é—®æµ‹è¯•åŒå‡»nginx.exeå³å¯å¯åŠ¨nginxæœåŠ¡ï¼Œé»˜è®¤è®¿é—®ç«¯å£ä¸º80ã€‚http:&#x2F;&#x2F;localhost:8"><meta property="og:type" content="article"><meta property="og:title" content="è‹ç©¹å¤–å–"><meta property="og:url" content="https://silvan.chat/2025/11/10/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/index.html"><meta property="og:site_name" content="Silvan&#39;s BlogğŸ³"><meta property="og:description" content="day01å‰ç«¯ç¯å¢ƒæ­å»º å‰ç«¯å·¥ç¨‹åŸºäº nginxåœ¨é»‘é©¬æä¾›çš„èµ„æ–™ä¸­æ‰¾åˆ°å‰ç«¯è¿è¡Œçš„nginxï¼Œå°†å…¶ç§»åŠ¨åˆ°ä¸€ä¸ªéä¸­æ–‡ç›®å½•ä¸‹   Nginxç›®å½•å¿…é¡»æ”¾åœ¨æ²¡æœ‰ä¸­æ–‡çš„ç›®å½•ä¸­æ‰èƒ½æ­£å¸¸è¿è¡Œï¼ï¼ å½“å‰çš„Nginxçš„é…ç½®æ–‡ä»¶å·²ç»é…ç½®äº†åå‘ä»£ç†ï¼Œé€šè¿‡æ­¤é…ç½®å¯ä»¥å°†å‰ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚    å¯åŠ¨nginxï¼Œè®¿é—®æµ‹è¯•åŒå‡»nginx.exeå³å¯å¯åŠ¨nginxæœåŠ¡ï¼Œé»˜è®¤è®¿é—®ç«¯å£ä¸º80ã€‚http:&#x2F;&#x2F;localhost:8"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/610377944fb31f01071d8d82782eedf4.jpg"><meta property="article:published_time" content="2025-11-10T11:24:19.755Z"><meta property="article:modified_time" content="2025-11-17T02:41:37.836Z"><meta property="article:author" content="SilvanğŸ³"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/610377944fb31f01071d8d82782eedf4.jpg"><link rel="shortcut icon" href="/%F0%9F%90%B3"><link rel="canonical" href="https://silvan.chat/2025/11/10/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":250},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'è‹ç©¹å¤–å–',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-11-17 10:41:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script><script src="https://unpkg.com/typed.js@2.0.12/lib/typed.min.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="/css/readPercent.css"><link rel="stylesheet" href="/css/toc-custom.css"><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute;overflow:hidden;width:0;height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248 626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><div id="myscoll"></div><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Silvan's BlogğŸ³" type="application/atom+xml"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/12e8275194271855a58c84429b090a10.jpg" data-lazy="false" referrerpolicy="no-referrer" onerror="this.onerror=null;this.src='/assets/avatar.webp'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">12</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-home"></use></svg> <span class="menu_word" style="font-size:17px">é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--article"></use></svg> <span class="menu_word" style="font-size:17px">æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guidang1"></use></svg> <span class="menu_word" style="font-size:17px">å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-sekuaibiaoqian"></use></svg> <span class="menu_word" style="font-size:17px">æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-fenlei"></use></svg> <span class="menu_word" style="font-size:17px">åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pinweishenghuo"></use></svg> <span class="menu_word" style="font-size:17px">ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yinle"></use></svg> <span class="menu_word" style="font-size:17px">å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying1"></use></svg> <span class="menu_word" style="font-size:17px">å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-youxishoubing"></use></svg> <span class="menu_word" style="font-size:17px">æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangzi"></use></svg> <span class="menu_word" style="font-size:17px">å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-tubiaozhizuomoban"></use></svg> <span class="menu_word" style="font-size:17px">ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-nvwumao"></use></svg> <span class="menu_word" style="font-size:17px">åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zhifengche"></use></svg> <span class="menu_word" style="font-size:17px">ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shejiaoxinxi"></use></svg> <span class="menu_word" style="font-size:17px">ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pengyouquan"></use></svg> <span class="menu_word" style="font-size:17px">æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-liuyan"></use></svg> <span class="menu_word" style="font-size:17px">ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-lianjie"></use></svg> <span class="menu_word" style="font-size:17px">å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-maoliang"></use></svg> <span class="menu_word" style="font-size:17px">ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qunliaotian"></use></svg> <span class="menu_word" style="font-size:17px">å” å¨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/field/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-love-sign"></use></svg> <span class="menu_word" style="font-size:17px">ä¸ªäººé¢†åŸŸ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-paperplane"></use></svg> <span class="menu_word" style="font-size:17px">å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Silvan's BlogğŸ³</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-home"></use></svg> <span class="menu_word" style="font-size:17px">é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--article"></use></svg> <span class="menu_word" style="font-size:17px">æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guidang1"></use></svg> <span class="menu_word" style="font-size:17px">å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-sekuaibiaoqian"></use></svg> <span class="menu_word" style="font-size:17px">æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-fenlei"></use></svg> <span class="menu_word" style="font-size:17px">åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pinweishenghuo"></use></svg> <span class="menu_word" style="font-size:17px">ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yinle"></use></svg> <span class="menu_word" style="font-size:17px">å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying1"></use></svg> <span class="menu_word" style="font-size:17px">å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-youxishoubing"></use></svg> <span class="menu_word" style="font-size:17px">æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangzi"></use></svg> <span class="menu_word" style="font-size:17px">å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-tubiaozhizuomoban"></use></svg> <span class="menu_word" style="font-size:17px">ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-nvwumao"></use></svg> <span class="menu_word" style="font-size:17px">åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zhifengche"></use></svg> <span class="menu_word" style="font-size:17px">ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shejiaoxinxi"></use></svg> <span class="menu_word" style="font-size:17px">ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pengyouquan"></use></svg> <span class="menu_word" style="font-size:17px">æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-liuyan"></use></svg> <span class="menu_word" style="font-size:17px">ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-lianjie"></use></svg> <span class="menu_word" style="font-size:17px">å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-maoliang"></use></svg> <span class="menu_word" style="font-size:17px">ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qunliaotian"></use></svg> <span class="menu_word" style="font-size:17px">å” å¨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/field/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-love-sign"></use></svg> <span class="menu_word" style="font-size:17px">ä¸ªäººé¢†åŸŸ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-paperplane"></use></svg> <span class="menu_word" style="font-size:17px">å…³äº</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg> <span>æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">è‹ç©¹å¤–å–</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº</span> <time class="post-meta-date-created" datetime="2025-11-10T11:24:19.755Z" title="å‘è¡¨äº 2025-11-10 19:24:19">2025-11-10</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-11-17T02:41:37.836Z" title="æ›´æ–°äº 2025-11-17 10:41:37">2025-11-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">5.1w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>210åˆ†é’Ÿ</span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="day01"><a href="#day01" class="headerlink" title="day01"></a>day01</h1><h2 id="å‰ç«¯ç¯å¢ƒæ­å»º"><a href="#å‰ç«¯ç¯å¢ƒæ­å»º" class="headerlink" title="å‰ç«¯ç¯å¢ƒæ­å»º"></a>å‰ç«¯ç¯å¢ƒæ­å»º</h2><ul><li><p><strong>å‰ç«¯å·¥ç¨‹åŸºäº nginx</strong><br>åœ¨é»‘é©¬æä¾›çš„èµ„æ–™ä¸­æ‰¾åˆ°å‰ç«¯è¿è¡Œçš„nginxï¼Œå°†å…¶ç§»åŠ¨åˆ°ä¸€ä¸ª<code>éä¸­æ–‡ç›®å½•</code>ä¸‹</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221106202239828.png"></div></div><div class="note warning no-icon flat"><ul><li>Nginxç›®å½•å¿…é¡»æ”¾åœ¨æ²¡æœ‰ä¸­æ–‡çš„ç›®å½•ä¸­æ‰èƒ½æ­£å¸¸è¿è¡Œï¼ï¼</li><li>å½“å‰çš„Nginxçš„é…ç½®æ–‡ä»¶å·²ç»é…ç½®äº†åå‘ä»£ç†ï¼Œé€šè¿‡æ­¤é…ç½®å¯ä»¥å°†å‰ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚</li></ul></div></li><li><p><strong>å¯åŠ¨nginxï¼Œè®¿é—®æµ‹è¯•</strong><br>åŒå‡»nginx.exeå³å¯å¯åŠ¨nginxæœåŠ¡ï¼Œé»˜è®¤è®¿é—®ç«¯å£ä¸º80ã€‚<br><a target="_blank" rel="noopener" href="http://localhost:80">http://localhost:80</a></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221106202720190.png"></div></div><details class="folding-tag"><summary>80ç«¯å£è¢«å ç”¨</summary><div class="content"><ul><li>å¦‚æœè®¿é—®é¡µé¢æ˜¯ä»¥ä¸‹é¡µé¢ï¼Œè¯´æ˜80ç«¯å£è¢«IISå ç”¨ï¼Œæ­¤æ—¶é€‰æ‹©å…³é—­IISæœåŠ¡<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251110193721.png"></div></div></li></ul><ol><li>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmd</li><li>è¾“å…¥<code>net stop http</code></li><li>æç¤ºæ˜¯å¦åœæ­¢è¯¥æœåŠ¡æ—¶ï¼Œè¾“å…¥<code>Y</code></li><li>å®Œæˆåè¾“å…¥<code>sc config http start=disabled</code></li><li>é‡æ–°è®¿é—®<a target="_blank" rel="noopener" href="http://localhost:80">http://localhost:80</a>ï¼Œå³å¯æ­£å¸¸è®¿é—®å‰ç«¯é¡µé¢ã€‚</li></ol></div></details></li></ul><h2 id="åç«¯ç¯å¢ƒæ­å»º"><a href="#åç«¯ç¯å¢ƒæ­å»º" class="headerlink" title="åç«¯ç¯å¢ƒæ­å»º"></a>åç«¯ç¯å¢ƒæ­å»º</h2><h3 id="ç†Ÿæ‚‰é¡¹ç›®ç»“æ„"><a href="#ç†Ÿæ‚‰é¡¹ç›®ç»“æ„" class="headerlink" title="ç†Ÿæ‚‰é¡¹ç›®ç»“æ„"></a>ç†Ÿæ‚‰é¡¹ç›®ç»“æ„</h3><p>å¯¼å…¥åç«¯èµ„æ–™åˆ°IDEAä¸­<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107092342140.png"></div></div><p></p><div class="table-container"><table><thead><tr><th><strong>åºå·</strong></th><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>1</td><td>sky-take-out</td><td>mavençˆ¶å·¥ç¨‹ï¼Œç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼Œèšåˆå…¶ä»–å­æ¨¡å—</td></tr><tr><td>2</td><td>sky-common</td><td>å­æ¨¡å—ï¼Œå­˜æ”¾å…¬å…±ç±»ï¼Œä¾‹å¦‚ï¼šå·¥å…·ç±»ã€å¸¸é‡ç±»ã€å¼‚å¸¸ç±»ç­‰</td></tr><tr><td>3</td><td>sky-pojo</td><td>å­æ¨¡å—ï¼Œå­˜æ”¾å®ä½“ç±»ã€VOã€DTOç­‰</td></tr><tr><td>4</td><td>sky-server</td><td>å­æ¨¡å—ï¼Œåç«¯æœåŠ¡ï¼Œå­˜æ”¾é…ç½®æ–‡ä»¶ã€Controllerã€Serviceã€Mapperç­‰</td></tr></tbody></table></div><ul><li><p><strong>sky-common:</strong> æ¨¡å—ä¸­å­˜æ”¾çš„æ˜¯å…¬å…±ç±»ï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107093606590.png"></div></div><p>sky-commonæ¨¡å—çš„æ¯ä¸ªåŒ…çš„ä½œç”¨ï¼š<br>| åç§° | è¯´æ˜ |<br>| â€”â€”â€”â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| constant | å­˜æ”¾ç›¸å…³å¸¸é‡ç±» |<br>| context | å­˜æ”¾ä¸Šä¸‹æ–‡ç±» |<br>| enumeration | é¡¹ç›®çš„æšä¸¾ç±»å­˜å‚¨ |<br>| exception | å­˜æ”¾è‡ªå®šä¹‰å¼‚å¸¸ç±» |<br>| json | å¤„ç†jsonè½¬æ¢çš„ç±» |<br>| properties | å­˜æ”¾SpringBootç›¸å…³çš„é…ç½®å±æ€§ç±» |<br>| result | è¿”å›ç»“æœç±»çš„å°è£… |<br>| utils | å¸¸ç”¨å·¥å…·ç±» |</p></li><li><p><strong>sky-pojo:</strong> æ¨¡å—ä¸­å­˜æ”¾çš„æ˜¯ä¸€äº› entityã€DTOã€VO</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107094611987.png"></div></div><p>sky-pojoæ¨¡å—çš„æ¯ä¸ªåŒ…çš„ä½œç”¨ï¼š</p></li></ul><div class="table-container"><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Entity</td><td>å®ä½“ï¼Œé€šå¸¸å’Œæ•°æ®åº“ä¸­çš„è¡¨å¯¹åº”</td></tr><tr><td>DTO</td><td>æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œé€šå¸¸ç”¨äºç¨‹åºä¸­å„å±‚ä¹‹é—´ä¼ é€’æ•°æ®</td></tr><tr><td>VO</td><td>è§†å›¾å¯¹è±¡ï¼Œä¸ºå‰ç«¯å±•ç¤ºæ•°æ®æä¾›çš„å¯¹è±¡</td></tr><tr><td>POJO</td><td>æ™®é€šJavaå¯¹è±¡ï¼Œåªæœ‰å±æ€§å’Œå¯¹åº”çš„getterå’Œsetter</td></tr></tbody></table></div><ul><li><strong>sky-server:</strong> æ¨¡å—ä¸­å­˜æ”¾çš„æ˜¯ é…ç½®æ–‡ä»¶ã€é…ç½®ç±»ã€æ‹¦æˆªå™¨ã€controllerã€serviceã€mapperã€å¯åŠ¨ç±»ç­‰</li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107094852361.png"></div></div><p>sky-serveræ¨¡å—çš„æ¯ä¸ªåŒ…çš„ä½œç”¨ï¼š</p><div class="table-container"><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>config</td><td>å­˜æ”¾é…ç½®ç±»</td></tr><tr><td>controller</td><td>å­˜æ”¾controllerç±»</td></tr><tr><td>interceptor</td><td>å­˜æ”¾æ‹¦æˆªå™¨ç±»</td></tr><tr><td>mapper</td><td>å­˜æ”¾mapperæ¥å£</td></tr><tr><td>service</td><td>å­˜æ”¾serviceç±»</td></tr><tr><td>SkyApplication</td><td>å¯åŠ¨ç±»</td></tr></tbody></table></div><h3 id="æ•°æ®åº“ç¯å¢ƒæ­å»º"><a href="#æ•°æ®åº“ç¯å¢ƒæ­å»º" class="headerlink" title="æ•°æ®åº“ç¯å¢ƒæ­å»º"></a>æ•°æ®åº“ç¯å¢ƒæ­å»º</h3><ul><li><p>ä½¿ç”¨navicateæ‰“å¼€èµ„æ–™ä¸­çš„sqlæ–‡ä»¶å¹¶æ‰§è¡Œï¼Œåˆ›å»ºæ•°æ®åº“</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107101030138.png"></div></div></li><li><p>æ‰§è¡Œå®Œæ¯•åï¼Œå…±åˆ›å»ºäº†11å¼ è¡¨</p><div class="tabs" id="åç«¯ç¯å¢ƒæ­å»º-æ•°æ®åº“ç¯å¢ƒæ­å»º"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åç«¯ç¯å¢ƒæ­å»º-æ•°æ®åº“ç¯å¢ƒæ­å»º-1">åˆ›å»ºè¡¨</button></li><li class="tab"><button type="button" data-href="#åç«¯ç¯å¢ƒæ­å»º-æ•°æ®åº“ç¯å¢ƒæ­å»º-2">è¡¨è¯´æ˜</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åç«¯ç¯å¢ƒæ­å»º-æ•°æ®åº“ç¯å¢ƒæ­å»º-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111145316.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åç«¯ç¯å¢ƒæ­å»º-æ•°æ®åº“ç¯å¢ƒæ­å»º-2"><div class="table-container"><table><thead><tr><th><strong>åºå·</strong></th><th><strong>è¡¨å</strong></th><th><strong>ä¸­æ–‡å</strong></th></tr></thead><tbody><tr><td>1</td><td>employee</td><td>å‘˜å·¥è¡¨</td></tr><tr><td>2</td><td>category</td><td>åˆ†ç±»è¡¨</td></tr><tr><td>3</td><td>dish</td><td>èœå“è¡¨</td></tr><tr><td>4</td><td>dish_flavor</td><td>èœå“å£å‘³è¡¨</td></tr><tr><td>5</td><td>setmeal</td><td>å¥—é¤è¡¨</td></tr><tr><td>6</td><td>setmeal_dish</td><td>å¥—é¤èœå“å…³ç³»è¡¨</td></tr><tr><td>7</td><td>user</td><td>ç”¨æˆ·è¡¨</td></tr><tr><td>8</td><td>address_book</td><td>åœ°å€è¡¨</td></tr><tr><td>9</td><td>shopping_cart</td><td>è´­ç‰©è½¦è¡¨</td></tr><tr><td>10</td><td>orders</td><td>è®¢å•è¡¨</td></tr><tr><td>11</td><td>order_detail</td><td>è®¢å•æ˜ç»†è¡¨</td></tr></tbody></table></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>è¿™é‡Œåªç®€å•äº†è§£æœ‰å“ªäº›è¡¨ï¼Œåœ¨æä¾›çš„èµ„æ–™ä¸­çš„<code>æ•°æ®åº“è®¾è®¡æ–‡æ¡£</code>ä¸­å¯¹è¡¨çš„ç»“æ„å’Œå­—æ®µæœ‰è¯¦ç»†ä»‹ç»</p></li></ul><h3 id="å‰åç«¯è”è°ƒ"><a href="#å‰åç«¯è”è°ƒ" class="headerlink" title="å‰åç«¯è”è°ƒ"></a>å‰åç«¯è”è°ƒ</h3><p>åç«¯çš„åˆå§‹å·¥ç¨‹ä¸­å·²ç»å®ç°äº†<strong>ç™»å½•</strong>åŠŸèƒ½ï¼Œç›´æ¥è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•å³å¯(åˆ«å¿˜äº†åˆ°ymlæ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œå¦åˆ™ä¼šç™»å½•å¤±è´¥)<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111150853.png"></div></div><br>å®ç°æ€è·¯ï¼š<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107110539832.png"></div></div><p></p><h3 id="nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡"><a href="#nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡" class="headerlink" title="nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡"></a>nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡</h3><div class="note info no-icon flat"><p><strong>æ€è€ƒï¼šå‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œæ˜¯å¦‚ä½•è¯·æ±‚åˆ°åç«¯æœåŠ¡çš„ï¼Ÿ</strong></p><ul><li>å‰ç«¯è¯·æ±‚åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://localhost/api/employee/login">http://localhost/api/employee/login</a></li><li>åç«¯æ¥å£åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://localhost:8080/admin/employee/login">http://localhost:8080/admin/employee/login</a></li></ul></div><div class="tabs" id="nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡-1">å‰ç«¯è¯·æ±‚åœ°å€</button></li><li class="tab"><button type="button" data-href="#nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡-2">åç«¯æ¥å£åœ°å€</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107151607921.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107151623005.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="nginxåå‘ä»£ç†"><a href="#nginxåå‘ä»£ç†" class="headerlink" title="nginxåå‘ä»£ç†"></a>nginxåå‘ä»£ç†</h4><p>nginxåå‘ä»£ç†å°±æ˜¯å°†å‰ç«¯å‘é€çš„åŠ¨æ€è¯·æ±‚é€šè¿‡nginxè½¬å‘åˆ°åç«¯æœåŠ¡å™¨<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107152112092.png"></div></div><p></p><p><strong><em>nginxåå‘ä»£ç†çš„å¥½å¤„ï¼š</em></strong></p><ul><li><strong>æé«˜è®¿é—®é€Ÿåº¦</strong><ul><li>å› ä¸ºnginxæœ¬èº«å¯ä»¥ç¼“å­˜ï¼Œå¦‚æœè®¿é—®åŒä¸€æ¥å£å¹¶åšäº†æ•°æ®ç¼“å­˜ï¼Œæ­¤æ—¶åˆ™ä¸éœ€è¦è®¿é—®æœåŠ¡ç«¯ï¼Œnginxå°±å¯ä»¥ç›´æ¥è¿”å›æ•°æ®ï¼Œè¿›è€Œæé«˜äº†è®¿é—®é€Ÿåº¦</li></ul></li><li><strong>è¿›è¡Œè´Ÿè½½å‡è¡¡</strong><ul><li>è´Ÿè½½å‡è¡¡å°±æ˜¯å°†å¤§é‡è¯·æ±‚æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ–¹å¼å‡è¡¡çš„åˆ†é…ç»™é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨</li></ul></li><li><strong>ä¿è¯åç«¯æœåŠ¡å®‰å…¨</strong><ul><li>ä¸æš´éœ²åç«¯æœåŠ¡åœ°å€ï¼Œå°†nginxä½œä¸ºè¯·æ±‚è®¿é—®çš„å…¥å£ï¼Œåˆ°è¾¾nginxåè½¬å‘åˆ°å…·ä½“çš„åç«¯æœåŠ¡å™¨ï¼Œä»è€Œä¿è¯åç«¯æœåŠ¡å™¨çš„å®‰å…¨</li></ul></li></ul><p><strong><em>nginxåå‘ä»£ç†çš„é…ç½®æ–¹å¼ï¼š</em></strong></p><ul><li>åœ¨nginxç›®å½•ä¸‹ï¼Œä¿®æ”¹nginx.configæ–‡ä»¶<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    </span><br><span class="line">    # å½“è®¿é—® http://localhost:80/api/../.. è¿™æ ·çš„æ¥å£çš„æ—¶å€™ï¼Œå®ƒä¼šé€šè¿‡ location /api/ &#123;&#125; è¿™æ ·çš„åå‘ä»£ç†åˆ° http://localhost:8080/admin/ä¸Šæ¥ã€‚</span><br><span class="line">    location /api/&#123;</span><br><span class="line">        proxy_pass http://localhost:8080/admin/; #åå‘ä»£ç†</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><strong>proxy_passï¼š</strong>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥è®¾ç½®ä»£ç†æœåŠ¡å™¨çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸»æœºåç§°ï¼ŒIPåœ°å€åŠ ç«¯å£å·ç­‰å½¢å¼ã€‚</li></ul><h4 id="nginxè´Ÿè½½å‡è¡¡"><a href="#nginxè´Ÿè½½å‡è¡¡" class="headerlink" title="nginxè´Ÿè½½å‡è¡¡"></a>nginxè´Ÿè½½å‡è¡¡</h4><p>å½“æœåŠ¡ä»¥é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²æ—¶ï¼Œnginxåœ¨è½¬å‘è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶å°±éœ€è¦åšç›¸åº”çš„è´Ÿè½½å‡è¡¡ã€‚è´Ÿè½½å‡è¡¡ä»æœ¬è´¨ä¸Šæ¥è¯´ä¹Ÿæ˜¯åŸºäºåå‘ä»£ç†æ¥å®ç°çš„ï¼Œæœ€ç»ˆæ•ˆæœéƒ½æ˜¯è½¬å‘è¯·æ±‚</p><p><strong><em>nginxè´Ÿè½½å‡è¡¡é…ç½®æ–¹å¼ï¼š</em></strong><br></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    # å£°æ˜äº†ä¸¤ç»„æœåŠ¡å™¨</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    </span><br><span class="line">    location /api/&#123;</span><br><span class="line">        proxy_pass http://webservers/admin; #è´Ÿè½½å‡è¡¡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>upstreamï¼š</strong> å¦‚æœä»£ç†æœåŠ¡å™¨æ˜¯ä¸€ç»„æœåŠ¡å™¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨upstreamæŒ‡ä»¤é…ç½®åç«¯æœåŠ¡å™¨ç»„ã€‚<br><strong>æ³¨ï¼š</strong> upstreamåé¢çš„åç§°å¯è‡ªå®šä¹‰ï¼Œä½†è¦ä¸Šä¸‹ä¿æŒä¸€è‡´ã€‚<p></p><div class="note info no-icon flat"><p>ä»¥ä¸Šé…ç½®çš„å«ä¹‰æ˜¯ï¼šç›‘å¬80ç«¯å£å·ï¼Œå½“è®¿é—®<code>http://localhost:80/api/../..</code>è¿™æ ·çš„æ¥å£æ—¶ï¼Œä¾¿ä¼šé€šè¿‡ <code>location /api/ {}</code> è¿™æ ·çš„åå‘ä»£ç†åˆ° <code>http://webservers/admin</code>ï¼Œæ ¹æ®<code>webservers</code>åç§°æ‰¾åˆ°ä¸€ç»„æœåŠ¡å™¨ï¼Œæ ¹æ®è®¾ç½®çš„<code>è´Ÿè½½å‡è¡¡ç­–ç•¥</code>(é»˜è®¤æ˜¯è½®è¯¢)è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡å™¨ã€‚</p></div><p><strong>è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼š</strong></p><div class="table-container"><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>è½®è¯¢</td><td>é»˜è®¤æ–¹å¼</td></tr><tr><td>weight</td><td>æƒé‡æ–¹å¼ï¼Œé»˜è®¤ä¸º1ï¼Œæƒé‡è¶Šé«˜ï¼Œè¢«åˆ†é…çš„å®¢æˆ·ç«¯è¯·æ±‚å°±è¶Šå¤š</td></tr><tr><td>ip_hash</td><td>ä¾æ®ipåˆ†é…æ–¹å¼ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å¯ä»¥å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡</td></tr><tr><td>least_conn</td><td>ä¾æ®æœ€å°‘è¿æ¥æ–¹å¼ï¼ŒæŠŠè¯·æ±‚ä¼˜å…ˆåˆ†é…ç»™è¿æ¥æ•°å°‘çš„åç«¯æœåŠ¡</td></tr><tr><td>url_hash</td><td>ä¾æ®urlåˆ†é…æ–¹å¼ï¼Œè¿™æ ·ç›¸åŒçš„urlä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡</td></tr><tr><td>fair</td><td>ä¾æ®å“åº”æ—¶é—´æ–¹å¼ï¼Œå“åº”æ—¶é—´çŸ­çš„æœåŠ¡å°†ä¼šè¢«ä¼˜å…ˆåˆ†é…</td></tr></tbody></table></div><p>å…·ä½“é…ç½®æ–¹å¼ï¼š<br></p><div class="tabs" id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#è´Ÿè½½å‡è¡¡ç­–ç•¥-1">è½®è¯¢</button></li><li class="tab"><button type="button" data-href="#è´Ÿè½½å‡è¡¡ç­–ç•¥-2">weight</button></li><li class="tab"><button type="button" data-href="#è´Ÿè½½å‡è¡¡ç­–ç•¥-3">ip_hash</button></li><li class="tab"><button type="button" data-href="#è´Ÿè½½å‡è¡¡ç­–ç•¥-4">least_conn</button></li><li class="tab"><button type="button" data-href="#è´Ÿè½½å‡è¡¡ç­–ç•¥-5">url_hash</button></li><li class="tab"><button type="button" data-href="#è´Ÿè½½å‡è¡¡ç­–ç•¥-6">fair</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="è´Ÿè½½å‡è¡¡ç­–ç•¥-1"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è´Ÿè½½å‡è¡¡ç­–ç•¥-2"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    server 192.168.100.128:8080 weight=90;</span><br><span class="line">    server 192.168.100.129:8080 weight=10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è´Ÿè½½å‡è¡¡ç­–ç•¥-3"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è´Ÿè½½å‡è¡¡ç­–ç•¥-4"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è´Ÿè½½å‡è¡¡ç­–ç•¥-5"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    hash &amp;request_uri;</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è´Ÿè½½å‡è¡¡ç­–ç•¥-6"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">    fair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p></p><h2 id="å®Œå–„ç™»å½•åŠŸèƒ½"><a href="#å®Œå–„ç™»å½•åŠŸèƒ½" class="headerlink" title="å®Œå–„ç™»å½•åŠŸèƒ½"></a>å®Œå–„ç™»å½•åŠŸèƒ½</h2><div class="note info no-icon flat"><p><strong>éœ€æ±‚:</strong> å‘˜å·¥è¡¨çš„å¯†ç å­—æ®µç›´æ¥æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼Œéœ€è¦å¯¹å¯†ç è¿›è¡ŒåŠ å¯†åï¼Œå†è¿›è¡Œå­˜å‚¨ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107160739680.png"></div></div></div><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><ol><li>æ‰“å¼€æ•°æ®åº“ä¸­çš„employeeè¡¨ï¼Œä¿®æ”¹æ˜æ–‡å¯†ç ä¸ºåŠ å¯†åçš„123456ï¼š<code>e10abc3949ba59abbe56e057f20f883e</code></li><li>ä¿®æ”¹Javaä»£ç ï¼Œå‰ç«¯æäº¤çš„å¯†ç è¿›è¡ŒMD5åŠ å¯†åå†è·Ÿæ•°æ®åº“ä¸­ä¿å­˜çš„å¯†ç è¿›è¡Œæ¯”å¯¹<br>æ‰“å¼€EmployeeServiceImplç±»,ä¿®æ”¹ä»£ç <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘˜å·¥ç™»å½•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeeLoginDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">login</span><span class="params">(EmployeeLoginDTO employeeLoginDTO)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> employeeLoginDTO.getUsername();</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employeeLoginDTO.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®</span></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getByUsername(username);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2ã€å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼ˆç”¨æˆ·åä¸å­˜åœ¨ã€å¯†ç ä¸å¯¹ã€è´¦å·è¢«é”å®šï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (employee == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//è´¦å·ä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccountNotFoundException</span>(MessageConstant.ACCOUNT_NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯†ç æ¯”å¯¹</span></span><br><span class="line">    password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line">    <span class="keyword">if</span> (!password.equals(employee.getPassword())) &#123;</span><br><span class="line">        <span class="comment">//å¯†ç é”™è¯¯</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordErrorException</span>(MessageConstant.PASSWORD_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (employee.getStatus().equals(StatusConstant.DISABLE) ) &#123;</span><br><span class="line">        <span class="comment">//è´¦å·è¢«é”å®š</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccountLockedException</span>(MessageConstant.ACCOUNT_LOCKED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3ã€è¿”å›å®ä½“å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> employee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="å¯¼å…¥æ¥å£æ–‡æ¡£"><a href="#å¯¼å…¥æ¥å£æ–‡æ¡£" class="headerlink" title="å¯¼å…¥æ¥å£æ–‡æ¡£"></a>å¯¼å…¥æ¥å£æ–‡æ¡£</h2><p>è¯¥é¡¹ç›®ä½¿ç”¨çš„å¼€å‘æ–¹å¼æ˜¯å½“å‰ä¼ä¸šä¸»æµçš„<code>å‰åç«¯åˆ†ç¦»å¼€å‘</code>ï¼Œè¯¥æ–¹å¼è¦æ±‚åœ¨å¼€å‘å‰å…ˆå°†æ¥å£å®šä¹‰å¥½ï¼Œè¿™æ ·å‰åç«¯æ‰èƒ½å¹¶è¡Œå¼€å‘ã€‚</p><h3 id="å‰åç«¯åˆ†ç¦»å¼€å‘æµç¨‹"><a href="#å‰åç«¯åˆ†ç¦»å¼€å‘æµç¨‹" class="headerlink" title="å‰åç«¯åˆ†ç¦»å¼€å‘æµç¨‹"></a>å‰åç«¯åˆ†ç¦»å¼€å‘æµç¨‹</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221107181446913.png"></div></div><div class="note info no-icon flat"><p>å¼€å‘æµç¨‹ï¼š</p><ol><li>å®šä¹‰æ¥å£å¹¶ç¡®å®šæ¥å£çš„è·¯å¾„ã€è¯·æ±‚æ–¹å¼ã€ä¼ å…¥å‚æ•°ã€è¿”å›å‚æ•°ã€‚</li><li>å‰ç«¯å¼€å‘äººå‘˜å’Œåç«¯å¼€å‘äººå‘˜å¹¶è¡Œå¼€å‘ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥è‡ªæµ‹</li><li>å‰åç«¯äººå‘˜è¿›è¡Œè”è°ƒæµ‹è¯•</li><li>æäº¤ç»™æµ‹è¯•äººå‘˜è¿›è¡Œæœ€ç»ˆæµ‹è¯•</li></ol></div><h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul><li>è¯¾ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯Yapiï¼Œå› ä¸ºç§ç§åŸå› æ— æ³•ä½¿ç”¨ï¼Œå› æ­¤è¿™é‡Œæ›¿æ¢ä¸ºApiFox</li><li>ApiFoxä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://apifox.com/">https://apifox.com/</a></li></ul><div class="note info no-icon flat"><p>ApiFox -&gt; æ–°å»ºé¡¹ç›® -&gt; é¡¹ç›®ç®¡ç† -&gt; å¯¼å…¥æ•°æ® -&gt; é€‰æ‹©Yapi -&gt; å°†èµ„æ–™ä¸­çš„jsonæ–‡ä»¶å¯¼å…¥</p></div><p>å¯¼å…¥æ•ˆæœï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111170626.png"></div></div><p></p><h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>Swagger</code>æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ–<code>RESTful</code>é£æ ¼çš„WebæœåŠ¡(<a target="_blank" rel="noopener" href="https://swagger.io/">https://swagger.io/</a>)<br><strong>ä½œç”¨ï¼š</strong></p><ol><li>ä½¿å‰åç«¯åˆ†ç¦»å¼€å‘æ›´åŠ æ–¹ä¾¿ï¼Œåˆ©äºå›¢é˜Ÿåä½œ</li><li>æ¥å£æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆï¼Œåç«¯å¼€å‘åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™æ¥å£æ–‡æ¡£</li><li>Springå°†Swaggerçº³å…¥äº†è‡ªèº«æ ‡å‡†ã€‚å¯ä»¥é€šè¿‡åœ¨é¡¹ç›®ä¸­å¼•å…¥Swaggerfoxï¼Œæ¥ç®€å•å¿«æ·çš„ä½¿ç”¨Swagger</li></ol><h3 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h3><div class="note info no-icon flat"><p><code>knife4j</code>æ˜¯ä¸º<code>JavaMVC</code>æ¡†æ¶é›†æˆ<code>Swagger</code>ç”ŸæˆApiæ–‡æ¡£çš„å¢å¼ºè§£å†³æ–¹æ¡ˆ,å‰èº«æ˜¯<code>swagger-bootstrap-ui</code>,å–åkni4jæ˜¯å¸Œæœ›å®ƒèƒ½åƒä¸€æŠŠåŒ•é¦–ä¸€æ ·å°å·§,è½»é‡,å¹¶ä¸”åŠŸèƒ½å¼ºæ‚!</p></div><ol><li>å¯¼å…¥<code>knife4j</code>çš„mavenåæ ‡<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>åœ¨<code>WebMvcConfiguration</code>é…ç½®ç±»ä¸­åŠ å…¥<code>knife4j</code>çš„é…ç½®<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡knife4jç”Ÿæˆæ¥å£æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li>ç»§ç»­åœ¨è¯¥é…ç½®ç±»ä¸‹è®¾ç½®é™æ€èµ„æºæ˜ å°„ï¼Œå¦åˆ™æ— æ³•è®¿é—®<code>knife4j</code>ç”Ÿæˆçš„æ¥å£æ–‡æ¡£<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ¥å£æ–‡æ¡£çš„è®¿é—®åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111174437.png"></div></div><p>è¿˜å¯ä»¥åœ¨è¿™é‡Œç›´æ¥æµ‹è¯•æ¥å£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111174543.png"></div></div><p></p><p><strong>æ€è€ƒï¼š</strong> é€šè¿‡Swaggerå°±å¯ä»¥ç”Ÿæˆæ¥å£æ–‡æ¡£äº†ï¼Œè¿˜éœ€è¦<code>ApiFox</code>å—ï¼Ÿ</p><ol><li><p><code>ApiFox</code>æ˜¯è®¾è®¡é˜¶æ®µä½¿ç”¨çš„å·¥å…·ï¼Œç®¡ç†å’Œç»´æŠ¤æ¥å£</p></li><li><p><code>Swagger</code>æ˜¯åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨çš„æ¡†æ¶ï¼Œå¸®åŠ©åç«¯å¼€å‘äººå‘˜åšåç«¯çš„æ¥å£æµ‹è¯•</p></li></ol><h3 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h3><p>é€šè¿‡æ³¨è§£å¯ä»¥æ§åˆ¶ç”Ÿæˆçš„æ¥å£æ–‡æ¡£ï¼Œä½¿æ¥å£æ–‡æ¡£æ‹¥æœ‰æ›´å¥½çš„å¯è¯»æ€§</p><div class="table-container"><table><thead><tr><th><strong>æ³¨è§£</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>@Api</td><td>ç”¨åœ¨ç±»ä¸Šï¼Œä¾‹å¦‚Controllerï¼Œè¡¨ç¤ºå¯¹ç±»çš„è¯´æ˜</td></tr><tr><td>@ApiModel</td><td>ç”¨åœ¨ç±»ä¸Šï¼Œä¾‹å¦‚entityã€DTOã€VO</td></tr><tr><td>@ApiModelProperty</td><td>ç”¨åœ¨å±æ€§ä¸Šï¼Œæè¿°å±æ€§ä¿¡æ¯</td></tr><tr><td>@ApiOperation</td><td>ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä¾‹å¦‚Controllerçš„æ–¹æ³•ï¼Œè¯´æ˜æ–¹æ³•çš„ç”¨é€”ã€ä½œç”¨</td></tr></tbody></table></div><div class="note warning no-icon flat"><p>é€šè¿‡åœ¨å„ç§ç±»ä¸Šæ·»åŠ ä¸Šè¿°æ³¨è§£ï¼Œç”Ÿæˆæ›´æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´å¥½çš„æ¥å£æ–‡æ¡£(ä¸‹é¢æ·»åŠ çš„æ³¨è§£ï¼Œåœ¨æä¾›çš„èµ„æ–™ä¸­å·²ç»é»˜è®¤æ·»åŠ )</p></div><p><strong>sky-pojoæ¨¡å—ä¸­ï¼š</strong><br></p><div class="tabs" id="swaggerå¸¸ç”¨æ³¨è§£sky-pojoæ¨¡å—"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swaggerå¸¸ç”¨æ³¨è§£sky-pojoæ¨¡å—-1">EmployeeLoginDTO</button></li><li class="tab"><button type="button" data-href="#swaggerå¸¸ç”¨æ³¨è§£sky-pojoæ¨¡å—-2">EmployeeLoginVO</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swaggerå¸¸ç”¨æ³¨è§£sky-pojoæ¨¡å—-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;å‘˜å·¥ç™»å½•æ—¶ä¼ é€’çš„æ•°æ®æ¨¡å‹&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å¯†ç &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swaggerå¸¸ç”¨æ³¨è§£sky-pojoæ¨¡å—-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;å‘˜å·¥ç™»å½•è¿”å›çš„æ•°æ®æ ¼å¼&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeLoginVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ä¸»é”®å€¼&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;jwtä»¤ç‰Œ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p></p><p><strong>sky-serveræ¨¡å—ä¸­:</strong><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘˜å·¥ç®¡ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å‘˜å·¥ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;å‘˜å·¥ç™»å½•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;EmployeeLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeLoginDTO employeeLoginDTO)</span> 	&#123;</span><br><span class="line">        <span class="comment">//..............</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€€å‡º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å‘˜å·¥é€€å‡º&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h1 id="day02"><a href="#day02" class="headerlink" title="day02"></a>day02</h1><h2 id="è¯¾ç¨‹å†…å®¹"><a href="#è¯¾ç¨‹å†…å®¹" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>æ–°å¢å‘˜å·¥</li><li>å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</li><li>å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</li><li>ç¼–è¾‘å‘˜å·¥</li><li>å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç </li></ul><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>å‘˜å·¥ç®¡ç†ã€èœå“åˆ†ç±»ç®¡ç†ã€‚</p><div class="tabs" id="day02åŠŸèƒ½å®ç°"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#day02åŠŸèƒ½å®ç°-1">å‘˜å·¥ç®¡ç†æ•ˆæœ</button></li><li class="tab"><button type="button" data-href="#day02åŠŸèƒ½å®ç°-2">èœå“åˆ†ç±»ç®¡ç†æ•ˆæœ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="day02åŠŸèƒ½å®ç°-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112172846316.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="day02åŠŸèƒ½å®ç°-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112172925354.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="æ–°å¢å‘˜å·¥"><a href="#æ–°å¢å‘˜å·¥" class="headerlink" title="æ–°å¢å‘˜å·¥"></a>æ–°å¢å‘˜å·¥</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç‚¹å‡»æ–°å¢å‘˜å·¥æŒ‰é’®åï¼Œå¼¹å‡ºæ–°å¢å‘˜å·¥çš„å¼¹çª—<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111161120975.png"></div></div><br>å½“å¡«å†™å®Œè¡¨å•ä¿¡æ¯ï¼Œç‚¹å‡»<code>ä¿å­˜</code>æŒ‰é’®åï¼Œä¼šå°†è¡¨å•çš„æ•°æ®æäº¤åˆ°æœåŠ¡ç«¯ï¼Œåœ¨æœåŠ¡ç«¯ä¸­æ¥æ”¶æ•°æ®ï¼Œå¹¶è°ƒç”¨ç›¸å…³æ–¹æ³•ä¿å­˜åˆ°æ•°æ®åº“<p></p><div class="note warning no-icon flat"><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>è´¦å·å¿…é¡»å”¯ä¸€</li><li>æ‰‹æœºå·å¿…é¡»æ˜¯åˆæ³•çš„åä¸€ä½æ•°å­—(1å¼€å¤´ï¼Œä¸”ç¬¬äºŒä½æ•°å­—ä¸ä¸º2)</li><li>èº«ä»½è¯å·ä¸ºåˆæ³•çš„18ä½æ•°å­—(å‰17ä½ä¸ºæ•°å­—ï¼Œæœ€åä¸€ä½ä¸ºæ•°å­—æˆ–X)</li><li>å¯†ç é»˜è®¤ä¸º123456</li></ol></div><p>åœ¨èµ„æ–™ä¸­æ‰¾åˆ°<code>é¡¹ç›®æ¥å£æ–‡æ¡£</code> -&gt; <code>è‹ç©¹å¤–å–-ç®¡ç†ç«¯æ¥å£.html</code><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111162912753.png"></div></div><br>æ˜ç¡®æ–°å¢å‘˜å·¥æ¥å£çš„<strong>è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹å¼ã€è¯·æ±‚å‚æ•°ã€è¿”å›æ•°æ®</strong><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111162930483.png"></div></div><p></p><div class="note danger no-icon flat"><p>æœ¬é¡¹ç›®çº¦å®šï¼š</p><ul><li><strong>ç®¡ç†ç«¯</strong> å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨ <strong>/admin</strong> ä½œä¸ºå‰ç¼€ã€‚</li><li><strong>ç”¨æˆ·ç«¯</strong> å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨ <strong>/user</strong> ä½œä¸ºå‰ç¼€ã€‚</li></ul></div><h3 id="ä»£ç å¼€å‘"><a href="#ä»£ç å¼€å‘" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="è®¾ç½®DTOç±»"><a href="#è®¾ç½®DTOç±»" class="headerlink" title="è®¾ç½®DTOç±»"></a>è®¾ç½®DTOç±»</h4><p><strong>æ ¹æ®æ¥å£æ¥è®¾è®¡å¯¹åº”çš„DTO</strong><br>å‰ç«¯ä¼ é€’å‚æ•°åˆ—è¡¨ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111164002448.png"></div></div><br><div class="note info no-icon flat"><p><strong>æ€è€ƒï¼š</strong> ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨å¯¹åº”å®ä½“ç±»ï¼Œè¿˜è¦ä¸“é—¨å°è£…DTOç±»ï¼Ÿ</p></div><p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111164453341.png"></div></div><p>å½“å‰ç«¯æäº¤æ•°æ®å’Œå®ä½“ç±»ä¸­å¯¹åº”å±æ€§å·®åˆ«è¾ƒå¤§æ—¶ï¼Œå»ºè®®ä½¿ç”¨DTOæ¥å°è£…æ•°æ®<br>åœ¨sky-pojoæ¨¡å—ä¸­å·²ç»å®šä¹‰äº†<code>EmployeeDTO</code>ç±»<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="åˆ›å»ºæ¥å£å’Œå®ç°ç±»"><a href="#åˆ›å»ºæ¥å£å’Œå®ç°ç±»" class="headerlink" title="åˆ›å»ºæ¥å£å’Œå®ç°ç±»"></a>åˆ›å»ºæ¥å£å’Œå®ç°ç±»</h4><p><strong>Controllerå±‚</strong></p><p>åœ¨sky-serveræ¨¡å—çš„<code>EmployeeController</code>ç±»ä¸­åˆ›å»ºæ–°å¢å‘˜å·¥æ–¹æ³•ï¼Œæ¥æ”¶å‰ç«¯æäº¤çš„å‚æ•°<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢å‘˜å·¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢å‘˜å·¥&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ–°å¢å‘˜å·¥ï¼š&#123;&#125;&quot;</span>,employeeDTO);</span><br><span class="line">    employeeService.save(employeeDTO);<span class="comment">//è¯¥æ–¹æ³•åç»­æ­¥éª¤ä¼šå®šä¹‰</span></span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><div class="note warning no-icon flat"><p><strong>æ³¨ï¼š</strong> Resultç±»å®šä¹‰äº†åç«¯ç»Ÿä¸€è¿”å›ç»“æœæ ¼å¼ã€‚</p></div><p></p><p>åœ¨sky-commonæ¨¡å—çš„com.sky.resultåŒ…ä¸­å®šä¹‰äº†Resultç±»ç”¨æ¥ç»Ÿä¸€è¿”å›ç»“æœæ ¼å¼<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åç«¯ç»Ÿä¸€è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.data = object;</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.msg = msg;</span><br><span class="line">        result.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚æ¥å£</strong></p><p>åœ¨sky-serveræ¨¡å—çš„com.sky.server.EmployeeServiceä¸­å£°æ˜æ–°å¢å‘˜å·¥æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢å‘˜å·¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span>;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚å®ç°ç±»</strong></p><p>åœ¨sky-serveræ¨¡å—çš„com.sky.server.impl.EmployeeServiceImplä¸­å®ç°æ–°å¢å‘˜å·¥æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹è±¡å±æ€§æ‹·è´</span></span><br><span class="line">        BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è´¦å·çš„çŠ¶æ€ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ 1è¡¨ç¤ºæ­£å¸¸ 0è¡¨ç¤ºé”å®š</span></span><br><span class="line">        employee.setStatus(StatusConstant.ENABLE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å¯†ç ï¼Œé»˜è®¤å¯†ç 123456</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´</span></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰è®°å½•åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line">        employee.setCreateUser(<span class="number">10L</span>);<span class="comment">//ç›®å‰å†™ä¸ªå‡æ•°æ®ï¼ŒåæœŸä¿®æ”¹</span></span><br><span class="line">        employee.setUpdateUser(<span class="number">10L</span>);</span><br><span class="line"></span><br><span class="line">        employeeMapper.insert(employee);<span class="comment">//åç»­æ­¥éª¤å®šä¹‰</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Mapperå±‚</strong><br>åœ¨EmployeeMapperæ¥å£ä¸­æ·»åŠ æ–°å¢å‘˜å·¥æ–¹æ³•ï¼Œå¹¶é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥æ˜ å°„SQLè¯­å¥<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥å‘˜å·¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into employee (name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user,status) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;values &quot; +</span></span><br><span class="line"><span class="meta">            &quot;(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><br><div class="note warning no-icon flat"><p>åœ¨application.ymlä¸­å·²å¼€å¯é©¼å³°å‘½åï¼Œæ•…id_numberå’ŒidNumberå¯å¯¹åº”ã€‚</p></div><p></p><h3 id="åŠŸèƒ½æµ‹è¯•"><a href="#åŠŸèƒ½æµ‹è¯•" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p><strong>åŠŸèƒ½æµ‹è¯•å®ç°æ–¹å¼ï¼š</strong></p><ul><li>é€šè¿‡æ¥å£æ–‡æ¡£æµ‹è¯•</li><li>é€šå‰åç«¯è”è°ƒæµ‹è¯•</li></ul><h4 id="æ¥å£æ–‡æ¡£æµ‹è¯•"><a href="#æ¥å£æ–‡æ¡£æµ‹è¯•" class="headerlink" title="æ¥å£æ–‡æ¡£æµ‹è¯•"></a>æ¥å£æ–‡æ¡£æµ‹è¯•</h4><p><strong>å¯åŠ¨æœåŠ¡ï¼š</strong>è®¿é—®[<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html][http://localhost:8080/doc.html]ï¼Œè¿›å…¥æ–°å¢å‘˜å·¥æ¥å£">http://localhost:8080/doc.html][http://localhost:8080/doc.html]ï¼Œè¿›å…¥æ–°å¢å‘˜å·¥æ¥å£</a></p><p>Jsonæ•°æ®ï¼š<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;111222333444555666&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaozhi&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13812344321&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°æ™º&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>å‘é€è¯·æ±‚åï¼Œè¿”å›çš„å“åº”ç æ˜¯401æŠ¥é”™<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111185046.png"></div></div><br>é€šè¿‡æ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯å¯ä»¥çŸ¥é“æ˜¯<code>JwtTokenAdminInterceptor</code>æ‹¦æˆªå™¨å‡ºç°çš„é—®é¢˜<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251111194813.png"></div></div><br><div class="note warning no-icon flat"><p><strong>æŠ¥é”™åŸå› ï¼š</strong> JWTä»¤ç‰Œå¤±æ•ˆå¯¼è‡´<code>EmployeeController</code>çš„<code>save</code>æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨<br><strong>è§£å†³æ–¹æ³•ï¼š</strong> è°ƒç”¨å‘˜å·¥ç™»å½•æ¥å£è·å¾—ä¸€ä¸ªåˆæ³•çš„JWTä»¤ç‰Œ</p></div><p></p><p><strong>è·å¾—ä»¤ç‰Œï¼š</strong><br>ä½¿ç”¨adminç”¨æˆ·ç™»å½•è·å–ä»¤ç‰Œ<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111185649636.png"></div></div><p></p><p><strong>æ·»åŠ ä»¤ç‰Œï¼š</strong></p><p>å°†åˆæ³•çš„JWTä»¤ç‰Œæ·»åŠ åˆ°å…¨å±€å‚æ•°ä¸­<br>æ–‡æ¡£ç®¡ç†â€”&gt;å…¨å±€å‚æ•°è®¾ç½®â€”&gt;æ·»åŠ å‚æ•°</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111185901726.png"></div></div><p><strong>æ¥å£æµ‹è¯•ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111190132481.png"></div></div><br>å…¶ä¸­ï¼Œè¯·æ±‚å¤´éƒ¨å«æœ‰JWTä»¤ç‰Œ<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111190248268.png"></div></div><p></p><h4 id="å‰åç«¯è”è°ƒæµ‹è¯•"><a href="#å‰åç«¯è”è°ƒæµ‹è¯•" class="headerlink" title="å‰åç«¯è”è°ƒæµ‹è¯•"></a>å‰åç«¯è”è°ƒæµ‹è¯•</h4><p>å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®<a href="localhost">localhost</a>ï¼Œå°±èƒ½è®¿é—®åˆ°ç™»å½•ç•Œé¢<br>ç™»å½• -&gt; å‘˜å·¥ç®¡ç† -&gt; æ·»åŠ å‘˜å·¥</p><div class="note warning no-icon flat"><p>æœŸé—´å¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ä¸å¿…å¤„ç†ï¼Œå› ä¸ºé‚£æ˜¯åˆ†é¡µæŸ¥è¯¢æ²¡æœ‰å®Œæˆçš„é—®é¢˜</p></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111192339271.png"></div></div><p>å¡«å†™ä¿¡æ¯å¹¶ä¿å­˜åå°±å¯ä»¥åœ¨æ•°æ®åº“ä¸­çœ‹åˆ°å¯¹åº”çš„ä¿¡æ¯äº†<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111192446950.png"></div></div><p></p><div class="note warning no-icon flat"><p>ç”±äºå¼€å‘é˜¶æ®µå‰ç«¯å’Œåç«¯æ˜¯å¹¶è¡Œå¼€å‘çš„ï¼Œåç«¯å®ŒæˆæŸä¸ªåŠŸèƒ½åï¼Œæ­¤æ—¶å‰ç«¯å¯¹åº”çš„åŠŸèƒ½å¯èƒ½è¿˜æ²¡æœ‰å¼€å‘å®Œæˆï¼Œå¯¼è‡´æ— æ³•è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•ã€‚<strong>æ‰€ä»¥åœ¨å¼€å‘é˜¶æ®µï¼Œåç«¯æµ‹è¯•ä¸»è¦ä»¥æ¥å£æ–‡æ¡£æµ‹è¯•ä¸ºä¸»ã€‚</strong></p></div><h3 id="ä»£ç å®Œå–„"><a href="#ä»£ç å®Œå–„" class="headerlink" title="ä»£ç å®Œå–„"></a>ä»£ç å®Œå–„</h3><p>ç›®å‰å­˜åœ¨çš„é—®é¢˜ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ol><li>å¦‚æœå½•å…¥çš„ç”¨æˆ·åå·²å­˜åœ¨ï¼ŒæŠ¥å‡ºçš„å¼‚å¸¸æ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡º</li><li>æ–°å¢å‘˜å·¥æ—¶ï¼Œç°åœ¨æ˜¯å°†åˆ›å»ºäººå’Œä¿®æ”¹äººçš„idè®¾ç½®ä¸ºå›ºå®šå€¼ï¼ŒåæœŸéœ€è¦æ ¹æ®ç™»å½•ç”¨æˆ·æ¥åŠ¨æ€è®¾ç½®</li></ol><h4 id="é—®é¢˜ä¸€"><a href="#é—®é¢˜ä¸€" class="headerlink" title="é—®é¢˜ä¸€"></a>é—®é¢˜ä¸€</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong> æ•°æ®åº“ä¸­usernameå­—æ®µè®¾ç½®äº†å”¯ä¸€ç´¢å¼•ï¼Œå½“ç”¨æˆ·å½•å…¥çš„ç”¨æˆ·åå·²å­˜åœ¨æ—¶ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸è€Œæ²¡æœ‰è¿›è¡Œå¤„ç†</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112121152.png"></div></div><p><strong>è§£å†³æ–¹æ³•ï¼š</strong> æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†å™¨</p><p>åœ¨sky-serveræ¨¡å—çš„com.sky.handeråŒ…ä¸‹æœ‰ä¸€ä¸ªGlobalExceptionHandlerç±»ï¼Œç”¨äºå¤„ç†å…¨å±€å¼‚å¸¸ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ç”¨äºå¤„ç†SQLå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†SQLå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">        <span class="comment">//Duplicate entry &#x27;zhangsan&#x27; for key &#x27;employee.idx_username&#x27;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">        <span class="keyword">if</span>(message.contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] split = message.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> split[<span class="number">2</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> username + MessageConstant.ALREADY_EXISTS;</span><br><span class="line">            <span class="keyword">return</span> Result.error(msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨sky-commonæ¨¡å—çš„MessageConstantç±»ä¸­æ·»åŠ ä»¥ä¸‹å¸¸é‡<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALREADY_EXISTS</span> <span class="operator">=</span> <span class="string">&quot;å·²å­˜åœ¨&quot;</span>;</span><br></pre></td></tr></table></figure><p></p><p>æ­¤æ—¶é‡å¯æœåŠ¡å™¨ï¼Œå†æ¬¡æ·»åŠ ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç”¨æˆ·åï¼Œå°±ä¼šè¿”å›å·²å­˜åœ¨çš„é”™è¯¯ä¿¡æ¯äº†<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112122002.png"></div></div><p></p><h4 id="é—®é¢˜äºŒ"><a href="#é—®é¢˜äºŒ" class="headerlink" title="é—®é¢˜äºŒ"></a>é—®é¢˜äºŒ</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong> æ–°å¢å‘˜å·¥æ—¶ï¼Œç°åœ¨æ˜¯å°†åˆ›å»ºäººå’Œä¿®æ”¹äººçš„idè®¾ç½®ä¸ºå›ºå®šå€¼ï¼ŒåæœŸéœ€è¦æ ¹æ®ç™»å½•ç”¨æˆ·æ¥åŠ¨æ€è®¾ç½®<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹è±¡å±æ€§æ‹·è´</span></span><br><span class="line">        BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è´¦å·çš„çŠ¶æ€ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ 1è¡¨ç¤ºæ­£å¸¸ 0è¡¨ç¤ºé”å®š</span></span><br><span class="line">        employee.setStatus(StatusConstant.ENABLE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å¯†ç ï¼Œé»˜è®¤å¯†ç 123456</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´</span></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰è®°å½•åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line">        employee.setCreateUser(<span class="number">10L</span>);<span class="comment">//ç›®å‰å†™ä¸ªå‡æ•°æ®ï¼ŒåæœŸä¿®æ”¹</span></span><br><span class="line">        employee.setUpdateUser(<span class="number">10L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åç»­æ­¥éª¤å®šä¹‰</span></span><br><span class="line">        employeeMapper.insert(employee);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong> é€šè¿‡æŸç§æ–¹å¼åŠ¨æ€è·å–å½“å‰å‘˜å·¥çš„id<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111201922482.png"></div></div><br>å‘˜å·¥ç™»å½•æˆåŠŸåå°±ä¼šç”ŸæˆJWTä»¤ç‰Œå¹¶å“åº”ç»™å‰ç«¯<p></p><p>åœ¨EmployeeControllerçš„loginæ–¹æ³•ä¸­å·²ç»æ·»åŠ è¿‡ä»¥ä¸‹ç”ŸæˆJWTä»¤ç‰Œçš„ä»£ç <br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å‘˜å·¥ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;å‘˜å·¥ç™»å½•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;EmployeeLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeLoginDTO employeeLoginDTO)</span> &#123;</span><br><span class="line">        <span class="comment">//.........</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç™»å½•æˆåŠŸåï¼Œç”Ÿæˆjwtä»¤ç‰Œ</span></span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claims.put(JwtClaimsConstant.EMP_ID, employee.getId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(</span><br><span class="line">                jwtProperties.getAdminSecretKey(),</span><br><span class="line">                jwtProperties.getAdminTtl(),</span><br><span class="line">                claims);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//............</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(employeeLoginVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨åç»­è¯·æ±‚ä¸­ï¼Œå‰ç«¯éƒ½ä¼šæºå¸¦JWTä»¤ç‰Œï¼Œé€šè¿‡JWTä»¤ç‰Œå¯ä»¥è§£æå‡ºå½“å‰å‘˜å·¥çš„id(è¯¥æ–¹æ³•å†™åœ¨sky-serveræ¨¡å—ä¸­çš„com.sky.interceptoråŒ…ä¸‹)<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jwtä»¤ç‰Œæ ¡éªŒçš„æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenAdminInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒjwt</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       </span><br><span class="line">		<span class="comment">//..............</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1ã€ä»è¯·æ±‚å¤´ä¸­è·å–ä»¤ç‰Œ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(jwtProperties.getAdminTokenName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€æ ¡éªŒä»¤ç‰Œ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;jwtæ ¡éªŒ:&#123;&#125;&quot;</span>, token);</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(jwtProperties.getAdminSecretKey(), token);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.EMP_ID).toString());</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰å‘˜å·¥idï¼š&quot;</span>, empId);</span><br><span class="line">            <span class="comment">//3ã€é€šè¿‡ï¼Œæ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">//4ã€ä¸é€šè¿‡ï¼Œå“åº”401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info no-icon flat"><p><strong>æ€è€ƒï¼š</strong> å…‰æ˜¯è§£æå‡ºå‘˜å·¥idï¼Œå¦‚ä½•ä¼ é€’ç»™Serviceçš„saveæ–¹æ³•å‘¢ï¼Ÿ<br>é€šè¿‡ThreadLocalæ¥ä¼ é€’</p></div><h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><p><strong>ç®€ä»‹ï¼š</strong><br><code>ThreadLocal</code>å¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªThreadçš„<code>å±€éƒ¨å˜é‡</code><br>ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å•ç‹¬ä¸€ä»½å­˜å‚¨ç©ºé—´ï¼Œå…·æœ‰çº¿ç¨‹éš”ç¦»çš„æ•ˆæœï¼Œåªæœ‰åœ¨çº¿ç¨‹å†…æ‰èƒ½è·å–åˆ°å¯¹åº”çš„å€¼ï¼Œçº¿ç¨‹å¤–åˆ™ä¸èƒ½è®¿é—®ï¼Œè€Œæ¯ä¸€æ¬¡ç”¨æˆ·çš„è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ThreadLocalæ¥ä¼ é€’å½“å‰å‘˜å·¥çš„id</p><p><strong>å¸¸ç”¨æ–¹æ³•ï¼š</strong></p><ul><li><code>public void set(T value)</code> è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</li><li><code>public T get()</code> è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</li><li><code>public void remove()</code> ç§»é™¤å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡</li></ul><p><strong>è§£å†³é—®é¢˜ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111212349365.png"></div></div><p>åœ¨åˆå§‹å·¥ç¨‹ä¸­çš„sky-commonæ¨¡å—å·²ç»å°è£…äº†ThreadLocalæ“ä½œçš„å·¥å…·ç±»<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨æ‹¦æˆªå™¨ä¸­è§£æå‡ºå½“å‰ç™»å½•å‘˜å·¥çš„idï¼Œå¹¶æ”¾å…¥çº¿ç¨‹å±€éƒ¨å˜é‡ä¸­ï¼ˆsetCurrentIdæ–¹æ³•ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jwtä»¤ç‰Œæ ¡éªŒçš„æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenAdminInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒjwt</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">//.............................</span></span><br><span class="line">       </span><br><span class="line">        <span class="comment">//2ã€æ ¡éªŒä»¤ç‰Œ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//.................</span></span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(jwtProperties.getAdminSecretKey(), token);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.EMP_ID).toString());</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰å‘˜å·¥idï¼š&quot;</span>, empId);</span><br><span class="line">            <span class="comment">/////å°†ç”¨æˆ·idå­˜å‚¨åˆ°ThreadLocal////////</span></span><br><span class="line">            BaseContext.setCurrentId(empId);</span><br><span class="line">            <span class="comment">////////////////////////////////////</span></span><br><span class="line">            <span class="comment">//3ã€é€šè¿‡ï¼Œæ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">//......................</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨Serviceä¸­ç›´æ¥è°ƒç”¨<code>BaseContext.getCurrentId()</code>æ–¹æ³•è·å–å½“å‰ç™»å½•å‘˜å·¥çš„id<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">employee.setCreateUser(BaseContext.getCurrentId());</span><br><span class="line">employee.setUpdateUser(BaseContext.getCurrentId());</span><br></pre></td></tr></table></figure><br>æµ‹è¯•:ä½¿ç”¨adminç”¨æˆ·æ¥æ·»åŠ ä¸€æ¡è®°å½•ï¼ŒæŸ¥çœ‹æ˜¯å¦èƒ½ä¿ç•™åˆ›å»ºè€…çš„id<p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112134948.png"></div></div><h2 id="å‘˜å·¥åˆ†é¡µæŸ¥è¯¢"><a href="#å‘˜å·¥åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="å‘˜å·¥åˆ†é¡µæŸ¥è¯¢"></a>å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-1"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-1" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p><strong>éœ€æ±‚åˆ†æï¼š</strong> å½“ç³»ç»Ÿä¹‹å‘˜å·¥å¾ˆå¤šæ—¶ï¼Œå°†æ•°æ®ä»¥åˆ†é¡µçš„æ–¹å¼æ¥å±•ç¤ºæ›´åŠ æ¸…æ™°æ˜ç¡®ã€‚åœ¨åˆ†é¡µæŸ¥è¯¢é¡µé¢ï¼Œé™¤äº†åˆ†é¡µæ¡ä»¶ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶â€å‘˜å·¥å§“åâ€<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111215309289.png"></div></div><br><div class="note info no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>æ ¹æ®é¡µç å±•ç¤ºå‘˜å·¥ä¿¡æ¯</li><li>æ¯é¡µå±•ç¤º10æ¡æ•°æ®</li><li>åˆ†é¡µæŸ¥è¯¢æ—¶å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè¾“å…¥å‘˜å·¥å§“åè¿›è¡ŒæŸ¥è¯¢</li></ul></div><br><strong>æ¥å£è®¾è®¡ï¼š</strong><br>èµ„æ–™ -&gt; é¡¹ç›®æ¥å£æ–‡æ¡£ -&gt; è‹ç©¹å¤–å–-ç®¡ç†ç«¯æ¥å£.html<p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111220031113.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221111220041965.png"></div></div><div class="note warning no-icon flat"><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>è¯·æ±‚å‚æ•°ç±»å‹ä¸ºQueryï¼Œä¸æ˜¯jsonæ ¼å¼æäº¤ï¼Œåœ¨è·¯å¾„åç›´æ¥æ‹¼æ¥ã€‚/admin/employee/page?name=zhangsan</li><li>è¿”å›æ•°æ®ä¸­recordsæ•°ç»„ä¸­ä½¿ç”¨Employeeå®ä½“ç±»å¯¹å±æ€§è¿›è¡Œå°è£…ã€‚</li></ul></div><h3 id="ä»£ç å¼€å‘-1"><a href="#ä»£ç å¼€å‘-1" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="è®¾ç½®DTOç±»-1"><a href="#è®¾ç½®DTOç±»-1" class="headerlink" title="è®¾ç½®DTOç±»"></a>è®¾ç½®DTOç±»</h4><p>æ ¹æ®è¯·æ±‚å‚æ•°è¿›è¡Œå°è£…ï¼Œåœ¨sky-pojoæ¨¡å—ä¸­åˆ›å»ºEmployeePageQueryDTOç±»<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeePageQueryDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘˜å·¥å§“å</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¡µç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> page;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="å°è£…åˆ†é¡µç»“æœç±»"><a href="#å°è£…åˆ†é¡µç»“æœç±»" class="headerlink" title="å°è£…åˆ†é¡µç»“æœç±»"></a>å°è£…åˆ†é¡µç»“æœç±»</h4><div class="note info no-icon flat"><p>åé¢æ‰€æœ‰çš„åˆ†é¡µæŸ¥è¯¢ï¼Œç»Ÿä¸€éƒ½å°è£…ä¸º<code>PageResult</code>å¯¹è±¡ã€‚</p></div><p>æ”¾åœ¨sky-commonæ¨¡å—<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°è£…åˆ†é¡µæŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> total; <span class="comment">//æ€»è®°å½•æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List records; <span class="comment">//å½“å‰é¡µæ•°æ®é›†åˆ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢åç«¯è¿”å›çš„å¯¹è±¡ç±»å‹ä¸º: <code>Result&lt;PageResult&gt;</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åç«¯ç»Ÿä¸€è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.data = object;</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.msg = msg;</span><br><span class="line">        result.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="åˆ›å»ºæ¥å£å’Œå®ç°ç±»-1"><a href="#åˆ›å»ºæ¥å£å’Œå®ç°ç±»-1" class="headerlink" title="åˆ›å»ºæ¥å£å’Œå®ç°ç±»"></a>åˆ›å»ºæ¥å£å’Œå®ç°ç±»</h4><p><strong>Controllerå±‚</strong><br>åœ¨å‘˜å·¥æ§åˆ¶å±‚æ·»åŠ åˆ†é¡µæŸ¥è¯¢æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å‘˜å·¥åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;å‘˜å·¥åˆ†é¡µæŸ¥è¯¢ï¼Œå‚æ•°ä¸ºï¼š&#123;&#125;&quot;</span>, employeePageQueryDTO);</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> employeeService.pageQuery(employeePageQueryDTO);<span class="comment">//åç»­å®šä¹‰</span></span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚æ¥å£</strong><br>å£°æ˜pageQueryæ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚å®ç°ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// select * from employee limit 0,10</span></span><br><span class="line">    <span class="comment">//å¼€å§‹åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">    Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);<span class="comment">//åç»­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">    List&lt;Employee&gt; records = page.getResult();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning no-icon flat"><p><strong>æ³¨æ„ï¼š</strong> è¯¥åŠŸèƒ½æ˜¯ä½¿ç”¨mybatisæä¾›çš„åˆ†é¡µæ’ä»¶PageHelperæ¥ç®€åŒ–åˆ†é¡µä»£ç çš„å¼€å‘ï¼Œåº•å±‚åŸºäºmybatisçš„æ‹¦æˆªå™¨å®ç°,è¯¥åŠŸèƒ½éœ€è¦åœ¨pom.xmlæ–‡ä¸­æ·»åŠ ä¾èµ–(åˆå§‹å·¥ç¨‹å·²æ·»åŠ )<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pagehelper&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p></div><p><strong>Mapperå±‚</strong></p><p>åœ¨EmployeeMapperä¸­å£°æ˜pageQueryæ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Page&lt;Employee&gt; <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><br>å› ä¸ºè¯¥åˆ†é¡µæ“ä½œæ¶‰åŠåŠ¨æ€æ¡ä»¶æŸ¥è¯¢ï¼Œæ‰€ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å†™sqlè¯­å¥ï¼Œåœ¨ <code>src/main/resources/mapper/EmployeeMapper.xml</code> ä¸­ç¼–å†™SQL<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="åŠŸèƒ½æµ‹è¯•-1"><a href="#åŠŸèƒ½æµ‹è¯•-1" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><h4 id="æ¥å£æ–‡æ¡£æµ‹è¯•-1"><a href="#æ¥å£æ–‡æ¡£æµ‹è¯•-1" class="headerlink" title="æ¥å£æ–‡æ¡£æµ‹è¯•"></a>æ¥å£æ–‡æ¡£æµ‹è¯•</h4><p><strong>é‡å¯æœåŠ¡ï¼š</strong>è®¿é—®<a target="_blank" rel="noopener" href="http://localhost:8080/doc.htmlï¼Œè¿›å…¥å‘˜å·¥åˆ†é¡µæŸ¥è¯¢">http://localhost:8080/doc.htmlï¼Œè¿›å…¥å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</a><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112101848657.png"></div></div><br><div class="note warning no-icon flat"><p>å¦‚æœä¸€ç›´æŠ¥401é”™è¯¯ï¼Œå¯èƒ½æ˜¯tokenå¤±æ•ˆçš„åŸå› ï¼Œæ­¤æ—¶éœ€è¦é‡æ–°ç™»å½•è·å–token</p></div><br><strong>å“åº”ç»“æœï¼š</strong><p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112144447.png"></div></div><h4 id="å‰åç«¯è”è°ƒæµ‹è¯•-1"><a href="#å‰åç«¯è”è°ƒæµ‹è¯•-1" class="headerlink" title="å‰åç«¯è”è°ƒæµ‹è¯•"></a>å‰åç«¯è”è°ƒæµ‹è¯•</h4><p><strong>ç‚¹å‡»å‘˜å·¥ç®¡ç†å¹¶è¾“å…¥å‘˜å·¥å§“å</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112144754.png"></div></div><p></p><p>æ­¤æ—¶å‘˜å·¥çš„åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½å·²ç»é¡ºåˆ©å®Œæˆäº†ï¼Œä½†æ˜¯ä»”ç»†è§‚å¯Ÿä¼šå‘ç°ï¼Œæ˜¾ç¤ºçš„ <strong>æœ€åæ“ä½œæ—¶é—´</strong> æ ¼å¼å¾ˆæ€ªï¼Œè¿™ä¸ªé—®é¢˜åœ¨ <strong>ä»£ç å®Œå–„</strong> ä¸­è§£å†³</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112144843.png"></div></div><h3 id="ä»£ç å®Œå–„-1"><a href="#ä»£ç å®Œå–„-1" class="headerlink" title="ä»£ç å®Œå–„"></a>ä»£ç å®Œå–„</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong>æ“ä½œæ—¶é—´å­—æ®µæ˜¾ç¤ºæœ‰é—®é¢˜ã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112103235539.png"></div></div><p></p><p><strong>è§£å†³æ–¹å¼ï¼š</strong></p><ul><li><strong>æ–¹å¼ä¸€ï¼š</strong> åœ¨å±æ€§ä¸ŠåŠ ä¸Šæ³¨è§£<code>@JsonFormat</code>ï¼ŒæŒ‡å®šæ—¥æœŸæ ¼å¼<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112103501581.png"></div></div></li><li><strong>æ–¹å¼äºŒï¼š</strong> æ·»åŠ æ¶ˆæ¯è½¬æ¢å™¨ï¼Œç»Ÿä¸€æ—¥æœŸç±»å‹çš„æ ¼å¼å¤„ç†</li></ul><div class="note info no-icon flat"><p>è¿™é‡Œæ¨èä½¿ç”¨æ–¹å¼äºŒï¼Œå› ä¸ºæ–¹å¼ä¸€çš„å¤„ç†æ–¹å¼ï¼Œåªå¯¹å•ä¸€å±æ€§è¿›è¡Œå¤„ç†ï¼Œéœ€è¦æ¯ä¸ªæ—¶é—´ç±»å‹éƒ½åŠ ä¸Š<code>@JsonFormat</code>æ³¨è§£ï¼Œæ•ˆç‡è¾ƒä½ï¼Œè€Œæ–¹å¼äºŒçš„å¤„ç†æ–¹å¼ï¼Œæ˜¯å¯¹æ‰€æœ‰æ—¥æœŸç±»å‹è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œæ•ˆç‡è¾ƒé«˜</p></div><p><strong>è§£å†³æ–¹æ³•</strong><br>åœ¨sky-serveræ¨¡å—ä¸‹çš„<code>WebMvcConfiguration</code>ä¸­æ‰©å±•SpringMVCçš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œç»Ÿä¸€å¯¹æ—¥æœŸç±»å‹è¿›è¡Œæ ¼å¼å¤„ç†<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰©å±•Spring MVCæ¡†æ¶çš„æ¶ˆæ¯è½¬åŒ–å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨...&quot;</span>);</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">    <span class="comment">//éœ€è¦ä¸ºæ¶ˆæ¯è½¬æ¢å™¨è®¾ç½®ä¸€ä¸ªå¯¹è±¡è½¬æ¢å™¨ï¼Œå¯¹è±¡è½¬æ¢å™¨å¯ä»¥å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonæ•°æ®</span></span><br><span class="line">    converter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">    <span class="comment">//å°†è‡ªå·±çš„æ¶ˆæ¯è½¬åŒ–å™¨åŠ å…¥å®¹å™¨ä¸­</span></span><br><span class="line">    converters.add(<span class="number">0</span>,converter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><div class="note info no-icon flat"><p>æ¶ˆæ¯è½¬åŒ–å™¨é…ç½®ä¸­çš„å¯¹è±¡è½¬æ¢å™¨ï¼Œæ˜¯åŸºç¡€å·¥ç¨‹ä¸­å·²ç»é…ç½®å¥½çš„<code>JacksonObjectMapper</code>ï¼Œå®ƒå·²ç»å¯¹æ—¥æœŸç±»å‹è¿›è¡Œäº†æ ¼å¼å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>WebMvcConfiguration</code>ä¸­æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨ï¼Œå°†å…¶åŠ å…¥å®¹å™¨ä¸­å³å¯</p></div><p></p><p>æ­¤æ—¶å†æ¬¡æµ‹è¯•ï¼Œå°±èƒ½çœ‹åˆ°æ­£ç¡®çš„æ˜¾ç¤ºæ—¶é—´æ ¼å¼äº†<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112145949.png"></div></div><p></p><h2 id="å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·"><a href="#å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·" class="headerlink" title="å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·"></a>å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-2"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-2" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p><strong>éœ€æ±‚åˆ†æï¼š</strong> åœ¨å‘˜å·¥ç®¡ç†åˆ—è¡¨é¡µé¢ï¼Œå¯ä»¥å¯¹æŸä¸ªå‘˜å·¥è´¦å·è¿›è¡Œå¯ç”¨æˆ–è€…ç¦ç”¨æ“ä½œã€‚è´¦å·ç¦ç”¨çš„å‘˜å·¥ä¸èƒ½ç™»å½•ç³»ç»Ÿï¼Œå¯ç”¨åçš„å‘˜å·¥å¯ä»¥æ­£å¸¸ç™»å½•ã€‚å¦‚æœæŸä¸ªå‘˜å·¥è´¦å·çŠ¶æ€ä¸ºæ­£å¸¸ï¼Œåˆ™æŒ‰é’®æ˜¾ç¤ºä¸º â€œç¦ç”¨â€ï¼Œå¦‚æœå‘˜å·¥è´¦å·çŠ¶æ€ä¸ºå·²ç¦ç”¨ï¼Œåˆ™æŒ‰é’®æ˜¾ç¤ºä¸ºâ€å¯ç”¨â€ï¼Œå…³äºæŒ‰é’®çš„æ˜¾ç¤ºåˆ‡æ¢åœ¨å‰ç«¯å·²ç»å®Œæˆï¼Œåç«¯åªéœ€è¦æ”¹å˜å‘˜å·¥è´¦å·çš„çŠ¶æ€å³å¯ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112112359233.png"></div></div><div class="note info no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>å¯ä»¥å¯¹çŠ¶æ€ä¸ºâ€œå¯ç”¨â€ çš„å‘˜å·¥è´¦å·è¿›è¡Œâ€œç¦ç”¨â€æ“ä½œ</li><li>å¯ä»¥å¯¹çŠ¶æ€ä¸ºâ€œç¦ç”¨â€çš„å‘˜å·¥è´¦å·è¿›è¡Œâ€œå¯ç”¨â€æ“ä½œ</li><li>çŠ¶æ€ä¸ºâ€œç¦ç”¨â€çš„å‘˜å·¥è´¦å·ä¸èƒ½ç™»å½•ç³»ç»Ÿ</li></ul></div><p><strong>æ¥å£è®¾è®¡</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112112728333.png"></div></div><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112112739680.png"></div></div><p></p><h3 id="ä»£ç å¼€å‘-2"><a href="#ä»£ç å¼€å‘-2" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p>æ ¹æ®æ¥å£è®¾è®¡ä¸­çš„è¯·æ±‚å‚æ•°å½¢å¼å¯¹åº”çš„åœ¨<code>EmployeeController</code>ä¸­åˆ›å»ºå¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status,Long id)</span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·ï¼š&#123;&#125;,&#123;&#125;&quot;</span>,status,id);</span><br><span class="line">       employeeService.startOrStop(status,id);<span class="comment">//åç»ªæ­¥éª¤å®šä¹‰</span></span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚æ¥å£"><a href="#Serviceå±‚æ¥å£" class="headerlink" title="Serviceå±‚æ¥å£"></a>Serviceå±‚æ¥å£</h4><p>åœ¨<code>EmployeeService</code>æ¥å£ä¸­å£°æ˜å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·çš„ä¸šåŠ¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span>;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚å®ç°ç±»"><a href="#Serviceå±‚å®ç°ç±»" class="headerlink" title="Serviceå±‚å®ç°ç±»"></a>Serviceå±‚å®ç°ç±»</h4><p>åœ¨<code>EmployeeServiceImpl</code>ä¸­å®ç°å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·çš„ä¸šåŠ¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">       <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> Employee.builder()</span><br><span class="line">               .status(status)</span><br><span class="line">               .id(id)</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       employeeMapper.update(employee);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚"><a href="#Mapperå±‚" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p>åœ¨<code>EmployeeMapper</code>æ¥å£ä¸­å£°æ˜ update æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®ä¸»é”®åŠ¨æ€ä¿®æ”¹å±æ€§</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><p>åœ¨<code>EmployeeMapper.xml</code>ä¸­ç¼–å†™SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">update</span> id<span class="operator">=</span>&quot;update&quot; parameterType<span class="operator">=</span>&quot;Employee&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">update</span> employee</span><br><span class="line">    <span class="operator">&lt;</span><span class="keyword">set</span><span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;name != null&quot;<span class="operator">&gt;</span>name <span class="operator">=</span> #&#123;name&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;username != null&quot;<span class="operator">&gt;</span>username <span class="operator">=</span> #&#123;username&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;password != null&quot;<span class="operator">&gt;</span>password <span class="operator">=</span> #&#123;password&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;phone != null&quot;<span class="operator">&gt;</span>phone <span class="operator">=</span> #&#123;phone&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;sex != null&quot;<span class="operator">&gt;</span>sex <span class="operator">=</span> #&#123;sex&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;idNumber != null&quot;<span class="operator">&gt;</span>id_Number <span class="operator">=</span> #&#123;idNumber&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;updateTime != null&quot;<span class="operator">&gt;</span>update_Time <span class="operator">=</span> #&#123;updateTime&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;updateUser != null&quot;<span class="operator">&gt;</span>update_User <span class="operator">=</span> #&#123;updateUser&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;status != null&quot;<span class="operator">&gt;</span>status <span class="operator">=</span> #&#123;status&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">set</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">where</span> id <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">update</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-2"><a href="#åŠŸèƒ½æµ‹è¯•-2" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><h4 id="æ¥å£æ–‡æ¡£æµ‹è¯•-2"><a href="#æ¥å£æ–‡æ¡£æµ‹è¯•-2" class="headerlink" title="æ¥å£æ–‡æ¡£æµ‹è¯•"></a>æ¥å£æ–‡æ¡£æµ‹è¯•</h4><p>åœ¨æµ‹è¯•å‰ï¼ŒæŸ¥è¯¢å‘˜å·¥idå’Œè´¦å·çŠ¶æ€ï¼Œåœ¨æ¥å£æ–‡æ¡£ä¸­ä½œä¸ºç›¸åº”çš„å‚æ•°è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å®Œæ¯•åï¼Œå†æ¬¡æŸ¥è¯¢å‘˜å·¥è´¦å·çŠ¶æ€ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸå¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112203047.png"></div></div><h4 id="å‰åç«¯è”è°ƒæµ‹è¯•-2"><a href="#å‰åç«¯è”è°ƒæµ‹è¯•-2" class="headerlink" title="å‰åç«¯è”è°ƒæµ‹è¯•"></a>å‰åç«¯è”è°ƒæµ‹è¯•</h4><p>ç‚¹å‡»ç›¸åº”çš„æŒ‰é’®ï¼Œä¼šå¯¹å‘˜å·¥è´¦å·è¿›è¡Œå¯ç”¨/ç¦ç”¨ï¼Œå¹¶æç¤ºè´¦å·çŠ¶æ€æ˜¯å¦æ›´æ”¹æˆåŠŸ<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112202543.png"></div></div><p></p><h2 id="ç¼–è¾‘å‘˜å·¥"><a href="#ç¼–è¾‘å‘˜å·¥" class="headerlink" title="ç¼–è¾‘å‘˜å·¥"></a>ç¼–è¾‘å‘˜å·¥</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-3"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-3" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p><strong>éœ€æ±‚åˆ†æï¼š</strong> å‘˜å·¥ç®¡ç†ç•Œé¢ç‚¹å‡»ç¼–è¾‘æŒ‰é’®å³å¯è·³è½¬åˆ°å‘˜å·¥ç¼–è¾‘é¡µé¢ï¼Œé¡µé¢ä¸­æ˜¾ç¤ºå½“å‰å‘˜å·¥ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹å‘˜å·¥ä¿¡æ¯å¹¶ä¿å­˜ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112144731759.png"></div></div><div class="note warning no-icon flat"><p>å‘˜å·¥ç¼–è¾‘é¡µé¢åº”å½“å›æ˜¾å½“å‰å‘˜å·¥ä¿¡æ¯ï¼Œç”¨æˆ·åœ¨å½“å‰å‘˜å·¥ä¿¡æ¯çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹</p></div><p><strong>æ¥å£è®¾è®¡ï¼š</strong><br>ç¼–è¾‘å‘˜å·¥å…±æ¶‰åŠåˆ°ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</li><li>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</li></ul><ol><li><p><strong>æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112145619775.png"></div></div></li><li><p><strong>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112145643769.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112145659035.png"></div></div></li></ol><div class="note warning no-icon flat"><p>ä¿®æ”¹åŠŸèƒ½ï¼Œæ‰€ä»¥è¯·æ±‚æ–¹å¼å¯è®¾ç½®ä¸ºPOST</p></div><h3 id="ä»£ç å¼€å‘-3"><a href="#ä»£ç å¼€å‘-3" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="å›æ˜¾å‘˜å·¥ä¿¡æ¯"><a href="#å›æ˜¾å‘˜å·¥ä¿¡æ¯" class="headerlink" title="å›æ˜¾å‘˜å·¥ä¿¡æ¯"></a>å›æ˜¾å‘˜å·¥ä¿¡æ¯</h4><ol><li><strong>Controllerå±‚</strong><br>åœ¨ <code>EmployeeController</code> ä¸­åˆ›å»º getById æ–¹æ³•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>Serviceå±‚æ¥å£</strong><br>åœ¨ EmployeeService æ¥å£ä¸­å£°æ˜ getById æ–¹æ³•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Employee <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure></li><li><strong>Serviceå±‚å®ç°ç±»</strong><br>åœ¨ <code>EmployeeServiceImpl</code> ä¸­å®ç° getById æ–¹æ³•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">     <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getById(id);</span><br><span class="line">     employee.setPassword(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span> employee;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><strong>Mapperå±‚</strong><br>åœ¨ EmployeeMapper æ¥å£ä¸­å£°æ˜ getById æ–¹æ³•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from employee where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">   Employee <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure></li></ol><h4 id="ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"><a href="#ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½" class="headerlink" title="ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"></a>ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½</h4><ol><li><p><strong>Controllerå±‚</strong><br>åœ¨ <code>EmployeeController</code> ä¸­åˆ›å»º <code>update</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>, employeeDTO);</span><br><span class="line">       employeeService.update(employeeDTO);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Serviceå±‚æ¥å£</strong><br>åœ¨ <code>EmployeeService</code> æ¥å£ä¸­å£°æ˜ <code>update</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>Serviceå±‚å®ç°ç±»</strong><br>åœ¨ <code>EmployeeServiceImpl</code> ä¸­å®ç° <code>update</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">      <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">      BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">      employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">      employee.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">      employeeMapper.update(employee);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ol><div class="note info no-icon flat"><p>åœ¨å®ç°<strong>å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</strong>åŠŸèƒ½æ—¶ï¼Œå·²å®ç°employeeMapper.update(employee)ï¼Œåœ¨æ­¤ä¸éœ€å†™Mapperå±‚ä»£ç ,ç›´æ¥è°ƒç”¨å³å¯</p></div><h3 id="åŠŸèƒ½æµ‹è¯•-3"><a href="#åŠŸèƒ½æµ‹è¯•-3" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><h4 id="æ¥å£æ–‡æ¡£æµ‹è¯•-3"><a href="#æ¥å£æ–‡æ¡£æµ‹è¯•-3" class="headerlink" title="æ¥å£æ–‡æ¡£æµ‹è¯•"></a>æ¥å£æ–‡æ¡£æµ‹è¯•</h4><p>åˆ†åˆ«æµ‹è¯•<code>æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</code>å’Œ<code>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯æ¥å£</code></p><ol><li><p>æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯<br>è·å¾—äº†å¯¹åº”idçš„ç›¸å…³å‘˜å·¥ä¿¡æ¯</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/20251112205954.png"></div></div></li><li><p>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯<br>ä¿®æ”¹id=4çš„å‘˜å·¥ä¿¡æ¯ï¼Œ<strong>name</strong>ç”±<strong>zhangsan</strong>æ”¹ä¸º<strong>å¼ ä¸‰ä¸°</strong>ï¼Œ<strong>username</strong>ç”±<strong>å¼ ä¸‰</strong>æ”¹ä¸º<strong>zhangsanfeng</strong>ã€‚</p></li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112155001414.png"></div></div><p>æŸ¥çœ‹employeeè¡¨æ•°æ®<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112155029547.png"></div></div><p></p><h4 id="å‰åç«¯è”è°ƒæµ‹è¯•-3"><a href="#å‰åç«¯è”è°ƒæµ‹è¯•-3" class="headerlink" title="å‰åç«¯è”è°ƒæµ‹è¯•"></a>å‰åç«¯è”è°ƒæµ‹è¯•</h4><p>è¿›å…¥åˆ°å‘˜å·¥åˆ—è¡¨æŸ¥è¯¢<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112155430652.png"></div></div><br>å¯¹å‘˜å·¥å§“åä¸ºæ°å…‹çš„å‘˜å·¥æ•°æ®ä¿®æ”¹ï¼Œç‚¹å‡»ä¿®æ”¹ï¼Œæ•°æ®å·²å›æ˜¾<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112155206712.png"></div></div><br>ä¿®æ”¹åï¼Œç‚¹å‡»ä¿å­˜<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112155559298.png"></div></div><p></p><h2 id="å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç "><a href="#å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç " class="headerlink" title="å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç "></a>å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç </h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-4"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-4" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><p>åå°ç³»ç»Ÿä¸­å¯ä»¥ç®¡ç†åˆ†ç±»ä¿¡æ¯ï¼Œåˆ†ç±»åŒ…æ‹¬ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ <strong>èœå“åˆ†ç±»</strong> å’Œ <strong>å¥—é¤åˆ†ç±»</strong> ã€‚</p><p><strong>åˆ†æèœå“åˆ†ç±»ç›¸å…³åŠŸèƒ½ï¼š</strong></p><ul><li><p><strong>æ–°å¢èœå“åˆ†ç±»ï¼š</strong>å½“æˆ‘ä»¬åœ¨åå°ç³»ç»Ÿä¸­æ·»åŠ èœå“æ—¶éœ€è¦é€‰æ‹©ä¸€ä¸ªèœå“åˆ†ç±»ï¼Œåœ¨ç§»åŠ¨ç«¯ä¹Ÿä¼šæŒ‰ç…§èœå“åˆ†ç±»æ¥å±•ç¤ºå¯¹åº”çš„èœå“ã€‚</p></li><li><p><strong>èœå“åˆ†ç±»åˆ†é¡µæŸ¥è¯¢ï¼š</strong>ç³»ç»Ÿä¸­çš„åˆ†ç±»å¾ˆå¤šçš„æ—¶å€™ï¼Œå¦‚æœåœ¨ä¸€ä¸ªé¡µé¢ä¸­å…¨éƒ¨å±•ç¤ºå‡ºæ¥ä¼šæ˜¾å¾—æ¯”è¾ƒä¹±ï¼Œä¸ä¾¿äºæŸ¥çœ‹ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„ç³»ç»Ÿä¸­éƒ½ä¼šä»¥åˆ†é¡µçš„æ–¹å¼æ¥å±•ç¤ºåˆ—è¡¨æ•°æ®ã€‚</p></li><li><p><strong>æ ¹æ®idåˆ é™¤èœå“åˆ†ç±»ï¼š</strong>åœ¨åˆ†ç±»ç®¡ç†åˆ—è¡¨é¡µé¢ï¼Œå¯ä»¥å¯¹æŸä¸ªåˆ†ç±»è¿›è¡Œåˆ é™¤æ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯å½“åˆ†ç±»å…³è”äº†èœå“æˆ–è€…å¥—é¤æ—¶ï¼Œæ­¤åˆ†ç±»ä¸å…è®¸åˆ é™¤ã€‚</p></li><li><p><strong>ä¿®æ”¹èœå“åˆ†ç±»ï¼š</strong>åœ¨åˆ†ç±»ç®¡ç†åˆ—è¡¨é¡µé¢ç‚¹å‡»ä¿®æ”¹æŒ‰é’®ï¼Œå¼¹å‡ºä¿®æ”¹çª—å£ï¼Œåœ¨ä¿®æ”¹çª—å£å›æ˜¾åˆ†ç±»ä¿¡æ¯å¹¶è¿›è¡Œä¿®æ”¹ï¼Œæœ€åç‚¹å‡»ç¡®å®šæŒ‰é’®å®Œæˆä¿®æ”¹æ“ä½œã€‚</p></li><li><p><strong>å¯ç”¨ç¦ç”¨èœå“åˆ†ç±»ï¼š</strong>åœ¨åˆ†ç±»ç®¡ç†åˆ—è¡¨é¡µé¢ï¼Œå¯ä»¥å¯¹æŸä¸ªåˆ†ç±»è¿›è¡Œå¯ç”¨æˆ–è€…ç¦ç”¨æ“ä½œã€‚</p></li><li><p><strong>åˆ†ç±»ç±»å‹æŸ¥è¯¢ï¼š</strong>å½“ç‚¹å‡»åˆ†ç±»ç±»å‹ä¸‹æ‹‰æ¡†æ—¶ï¼Œä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ‰€æœ‰çš„èœå“åˆ†ç±»æ•°æ®è¿›è¡Œå±•ç¤ºã€‚</p></li></ul><p><strong>åˆ†ç±»ç®¡ç†åŸå‹ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/image-20221112160907419.png"></div></div><p></p><div class="note warning no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>åˆ†ç±»åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„</li><li>åˆ†ç±»æŒ‰ç…§ç±»å‹å¯ä»¥åˆ†ä¸ºèœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±»</li><li>æ–°æ·»åŠ çš„åˆ†ç±»çŠ¶æ€é»˜è®¤ä¸ºâ€œç¦ç”¨â€</li></ul></div><h4 id="æ¥å£è®¾è®¡"><a href="#æ¥å£è®¾è®¡" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œèœå“åˆ†ç±»æ¨¡å—å…±æ¶‰åŠ6ä¸ªæ¥å£ï¼š</p><ul><li>æ–°å¢åˆ†ç±»</li><li>åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</li><li>æ ¹æ®idåˆ é™¤åˆ†ç±»</li><li>ä¿®æ”¹åˆ†ç±»</li><li>å¯ç”¨ç¦ç”¨åˆ†ç±»</li><li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</li></ul><ol><li><strong>æ–°å¢åˆ†ç±»</strong><div class="tabs" id="å¯¼å…¥åˆ†ç±»æ–°å¢åˆ†ç±»"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»æ–°å¢åˆ†ç±»-1">åŸºæœ¬ä¿¡æ¯</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»æ–°å¢åˆ†ç±»-2">è¿”å›æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»æ–°å¢åˆ†ç±»-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163011291.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»æ–°å¢åˆ†ç±»-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163044547.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li><li><strong>åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</strong><div class="tabs" id="å¯¼å…¥åˆ†ç±»åˆ†ç±»åˆ†é¡µæŸ¥è¯¢"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»åˆ†ç±»åˆ†é¡µæŸ¥è¯¢-1">åŸºæœ¬ä¿¡æ¯</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»åˆ†ç±»åˆ†é¡µæŸ¥è¯¢-2">è¿”å›æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»åˆ†ç±»åˆ†é¡µæŸ¥è¯¢-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163209383.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»åˆ†ç±»åˆ†é¡µæŸ¥è¯¢-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163233212.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li><li><strong>æ ¹æ®idåˆ é™¤åˆ†ç±»</strong></li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163323554.png"></div></div><ol><li><strong>ä¿®æ”¹åˆ†ç±»</strong><div class="tabs" id="å¯¼å…¥åˆ†ç±»ä¿®æ”¹åˆ†ç±»"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»ä¿®æ”¹åˆ†ç±»-1">åŸºæœ¬ä¿¡æ¯</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»ä¿®æ”¹åˆ†ç±»-2">è¿”å›æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»ä¿®æ”¹åˆ†ç±»-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163424457.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»ä¿®æ”¹åˆ†ç±»-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163445296.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li><li><strong>å¯ç”¨ç¦ç”¨åˆ†ç±»</strong><div class="tabs" id="å¯¼å…¥åˆ†ç±»å¯ç”¨ç¦ç”¨åˆ†ç±»"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»å¯ç”¨ç¦ç”¨åˆ†ç±»-1">åŸºæœ¬ä¿¡æ¯</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»å¯ç”¨ç¦ç”¨åˆ†ç±»-2">è¿”å›æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»å¯ç”¨ç¦ç”¨åˆ†ç±»-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163557247.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»å¯ç”¨ç¦ç”¨åˆ†ç±»-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163622896.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li><li><strong>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</strong><div class="tabs" id="å¯¼å…¥åˆ†ç±»æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»-1">åŸºæœ¬ä¿¡æ¯</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»-2">è¿”å›æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163806318.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112163839168.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="è¡¨è®¾è®¡"><a href="#è¡¨è®¾è®¡" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><strong>categoryè¡¨ç»“æ„ï¼š</strong></li></ol><div class="table-container"><table><thead><tr><th><strong>å­—æ®µå</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>name</td><td>varchar(32)</td><td>åˆ†ç±»åç§°</td><td>å”¯ä¸€</td></tr><tr><td>type</td><td>int</td><td>åˆ†ç±»ç±»å‹</td><td>1èœå“åˆ†ç±» 2å¥—é¤åˆ†ç±»</td></tr><tr><td>sort</td><td>int</td><td>æ’åºå­—æ®µ</td><td>ç”¨äºåˆ†ç±»æ•°æ®çš„æ’åº</td></tr><tr><td>status</td><td>int</td><td>çŠ¶æ€</td><td>1å¯ç”¨ 0ç¦ç”¨</td></tr><tr><td>create_time</td><td>datetime</td><td>åˆ›å»ºæ—¶é—´</td><td></td></tr><tr><td>update_time</td><td>datetime</td><td>æœ€åä¿®æ”¹æ—¶é—´</td><td></td></tr><tr><td>create_user</td><td>bigint</td><td>åˆ›å»ºäººid</td><td></td></tr><tr><td>update_user</td><td>bigint</td><td>æœ€åä¿®æ”¹äººid</td></tr></tbody></table></div><h3 id="ä»£ç å¯¼å…¥"><a href="#ä»£ç å¯¼å…¥" class="headerlink" title="ä»£ç å¯¼å…¥"></a>ä»£ç å¯¼å…¥</h3><div class="note info no-icon flat"><p>ç›´æ¥å°†èµ„æ–™ä¸­çš„åˆ†ç±»ç®¡ç†æ¨¡å—åŠŸèƒ½ä»£ç å¯¼å…¥å³å¯</p></div><h4 id="Mapperå±‚-1"><a href="#Mapperå±‚-1" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><div class="tabs" id="å¯¼å…¥åˆ†ç±»mapperå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»mapperå±‚-1">CategoryMapper.java</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»mapperå±‚-2">DishMapper.java</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»mapperå±‚-3">SetmealMapper.java</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»mapperå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into category(type, name, sort, status, create_time, update_time, create_user, update_user)&quot; +</span></span><br><span class="line"><span class="meta">            &quot; VALUES&quot; +</span></span><br><span class="line"><span class="meta">            &quot; (#&#123;type&#125;, #&#123;name&#125;, #&#123;sort&#125;, #&#123;status&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Category category)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;Category&gt; <span class="title function_">pageQuery</span><span class="params">(CategoryPageQueryDTO categoryPageQueryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from category where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idä¿®æ”¹åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Category category)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Category&gt; <span class="title function_">list</span><span class="params">(Integer type)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»mapperå±‚-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select count(id) from dish where category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    Integer <span class="title function_">countByCategoryId</span><span class="params">(Long categoryId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»mapperå±‚-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select count(id) from setmeal where category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    Integer <span class="title function_">countByCategoryId</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>æ¥å£ç±»</strong><br></p><div class="tabs" id="å¯¼å…¥åˆ†ç±»serviceå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»serviceå±‚-1">CategoryService.java</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»serviceå±‚-2">EmployeeService.java</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»serviceå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(CategoryDTO categoryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PageResult <span class="title function_">pageQuery</span><span class="params">(CategoryPageQueryDTO categoryPageQueryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(CategoryDTO categoryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯ç”¨ã€ç¦ç”¨åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Category&gt; <span class="title function_">list</span><span class="params">(Integer type)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»serviceå±‚-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘˜å·¥ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Employee <span class="title function_">login</span><span class="params">(EmployeeLoginDTO employeeLoginDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Employee <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><br><strong>å®ç°ç±»</strong><br><div class="tabs" id="å¯¼å…¥åˆ†ç±»serviceå±‚å®ç°ç±»"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»serviceå±‚å®ç°ç±»-1">CategoryServiceImpl.java</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åˆ†ç±»serviceå±‚å®ç°ç±»-2">EmployeeServiceImpl.java</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åˆ†ç±»serviceå±‚å®ç°ç±»-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†ç±»ä¸šåŠ¡å±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryMapper categoryMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(CategoryDTO categoryDTO)</span> &#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();</span><br><span class="line">        <span class="comment">//å±æ€§æ‹·è´</span></span><br><span class="line">        BeanUtils.copyProperties(categoryDTO, category);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ†ç±»çŠ¶æ€é»˜è®¤ä¸ºç¦ç”¨çŠ¶æ€0</span></span><br><span class="line">        category.setStatus(StatusConstant.DISABLE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹äºº</span></span><br><span class="line">        category.setCreateTime(LocalDateTime.now());</span><br><span class="line">        category.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        category.setCreateUser(BaseContext.getCurrentId());</span><br><span class="line">        category.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        categoryMapper.insert(category);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(CategoryPageQueryDTO categoryPageQueryDTO)</span> &#123;</span><br><span class="line">        PageHelper.startPage(categoryPageQueryDTO.getPage(),categoryPageQueryDTO.getPageSize());</span><br><span class="line">        <span class="comment">//ä¸‹ä¸€æ¡sqlè¿›è¡Œåˆ†é¡µï¼Œè‡ªåŠ¨åŠ å…¥limitå…³é”®å­—åˆ†é¡µ</span></span><br><span class="line">        Page&lt;Category&gt; page = categoryMapper.pageQuery(categoryPageQueryDTO);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), page.getResult());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å½“å‰åˆ†ç±»æ˜¯å¦å…³è”äº†èœå“ï¼Œå¦‚æœå…³è”äº†å°±æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> dishMapper.countByCategoryId(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//å½“å‰åˆ†ç±»ä¸‹æœ‰èœå“ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.CATEGORY_BE_RELATED_BY_DISH);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å½“å‰åˆ†ç±»æ˜¯å¦å…³è”äº†å¥—é¤ï¼Œå¦‚æœå…³è”äº†å°±æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">        count = setmealMapper.countByCategoryId(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//å½“å‰åˆ†ç±»ä¸‹æœ‰èœå“ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.CATEGORY_BE_RELATED_BY_SETMEAL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤åˆ†ç±»æ•°æ®</span></span><br><span class="line">        categoryMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(CategoryDTO categoryDTO)</span> &#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();</span><br><span class="line">        BeanUtils.copyProperties(categoryDTO,category);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®ä¿®æ”¹æ—¶é—´ã€ä¿®æ”¹äºº</span></span><br><span class="line">        category.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        category.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        categoryMapper.update(category);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯ç”¨ã€ç¦ç”¨åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> Category.builder()</span><br><span class="line">                .id(id)</span><br><span class="line">                .status(status)</span><br><span class="line">                .updateTime(LocalDateTime.now())</span><br><span class="line">                .updateUser(BaseContext.getCurrentId())</span><br><span class="line">                .build();</span><br><span class="line">        categoryMapper.update(category);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">list</span><span class="params">(Integer type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> categoryMapper.list(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åˆ†ç±»serviceå±‚å®ç°ç±»-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘˜å·¥ç™»å½•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">login</span><span class="params">(EmployeeLoginDTO employeeLoginDTO)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> employeeLoginDTO.getUsername();</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employeeLoginDTO.getPassword();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getByUsername(username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼ˆç”¨æˆ·åä¸å­˜åœ¨ã€å¯†ç ä¸å¯¹ã€è´¦å·è¢«é”å®šï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (employee == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è´¦å·ä¸å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccountNotFoundException</span>(MessageConstant.ACCOUNT_NOT_FOUND);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯†ç æ¯”å¯¹</span></span><br><span class="line">        <span class="comment">// TODO åæœŸéœ€è¦è¿›è¡Œmd5åŠ å¯†ï¼Œç„¶åå†è¿›è¡Œæ¯”å¯¹</span></span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line">        <span class="keyword">if</span> (!password.equals(employee.getPassword())) &#123;</span><br><span class="line">            <span class="comment">//å¯†ç é”™è¯¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordErrorException</span>(MessageConstant.PASSWORD_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (employee.getStatus().equals(StatusConstant.DISABLE)) &#123;</span><br><span class="line">            <span class="comment">//è´¦å·è¢«é”å®š</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccountLockedException</span>(MessageConstant.ACCOUNT_LOCKED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3ã€è¿”å›å®ä½“å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹è±¡å±æ€§æ‹·è´</span></span><br><span class="line">        BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è´¦å·çš„çŠ¶æ€ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ 1è¡¨ç¤ºæ­£å¸¸ 0è¡¨ç¤ºé”å®š</span></span><br><span class="line">        employee.setStatus(StatusConstant.ENABLE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å¯†ç ï¼Œé»˜è®¤å¯†ç 123456</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´</span></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰è®°å½•åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line">        employee.setCreateUser(BaseContext.getCurrentId());<span class="comment">//ç›®å‰å†™ä¸ªå‡æ•°æ®ï¼ŒåæœŸä¿®æ”¹</span></span><br><span class="line">        employee.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        employeeMapper.insert(employee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// select * from employee limit 0,10</span></span><br><span class="line">        <span class="comment">//å¼€å§‹åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">        PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">        Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">        List&lt;Employee&gt; records = page.getResult();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, records);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> Employee.builder()</span><br><span class="line">                .status(status)</span><br><span class="line">                .id(id)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        employeeMapper.update(employee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getById(id);</span><br><span class="line">        employee.setPassword(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">        BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        employeeMapper.update(employee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p></p><h4 id="Controllerå±‚-1"><a href="#Controllerå±‚-1" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>CategoryController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†ç±»ç®¡ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/category&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;åˆ†ç±»ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> CategoryDTO categoryDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–°å¢åˆ†ç±»ï¼š&#123;&#125;&quot;</span>, categoryDTO);</span><br><span class="line">        categoryService.save(categoryDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;åˆ†ç±»åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(CategoryPageQueryDTO categoryPageQueryDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;åˆ†é¡µæŸ¥è¯¢ï¼š&#123;&#125;&quot;</span>, categoryPageQueryDTO);</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> categoryService.pageQuery(categoryPageQueryDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;åˆ é™¤åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">deleteById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;åˆ é™¤åˆ†ç±»ï¼š&#123;&#125;&quot;</span>, id);</span><br><span class="line">        categoryService.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¿®æ”¹åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> CategoryDTO categoryDTO)</span>&#123;</span><br><span class="line">        categoryService.update(categoryDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯ç”¨ã€ç¦ç”¨åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å¯ç”¨ç¦ç”¨åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status, Long id)</span>&#123;</span><br><span class="line">        categoryService.startOrStop(status,id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Integer type)</span>&#123;</span><br><span class="line">        List&lt;Category&gt; list = categoryService.list(type);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-4"><a href="#åŠŸèƒ½æµ‹è¯•-4" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p><strong>åˆ†é¡µæŸ¥è¯¢å’Œåˆ†ç±»ç±»å‹</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251112225311.png"></div></div><br><strong>å¯ç”¨ç¦ç”¨</strong><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251112225433.png"></div></div><p></p><p><strong>ä¿®æ”¹</strong><br>å›æ˜¾<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251112225716.png"></div></div><p></p><p>ä¿®æ”¹å</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251112225813.png"></div></div><p><strong>æ–°å¢</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112172356093.png"></div></div><p><strong>åˆ é™¤</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221112172525216.png"></div></div><h1 id="day03"><a href="#day03" class="headerlink" title="day03"></a>day03</h1><h2 id="è¯¾ç¨‹å†…å®¹-1"><a href="#è¯¾ç¨‹å†…å®¹-1" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</li><li>æ–°å¢èœå“</li><li>èœå“åˆ†é¡µæŸ¥è¯¢</li><li>åˆ é™¤èœå“</li><li>ä¿®æ”¹èœå“</li></ul><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>èœå“ç®¡ç†</p><p><strong>èœå“ç®¡ç†æ•ˆæœå›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121142133307.png"></div></div><h2 id="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>åœ¨å‰é¢å­¦ä¹ çš„<code>å‘˜å·¥ç®¡ç†åŠŸèƒ½</code>å’Œ<code>èœå“åˆ†ç±»åŠŸèƒ½</code>ï¼Œåœ¨ <strong>æ·»åŠ å‘˜å·¥</strong> æˆ–è€… <strong>æ·»åŠ èœå“åˆ†ç±»</strong> æ—¶éƒ½éœ€è¦è®¾ç½®åˆ›å»ºæ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹æ—¶é—´ã€ä¿®æ”¹äººç­‰å­—æ®µï¼Œåœ¨ <strong>ç¼–è¾‘å‘˜å·¥</strong> æˆ– <strong>ç¼–è¾‘èœå“</strong> åˆ†ç±»æ—¶éœ€è¦è®¾ç½®ä¿®æ”¹æ—¶é—´ã€ä¿®æ”¹äººç­‰å­—æ®µã€‚è¿™äº›å­—æ®µå±äºå…¬å…±å­—æ®µä¹Ÿå°±æ˜¯åœ¨ç³»ç»Ÿä¸­å¾ˆå¤šè¡¨ä¸­éƒ½ä¼šæœ‰è¿™äº›å­—æ®µï¼Œå¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th><strong>åºå·</strong></th><th><strong>å­—æ®µå</strong></th><th><strong>å«ä¹‰</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th></tr></thead><tbody><tr><td>1</td><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td><td>datetime</td></tr><tr><td>2</td><td>create_user</td><td>åˆ›å»ºäººid</td><td>bigint</td></tr><tr><td>3</td><td>update_time</td><td>ä¿®æ”¹æ—¶é—´</td><td>datetime</td></tr><tr><td>4</td><td>update_user</td><td>ä¿®æ”¹äººid</td><td>bigint</td></tr></tbody></table></div><p>é’ˆå¯¹è¿™äº›å­—æ®µçš„èµ‹å€¼æ–¹å¼é€šå¸¸ä¸ºï¼š</p><ol><li>æ–°å¢æ•°æ®æ—¶, å°†<code>createTime</code>ã€<code>updateTime</code> è®¾ç½®ä¸ºå½“å‰æ—¶é—´, <code>createUser</code>ã€<code>updateUser</code>è®¾ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·IDã€‚</li><li>æ›´æ–°æ•°æ®æ—¶, å°†<code>updateTime</code>è®¾ç½®ä¸ºå½“å‰æ—¶é—´, <code>updateUser</code>è®¾ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·IDã€‚</li></ol><div class="note info no-icon flat"><p>ç›®å‰å¤„ç†è¿™äº›å­—æ®µéƒ½æ˜¯é€šè¿‡åœ¨å¯¹åº”çš„æ·»åŠ ã€ä¿®æ”¹æ–¹æ³•ä¸­æ‰‹åŠ¨è®¾ç½®è¿™äº›å­—æ®µçš„å€¼æ¥å®ç°ï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚æ–°å¢ã€ä¿®æ”¹æ–¹æ³•ä¸­å¦‚æœå¿˜è®°è®¾ç½®è¿™äº›å­—æ®µçš„å€¼ï¼Œé‚£ä¹ˆè¿™äº›å­—æ®µçš„å€¼å°±ä¼šä¸¢å¤±ï¼Œä¸”å¤„ç†æ–¹æ³•ç›¸å¯¹å†—ä½™ã€ç¹çã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡AOPåˆ‡é¢ç¼–ç¨‹æ¥å®ç°è¿™äº›å…¬å…±å­—æ®µçš„è‡ªåŠ¨å¡«å……ã€‚</p></div><h3 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><p>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……ï¼Œä¹Ÿå°±æ˜¯åœ¨æ’å…¥æˆ–è€…æ›´æ–°çš„æ—¶å€™ä¸ºæŒ‡å®šå­—æ®µèµ‹äºˆæŒ‡å®šçš„å€¼ï¼Œä½¿ç”¨å®ƒçš„å¥½å¤„å°±æ˜¯å¯ä»¥ç»Ÿä¸€å¯¹è¿™äº›å­—æ®µè¿›è¡Œå¤„ç†ï¼Œé¿å…äº†é‡å¤ä»£ç ,å‰é¢æåˆ°çš„å…±æœ‰å››ä¸ªå…¬å…±å­—æ®µéœ€è¦è¿›è¡Œè‡ªåŠ¨å¡«å……ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>createTime</code>ã€<code>updateTime</code>ã€<code>createUser</code>ã€<code>updateUser</code>ã€‚</p><div class="table-container"><table><thead><tr><th><strong>åºå·</strong></th><th><strong>å­—æ®µå</strong></th><th><strong>å«ä¹‰</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>æ“ä½œç±»å‹</strong></th></tr></thead><tbody><tr><td>1</td><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td><td>datetime</td><td>insert</td></tr><tr><td>2</td><td>create_user</td><td>åˆ›å»ºäººid</td><td>bigint</td><td>insert</td></tr><tr><td>3</td><td>update_time</td><td>ä¿®æ”¹æ—¶é—´</td><td>datetime</td><td>insertã€update</td></tr><tr><td>4</td><td>update_user</td><td>ä¿®æ”¹äººid</td><td>bigint</td><td>insertã€update</td></tr></tbody></table></div><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><ol><li>è‡ªå®šä¹‰æ³¨è§£<code>AutoFill</code>ï¼Œç”¨äºæ ‡è¯†éœ€è¦è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……çš„æ–¹æ³•ã€‚</li><li>è‡ªå®šä¹‰åˆ‡é¢ç±»<code>AutoFillAspect</code>ï¼Œç»Ÿä¸€æ‹¦æˆªåŠ å…¥äº†<code>AutoFill</code>æ³¨è§£çš„æ–¹æ³•ï¼Œé€šè¿‡åå°„ä¸ºå…¬å…±å­—æ®µèµ‹å€¼ã€‚</li><li>åœ¨Mapperçš„æ–¹æ³•ä¸ŠåŠ å…¥<code>AutoFill</code>æ³¨è§£</li></ol><div class="note info no-icon flat"><p><strong>æŠ€æœ¯ç‚¹ï¼š</strong> æšä¸¾ã€æ³¨è§£ã€AOPã€åå°„</p></div><h3 id="ä»£ç å¼€å‘-4"><a href="#ä»£ç å¼€å‘-4" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h4><p>è¿›å…¥sky-serveræ¨¡å—ï¼Œåˆ›å»ºcom.sky.annotationåŒ…<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºæ ‡è¯†æŸä¸ªæ–¹æ³•éœ€è¦è¿›è¡ŒåŠŸèƒ½å­—æ®µè‡ªåŠ¨å¡«å……å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoFill &#123;</span><br><span class="line">    <span class="comment">//æ•°æ®åº“æ“ä½œç±»å‹ï¼šUPDATE INSERT</span></span><br><span class="line">    OperationType <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…¶ä¸­OperationTypeå·²åœ¨sky-commonæ¨¡å—ä¸­å®šä¹‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“æ“ä½œç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">OperationType</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UPDATE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INSERT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="è‡ªå®šä¹‰åˆ‡é¢"><a href="#è‡ªå®šä¹‰åˆ‡é¢" class="headerlink" title="è‡ªå®šä¹‰åˆ‡é¢"></a>è‡ªå®šä¹‰åˆ‡é¢</h4><p>åœ¨sky-serveræ¨¡å—ï¼Œåˆ›å»ºcom.sky.aspectåŒ…<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰åˆ‡é¢ï¼Œå®ç°å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……å¤„ç†é€»è¾‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰ç½®é€šçŸ¥ï¼Œåœ¨é€šçŸ¥ä¸­è¿›è¡Œå…¬å…±å­—æ®µçš„èµ‹å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">/////////////////////é‡è¦////////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å¯å…ˆè¿›è¡Œè°ƒè¯•ï¼Œæ˜¯å¦èƒ½è¿›å…¥è¯¥æ–¹æ³• æå‰åœ¨mapperæ–¹æ³•æ·»åŠ AutoFillæ³¨è§£</span></span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>å®Œå–„è‡ªå®šä¹‰åˆ‡é¢ <code>AutoFillAspect</code> çš„ <code>autoFill</code> æ–¹æ³•</strong><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰åˆ‡é¢ï¼Œå®ç°å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……å¤„ç†é€»è¾‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰ç½®é€šçŸ¥ï¼Œåœ¨é€šçŸ¥ä¸­è¿›è¡Œå…¬å…±å­—æ®µçš„èµ‹å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–åˆ°å½“å‰è¢«æ‹¦æˆªçš„æ–¹æ³•ä¸Šçš„æ•°æ®åº“æ“ä½œç±»å‹</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();<span class="comment">//æ–¹æ³•ç­¾åå¯¹è±¡</span></span><br><span class="line">        <span class="type">AutoFill</span> <span class="variable">autoFill</span> <span class="operator">=</span> signature.getMethod().getAnnotation(AutoFill.class);<span class="comment">//è·å¾—æ–¹æ³•ä¸Šçš„æ³¨è§£å¯¹è±¡</span></span><br><span class="line">        <span class="type">OperationType</span> <span class="variable">operationType</span> <span class="operator">=</span> autoFill.value();<span class="comment">//è·å¾—æ•°æ®åº“æ“ä½œç±»å‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–åˆ°å½“å‰è¢«æ‹¦æˆªçš„æ–¹æ³•çš„å‚æ•°--å®ä½“å¯¹è±¡</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="keyword">if</span>(args == <span class="literal">null</span> || args.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">entity</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‡†å¤‡èµ‹å€¼çš„æ•°æ®</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¹æ®å½“å‰ä¸åŒçš„æ“ä½œç±»å‹ï¼Œä¸ºå¯¹åº”çš„å±æ€§é€šè¿‡åå°„æ¥èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">if</span>(operationType == OperationType.INSERT)&#123;</span><br><span class="line">            <span class="comment">//ä¸º4ä¸ªå…¬å…±å­—æ®µèµ‹å€¼</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setCreateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME, LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setCreateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER, Long.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//é€šè¿‡åå°„ä¸ºå¯¹è±¡å±æ€§èµ‹å€¼</span></span><br><span class="line">                setCreateTime.invoke(entity,now);</span><br><span class="line">                setCreateUser.invoke(entity,currentId);</span><br><span class="line">                setUpdateTime.invoke(entity,now);</span><br><span class="line">                setUpdateUser.invoke(entity,currentId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(operationType == OperationType.UPDATE)&#123;</span><br><span class="line">            <span class="comment">//ä¸º2ä¸ªå…¬å…±å­—æ®µèµ‹å€¼</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//é€šè¿‡åå°„ä¸ºå¯¹è±¡å±æ€§èµ‹å€¼</span></span><br><span class="line">                setUpdateTime.invoke(entity,now);</span><br><span class="line">                setUpdateUser.invoke(entity,currentId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ æ³¨è§£"><a href="#æ·»åŠ æ³¨è§£" class="headerlink" title="æ·»åŠ æ³¨è§£"></a>æ·»åŠ æ³¨è§£</h4><p>ä»¥<strong>CategoryMapper</strong>ä¸ºä¾‹ï¼Œåˆ†åˆ«åœ¨æ–°å¢å’Œä¿®æ”¹æ–¹æ³•æ·»åŠ <code>@AutoFill()</code>æ³¨è§£ï¼Œä¹Ÿéœ€è¦<strong>EmployeeMapper</strong>åšç›¸åŒæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into category(type, name, sort, status, create_time, update_time, create_user, update_user)&quot; +</span></span><br><span class="line"><span class="meta">            &quot; VALUES&quot; +</span></span><br><span class="line"><span class="meta">            &quot; (#&#123;type&#125;, #&#123;name&#125;, #&#123;sort&#125;, #&#123;status&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@AutoFill(value = OperationType.INSERT)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Category category)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idä¿®æ”¹åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AutoFill(value = OperationType.UPDATE)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Category category)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info no-icon flat"><p>æ‰§è¡Œå®Œè¿™ä¸‰æ­¥æ“ä½œä»¥åï¼Œå°±å¯ä»¥å°†ä¸šåŠ¡å±‚ä¸­ä¸ºå…¬å…±å­—æ®µèµ‹å€¼çš„ä»£ç æ³¨é‡Šæ‰äº†</p></div><h3 id="åŠŸèƒ½æµ‹è¯•-5"><a href="#åŠŸèƒ½æµ‹è¯•-5" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>é‡å¯é¡¹ç›®å¹¶æ–°å¢ä¸€ä¸ªèœå“åˆ†ç±»</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251113151602.png"></div></div><p>æ–°å¢ä¹‹åï¼Œå¯ä»¥å»æ•°æ®åº“æŸ¥çœ‹categoryè¡¨ï¼Œæ–°å¢çš„åˆ†ç±»æ•°æ®å·²ç»åŒ…å«äº†å…¬å…±å­—æ®µçš„èµ‹å€¼:<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251113151602.png"></div></div><p></p><h2 id="æ–°å¢èœå“"><a href="#æ–°å¢èœå“" class="headerlink" title="æ–°å¢èœå“"></a>æ–°å¢èœå“</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-5"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-5" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><p>åœ¨åå°ç³»ç»Ÿå¯ä»¥ç®¡ç†èœå“çš„ä¿¡æ¯ï¼Œé€šè¿‡æ–°å¢åŠŸèƒ½æ¥æ·»åŠ æ–°çš„èœå“ï¼Œåœ¨æ·»åŠ æ—¶éœ€è¦é€‰æ‹©èœå“æ‰€å±åˆ†ç±»å¹¶ä¸”ä¸Šä¼ èœå“å›¾ç‰‡<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121164131337.png"></div></div><p></p><div class="note info no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>èœå“åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„</li><li>èœå“å¿…é¡»å±äºæŸä¸ªåˆ†ç±»ä¸‹ï¼Œä¸èƒ½å•ç‹¬å­˜åœ¨</li><li>æ–°å¢èœå“æ—¶å¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©èœå“çš„å£å‘³</li><li>æ¯ä¸ªèœå“å¿…é¡»å¯¹åº”ä¸€å¼ å›¾ç‰‡</li></ul></div><h4 id="æ¥å£è®¾è®¡-1"><a href="#æ¥å£è®¾è®¡-1" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><ul><li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»ï¼ˆå·²å®Œæˆï¼‰</li><li>æ–‡ä»¶ä¸Šä¼ </li><li>æ–°å¢èœå“</li></ul><div class="tabs" id="å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡-1">æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</button></li><li class="tab"><button type="button" data-href="#å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡-2">æ–‡ä»¶ä¸Šä¼ </button></li><li class="tab"><button type="button" data-href="#å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡-3">æ–°å¢èœå“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165033612.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165043619.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165033612.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165215634.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å®¶ç«¯æ–°å¢èœå“æ¥å£è®¾è®¡-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165254961.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165322687.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="è¡¨è®¾è®¡-1"><a href="#è¡¨è®¾è®¡-1" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121165917874.png" style="width:600px"></div></div><p>æ–°å¢èœå“ï¼Œå…¶å®å°±æ˜¯å°†æ–°å¢é¡µé¢å½•å…¥çš„èœå“ä¿¡æ¯æ’å…¥åˆ°dishè¡¨ï¼Œå¦‚æœæ·»åŠ äº†å£å‘³åšæ³•ï¼Œè¿˜éœ€è¦å‘dish_flavorè¡¨æ’å…¥æ•°æ®ã€‚æ‰€ä»¥åœ¨æ–°å¢èœå“æ—¶ï¼Œæ¶‰åŠåˆ°ä¸¤ä¸ªè¡¨ï¼š</p><div class="table-container"><table><thead><tr><th>è¡¨å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>dish</td><td>èœå“è¡¨</td></tr><tr><td>dish_flavor</td><td>èœå“å£å‘³è¡¨</td></tr></tbody></table></div><div class="tabs" id="æ–°å¢èœå“è¡¨è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢èœå“è¡¨è®¾è®¡-1">dishè¡¨</button></li><li class="tab"><button type="button" data-href="#æ–°å¢èœå“è¡¨è®¾è®¡-2">dish_flavor</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢èœå“è¡¨è®¾è®¡-1"><div class="table-container"><table><thead><tr><th><strong>å­—æ®µå</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>name</td><td>varchar(32)</td><td>èœå“åç§°</td><td>å”¯ä¸€</td></tr><tr><td>category_id</td><td>bigint</td><td>åˆ†ç±»id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>price</td><td>decimal(10,2)</td><td>èœå“ä»·æ ¼</td><td></td></tr><tr><td>image</td><td>varchar(255)</td><td>å›¾ç‰‡è·¯å¾„</td><td></td></tr><tr><td>description</td><td>varchar(255)</td><td>èœå“æè¿°</td><td></td></tr><tr><td>status</td><td>int</td><td>å”®å–çŠ¶æ€</td><td>1èµ·å”® 0åœå”®</td></tr><tr><td>create_time</td><td>datetime</td><td>åˆ›å»ºæ—¶é—´</td><td></td></tr><tr><td>update_time</td><td>datetime</td><td>æœ€åä¿®æ”¹æ—¶é—´</td><td></td></tr><tr><td>create_user</td><td>bigint</td><td>åˆ›å»ºäººid</td><td></td></tr><tr><td>update_user</td><td>bigint</td><td>æœ€åä¿®æ”¹äººid</td></tr></tbody></table></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢èœå“è¡¨è®¾è®¡-2"><div class="table-container"><table><thead><tr><th><strong>å­—æ®µå</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>dish_id</td><td>bigint</td><td>èœå“id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>name</td><td>varchar(32)</td><td>å£å‘³åç§°</td><td></td></tr><tr><td>value</td><td>varchar(255)</td><td>å£å‘³å€¼</td></tr></tbody></table></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="ä»£ç å¼€å‘-5"><a href="#ä»£ç å¼€å‘-5" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½"><a href="#æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½"></a>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</h4><p>æ–°å¢èœå“æ—¶ï¼Œéœ€è¦ä¸Šä¼ èœå“çš„å›¾ç‰‡ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨åˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚<br>æ–‡ä»¶ä¸Šä¼ æ˜¯å°†æœ¬åœ°å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ¥ä¾›å…¶ä»–ç”¨æˆ·æµè§ˆæˆ–ä¸‹è½½çš„è¿‡ç¨‹ã€‚å®ç°æ–‡ä»¶ä¸Šä¼ æœåŠ¡åˆ†ä¸ºå¯¹æ–‡ä»¶è¿›è¡Œå­˜å‚¨å’Œå–å‡ºå­˜å‚¨çš„æ–‡ä»¶ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¯¹äºæ–‡ä»¶çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>ç›´æ¥å°†å›¾ç‰‡ä¿å­˜åˆ°æœåŠ¡çš„ç¡¬ç›˜ï¼ˆspringmvcä¸­çš„æ–‡ä»¶ä¸Šä¼ ï¼‰<ul><li>ä¼˜ç‚¹ï¼šå¼€å‘ä¾¿æ·ï¼Œæˆæœ¬ä½</li><li>ç¼ºç‚¹ï¼šæ‰©å®¹å›°éš¾</li></ul></li><li>ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå­˜å‚¨<ul><li>ä¼˜ç‚¹ï¼šå®¹æ˜“å®ç°æ‰©å®¹</li><li>ç¼ºç‚¹ï¼šå¼€å‘å¤æ‚åº¦ç¨å¤§ï¼ˆæœ‰æˆç†Ÿçš„äº§å“å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šFastDFS,MinIOï¼‰</li></ul></li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å­˜å‚¨æœåŠ¡ï¼ˆä¾‹å¦‚OSSï¼‰<ul><li>ä¼˜ç‚¹ï¼šå¼€å‘ç®€å•ï¼Œæ‹¥æœ‰å¼ºå¤§åŠŸèƒ½ï¼Œå…ç»´æŠ¤</li><li>ç¼ºç‚¹ï¼šä»˜è´¹(ä¸ªäººä½¿ç”¨çš„è¯è´¹ç”¨å¾ˆä½)</li></ul></li></ol><div class="note info no-icon flat"><p>æ­¤å¤„ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„OSSæœåŠ¡è¿›è¡Œæ–‡ä»¶å­˜å‚¨ï¼Œå…·ä½“çš„é˜¿é‡Œäº‘OSSå†…å®¹åœ¨æœ€æ–°ç‰ˆçš„Webè¯¾ç¨‹ä¸­æœ‰è¿‡ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸é‡å¤ä»‹ç»äº†ã€‚<br><a target="_blank" rel="noopener" href="https://heuqqdmbyk.feishu.cn/wiki/PHp6wXaNUij3bokCXWrclz5anWh">Webåœ¨çº¿ç¬”è®°</a></p></div><p><strong><em>å®ç°æ­¥éª¤ï¼š</em></strong></p><ol><li>å®šä¹‰OSSç›¸å…³é…ç½®<br>åœ¨sky-serveræ¨¡å—çš„<code>application-dev.yml</code>ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®,å…¶ä¸­<code>access-key-id</code>å’Œ<code>access-key-secret</code>éœ€è¦ä»é˜¿é‡Œäº‘OSSæ§åˆ¶å°è·å–<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">oss-cn-beijing.aliyuncs.com</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">secret</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">sky-take-out-silvan</span></span><br></pre></td></tr></table></figure><div class="note warning no-icon flat"><ul><li>æ­¤å¤„çš„<code>access-key-id</code>å’Œ<code>access-key-secret</code>éœ€è¦ä»é˜¿é‡Œäº‘OSSæ§åˆ¶å°è·å–ï¼Œè¯·å‹¿æ³„éœ²</li><li><code>endpoint</code>çš„åŒºåŸŸä¹Ÿéœ€è¦æ ¹æ®bucketæ‰€åœ¨åœ°åŒºè¿›è¡Œé€‰æ‹©ï¼Œå¦‚åœ¨æ­å·ï¼Œåˆ™<code>endpoint</code>ä¸º<code>oss-cn-hangzhou.aliyuncs.com</code></li></ul></div></li><li>è¯»å–OSSé…ç½®<br>åœ¨sky-commonæ¨¡å—ä¸­ï¼ŒåŸºç¡€å·¥ç¨‹å·²å®šä¹‰<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sky.alioss&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ç”ŸæˆOSSå·¥å…·ç±»å¯¹è±¡<br>åœ¨sky-serveræ¨¡å—çš„configåŒ…ä¸‹æ–°å»ºOSSé…ç½®ç±»<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºAliOssUtilå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> AliOssUtil <span class="title function_">aliOssUtil</span><span class="params">(AliOssProperties aliOssProperties)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹åˆ›å»ºé˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ å·¥å…·ç±»å¯¹è±¡ï¼š&#123;&#125;&quot;</span>,aliOssProperties);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AliOssUtil</span>(aliOssProperties.getEndpoint(),</span><br><span class="line">                aliOssProperties.getAccessKeyId(),</span><br><span class="line">                aliOssProperties.getAccessKeySecret(),</span><br><span class="line">                aliOssProperties.getBucketName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å…¶ä¸­çš„<code>AliOssUtil.java</code>å·²ç»åœ¨sky-commonæ¨¡å—ä¸­å®šä¹‰äº†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] bytes, String objectName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºOSSClientå®ä¾‹ã€‚</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºPutObjectè¯·æ±‚ã€‚</span></span><br><span class="line">            ossClient.putObject(bucketName, objectName, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OSSException oe) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;but was rejected with an error response for some reason.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + oe.getErrorMessage());</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Code:&quot;</span> + oe.getErrorCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Request ID:&quot;</span> + oe.getRequestId());</span><br><span class="line">            System.out.println(<span class="string">&quot;Host ID:&quot;</span> + oe.getHostId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException ce) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an ClientException, which means the client encountered &quot;</span></span><br><span class="line">                    + <span class="string">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;such as not being able to access the network.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + ce.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–‡ä»¶è®¿é—®è·¯å¾„è§„åˆ™ https://BucketName.Endpoint/ObjectName</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;https://&quot;</span>);</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(bucketName)</span><br><span class="line">                .append(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">                .append(endpoint)</span><br><span class="line">                .append(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .append(objectName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ åˆ°:&#123;&#125;&quot;</span>, stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>å®šä¹‰æ–‡ä»¶ä¸Šä¼ æ¥å£<br>åœ¨Controllerå±‚ä¸­å®šä¹‰æ¥å£<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šç”¨æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/common&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;é€šç”¨æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOssUtil aliOssUtil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–‡ä»¶ä¸Šä¼ &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ ï¼š&#123;&#125;&quot;</span>,file);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åŸå§‹æ–‡ä»¶å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//æˆªå–åŸå§‹æ–‡ä»¶åçš„åç¼€   dfdfdf.png</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="comment">//æ„é€ æ–°æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> UUID.randomUUID().toString() + extension;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ–‡ä»¶çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> aliOssUtil.upload(file.getBytes(), objectName);</span><br><span class="line">            <span class="keyword">return</span> Result.success(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š&#123;&#125;&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–°å¢èœå“å®ç°"><a href="#æ–°å¢èœå“å®ç°" class="headerlink" title="æ–°å¢èœå“å®ç°"></a>æ–°å¢èœå“å®ç°</h4></li><li>è®¾è®¡DTOç±»<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//èœå“åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//èœå“åˆ†ç±»id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//èœå“ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">//å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="comment">//æè¿°ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//0 åœå”® 1 èµ·å”®</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="comment">//å£å‘³</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>Controllerå±‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èœå“ç®¡ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;èœå“ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–°å¢èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);</span><br><span class="line">        dishService.saveWithFlavor(dishDTO);<span class="comment">//åç»ªæ­¥éª¤å¼€å‘</span></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>Serviceå±‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢èœå“å’Œå¯¹åº”çš„å£å‘³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ServiceImplå±‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢èœå“å’Œå¯¹åº”çš„å£å‘³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        BeanUtils.copyProperties(dishDTO, dish);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘èœå“è¡¨æ’å…¥1æ¡æ•°æ®</span></span><br><span class="line">        dishMapper.insert(dish);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–insertè¯­å¥ç”Ÿæˆçš„ä¸»é”®å€¼</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dish.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">        <span class="keyword">if</span> (flavors != <span class="literal">null</span> &amp;&amp; flavors.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">                dishFlavor.setDishId(dishId);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//å‘å£å‘³è¡¨æ’å…¥næ¡æ•°æ®</span></span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>Mapperå±‚</li><li><div class="tabs" id="æ–°å¢èœå“å®ç°dishmapper"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢èœå“å®ç°dishmapper-1">DishMapper.java</button></li><li class="tab"><button type="button" data-href="#æ–°å¢èœå“å®ç°dishmapper-2">DishMapper.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢èœå“å®ç°dishmapper-1"><p>åœ¨DishMapperä¸­æ·»åŠ <br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥èœå“æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AutoFill(value = OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢èœå“å®ç°dishmapper-2"><p>åœ¨/resources/mapperä¸­æ–°å»ºDishMapper.xml<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into dish (name, category_id, price, image, description, create_time, update_time, create_user,update_user, status)</span><br><span class="line">        values (#&#123;name&#125;, #&#123;categoryId&#125;, #&#123;price&#125;, #&#123;image&#125;, #&#123;description&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;, #&#123;status&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>DishFlavorMapper<div class="tabs" id="æ–°å¢èœå“å®ç°dishflavormapper"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢èœå“å®ç°dishflavormapper-1">DishFlavorMapper.java</button></li><li class="tab"><button type="button" data-href="#æ–°å¢èœå“å®ç°dishflavormapper-2">DishFlavorMapper.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢èœå“å®ç°dishflavormapper-1"><p>åœ¨DishFlavorMapperä¸­æ·»åŠ <br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishFlavorMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥å£å‘³æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flavors</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(List&lt;DishFlavor&gt; flavors)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢èœå“å®ç°dishflavormapper-2"><p>åœ¨/resources/mapperä¸­æ–°å»ºDishFlavorMapper.xml<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span>&gt;</span></span><br><span class="line">        insert into dish_flavor (dish_id, name, value) VALUES</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;flavors&quot;</span> <span class="attr">item</span>=<span class="string">&quot;df&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li></ol><h3 id="åŠŸèƒ½æµ‹è¯•-6"><a href="#åŠŸèƒ½æµ‹è¯•-6" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>ç™»å½• -&gt; èœå“ç®¡ç† -&gt; æ–°å¢èœå“ -&gt; è¾“å…¥èœå“ä¿¡æ¯ -&gt; ä¿å­˜<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251113211125.png"></div></div><br>æš‚æ—¶è¿˜æ²¡æœ‰å®ç°èœå“æŸ¥è¯¢åŠŸèƒ½ï¼Œæ‰€ä»¥ä¿å­˜åé€šè¿‡æ•°æ®åº“æŸ¥çœ‹æ·»åŠ çš„æ•°æ®<p></p><h2 id="èœå“åˆ†é¡µæŸ¥è¯¢"><a href="#èœå“åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="èœå“åˆ†é¡µæŸ¥è¯¢"></a>èœå“åˆ†é¡µæŸ¥è¯¢</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-6"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-6" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p><strong>éœ€æ±‚åˆ†æ</strong><br>ç³»ç»Ÿä¸­çš„èœå“æ•°æ®å¾ˆå¤šçš„æ—¶å€™ï¼Œå¦‚æœåœ¨ä¸€ä¸ªé¡µé¢ä¸­å…¨éƒ¨å±•ç¤ºå‡ºæ¥ä¼šæ˜¾å¾—æ¯”è¾ƒä¹±ï¼Œä¸ä¾¿äºæŸ¥çœ‹ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„ç³»ç»Ÿä¸­éƒ½ä¼šä»¥åˆ†é¡µçš„æ–¹å¼æ¥å±•ç¤ºåˆ—è¡¨æ•°æ®ã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121201552489.png"></div></div><br><div class="note info no-icon flat"><p>èœå“ä¿¡æ¯å±•ç¤ºæ—¶ï¼Œèœå“çš„å›¾ç‰‡å­—æ®µå’Œèœå“åˆ†ç±»å­—æ®µè¾ƒç‰¹æ®Š</p><ul><li>å›¾ç‰‡å­—æ®µåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„ä»…ä»…æ˜¯å›¾ç‰‡åç§°ï¼Œæƒ³è¦å›æ˜¾åˆ°é¡µé¢åˆ™éœ€è¦ä¸‹è½½è¯¥å›¾ç‰‡</li><li>åˆ†ç±»åç§°å­˜å‚¨å½¢å¼æ˜¯åˆ†ç±»idï¼Œéœ€è¦æ ¹æ®idæ¥æŸ¥è¯¢åˆ†ç±»åç§°å¹¶å±•ç¤º</li></ul></div><p></p><p><strong>æ¥å£è®¾è®¡</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121202019258.png"></div></div><p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121202033284.png"></div></div><h3 id="ä»£ç å¼€å‘-6"><a href="#ä»£ç å¼€å‘-6" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="è®¾è®¡DTOç±»"><a href="#è®¾è®¡DTOç±»" class="headerlink" title="è®¾è®¡DTOç±»"></a>è®¾è®¡DTOç±»</h4><p><strong>æ ¹æ®èœå“åˆ†é¡µæŸ¥è¯¢æ¥å£å®šä¹‰è®¾è®¡å¯¹åº”çš„DTOï¼š</strong></p><p>åœ¨sky-pojoæ¨¡å—ä¸­æä¾›äº†<code>DishPageQueryDTO</code>ç±»ç”¨äºæ¥æ”¶èœå“åˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishPageQueryDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> page;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer categoryId; <span class="comment">//åˆ†ç±»id</span></span><br><span class="line">    <span class="keyword">private</span> Integer status; <span class="comment">//çŠ¶æ€ 0è¡¨ç¤ºç¦ç”¨ 1è¡¨ç¤ºå¯ç”¨</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¾è®¡VOç±»"><a href="#è®¾è®¡VOç±»" class="headerlink" title="è®¾è®¡VOç±»"></a>è®¾è®¡VOç±»</h4><p><strong>æ ¹æ®èœå“åˆ†é¡µæŸ¥è¯¢æ¥å£å®šä¹‰è®¾è®¡å¯¹åº”çš„VOï¼š</strong></p><p>åœ¨sky-pojoæ¨¡å—ä¸­æä¾›äº†<code>DishVO</code>ç±»ç”¨äºè¿”å›èœå“åˆ†é¡µæŸ¥è¯¢çš„ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//èœå“åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//èœå“åˆ†ç±»id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//èœå“ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">//å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="comment">//æè¿°ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//0 åœå”® 1 èµ·å”®</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="comment">//æ›´æ–°æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="comment">//åˆ†ç±»åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    <span class="comment">//èœå“å…³è”çš„å£å‘³</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-2"><a href="#Controllerå±‚-2" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰æ·»åŠ DishControllerçš„pageåˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;èœå“åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;èœå“åˆ†é¡µæŸ¥è¯¢:&#123;&#125;&quot;</span>, dishPageQueryDTO);</span><br><span class="line">       <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> dishService.pageQuery(dishPageQueryDTO);<span class="comment">//åç»ªæ­¥éª¤å®šä¹‰</span></span><br><span class="line">       <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚æ¥å£-1"><a href="#Serviceå±‚æ¥å£-1" class="headerlink" title="Serviceå±‚æ¥å£"></a>Serviceå±‚æ¥å£</h4><p><strong>åœ¨ DishServiceä¸­æ·»åŠ åˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   PageResult <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚å®ç°ç±»-1"><a href="#Serviceå±‚å®ç°ç±»-1" class="headerlink" title="Serviceå±‚å®ç°ç±»"></a>Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨ DishServiceImpl ä¸­å®ç°åˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line">       PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());</span><br><span class="line">       Page&lt;DishVO&gt; page = dishMapper.pageQuery(dishPageQueryDTO);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), page.getResult());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-2"><a href="#Mapperå±‚-2" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨ DishMapper æ¥å£ä¸­å£°æ˜ pageQuery æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   Page&lt;DishVO&gt; <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨<code>DishMapper.xml</code>ä¸­ç¼–å†™SQLï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.DishVO&quot;</span>&gt;</span></span><br><span class="line">        select d.* , c.name as categoryName from dish d left outer join category c on d.category_id = c.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                and d.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">                and d.category_id = #&#123;categoryId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                and d.status = #&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by d.create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-7"><a href="#åŠŸèƒ½æµ‹è¯•-7" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><h2 id="åˆ é™¤èœå“"><a href="#åˆ é™¤èœå“" class="headerlink" title="åˆ é™¤èœå“"></a>åˆ é™¤èœå“</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-7"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-7" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>èœå“åˆ—è¡¨é¡µé¢ä¸­æ¯ä¸ªèœå“åé¢å¯¹åº”çš„æ“ä½œåˆ†åˆ«ä¸º<strong>ä¿®æ”¹</strong>ã€<strong>åˆ é™¤</strong>ã€<strong>åœå”®</strong>ï¼Œå¯é€šè¿‡åˆ é™¤åŠŸèƒ½å®Œæˆå¯¹èœå“åŠç›¸å…³çš„æ•°æ®è¿›è¡Œåˆ é™¤ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121211236356.png"></div></div><div class="note info no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>å¯ä»¥ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªèœå“ï¼Œä¹Ÿå¯ä»¥æ‰¹é‡åˆ é™¤èœå“</li><li>èµ·å”®ä¸­çš„èœå“ä¸èƒ½åˆ é™¤</li><li>è¢«å¥—é¤å…³è”çš„èœå“ä¸èƒ½åˆ é™¤</li><li>åˆ é™¤èœå“åï¼Œå…³è”çš„å£å‘³æ•°æ®ä¹Ÿéœ€è¦åˆ é™¤æ‰</li></ul></div><h4 id="æ¥å£è®¾è®¡-2"><a href="#æ¥å£è®¾è®¡-2" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>æ ¹æ®åŸå‹å›¾ï¼Œè®¾è®¡å‡ºç›¸åº”çš„æ¥å£ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121211801121.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121211814429.png"></div></div><div class="note warning no-icon flat"><p><strong>æ³¨æ„ï¼š</strong> åˆ é™¤ä¸€ä¸ªèœå“å’Œæ‰¹é‡åˆ é™¤èœå“å…±ç”¨ä¸€ä¸ªæ¥å£ï¼ŒåŒºåˆ«åªæ˜¯å‚æ•°ä¸ªæ•°ä¸åŒã€‚</p></div><h4 id="è¡¨è®¾è®¡-2"><a href="#è¡¨è®¾è®¡-2" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><p>åˆ é™¤èœå“æ“ä½œæ—¶ï¼Œä¼šæ¶‰åŠåˆ°ä»¥ä¸‹ä¸‰å¼ è¡¨ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221121212436851.png"></div></div><div class="note warning no-icon flat"><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>åœ¨dishè¡¨ä¸­åˆ é™¤èœå“åŸºæœ¬æ•°æ®æ—¶ï¼ŒåŒæ—¶ï¼Œä¹Ÿè¦æŠŠå…³è”åœ¨dish_flavorè¡¨ä¸­çš„æ•°æ®ä¸€å—åˆ é™¤ã€‚</li><li>setmeal_dishè¡¨ä¸ºèœå“å’Œå¥—é¤å…³è”çš„ä¸­é—´è¡¨ã€‚</li><li>è‹¥åˆ é™¤çš„èœå“æ•°æ®å…³è”ç€æŸä¸ªå¥—é¤ï¼Œæ­¤æ—¶ï¼Œåˆ é™¤å¤±è´¥ã€‚</li><li>è‹¥è¦åˆ é™¤å¥—é¤å…³è”çš„èœå“æ•°æ®ï¼Œå…ˆè§£é™¤ä¸¤è€…å…³è”ï¼Œå†å¯¹èœå“è¿›è¡Œåˆ é™¤ã€‚</li></ul></div><h3 id="ä»£ç å¼€å‘-7"><a href="#ä»£ç å¼€å‘-7" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="Controllerå±‚-3"><a href="#Controllerå±‚-3" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>åœ¨DishControllerä¸­æ·»åŠ æ‰¹é‡åˆ é™¤èœå“çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“æ‰¹é‡åˆ é™¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@DeleteMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;èœå“æ‰¹é‡åˆ é™¤&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;èœå“æ‰¹é‡åˆ é™¤ï¼š&#123;&#125;&quot;</span>, ids);</span><br><span class="line">       dishService.deleteBatch(ids);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚æ¥å£-2"><a href="#Serviceå±‚æ¥å£-2" class="headerlink" title="Serviceå±‚æ¥å£"></a>Serviceå±‚æ¥å£</h4><p><strong>åœ¨DishServiceæ¥å£ä¸­å£°æ˜deleteBatchæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“æ‰¹é‡åˆ é™¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br></pre></td></tr></table></figure><h4 id="4-2-3-Serviceå±‚å®ç°ç±»"><a href="#4-2-3-Serviceå±‚å®ç°ç±»" class="headerlink" title="4.2.3 Serviceå±‚å®ç°ç±»"></a>4.2.3 Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨DishServiceImplä¸­å®ç°deleteBatchæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“æ‰¹é‡åˆ é™¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Transactional</span><span class="comment">//äº‹åŠ¡</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">       <span class="comment">//åˆ¤æ–­å½“å‰èœå“æ˜¯å¦èƒ½å¤Ÿåˆ é™¤---æ˜¯å¦å­˜åœ¨èµ·å”®ä¸­çš„èœå“ï¼Ÿï¼Ÿ</span></span><br><span class="line">       <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">           <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">           <span class="keyword">if</span> (dish.getStatus() == StatusConstant.ENABLE) &#123;</span><br><span class="line">               <span class="comment">//å½“å‰èœå“å¤„äºèµ·å”®ä¸­ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//åˆ¤æ–­å½“å‰èœå“æ˜¯å¦èƒ½å¤Ÿåˆ é™¤---æ˜¯å¦è¢«å¥—é¤å…³è”äº†ï¼Ÿï¼Ÿ</span></span><br><span class="line">       List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);</span><br><span class="line">       <span class="keyword">if</span> (setmealIds != <span class="literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="comment">//å½“å‰èœå“è¢«å¥—é¤å…³è”äº†ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//åˆ é™¤èœå“è¡¨ä¸­çš„èœå“æ•°æ®</span></span><br><span class="line">       <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">           dishMapper.deleteById(id);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">           <span class="comment">//åˆ é™¤èœå“å…³è”çš„å£å‘³æ•°æ®</span></span><br><span class="line">           dishFlavorMapper.deleteByDishId(id);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-3"><a href="#Mapperå±‚-3" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨DishMapperä¸­æ·»åŠ getByIdæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®ä¸»é”®æŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from dish where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">   Dish <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºSetmealDishMapperï¼Œå£°æ˜getSetmealIdsByDishIdsæ–¹æ³•ï¼Œå¹¶åœ¨xmlæ–‡ä»¶ä¸­ç¼–å†™SQLï¼š</strong></p><div class="tabs" id="åˆ é™¤èœå“mapperå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ é™¤èœå“mapperå±‚-1">SetmealDishMapper.java</button></li><li class="tab"><button type="button" data-href="#åˆ é™¤èœå“mapperå±‚-2">SetmealDishMapper.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ é™¤èœå“mapperå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®èœå“idæŸ¥è¯¢å¯¹åº”çš„å¥—é¤id</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishIds</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//select setmeal_id from setmeal_dish where dish_id in (1,2,3,4)</span></span><br><span class="line">    List&lt;Long&gt; <span class="title function_">getSetmealIdsByDishIds</span><span class="params">(List&lt;Long&gt; dishIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ é™¤èœå“mapperå±‚-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.SetmealDishMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">        select setmeal_id from setmeal_dish where dish_id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;dishIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;dishId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;dishId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>åœ¨DishMapper.javaä¸­å£°æ˜<code>deleteById</code>æ–¹æ³•å¹¶é…ç½®SQLï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®ä¸»é”®åˆ é™¤èœå“æ•°æ®</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Delete(&quot;delete from dish where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨DishFlavorMapperä¸­å£°æ˜<code>deleteByDishId</code>æ–¹æ³•å¹¶é…ç½®SQLï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®èœå“idåˆ é™¤å¯¹åº”çš„å£å‘³æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishId</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByDishId</span><span class="params">(Long dishId)</span>;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹èœå“"><a href="#ä¿®æ”¹èœå“" class="headerlink" title="ä¿®æ”¹èœå“"></a>ä¿®æ”¹èœå“</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-8"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-8" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç‚¹å‡»ä¿®æ”¹æŒ‰é’®åè·³è½¬åˆ°èœå“ä¿®æ”¹é¡µé¢ï¼Œä¿®æ”¹é¡µé¢ä¼šå›æ˜¾èœå“ç›¸å…³ä¿¡æ¯ï¼Œç‚¹å‡»ä¿å­˜åˆ™å®Œæˆä¿®æ”¹æ“ä½œ<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221122130837173.png"></div></div><p></p><p><strong>æ¥å£è®¾è®¡</strong><br>åˆ†æå¯å¾—è¯¥é¡µé¢æ¶‰åŠå››ä¸ªæ¥å£ï¼š</p><ul><li>æ ¹æ®idæŸ¥è¯¢èœå“</li><li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»(å·²å®ç°)</li><li>æ–‡ä»¶ä¸Šä¼ (å·²å®ç°)</li><li>ä¿®æ”¹èœå“</li></ul><ul><li>æ ¹æ®idæŸ¥è¯¢èœå“<div class="tabs" id="ä¿®æ”¹èœå“æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¿®æ”¹èœå“æ¥å£è®¾è®¡-1">æ ¹æ®idæŸ¥è¯¢èœå“</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“æ¥å£è®¾è®¡-2">ä¿®æ”¹èœå“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¿®æ”¹èœå“æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221122131733147.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221122131743509.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221122131914533.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221122131837393.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li></ul><h3 id="ä»£ç å¼€å‘-8"><a href="#ä»£ç å¼€å‘-8" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="æ ¹æ®idæŸ¥è¯¢èœå“å®ç°"><a href="#æ ¹æ®idæŸ¥è¯¢èœå“å®ç°" class="headerlink" title="æ ¹æ®idæŸ¥è¯¢èœå“å®ç°"></a>æ ¹æ®idæŸ¥è¯¢èœå“å®ç°</h4><div class="tabs" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-1">Controllerå±‚</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-2">Serviceå±‚æ¥å£</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-3">Serviceå±‚å®ç°ç±»</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-4">Mapperå±‚</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-1"><p>åœ¨DishControllerä¸­åˆ›å»ºæ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;DishVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ ¹æ®idæŸ¥è¯¢èœå“ï¼š&#123;&#125;&quot;</span>, id);</span><br><span class="line">    <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">    <span class="keyword">return</span> Result.success(dishVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-2"><p>åœ¨DishServiceæ¥å£ä¸­å£°æ˜getByIdWithFlavoræ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢èœå“å’Œå¯¹åº”çš„å£å‘³æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-3"><p>åœ¨DishServiceImplä¸­å®ç°getByIdWithFlavoræ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢èœå“å’Œå¯¹åº”çš„å£å‘³æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//æ ¹æ®idæŸ¥è¯¢èœå“æ•°æ®</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®èœå“idæŸ¥è¯¢å£å‘³æ•°æ®</span></span><br><span class="line">    List&lt;DishFlavor&gt; dishFlavors = dishFlavorMapper.getByDishId(id);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æŸ¥è¯¢åˆ°çš„æ•°æ®å°è£…åˆ°VO</span></span><br><span class="line">    <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(dish, dishVO);</span><br><span class="line">    dishVO.setFlavors(dishFlavors);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dishVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-æ ¹æ®idæŸ¥è¯¢èœå“å®ç°-4"><p>åœ¨DishFlavorMapperä¸­å£°æ˜getByDishIdæ–¹æ³•ï¼Œå¹¶é…ç½®SQLï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®èœå“idæŸ¥è¯¢å¯¹åº”çš„å£å‘³æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span></span><br><span class="line">List&lt;DishFlavor&gt; <span class="title function_">getByDishId</span><span class="params">(Long dishId)</span>;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="ä¿®æ”¹èœå“å®ç°"><a href="#ä¿®æ”¹èœå“å®ç°" class="headerlink" title="ä¿®æ”¹èœå“å®ç°"></a>ä¿®æ”¹èœå“å®ç°</h4><div class="tabs" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-1">Controllerå±‚</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-2">Serviceå±‚æ¥å£</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-3">Serviceå±‚å®ç°ç±»</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-4">Mapperå±‚</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-1"><p><strong>æ ¹æ®ä¿®æ”¹èœå“çš„æ¥å£å®šä¹‰åœ¨DishControllerä¸­åˆ›å»ºæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¿®æ”¹èœå“</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;ä¿®æ”¹èœå“&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;ä¿®æ”¹èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);</span><br><span class="line">       dishService.updateWithFlavor(dishDTO);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-2"><p><strong>åœ¨DishServiceæ¥å£ä¸­å£°æ˜updateWithFlavoræ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idä¿®æ”¹èœå“åŸºæœ¬ä¿¡æ¯å’Œå¯¹åº”çš„å£å‘³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-3"><p><strong>åœ¨DishServiceImplä¸­å®ç°updateWithFlavoræ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idä¿®æ”¹èœå“åŸºæœ¬ä¿¡æ¯å’Œå¯¹åº”çš„å£å‘³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">       <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">       BeanUtils.copyProperties(dishDTO, dish);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//ä¿®æ”¹èœå“è¡¨åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">       dishMapper.update(dish);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//åˆ é™¤åŸæœ‰çš„å£å‘³æ•°æ®</span></span><br><span class="line">       dishFlavorMapper.deleteByDishId(dishDTO.getId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//é‡æ–°æ’å…¥å£å‘³æ•°æ®</span></span><br><span class="line">       List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">       <span class="keyword">if</span> (flavors != <span class="literal">null</span> &amp;&amp; flavors.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">               dishFlavor.setDishId(dishDTO.getId());</span><br><span class="line">           &#125;);</span><br><span class="line">           <span class="comment">//å‘å£å‘³è¡¨æ’å…¥næ¡æ•°æ®</span></span><br><span class="line">           dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹èœå“ä»£ç å¼€å‘-ä¿®æ”¹èœå“å®ç°-4"><p><strong>åœ¨DishMapperä¸­ï¼Œå£°æ˜updateæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idåŠ¨æ€ä¿®æ”¹èœå“æ•°æ®</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@AutoFill(value = OperationType.UPDATE)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure><p><strong>å¹¶åœ¨DishMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™SQL:</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update dish</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span>category_id = #&#123;categoryId&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span>price = #&#123;price&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null&quot;</span>&gt;</span>image = #&#123;image&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;description != null&quot;</span>&gt;</span>description = #&#123;description&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span>update_user = #&#123;updateUser&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="èœå“çš„èµ·å”®-åœå”®"><a href="#èœå“çš„èµ·å”®-åœå”®" class="headerlink" title="èœå“çš„èµ·å”®/åœå”®"></a>èœå“çš„èµ·å”®/åœå”®</h2><h1 id="day04"><a href="#day04" class="headerlink" title="day04"></a>day04</h1><h2 id="å®Œæˆå†…å®¹"><a href="#å®Œæˆå†…å®¹" class="headerlink" title="å®Œæˆå†…å®¹"></a>å®Œæˆå†…å®¹</h2><p>å®Œæˆå¥—é¤ç®¡ç†æ¨¡å—çš„ç›¸å…³ä¸šåŠ¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ–°å¢å¥—é¤</li><li>å¥—é¤åˆ†é¡µæŸ¥è¯¢</li><li>åˆ é™¤å¥—é¤</li><li>ä¿®æ”¹å¥—é¤</li><li>å¥—é¤çš„èµ·å”®/åœå”®</li></ul><h2 id="æ–°å¢å¥—é¤"><a href="#æ–°å¢å¥—é¤" class="headerlink" title="æ–°å¢å¥—é¤"></a>æ–°å¢å¥—é¤</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-9"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-9" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018135930842.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å¥—é¤åç§°å”¯ä¸€</li><li>å¥—é¤å¿…é¡»å±äºæŸä¸ªåˆ†ç±»</li><li>å¥—é¤å¿…é¡»åŒ…å«èœå“</li><li>åç§°ã€åˆ†ç±»ã€ä»·æ ¼ã€å›¾ç‰‡ä¸ºå¿…å¡«é¡¹</li><li>æ·»åŠ èœå“çª—å£éœ€è¦æ ¹æ®åˆ†ç±»ç±»å‹æ¥å±•ç¤ºèœå“</li><li>æ–°å¢çš„å¥—é¤é»˜è®¤ä¸ºåœå”®çŠ¶æ€</li></ul></div><p><strong>æ¥å£è®¾è®¡</strong><br>æ¶‰åŠå››ä¸ªæ¥å£ï¼š</p><ul><li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»ï¼ˆå·²å®Œæˆï¼‰</li><li>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</li><li>å›¾ç‰‡ä¸Šä¼ ï¼ˆå·²å®Œæˆï¼‰</li><li>æ–°å¢å¥—é¤</li></ul><div class="tabs" id="æ–°å¢å¥—é¤"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢å¥—é¤-1">æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤-2">æ–°å¢å¥—é¤</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢å¥—é¤-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018141521068.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018141606787.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>æ•°æ®åº“è®¾è®¡</strong></p><div class="tabs" id="æ–°å¢å¥—é¤æ•°æ®åº“è¡¨"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢å¥—é¤æ•°æ®åº“è¡¨-1">setmealè¡¨</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤æ•°æ®åº“è¡¨-2">setmeal_dishè¡¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢å¥—é¤æ•°æ®åº“è¡¨-1"><p>setmealè¡¨ä¸ºå¥—é¤è¡¨ï¼Œç”¨äºå­˜å‚¨å¥—é¤çš„ä¿¡æ¯ã€‚</p><div class="table-container"><table><thead><tr><th>å­—æ®µå</th><th>æ•°æ®ç±»å‹</th><th>è¯´æ˜</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>name</td><td>varchar(32)</td><td>å¥—é¤åç§°</td><td>å”¯ä¸€</td></tr><tr><td>category_id</td><td>bigint</td><td>åˆ†ç±»id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>price</td><td>decimal(10,2)</td><td>å¥—é¤ä»·æ ¼</td><td></td></tr><tr><td>image</td><td>varchar(255)</td><td>å›¾ç‰‡è·¯å¾„</td><td></td></tr><tr><td>description</td><td>varchar(255)</td><td>å¥—é¤æè¿°</td><td></td></tr><tr><td>status</td><td>int</td><td>å”®å–çŠ¶æ€</td><td>1èµ·å”® 0åœå”®</td></tr><tr><td>create_time</td><td>datetime</td><td>åˆ›å»ºæ—¶é—´</td><td></td></tr><tr><td>update_time</td><td>datetime</td><td>æœ€åä¿®æ”¹æ—¶é—´</td><td></td></tr><tr><td>create_user</td><td>bigint</td><td>åˆ›å»ºäººid</td><td></td></tr><tr><td>update_user</td><td>bigint</td><td>æœ€åä¿®æ”¹äººid</td></tr></tbody></table></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤æ•°æ®åº“è¡¨-2"><p>setmeal_dishè¡¨ä¸ºå¥—é¤èœå“å…³ç³»è¡¨ï¼Œç”¨äºå­˜å‚¨å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</p><div class="table-container"><table><thead><tr><th>å­—æ®µå</th><th>æ•°æ®ç±»å‹</th><th>è¯´æ˜</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>setmeal_id</td><td>bigint</td><td>å¥—é¤id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>dish_id</td><td>bigint</td><td>èœå“id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>name</td><td>varchar(32)</td><td>èœå“åç§°</td><td>å†—ä½™å­—æ®µ</td></tr><tr><td>price</td><td>decimal(10,2)</td><td>èœå“å•ä»·</td><td>å†—ä½™å­—æ®µ</td></tr><tr><td>copies</td><td>int</td><td>èœå“ä»½æ•°</td></tr></tbody></table></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="Controllerå±‚-4"><a href="#Controllerå±‚-4" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><div class="tabs" id="æ–°å¢å¥—é¤controllerå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢å¥—é¤controllerå±‚-1">DishController</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤controllerå±‚-2">SetmealController</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢å¥—é¤controllerå±‚-1"><p>åœ¨DishControllerä¸­æ·»åŠ æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“çš„æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span>&#123;</span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(categoryId);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤controllerå±‚-2"><p>åœ¨SetmealControllerä¸­æ·»åŠ æ–°å¢å¥—é¤çš„æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤ç®¡ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/setmeal&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å¥—é¤ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢å¥—é¤&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">        setmealService.saveWithDish(setmealDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="Serviceå±‚-1"><a href="#Serviceå±‚-1" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><div class="tabs" id="æ–°å¢å¥—é¤serviceå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢å¥—é¤serviceå±‚-1">DishService</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤serviceå±‚-2">DishServiceImpl</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤serviceå±‚-3">SetmealService</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤serviceå±‚-4">SetmealServiceImpl</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢å¥—é¤serviceå±‚-1"><p>åœ¨DishServiceä¸­æ·»åŠ æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“çš„æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span>;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤serviceå±‚-2"><p>åœ¨DishServiceImplä¸­å®ç°è¯¥æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> Dish.builder()</span><br><span class="line">        .categoryId(categoryId)</span><br><span class="line">        .status(StatusConstant.ENABLE)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> dishMapper.list(dish);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤serviceå±‚-3"><p>åœ¨SetmealServiceä¸­æ·»åŠ æ–°å¢å¥—é¤çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDTO setmealDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤serviceå±‚-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤ä¸šåŠ¡å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">        BeanUtils.copyProperties(setmealDTO, setmeal);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘å¥—é¤è¡¨æ’å…¥æ•°æ®</span></span><br><span class="line">        setmealMapper.insert(setmeal);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ç”Ÿæˆçš„å¥—é¤id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmeal.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line">        setmealDishes.forEach(setmealDish -&gt; &#123;</span><br><span class="line">            setmealDish.setSetmealId(setmealId);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span></span><br><span class="line">        setmealDishMapper.insertBatch(setmealDishes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="Mapperå±‚-4"><a href="#Mapperå±‚-4" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><div class="tabs" id="æ–°å¢å¥—é¤mapperå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–°å¢å¥—é¤mapperå±‚-1">DishMapper</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤mapperå±‚-2">SetmealMapper</button></li><li class="tab"><button type="button" data-href="#æ–°å¢å¥—é¤mapperå±‚-3">SetmealDishMapper</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–°å¢å¥—é¤mapperå±‚-1"><p>åœ¨DishMapperä¸­æ·»åŠ listæ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨DishMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™SQLï¼š<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Dish&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Dish&quot;</span>&gt;</span></span><br><span class="line">    select * from dish</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤mapperå±‚-2"><p>åœ¨SetmealMapperä¸­æ·»åŠ insertæ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Setmeal setmeal)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨SetmealMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™SQLï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Setmeal&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into setmeal</span><br><span class="line">    (category_id, name, price, status, description, image, create_time, update_time, create_user, update_user)</span><br><span class="line">    values (#&#123;categoryId&#125;, #&#123;name&#125;, #&#123;price&#125;, #&#123;status&#125;, #&#123;description&#125;, #&#123;image&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;,</span><br><span class="line">    #&#123;createUser&#125;, #&#123;updateUser&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–°å¢å¥—é¤mapperå±‚-3"><p>åœ¨SetmealDishMapperä¸­æ·»åŠ insertBatchæ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDishes</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(List&lt;SetmealDish&gt; setmealDishes)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨SetmealDishMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™SQLï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    insert into setmeal_dish</span><br><span class="line">    (setmeal_id,dish_id,name,price,copies)</span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;setmealDishes&quot;</span> <span class="attr">item</span>=<span class="string">&quot;sd&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;sd.setmealId&#125;,#&#123;sd.dishId&#125;,#&#123;sd.name&#125;,#&#123;sd.price&#125;,#&#123;sd.copies&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="åŠŸèƒ½æµ‹è¯•-8"><a href="#åŠŸèƒ½æµ‹è¯•-8" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>ç‚¹å‡»æ–°å¢å¥—é¤æŒ‰é’®ï¼Œå¹¶å¡«å†™ç›¸å…³å¥—é¤ä¿¡æ¯<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114144406.png"></div></div><br>ç‚¹å‡»ä¿å­˜æŒ‰é’®åï¼Œå»æ•°æ®åº“çš„setmealè¡¨ä¸­æŸ¥çœ‹æ•°æ®æ˜¯å¦æ·»åŠ æˆåŠŸ<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114144759.png"></div></div><p></p><h2 id="å¥—é¤åˆ†é¡µæŸ¥è¯¢"><a href="#å¥—é¤åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="å¥—é¤åˆ†é¡µæŸ¥è¯¢"></a>å¥—é¤åˆ†é¡µæŸ¥è¯¢</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-10"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-10" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018152429246.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>æ ¹æ®é¡µç è¿›è¡Œåˆ†é¡µå±•ç¤º</li><li>æ¯é¡µå±•ç¤º10æ¡æ•°æ®</li><li>å¯ä»¥æ ¹æ®éœ€è¦ï¼ŒæŒ‰ç…§å¥—é¤åç§°ã€åˆ†ç±»ã€å”®å–çŠ¶æ€è¿›è¡ŒæŸ¥è¯¢</li></ul></div><p><strong>æ¥å£è®¾è®¡</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018152731141.png"></div></div><p></p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="Controllerå±‚-5"><a href="#Controllerå±‚-5" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p>åœ¨SetmealControllerä¸­æ·»åŠ åˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> setmealService.pageQuery(setmealPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Serviceå±‚-2"><a href="#Serviceå±‚-2" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p>åœ¨SetmealServiceä¸­æ·»åŠ åˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">PageResult <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨SetmealServiceImplä¸­å®ç°è¯¥æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> setmealPageQueryDTO.getPage();</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> setmealPageQueryDTO.getPageSize();</span><br><span class="line"></span><br><span class="line">    PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">    Page&lt;SetmealVO&gt; page = setmealMapper.pageQuery(setmealPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Mapperå±‚-5"><a href="#Mapperå±‚-5" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p>åœ¨SetmealMapperä¸­æ·»åŠ åˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Page&lt;SetmealVO&gt; <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨SetmealMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™SQLï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.SetmealVO&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    	s.*,c.name categoryName</span><br><span class="line">    from</span><br><span class="line">    	setmeal s</span><br><span class="line">    left join</span><br><span class="line">    	category c</span><br><span class="line">    on</span><br><span class="line">    	s.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and s.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and s.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and s.category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by s.create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="åŠŸèƒ½æµ‹è¯•-9"><a href="#åŠŸèƒ½æµ‹è¯•-9" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>é‡å¯æœåŠ¡å™¨ï¼Œè®¿é—®<a target="_blank" rel="noopener" href="http://localhost">http://localhost</a>ï¼Œç‚¹å‡»å¥—é¤é¡µé¢çš„æ•°æ®å·²ç»èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­äº†<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114150708.png"></div></div><p></p><h2 id="åˆ é™¤å¥—é¤"><a href="#åˆ é™¤å¥—é¤" class="headerlink" title="åˆ é™¤å¥—é¤"></a>åˆ é™¤å¥—é¤</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-11"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-11" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç‚¹å‡»åˆ é™¤å¥—é¤æŒ‰é’®å³å¯åœ¨æ•°æ®åº“ä¸­åˆ é™¤è¯¥å¥—é¤ï¼Œå¥—é¤å¯ä»¥å•ä¸ªåˆ é™¤ï¼Œä¹Ÿå¯ä»¥æ‰¹é‡åˆ é™¤,<strong>èµ·å”®ä¸­çš„å¥—é¤ä¸èƒ½åˆ é™¤</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018153756531.png"></div></div><p></p><p><strong>æ¥å£è®¾è®¡</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018154541067.png"></div></div><p></p><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="Controllerå±‚-6"><a href="#Controllerå±‚-6" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p>åœ¨SetmealControllerä¸­æ·»åŠ æ‰¹é‡åˆ é™¤æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤å¥—é¤&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    setmealService.deleteBatch(ids);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Serviceå±‚-3"><a href="#Serviceå±‚-3" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p>åœ¨SetmealServiceä¸­æ·»åŠ æ‰¹é‡åˆ é™¤æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨SetmealServiceImplä¸­å®ç°è¯¥æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    ids.forEach(id -&gt; &#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(id);</span><br><span class="line">        <span class="keyword">if</span>(StatusConstant.ENABLE == setmeal.getStatus())&#123;</span><br><span class="line">            <span class="comment">//èµ·å”®ä¸­çš„å¥—é¤ä¸èƒ½åˆ é™¤</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.SETMEAL_ON_SALE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ids.forEach(setmealId -&gt; &#123;</span><br><span class="line">        <span class="comment">//åˆ é™¤å¥—é¤è¡¨ä¸­çš„æ•°æ®</span></span><br><span class="line">        setmealMapper.deleteById(setmealId);</span><br><span class="line">        <span class="comment">//åˆ é™¤å¥—é¤èœå“å…³ç³»è¡¨ä¸­çš„æ•°æ®</span></span><br><span class="line">        setmealDishMapper.deleteBySetmealId(setmealId);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Mapperå±‚-6"><a href="#Mapperå±‚-6" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><div class="tabs" id="åˆ é™¤å¥—é¤mapperå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ é™¤å¥—é¤mapperå±‚-1">SetmealMapper</button></li><li class="tab"><button type="button" data-href="#åˆ é™¤å¥—é¤mapperå±‚-2">SetmealDishMapper</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ é™¤å¥—é¤mapperå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from setmeal where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">Setmeal <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤å¥—é¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from setmeal where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ é™¤å¥—é¤mapperå±‚-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å¥—é¤idåˆ é™¤å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="åŠŸèƒ½æµ‹è¯•-10"><a href="#åŠŸèƒ½æµ‹è¯•-10" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å‰åç«¯è”è°ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¥å£æ–‡æ¡£æµ‹è¯•ï¼Œæ­¤å¤„é€šè¿‡æ¥å£æ–‡æ¡£ç®€å•è¿›è¡Œæµ‹è¯•ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114171126.png"></div></div><p></p><p>å†æ¬¡åˆ·æ–°æ•°æ®åº“ï¼Œè¯¥idå¯¹åº”çš„å¥—é¤å°±è¢«åˆ é™¤äº†</p><h2 id="ä¿®æ”¹å¥—é¤"><a href="#ä¿®æ”¹å¥—é¤" class="headerlink" title="ä¿®æ”¹å¥—é¤"></a>ä¿®æ”¹å¥—é¤</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-12"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-12" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œä¿®æ”¹å¥—é¤éœ€è¦æœ‰æ•°æ®çš„å›æ˜¾å’Œå¯¹æ•°æ®çš„æ›´æ–°<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018160214225.png"></div></div><p></p><p><strong>æ¥å£è®¾è®¡</strong><br>å…±æ¶‰åŠ5ä¸ªæ¥å£</p><ul><li>æ ¹æ®idæŸ¥è¯¢å¥—é¤</li><li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»ï¼ˆå·²å®Œæˆï¼‰</li><li>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“ï¼ˆå·²å®Œæˆï¼‰</li><li>å›¾ç‰‡ä¸Šä¼ ï¼ˆå·²å®Œæˆï¼‰</li><li>ä¿®æ”¹å¥—é¤</li></ul><div class="tabs" id="ä¿®æ”¹å¥—é¤æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¿®æ”¹å¥—é¤æ¥å£è®¾è®¡-1">æ ¹æ®idæŸ¥è¯¢å¥—é¤</button></li><li class="tab"><button type="button" data-href="#ä¿®æ”¹å¥—é¤æ¥å£è®¾è®¡-2">ä¿®æ”¹å¥—é¤</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¿®æ”¹å¥—é¤æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018160915177.png" style="width:400px"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018160949864.png" style="width:400px"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¿®æ”¹å¥—é¤æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018161046352.png" style="width:400px"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018161117780.png" style="width:400px"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018161139861.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="Controllerå±‚-7"><a href="#Controllerå±‚-7" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p>åœ¨SetmealControllerä¸­æ·»åŠ <code>æ•°æ®å›æ˜¾</code>å’Œ<code>ä¿®æ”¹å¥—é¤</code>çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤ï¼Œç”¨äºä¿®æ”¹é¡µé¢å›æ˜¾æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢å¥—é¤&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SetmealVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">SetmealVO</span> <span class="variable">setmealVO</span> <span class="operator">=</span> setmealService.getByIdWithDish(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(setmealVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ä¿®æ”¹å¥—é¤&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">    setmealService.update(setmealDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Serviceå±‚-4"><a href="#Serviceå±‚-4" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p>åœ¨SetmealServiceä¸­æ·»åŠ <code>æ•°æ®å›æ˜¾</code>å’Œ<code>ä¿®æ”¹å¥—é¤</code>çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤ï¼Œç”¨äºä¿®æ”¹é¡µé¢å›æ˜¾æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SetmealVO <span class="title function_">getByIdWithDish</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(SetmealDTO setmealDTO)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨SetmealServiceImplä¸­å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤å’Œå¥—é¤èœå“å…³ç³»</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> SetmealVO <span class="title function_">getByIdWithDish</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(id);</span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDishMapper.getBySetmealId(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">SetmealVO</span> <span class="variable">setmealVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(setmeal, setmealVO);</span><br><span class="line">    setmealVO.setSetmealDishes(setmealDishes);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> setmealVO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">    BeanUtils.copyProperties(setmealDTO, setmeal);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1ã€ä¿®æ”¹å¥—é¤è¡¨ï¼Œæ‰§è¡Œupdate</span></span><br><span class="line">    setmealMapper.update(setmeal);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmealDTO.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2ã€åˆ é™¤å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»ï¼Œæ“ä½œsetmeal_dishè¡¨ï¼Œæ‰§è¡Œdelete</span></span><br><span class="line">    setmealDishMapper.deleteBySetmealId(setmealId);</span><br><span class="line"></span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line">    setmealDishes.forEach(setmealDish -&gt; &#123;</span><br><span class="line">        setmealDish.setSetmealId(setmealId);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//3ã€é‡æ–°æ’å…¥å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»ï¼Œæ“ä½œsetmeal_dishè¡¨ï¼Œæ‰§è¡Œinsert</span></span><br><span class="line">    setmealDishMapper.insertBatch(setmealDishes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Mapperå±‚-7"><a href="#Mapperå±‚-7" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p>åœ¨SetmealDishMapperä¸­æ·»åŠ æŸ¥è¯¢å¥—é¤å’Œå¥—é¤èœå“å…³ç³»çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å¥—é¤idæŸ¥è¯¢å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line">List&lt;SetmealDish&gt; <span class="title function_">getBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="åŠŸèƒ½æµ‹è¯•-11"><a href="#åŠŸèƒ½æµ‹è¯•-11" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><ul><li>ç›´æ¥é€šè¿‡å‰åç«¯è”è°ƒè¿›è¡Œç®€å•æµ‹è¯•å³å¯ï¼Œé¦–å…ˆæ–°å¢ä¸€ä¸ªå¥—é¤<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114174039.png"></div></div></li><li>å¯¹è¯¥å¥—é¤å„é¡¹æ•°æ®éƒ½è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œåç‚¹å‡»ä¿å­˜<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114174401.png"></div></div></li></ul><h2 id="èµ·å”®-åœå”®å¥—é¤"><a href="#èµ·å”®-åœå”®å¥—é¤" class="headerlink" title="èµ·å”®/åœå”®å¥—é¤"></a>èµ·å”®/åœå”®å¥—é¤</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-13"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-13" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>å’Œå¯¹èœå“çš„èµ·å”®/åœå”®æ“ä½œä¸€æ ·<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018163720881.png" style="width:600px"></div></div><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018163720881.png"></div></div><p></p><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å¯¹çŠ¶æ€ä¸ºèµ·å”®çš„å¥—é¤è¿›è¡Œåœå”®æ“ä½œï¼Œå¯¹çŠ¶æ€ä¸ºåœå”®çš„å¥—é¤è¿›è¡Œèµ·å”®æ“ä½œ</li><li>èµ·å”®çš„å¥—é¤å¯ä»¥å±•ç¤ºåœ¨ç”¨æˆ·ç«¯ï¼Œåœå”®çš„å¥—é¤ä¸èƒ½å±•ç¤ºåœ¨ç”¨æˆ·ç«¯</li><li>èµ·å”®å¥—é¤æ—¶ï¼Œå¦‚æœå¥—é¤å†…åŒ…å«åœå”®çš„èœå“ï¼Œåˆ™ä¸èƒ½èµ·å”®</li></ul></div><p><strong>æ¥å£è®¾è®¡</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221018165055208.png"></div></div><p></p><h3 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="Controllerå±‚-8"><a href="#Controllerå±‚-8" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p>åœ¨SetmealControllerä¸­æ·»åŠ <code>èµ·å”®/åœå”®å¥—é¤</code>çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¥—é¤èµ·å”®åœå”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å¥—é¤èµ·å”®åœå”®&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line">    setmealService.startOrStop(status, id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Serviceå±‚-5"><a href="#Serviceå±‚-5" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p>åœ¨SetmealServiceä¸­æ·»åŠ <code>èµ·å”®/åœå”®å¥—é¤</code>çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¥—é¤èµ·å”®ã€åœå”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨SetmealServiceImplä¸­å®ç°è¯¥æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¥—é¤èµ·å”®ã€åœå”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//èµ·å”®å¥—é¤æ—¶ï¼Œåˆ¤æ–­å¥—é¤å†…æ˜¯å¦æœ‰åœå”®èœå“ï¼Œæœ‰åœå”®èœå“æç¤º&quot;å¥—é¤å†…åŒ…å«æœªå¯å”®èœå“ï¼Œæ— æ³•å¯å”®&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(status == StatusConstant.ENABLE)&#123;</span><br><span class="line">        <span class="comment">//select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = ?</span></span><br><span class="line">        List&lt;Dish&gt; dishList = dishMapper.getBySetmealId(id);</span><br><span class="line">        <span class="keyword">if</span>(dishList != <span class="literal">null</span> &amp;&amp; dishList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            dishList.forEach(dish -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span>(StatusConstant.DISABLE == dish.getStatus())&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SetmealEnableFailedException</span>(MessageConstant.SETMEAL_ENABLE_FAILED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> Setmeal.builder()</span><br><span class="line">        .id(id)</span><br><span class="line">        .status(status)</span><br><span class="line">        .build();</span><br><span class="line">    setmealMapper.update(setmeal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Mapperå±‚-8"><a href="#Mapperå±‚-8" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p>åœ¨DishMapperä¸­æ·»åŠ æŸ¥è¯¢èœå“çš„æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å¥—é¤idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Select(&quot;select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="åŠŸèƒ½æµ‹è¯•-12"><a href="#åŠŸèƒ½æµ‹è¯•-12" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>é€šè¿‡æ¥å£æ–‡æ¡£ï¼Œæµ‹è¯•å¥—é¤èµ·å”®åœå”®åŠŸèƒ½<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251114180102.png"></div></div><p></p><h1 id="day05"><a href="#day05" class="headerlink" title="day05"></a>day05</h1><h2 id="è¯¾ç¨‹å…¥é—¨"><a href="#è¯¾ç¨‹å…¥é—¨" class="headerlink" title="è¯¾ç¨‹å…¥é—¨"></a>è¯¾ç¨‹å…¥é—¨</h2><ul><li>Rediså…¥é—¨</li><li>Redisæ•°æ®ç±»å‹</li><li>Rediså¸¸ç”¨å‘½ä»¤</li><li>åœ¨Javaä¸­æ“ä½œRedis</li><li>åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</li></ul><div class="note info no-icon flat"><p>Redisç›¸å…³çš„å†…å®¹ä¹‹å‰å­¦ä¹ è¿‡å¹¶åšäº†ç›¸å…³ç¬”è®°ï¼Œæ­¤å¤„ä¸å†è¯¦ç»†è®°å½•</p></div><p>åŠŸèƒ½å®ç°ï¼š<strong>è¥ä¸šçŠ¶æ€è®¾ç½®</strong></p><p><strong>æ•ˆæœå›¾ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130223019209.png"></div></div><br>å•†å®¶å¯ä»¥è‡ªå·±é€‰æ‹©åœ¨çº¿çŠ¶æ€ï¼ŒçŠ¶æ€ä¸ºè¥ä¸šæ—¶å®¢æˆ·å¯ä»¥åœ¨å°ç¨‹åºä¸‹å•ï¼ŒçŠ¶æ€ä¸ºæ‰“æ ·æ—¶ï¼Œå®¢æˆ·æ— æ³•åœ¨å°ç¨‹åºç«¯ä¸‹å•<br><div class="tabs" id="day05æ•ˆæœå›¾"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#day05æ•ˆæœå›¾-1">è¥ä¸šä¸­</button></li><li class="tab"><button type="button" data-href="#day05æ•ˆæœå›¾-2">æ‰“çƒŠä¸­</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="day05æ•ˆæœå›¾-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130223113561.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="day05æ•ˆæœå›¾-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130223205032.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p></p><h2 id="Javaä¸­æ“ä½œRedis"><a href="#Javaä¸­æ“ä½œRedis" class="headerlink" title="Javaä¸­æ“ä½œRedis"></a>Javaä¸­æ“ä½œRedis</h2><h3 id="Redisçš„Javaå®¢æˆ·ç«¯"><a href="#Redisçš„Javaå®¢æˆ·ç«¯" class="headerlink" title="Redisçš„Javaå®¢æˆ·ç«¯"></a>Redisçš„Javaå®¢æˆ·ç«¯</h3><p>åœ¨javaç¨‹åºä¸­æ“ä½œRediså°±éœ€è¦ä½¿ç”¨Redisçš„Javaå®¢æˆ·ç«¯ï¼Œå°±å¦‚åŒæˆ‘ä»¬ä½¿ç”¨JDBCæ“ä½œMySQLæ•°æ®åº“ä¸€æ ·ã€‚<br>Redis çš„ Java å®¢æˆ·ç«¯å¾ˆå¤šï¼Œå¸¸ç”¨çš„å‡ ç§ï¼š</p><ul><li>Jedis</li><li>Lettuce</li><li>Spring Data Redis</li></ul><p>Spring å¯¹ Redis å®¢æˆ·ç«¯è¿›è¡Œäº†æ•´åˆï¼Œæä¾›äº† <code>Spring Data Redis</code>ï¼Œåœ¨Spring Booté¡¹ç›®ä¸­è¿˜æä¾›äº†å¯¹åº”çš„Starterï¼Œå³ <code>spring-boot-starter-data-redis</code>ã€‚</p><h3 id="Spring-Data-Redisä½¿ç”¨æ–¹å¼"><a href="#Spring-Data-Redisä½¿ç”¨æ–¹å¼" class="headerlink" title="Spring Data Redisä½¿ç”¨æ–¹å¼"></a>Spring Data Redisä½¿ç”¨æ–¹å¼</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p><code>Spring Data Redis</code> æ˜¯ Spring çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†åœ¨ Spring åº”ç”¨ä¸­é€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥è®¿é—® Redis æœåŠ¡ï¼Œå¯¹ Redis åº•å±‚å¼€å‘åŒ…è¿›è¡Œäº†é«˜åº¦å°è£…ã€‚<br>ç½‘å€ï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-redis">https://spring.io/projects/spring-data-redis</a><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20210927143741458.png"></div></div><p></p><p>Spring Bootæä¾›äº†å¯¹åº”çš„Starterï¼Œmavenåæ ‡ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Spring Data Redisä¸­æä¾›äº†ä¸€ä¸ªé«˜åº¦å°è£…çš„ç±»ï¼š<strong>RedisTemplate</strong>ï¼Œå¯¹ç›¸å…³apiè¿›è¡Œäº†å½’ç±»å°è£…,å°†åŒä¸€ç±»å‹æ“ä½œå°è£…ä¸ºoperationæ¥å£ï¼Œå…·ä½“åˆ†ç±»å¦‚ä¸‹ï¼š</p><ul><li>ValueOperationsï¼šstringæ•°æ®æ“ä½œ</li><li>SetOperationsï¼šsetç±»å‹æ•°æ®æ“ä½œ</li><li>ZSetOperationsï¼šzsetç±»å‹æ•°æ®æ“ä½œ</li><li>HashOperationsï¼šhashç±»å‹çš„æ•°æ®æ“ä½œ</li><li>ListOperationsï¼šlistç±»å‹çš„æ•°æ®æ“ä½œ</li></ul><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p>è¿›å…¥åˆ°sky-serveræ¨¡å—</p><ol><li>å¯¼å…¥Spring Data Redisçš„mavenåæ ‡(å·²å®Œæˆ)<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol><li>é…ç½®Redisæ•°æ®æº<br>åœ¨application-dev.ymlä¸­æ·»åŠ <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></li></ol><div class="note warning no-icon flat"><p><strong>è¯´æ˜ï¼š</strong><br>database:æŒ‡å®šä½¿ç”¨Redisçš„å“ªä¸ªæ•°æ®åº“ï¼ŒRedisæœåŠ¡å¯åŠ¨åé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œç¼–å·åˆ†åˆ«æ˜¯ä»0åˆ°15ã€‚<br>å¯ä»¥é€šè¿‡ä¿®æ”¹Redisé…ç½®æ–‡ä»¶æ¥æŒ‡å®šæ•°æ®åº“çš„æ•°é‡ã€‚</p></div><p>åœ¨application.ymlä¸­æ·»åŠ è¯»å–application-dev.ymlä¸­çš„ç›¸å…³Redisé…ç½®<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">$&#123;sky.redis.host&#125;</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">$&#123;sky.redis.port&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;sky.redis.password&#125;</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">$&#123;sky.redis.database&#125;</span></span><br></pre></td></tr></table></figure><p></p><ol><li><p>ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºRedisTemplateå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹åˆ›å»ºredisæ¨¡æ¿å¯¹è±¡...&quot;</span>);</span><br><span class="line">        <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®redisçš„è¿æ¥å·¥å‚å¯¹è±¡</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//è®¾ç½®redis keyçš„åºåˆ—åŒ–å™¨</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning no-icon flat"><p><strong>æ³¨æ„</strong><br>å½“å‰é…ç½®ç±»ä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸º Spring Boot æ¡†æ¶ä¼šè‡ªåŠ¨è£…é… RedisTemplate å¯¹è±¡ï¼Œä½†æ˜¯é»˜è®¤çš„keyåºåˆ—åŒ–å™¨ä¸º<code>JdkSerializationRedisSerializer</code>ï¼Œå¯¼è‡´æˆ‘ä»¬å­˜åˆ°Redisä¸­åçš„æ•°æ®å’ŒåŸå§‹æ•°æ®æœ‰å·®åˆ«ï¼Œæ•…è®¾ç½®ä¸º<code>StringRedisSerializer</code>åºåˆ—åŒ–å™¨ã€‚</p></div></li><li><p>é€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis<br>åœ¨testä¸‹æ–°å»ºæµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataRedisTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(redisTemplate);</span><br><span class="line">        <span class="comment">//stringæ•°æ®æ“ä½œ</span></span><br><span class="line">        <span class="type">ValueOperations</span> <span class="variable">valueOperations</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">        <span class="comment">//hashç±»å‹çš„æ•°æ®æ“ä½œ</span></span><br><span class="line">        <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">        <span class="comment">//listç±»å‹çš„æ•°æ®æ“ä½œ</span></span><br><span class="line">        <span class="type">ListOperations</span> <span class="variable">listOperations</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line">        <span class="comment">//setç±»å‹æ•°æ®æ“ä½œ</span></span><br><span class="line">        <span class="type">SetOperations</span> <span class="variable">setOperations</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line">        <span class="comment">//zsetç±»å‹æ•°æ®æ“ä½œ</span></span><br><span class="line">        <span class="type">ZSetOperations</span> <span class="variable">zSetOperations</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130205351403.png"></div></div><p>è¯´æ˜RedisTemplateå¯¹è±¡æ³¨å…¥æˆåŠŸï¼Œå¹¶ä¸”é€šè¿‡è¯¥RedisTemplateå¯¹è±¡è·å–æ“ä½œ5ç§æ•°æ®ç±»å‹ç›¸å…³å¯¹è±¡ã€‚</p></li></ol><h4 id="å¸¸è§æ•°æ®ç±»å‹"><a href="#å¸¸è§æ•°æ®ç±»å‹" class="headerlink" title="å¸¸è§æ•°æ®ç±»å‹"></a>å¸¸è§æ•°æ®ç±»å‹</h4><div class="tabs" id="springdataredis"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#springdataredis-1">å­—ç¬¦ä¸²ç±»å‹</button></li><li class="tab"><button type="button" data-href="#springdataredis-2">å“ˆå¸Œç±»å‹</button></li><li class="tab"><button type="button" data-href="#springdataredis-3">åˆ—è¡¨ç±»å‹</button></li><li class="tab"><button type="button" data-href="#springdataredis-4">é›†åˆç±»å‹</button></li><li class="tab"><button type="button" data-href="#springdataredis-5">æœ‰åºé›†åˆç±»å‹</button></li><li class="tab"><button type="button" data-href="#springdataredis-6">é€šç”¨å‘½ä»¤æ“ä½œ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="springdataredis-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ“ä½œå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">// set get setex setnx</span></span><br><span class="line">       redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">       System.out.println(city);</span><br><span class="line">       redisTemplate.opsForValue().set(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;1234&quot;</span>,<span class="number">3</span>, TimeUnit.MINUTES);</span><br><span class="line">       redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">       redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springdataredis-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ“ä½œå“ˆå¸Œç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//hset hget hdel hkeys hvals</span></span><br><span class="line">       <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line">       hashOperations.put(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">       hashOperations.put(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) hashOperations.get(<span class="string">&quot;100&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">       System.out.println(name);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> hashOperations.keys(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">       System.out.println(keys);</span><br><span class="line"></span><br><span class="line">       <span class="type">List</span> <span class="variable">values</span> <span class="operator">=</span> hashOperations.values(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">       System.out.println(values);</span><br><span class="line"></span><br><span class="line">       hashOperations.delete(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;age&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springdataredis-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ“ä½œåˆ—è¡¨ç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//lpush lrange rpop llen</span></span><br><span class="line">       <span class="type">ListOperations</span> <span class="variable">listOperations</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line"></span><br><span class="line">       listOperations.leftPushAll(<span class="string">&quot;mylist&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">       listOperations.leftPush(<span class="string">&quot;mylist&quot;</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">List</span> <span class="variable">mylist</span> <span class="operator">=</span> listOperations.range(<span class="string">&quot;mylist&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">       System.out.println(mylist);</span><br><span class="line"></span><br><span class="line">       listOperations.rightPop(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> listOperations.size(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">       System.out.println(size);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springdataredis-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ“ä½œé›†åˆç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//sadd smembers scard sinter sunion srem</span></span><br><span class="line">       <span class="type">SetOperations</span> <span class="variable">setOperations</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line"></span><br><span class="line">       setOperations.add(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line">       setOperations.add(<span class="string">&quot;set2&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">members</span> <span class="operator">=</span> setOperations.members(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line">       System.out.println(members);</span><br><span class="line"></span><br><span class="line">       <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> setOperations.size(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line">       System.out.println(size);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">intersect</span> <span class="operator">=</span> setOperations.intersect(<span class="string">&quot;set1&quot;</span>, <span class="string">&quot;set2&quot;</span>);</span><br><span class="line">       System.out.println(intersect);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">union</span> <span class="operator">=</span> setOperations.union(<span class="string">&quot;set1&quot;</span>, <span class="string">&quot;set2&quot;</span>);</span><br><span class="line">       System.out.println(union);</span><br><span class="line"></span><br><span class="line">       setOperations.remove(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springdataredis-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ“ä½œæœ‰åºé›†åˆç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZset</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//zadd zrange zincrby zrem</span></span><br><span class="line">       <span class="type">ZSetOperations</span> <span class="variable">zSetOperations</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line"></span><br><span class="line">       zSetOperations.add(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="number">10</span>);</span><br><span class="line">       zSetOperations.add(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="number">12</span>);</span><br><span class="line">       zSetOperations.add(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">zset1</span> <span class="operator">=</span> zSetOperations.range(<span class="string">&quot;zset1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">       System.out.println(zset1);</span><br><span class="line"></span><br><span class="line">       zSetOperations.incrementScore(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">       zSetOperations.remove(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springdataredis-6"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é€šç”¨å‘½ä»¤æ“ä½œ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCommon</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//keys exists type del</span></span><br><span class="line">       <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> redisTemplate.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">       System.out.println(keys);</span><br><span class="line"></span><br><span class="line">       <span class="type">Boolean</span> <span class="variable">name</span> <span class="operator">=</span> redisTemplate.hasKey(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">       <span class="type">Boolean</span> <span class="variable">set1</span> <span class="operator">=</span> redisTemplate.hasKey(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (Object key : keys) &#123;</span><br><span class="line">           <span class="type">DataType</span> <span class="variable">type</span> <span class="operator">=</span> redisTemplate.type(key);</span><br><span class="line">           System.out.println(type.name());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       redisTemplate.delete(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®"><a href="#åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®" class="headerlink" title="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®"></a>åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-14"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-14" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>è¿›åˆ°è‹ç©¹å¤–å–åå°ï¼Œæ˜¾ç¤ºé¤å…çš„è¥ä¸šçŠ¶æ€ï¼Œè¥ä¸šçŠ¶æ€åˆ†ä¸º<strong>è¥ä¸šä¸­</strong>å’Œ<strong>æ‰“çƒŠä¸­</strong>ï¼Œè‹¥å½“å‰é¤å…å¤„äºè¥ä¸šçŠ¶æ€ï¼Œè‡ªåŠ¨æ¥æ”¶ä»»ä½•è®¢å•ï¼Œå®¢æˆ·å¯åœ¨å°ç¨‹åºè¿›è¡Œä¸‹å•æ“ä½œï¼›è‹¥å½“å‰é¤å…å¤„äºæ‰“çƒŠçŠ¶æ€ï¼Œä¸æ¥å—ä»»ä½•è®¢å•ï¼Œå®¢æˆ·ä¾¿æ— æ³•åœ¨å°ç¨‹åºè¿›è¡Œä¸‹å•æ“ä½œã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130212134915.png"></div></div><p><strong>æ¥å£è®¾è®¡ï¼š</strong></p><ul><li>è®¾ç½®è¥ä¸šçŠ¶æ€</li><li>ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</li><li>ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</li></ul><div class="note warning no-icon flat"><p><strong>æ³¨ï¼š</strong>ä»æŠ€æœ¯å±‚é¢åˆ†æï¼Œå…¶å®ç®¡ç†ç«¯å’Œç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€æ—¶ï¼Œå¯é€šè¿‡ä¸€ä¸ªæ¥å£å»å®ç°å³å¯ã€‚å› ä¸ºè¥ä¸šçŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯ï¼Œæœ¬é¡¹ç›®çº¦å®šï¼š</p><ul><li><strong>ç®¡ç†ç«¯</strong>å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨/adminä½œä¸ºå‰ç¼€ã€‚</li><li><strong>ç”¨æˆ·ç«¯</strong>å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨/userä½œä¸ºå‰ç¼€ã€‚</li></ul></div><div class="tabs" id="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡-1">è®¾ç½®è¥ä¸šçŠ¶æ€</button></li><li class="tab"><button type="button" data-href="#åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡-2">ç®¡ç†ç«¯è¥ä¸šçŠ¶æ€</button></li><li class="tab"><button type="button" data-href="#åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡-3">ç”¨æˆ·ç«¯è¥ä¸šçŠ¶æ€</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130215725802.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130215814021.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®æ¥å£è®¾è®¡-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221130215836785.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note warning no-icon flat"><p>å¯ä»¥é€šè¿‡ä¸€å¼ è¡¨æ¥å­˜å‚¨è¥ä¸šçŠ¶æ€æ•°æ®ï¼Œä½†æ•´ä¸ªè¡¨å°±ä¸€ä¸ªå­—æ®µçš„æ„ä¹‰ä¸å¤§ï¼Œæ‰€ä»¥è¥ä¸šçŠ¶æ€å­˜å‚¨æ–¹å¼ï¼šåŸºäºRedisçš„å­—ç¬¦ä¸²æ¥å­˜å‚¨<br><strong>çº¦å®šï¼š</strong> 1è¡¨ç¤ºè¥ä¸š 0è¡¨ç¤ºæ‰“çƒŠ</p></div><h3 id="ä»£ç å¼€å‘-9"><a href="#ä»£ç å¼€å‘-9" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="è®¾ç½®è¥ä¸šçŠ¶æ€"><a href="#è®¾ç½®è¥ä¸šçŠ¶æ€" class="headerlink" title="è®¾ç½®è¥ä¸šçŠ¶æ€"></a>è®¾ç½®è¥ä¸šçŠ¶æ€</h4><p>åœ¨sky-serveræ¨¡å—ä¸­ï¼Œåˆ›å»ºShopController.java</p><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºShopControllerçš„setStatusè®¾ç½®è¥ä¸šçŠ¶æ€æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;adminShopController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/shop&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;åº—é“ºç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;SHOP_STATUS&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setStatus</span><span class="params">(<span class="meta">@PathVariable</span> Integer status)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€ä¸ºï¼š&#123;&#125;&quot;</span>,status == <span class="number">1</span> ? <span class="string">&quot;è¥ä¸šä¸­&quot;</span> : <span class="string">&quot;æ‰“çƒŠä¸­&quot;</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(KEY,status);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"><a href="#ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€" class="headerlink" title="ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"></a>ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºShopControllerçš„getStatusæŸ¥è¯¢è¥ä¸šçŠ¶æ€æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);</span><br><span class="line">       log.info(<span class="string">&quot;è·å–åˆ°åº—é“ºçš„è¥ä¸šçŠ¶æ€ä¸ºï¼š&#123;&#125;&quot;</span>,status == <span class="number">1</span> ? <span class="string">&quot;è¥ä¸šä¸­&quot;</span> : <span class="string">&quot;æ‰“çƒŠä¸­&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> Result.success(status);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"><a href="#ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€" class="headerlink" title="ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"></a>ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</h4><p>åˆ›å»ºcom.sky.controller.useråŒ…ï¼Œåœ¨è¯¥åŒ…ä¸‹åˆ›å»ºShopController.java</p><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºShopControllerçš„getStatusæŸ¥è¯¢è¥ä¸šçŠ¶æ€æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userShopController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shop&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;åº—é“ºç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;SHOP_STATUS&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);</span><br><span class="line">        log.info(<span class="string">&quot;è·å–åˆ°åº—é“ºçš„è¥ä¸šçŠ¶æ€ä¸ºï¼š&#123;&#125;&quot;</span>,status == <span class="number">1</span> ? <span class="string">&quot;è¥ä¸šä¸­&quot;</span> : <span class="string">&quot;æ‰“çƒŠä¸­&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success(status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="day06"><a href="#day06" class="headerlink" title="day06"></a>day06</h1><h2 id="è¯¾ç¨‹å†…å®¹-2"><a href="#è¯¾ç¨‹å†…å®¹-2" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>HttpClient</li><li>å¾®ä¿¡å°ç¨‹åºå¼€å‘</li><li>å¾®ä¿¡ç™»å½•</li><li>å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç </li></ul><h2 id="å¾®ä¿¡å°ç¨‹åºå¼€å‘"><a href="#å¾®ä¿¡å°ç¨‹åºå¼€å‘" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºå¼€å‘"></a>å¾®ä¿¡å°ç¨‹åºå¼€å‘</h2><h3 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚<br><strong>å®˜æ–¹ç½‘å€ï¼š</strong> <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/wx?token=&amp;lang=zh_CN">https://mp.weixin.qq.com/cgi-bin/wx?token=&amp;lang=zh_CN</a></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203205305487.png"></div></div><ol><li>è¿›è¡Œå°ç¨‹åºå¼€å‘æ—¶ï¼Œéœ€è¦å…ˆæ‰æ³¨å†Œä¸€ä¸ªå°ç¨‹åºï¼Œå¯ä»¥ä»¥ä¸ªäººçš„èº«ä»½æ¥æ³¨å†Œï¼Œä¹Ÿå¯ä»¥ä»¥ä¼ä¸šæˆ–è€…å…¶ä»–ç»„ç»‡çš„æ–¹å¼æ¥æ³¨å†Œï¼Œä¸åŒçš„ä¸»é¢˜æ³¨å†Œå°ç¨‹åºï¼Œæœ€ç»ˆçš„å¼€æ”¾æƒé™ä¹Ÿä¸åŒï¼Œæ¯”å¦‚ä»¥ä¸ªäººèº«ä»½æ¥æ³¨å†Œï¼Œåˆ™æ— æ³•å¼€é€šæ”¯ä»˜æƒé™ã€‚<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203210640473.png"></div></div></li><li>å¾®ä¿¡å®˜æ–¹æä¾›äº†ä¸€ç³»åˆ—å·¥å…·æ¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®Œæˆå°ç¨‹åºçš„å¼€å‘ï¼Œæä¾›äº†å®Œå–„çš„å¼€å‘æ–‡æ¡£å’Œå¼€å‘è€…å·¥å…·ï¼Œè¿˜æä¾›äº†ç›¸åº”çš„è®¾è®¡æŒ‡å—ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›å°ç¨‹åºä½“éªŒDEMOï¼Œå¯ä»¥å¿«é€Ÿçš„ä½“éªŒå°ç¨‹åºå®ç°çš„åŠŸèƒ½ã€‚<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203211226920.png"></div></div></li><li>å¼€å‘å®Œçš„å°ç¨‹åºæƒ³è¦ä¸Šçº¿ï¼Œä¹Ÿæä¾›äº†è¯¦ç»†çš„æ¥å…¥æ•™ç¨‹<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203211535565.png"></div></div></li></ol><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>å¼€å‘å¾®ä¿¡å°ç¨‹åºä¹‹å‰éœ€è¦åšå¦‚ä¸‹å‡†å¤‡å·¥ä½œï¼š</p><ul><li>æ³¨å†Œå°ç¨‹åº</li><li>å®Œå–„å°ç¨‹åºä¿¡æ¯</li><li>ä¸‹è½½å¼€å‘è€…å·¥å…·</li></ul><ol><li><p>æ³¨å†Œå°ç¨‹åº,æ³¨å†Œåœ°å€ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/wxopen/waregister?action=step1">https://mp.weixin.qq.com/wxopen/waregister?action=step1</a></p></li><li><p>å®Œå–„å°ç¨‹åºä¿¡æ¯<br>ç™»å½•å°ç¨‹åºåå°ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com/</a><br>å®Œå–„å°ç¨‹åºä¿¡æ¯ã€å°ç¨‹åºç±»ç›®</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203212615981.png"></div></div><p>æŸ¥çœ‹å°ç¨‹åºçš„ <code>AppID</code></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203212702993.png"></div></div></li><li><p>ä¸‹è½½å¼€å‘è€…å·¥å…·,ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/stable.html">https://developers.weixin.qq.com/miniprogram/dev/devtools/stable.html</a></p></li><li><p>åˆ›å»ºå°ç¨‹åºé¡¹ç›®</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203213042020.png"></div></div><p>ç†Ÿæ‚‰å¼€å‘è€…å·¥å…·å¸ƒå±€</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203213108317.png"></div></div></li><li>è®¾ç½®ä¸æ ¡éªŒåˆæ³•åŸŸå<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203213212370.png"></div></div></li></ol><div class="note warning no-icon flat"><p><strong>æ³¨ï¼š</strong> å¼€å‘é˜¶æ®µï¼Œå°ç¨‹åºå‘å‡ºè¯·æ±‚åˆ°åç«¯çš„TomcatæœåŠ¡å™¨ï¼Œè‹¥ä¸å‹¾é€‰ï¼Œè¯·æ±‚å‘é€å¤±è´¥ã€‚</p></div><h3 id="å…¥é—¨æ¡ˆä¾‹"><a href="#å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><div class="note danger no-icon flat"><p>å°ç¨‹åºå¼€å‘æœ¬è´¨ä¸Šå±äºå‰ç«¯å¼€å‘ï¼Œä¸»è¦ä½¿ç”¨<code>JavaScript</code>è¿›è¡Œå¼€å‘ï¼Œç®€å•äº†è§£å³å¯ï¼Œåé¢ä¼šç›´æ¥ç»™å‡ºå°ç¨‹åºçš„ä»£ç </p></div><h4 id="å°ç¨‹åºç›®å½•ç»“æ„"><a href="#å°ç¨‹åºç›®å½•ç»“æ„" class="headerlink" title="å°ç¨‹åºç›®å½•ç»“æ„"></a>å°ç¨‹åºç›®å½•ç»“æ„</h4><p>å°ç¨‹åºåŒ…å«ä¸€ä¸ªæè¿°æ•´ä½“ç¨‹åºçš„ app å’Œå¤šä¸ªæè¿°å„è‡ªé¡µé¢çš„ pageã€‚ä¸€ä¸ªå°ç¨‹åºä¸»ä½“éƒ¨åˆ†ç”±ä¸‰ä¸ªæ–‡ä»¶ç»„æˆï¼Œå¿…é¡»æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¦‚ä¸‹ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203220557676.png"></div></div><p></p><p><strong>æ–‡ä»¶è¯´æ˜ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203220635867.png"></div></div><p></p><p><strong>app.jsï¼š</strong> å¿…é¡»å­˜åœ¨ï¼Œä¸»è¦å­˜æ”¾å°ç¨‹åºçš„é€»è¾‘ä»£ç </p><p><strong>app.jsonï¼š</strong> å¿…é¡»å­˜åœ¨ï¼Œå°ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œä¸»è¦å­˜æ”¾å°ç¨‹åºçš„å…¬å…±é…ç½®</p><p><strong>app.wxss:</strong> éå¿…é¡»å­˜åœ¨ï¼Œä¸»è¦å­˜æ”¾å°ç¨‹åºå…¬å…±æ ·å¼è¡¨ï¼Œç±»ä¼¼äºå‰ç«¯çš„CSSæ ·å¼</p><p>å¯¹å°ç¨‹åºä¸»ä½“ä¸‰ä¸ªæ–‡ä»¶äº†è§£åï¼Œå…¶å®ä¸€ä¸ªå°ç¨‹åºåˆæœ‰å¤šä¸ªé¡µé¢ã€‚æ¯”å¦‚è¯´ï¼Œæœ‰å•†å“æµè§ˆé¡µé¢ã€è´­ç‰©è½¦çš„é¡µé¢ã€è®¢å•æ”¯ä»˜çš„é¡µé¢ã€å•†å“çš„è¯¦æƒ…é¡µé¢ç­‰ç­‰ã€‚é‚£è¿™äº›é¡µé¢ä¼šæ”¾åœ¨å“ªå‘¢ï¼Ÿ<br>ä¼šå­˜æ”¾åœ¨pagesç›®å½•ã€‚</p><p>ä¸€ä¸ªå°ç¨‹åºä¼šæœ‰è®¸å¤šä¸ªé¡µé¢ï¼Œæ¯”å¦‚å•†å“æµè§ˆé¡µé¢ã€è´­ç‰©è½¦çš„é¡µé¢ã€è®¢å•æ”¯ä»˜çš„é¡µé¢ã€å•†å“çš„è¯¦æƒ…é¡µé¢ç­‰ç­‰ï¼Œè¿™äº›é¡µé¢ä¼šå­˜æ”¾åœ¨pagesç›®å½•ä¸‹ï¼Œæ¯ä¸ªå°ç¨‹åºé¡µé¢ä¸»è¦ç”±å››ä¸ªæ–‡ä»¶ç»„æˆ</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203220826893.png"></div></div><p><strong>æ–‡ä»¶è¯´æ˜ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221203220839187.png"></div></div><p></p><p><strong>jsæ–‡ä»¶ï¼š</strong> å¿…é¡»å­˜åœ¨ï¼Œå­˜æ”¾é¡µé¢ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œç¼–å†™çš„jsä»£ç ã€‚</p><p><strong>wxmlæ–‡ä»¶ï¼š</strong> å¿…é¡»å­˜åœ¨ï¼Œå­˜æ”¾é¡µé¢ç»“æ„ï¼Œä¸»è¦æ˜¯åšé¡µé¢å¸ƒå±€ï¼Œé¡µé¢æ•ˆæœå±•ç¤ºçš„ï¼Œç±»ä¼¼äºHTMLé¡µé¢ã€‚</p><p><strong>jsonæ–‡ä»¶ï¼š</strong> éå¿…é¡»ï¼Œå­˜æ”¾é¡µé¢ç›¸å…³çš„é…ç½®ã€‚</p><p><strong>wxssæ–‡ä»¶ï¼š</strong> éå¿…é¡»ï¼Œå­˜æ”¾é¡µé¢æ ·å¼è¡¨ï¼Œç›¸å½“äºCSSæ–‡ä»¶ã€‚</p><h4 id="ç¼–å†™å’Œç¼–è¯‘å°ç¨‹åº"><a href="#ç¼–å†™å’Œç¼–è¯‘å°ç¨‹åº" class="headerlink" title="ç¼–å†™å’Œç¼–è¯‘å°ç¨‹åº"></a>ç¼–å†™å’Œç¼–è¯‘å°ç¨‹åº</h4><ol><li>ç¼–å†™<br>è¿›å…¥åˆ°index.wxmlï¼Œç¼–å†™é¡µé¢å¸ƒå±€<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>Â <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">Â Â <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"> Â Â <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">Â Â Â Â <span class="tag">&lt;<span class="name">button</span>Â <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>Â <span class="attr">bindtap</span>=<span class="string">&quot;getUserInfo&quot;</span>&gt;</span>è·å–ç”¨æˆ·ä¿¡æ¯<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">Â Â Â Â <span class="tag">&lt;<span class="name">image</span>Â <span class="attr">style</span>=<span class="string">&quot;width:Â 100px;height:Â 100px;&quot;</span>Â <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;avatarUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">Â Â Â Â &#123;&#123;nickName&#125;&#125;</span><br><span class="line">Â Â <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"> Â Â <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">Â Â Â Â <span class="tag">&lt;<span class="name">button</span>Â <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>Â <span class="attr">bindtap</span>=<span class="string">&quot;wxlogin&quot;</span>&gt;</span>å¾®ä¿¡ç™»å½•<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">Â Â Â Â æˆæƒç ï¼š&#123;&#123;code&#125;&#125;</span><br><span class="line">Â Â <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"> Â Â <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">Â Â Â Â <span class="tag">&lt;<span class="name">button</span>Â <span class="attr">type</span>=<span class="string">&quot;warn&quot;</span>Â <span class="attr">bindtap</span>=<span class="string">&quot;sendRequest&quot;</span>&gt;</span>å‘é€è¯·æ±‚<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">Â Â Â Â å“åº”ç»“æœï¼š&#123;&#123;result&#125;&#125;</span><br><span class="line">Â Â <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>è¿›å…¥åˆ°index.jsï¼Œç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">Â Â <span class="attr">data</span>:&#123;</span><br><span class="line">Â Â Â Â <span class="attr">msg</span>:<span class="string">&#x27;helloÂ world&#x27;</span>,</span><br><span class="line">Â Â Â Â <span class="attr">avatarUrl</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">Â Â Â Â <span class="attr">nickName</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">Â Â Â Â <span class="attr">code</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">Â Â Â Â <span class="attr">result</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">Â Â &#125;,</span><br><span class="line">Â Â <span class="attr">getUserInfo</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">Â Â Â Â wx.<span class="title function_">getUserProfile</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â <span class="attr">desc</span>:Â <span class="string">&#x27;è·å–ç”¨æˆ·ä¿¡æ¯&#x27;</span>,</span><br><span class="line">Â Â Â Â Â Â <span class="attr">success</span>:<span class="function">(<span class="params">res</span>)Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">avatarUrl</span>:res.<span class="property">userInfo</span>.<span class="property">avatarUrl</span>,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">nickName</span>:res.<span class="property">userInfo</span>.<span class="property">nickName</span></span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line">Â Â &#125;,</span><br><span class="line">Â Â <span class="attr">wxlogin</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">Â Â Â Â wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â <span class="attr">success</span>:Â <span class="function">(<span class="params">res</span>)Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æˆæƒç ï¼š&quot;</span>+res.<span class="property">code</span>)</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">code</span>:res.<span class="property">code</span></span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line">Â Â &#125;,</span><br><span class="line">Â Â <span class="attr">sendRequest</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">Â Â Â Â wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â <span class="attr">url</span>:Â <span class="string">&#x27;http://localhost:8080/user/shop/status&#x27;</span>,</span><br><span class="line">Â Â Â Â Â Â <span class="attr">method</span>:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">Â Â Â Â Â Â <span class="attr">success</span>:<span class="function">(<span class="params">res</span>)Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å“åº”ç»“æœï¼š&quot;</span>Â +Â res.<span class="property">data</span>.<span class="property">data</span>)</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">result</span>:res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line">Â Â &#125;&#125;)</span><br></pre></td></tr></table></figure></li><li>ç¼–è¯‘å°ç¨‹åº<br>ç‚¹å‡»å¼€å‘è€…å·¥å…·çš„ç¼–è¯‘æŒ‰é’®ï¼Œç¼–è¯‘å°ç¨‹åºï¼Œå°±èƒ½çœ‹åˆ°è¿è¡Œæ•ˆæœäº†<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204181606927.png"></div></div></li></ol><h4 id="å‘å¸ƒå°ç¨‹åº"><a href="#å‘å¸ƒå°ç¨‹åº" class="headerlink" title="å‘å¸ƒå°ç¨‹åº"></a>å‘å¸ƒå°ç¨‹åº</h4><p>æƒ³è¦å°†å°ç¨‹åºå‘å¸ƒä¸Šçº¿ï¼Œè®©æ‰€æœ‰ç”¨æˆ·éƒ½ç”¨åˆ°è¯¥å°ç¨‹åº<br>ç‚¹å‡»ä¸Šä¼ æŒ‰é’®:<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204225355015.png"></div></div><br>ä¸Šä¼ æˆåŠŸï¼š<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204225557820.png"></div></div><br><div class="note info no-icon flat"><ul><li><p>å°†ä»£ç ä¸Šä¼ åˆ°å¾®ä¿¡æœåŠ¡ç«¯å¹¶ä¸æ˜¯è¡¨ç¤ºå°ç¨‹åºå·²ç»å‘å¸ƒäº†ï¼Œå½“å‰å°ç¨‹åºåªæ˜¯ä¸€ä¸ªå¼€å‘ç‰ˆæœ¬ï¼Œéœ€æäº¤å®¡æ ¸ï¼Œå˜æˆå®¡æ ¸ç‰ˆæœ¬ï¼Œå®¡æ ¸é€šè¿‡åï¼Œè¿›è¡Œå‘å¸ƒï¼Œå˜æˆçº¿ä¸Šç‰ˆæœ¬ã€‚</p></li><li><p>ä¸€æ—¦æˆä¸ºçº¿ä¸Šç‰ˆæœ¬ï¼Œè¿™å°±è¯´æ˜å°ç¨‹åºå°±å·²ç»å‘å¸ƒä¸Šçº¿äº†ï¼Œå¾®ä¿¡ç”¨æˆ·å°±å¯ä»¥åœ¨å¾®ä¿¡é‡Œé¢å»æœç´¢å’Œä½¿ç”¨è¿™ä¸ªå°ç¨‹åºäº†ã€‚</p></li></ul></div><p></p><h2 id="å¾®ä¿¡ç™»å½•"><a href="#å¾®ä¿¡ç™»å½•" class="headerlink" title="å¾®ä¿¡ç™»å½•"></a>å¾®ä¿¡ç™»å½•</h2><h3 id="å¯¼å…¥å°ç¨‹åºä»£ç "><a href="#å¯¼å…¥å°ç¨‹åºä»£ç " class="headerlink" title="å¯¼å…¥å°ç¨‹åºä»£ç "></a>å¯¼å…¥å°ç¨‹åºä»£ç </h3><ol><li>åœ¨å¾®ä¿¡å°ç¨‹åºå¼€å‘è€…å·¥å…·ä¸­å¯¼å…¥å°ç¨‹åºä»£ç <div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204205631809.png"></div></div></li><li>è¾“å…¥è‡ªå·±çš„AppID<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204210011364.png"></div></div></li><li>æŸ¥çœ‹é¡¹ç›®ç»“æ„<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204210739195.png"></div></div></li><li>ä¿®æ”¹é…ç½®<br>å°†å°ç¨‹åºè¯·æ±‚çš„åç«¯æœåŠ¡urlä¿®æ”¹ä¸ºè‡ªå·±åç«¯æœåŠ¡çš„ipåœ°å€å’Œç«¯å£å·(é»˜è®¤ä¸éœ€è¦ä¿®æ”¹)<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204211239035.png"></div></div></li></ol><h3 id="å¾®ä¿¡ç™»å½•æµç¨‹"><a href="#å¾®ä¿¡ç™»å½•æµç¨‹" class="headerlink" title="å¾®ä¿¡ç™»å½•æµç¨‹"></a>å¾®ä¿¡ç™»å½•æµç¨‹</h3><p>å®˜æ–¹ç»™å‡ºäº†å°ç¨‹åºå¾®ä¿¡ç™»å½•çš„è¯¦ç»†æµç¨‹ï¼š<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html</a></p><p><strong>æµç¨‹å›¾ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204211800753.png"></div></div><p></p><p><strong>æ­¥éª¤åˆ†æï¼š</strong></p><ol><li>å°ç¨‹åºç«¯ï¼Œè°ƒç”¨wx.login()è·å–codeï¼Œå°±æ˜¯æˆæƒç ã€‚</li><li>å°ç¨‹åºç«¯ï¼Œè°ƒç”¨wx.request()å‘é€è¯·æ±‚å¹¶æºå¸¦codeï¼Œè¯·æ±‚å¼€å‘è€…æœåŠ¡å™¨(è‡ªå·±ç¼–å†™çš„åç«¯æœåŠ¡)ã€‚</li><li>å¼€å‘è€…æœåŠ¡ç«¯ï¼Œé€šè¿‡HttpClientå‘å¾®ä¿¡æ¥å£æœåŠ¡å‘é€è¯·æ±‚ï¼Œå¹¶æºå¸¦appId+appsecret+codeä¸‰ä¸ªå‚æ•°ã€‚</li><li>å¼€å‘è€…æœåŠ¡ç«¯ï¼Œæ¥æ”¶å¾®ä¿¡æ¥å£æœåŠ¡è¿”å›çš„æ•°æ®ï¼Œsession_key+opendIdç­‰ã€‚opendIdæ˜¯å¾®ä¿¡ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ã€‚</li><li>å¼€å‘è€…æœåŠ¡ç«¯ï¼Œè‡ªå®šä¹‰ç™»å½•æ€ï¼Œç”Ÿæˆä»¤ç‰Œ(token)å’Œopenidç­‰æ•°æ®è¿”å›ç»™å°ç¨‹åºç«¯ï¼Œæ–¹ä¾¿åç»ªè¯·æ±‚èº«ä»½æ ¡éªŒã€‚</li><li>å°ç¨‹åºç«¯ï¼Œæ”¶åˆ°è‡ªå®šä¹‰ç™»å½•æ€ï¼Œå­˜å‚¨storageã€‚</li><li>å°ç¨‹åºç«¯ï¼Œåç»ªé€šè¿‡wx.request()å‘èµ·ä¸šåŠ¡è¯·æ±‚æ—¶ï¼Œæºå¸¦tokenã€‚</li><li>å¼€å‘è€…æœåŠ¡ç«¯ï¼Œæ”¶åˆ°è¯·æ±‚åï¼Œé€šè¿‡æºå¸¦çš„tokenï¼Œè§£æå½“å‰ç™»å½•ç”¨æˆ·çš„idã€‚</li><li>å¼€å‘è€…æœåŠ¡ç«¯ï¼Œèº«ä»½æ ¡éªŒé€šè¿‡åï¼Œç»§ç»­ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæœ€ç»ˆè¿”å›ä¸šåŠ¡æ•°æ®ã€‚</li></ol><p><strong>ä¸‹é¢ä½¿ç”¨Postmanæ¥è¿›è¡Œæµ‹è¯•ï¼š</strong></p><div class="note info no-icon flat"><ol><li>è°ƒç”¨ <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html">wx.login()</a> è·å– <strong>ä¸´æ—¶ç™»å½•å‡­è¯code</strong> ï¼Œå¹¶å›ä¼ åˆ°å¼€å‘è€…æœåŠ¡å™¨ã€‚</li><li>è°ƒç”¨ <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/login/auth.code2Session.html">auth.code2Session</a> æ¥å£ï¼Œæ¢å– <strong>ç”¨æˆ·å”¯ä¸€æ ‡è¯† OpenID</strong> ã€ ç”¨æˆ·åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°å¸å·ä¸‹çš„<strong>å”¯ä¸€æ ‡è¯†UnionID</strong>ï¼ˆè‹¥å½“å‰å°ç¨‹åºå·²ç»‘å®šåˆ°å¾®ä¿¡å¼€æ”¾å¹³å°å¸å·ï¼‰ å’Œ <strong>ä¼šè¯å¯†é’¥ session_key</strong>ã€‚</li></ol><p>ä¹‹åå¼€å‘è€…æœåŠ¡å™¨å¯ä»¥æ ¹æ®ç”¨æˆ·æ ‡è¯†æ¥ç”Ÿæˆè‡ªå®šä¹‰ç™»å½•æ€ï¼Œç”¨äºåç»­ä¸šåŠ¡é€»è¾‘ä¸­å‰åç«¯äº¤äº’æ—¶è¯†åˆ«ç”¨æˆ·èº«ä»½ã€‚</p></div><p><strong>å®ç°æ­¥éª¤</strong></p><ol><li><strong>è·å–æˆæƒç </strong><br>æ¯æ¬¡ç™»å½•å°ç¨‹åºæ—¶ï¼Œå°ç¨‹åºä¼šå¼¹å‡ºæç¤ºæ¡†ï¼Œç‚¹å‡»ç¡®å®šæŒ‰é’®ï¼Œå³å¯è·å–æˆæƒç ï¼Œæ¯ä¸ªæˆæƒç åªå¯¹åº”ä¸€æ¬¡ç™»å½•ï¼Œå› æ­¤æ¯æ¬¡æµ‹è¯•éƒ½éœ€è¦é‡æ–°è·å–æˆæƒç <div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204222008130.png"></div></div></li><li><strong>æ˜ç¡®è¯·æ±‚æ¥å£</strong><br>è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204222434054.png"></div></div></li><li><strong>å‘é€è¯·æ±‚</strong><br>è·å–<code>session_key</code>å’Œ<code>openid</code><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204223956568.png"></div></div>å¦‚æœå‡ºç°code been usedé”™è¯¯æç¤ºï¼Œè¯´æ˜æˆæƒç å·²è¢«ä½¿ç”¨è¿‡ï¼Œéœ€è¦é‡æ–°è·å–<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221204224130409.png"></div></div></li></ol><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-15"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-15" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹"><a href="#äº§å“åŸå‹" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>ç”¨æˆ·è¿›å…¥å°ç¨‹åºåï¼Œç‚¹å‡»æˆæƒåæ‰èƒ½ç‚¹é¤ï¼Œéœ€è¦è·å–å½“å‰ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜µç§°ã€å¤´åƒç­‰ã€‚è¯¥æ–¹å¼åŸºäºå¾®ä¿¡ç™»å½•æ¥å®ç°å°ç¨‹åºçš„ç™»å½•ï¼Œè‹¥ç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨å°ç¨‹åºè¿›è¡Œç‚¹é¤ï¼Œåˆ™è¯´æ˜æ˜¯æ–°ç”¨æˆ·ï¼Œéœ€è¦å°†æ–°ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­å®Œæˆè‡ªåŠ¨æ³¨å†Œ<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205173711304.png"></div></div><p></p><h4 id="æ¥å£è®¾è®¡-3"><a href="#æ¥å£è®¾è®¡-3" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>é€šè¿‡å¾®ä¿¡ç™»å½•å°±éœ€è¦è·å¾—å¾®ä¿¡ç”¨æˆ·çš„openidï¼Œåœ¨å°ç¨‹åºç«¯è·å–æˆæƒç åï¼Œå‘åç«¯æœåŠ¡å‘é€è¯·æ±‚å¹¶æºå¸¦æˆæƒç ï¼Œè¿™æ ·åç«¯æœåŠ¡åœ¨æ”¶åˆ°æˆæƒç åå°±å¯ä»¥å»è¯·æ±‚å¾®ä¿¡ä½ æ¥å£æœåŠ¡ï¼Œæœ€ç»ˆåç«¯å‘å°ç¨‹åºè¿”å›openidå’Œtokenç­‰æ•°æ®<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205175429394.png"></div></div><p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205175441256.png"></div></div><div class="note warning no-icon flat"><p><strong>è¯´æ˜ï¼š</strong> è¯·æ±‚è·¯å¾„/user/user/login,ç¬¬ä¸€ä¸ªuserä»£è¡¨ç”¨æˆ·ç«¯ï¼Œç¬¬äºŒä¸ªuserä»£è¡¨ç”¨æˆ·æ¨¡å—ã€‚</p></div><h4 id="è¡¨è®¾è®¡-3"><a href="#è¡¨è®¾è®¡-3" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><p>ç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨å°ç¨‹åºæ—¶ä¼šè‡ªåŠ¨æ³¨å†Œè´¦å·ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°Userè¡¨ã€‚</p><div class="table-container"><table><thead><tr><th><strong>å­—æ®µå</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>openid</td><td>varchar(45)</td><td>å¾®ä¿¡ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†</td><td></td></tr><tr><td>name</td><td>varchar(32)</td><td>ç”¨æˆ·å§“å</td><td></td></tr><tr><td>phone</td><td>varchar(11)</td><td>æ‰‹æœºå·</td><td></td></tr><tr><td>sex</td><td>varchar(2)</td><td>æ€§åˆ«</td><td></td></tr><tr><td>id_number</td><td>varchar(18)</td><td>èº«ä»½è¯å·</td><td></td></tr><tr><td>avatar</td><td>varchar(500)</td><td>å¾®ä¿¡ç”¨æˆ·å¤´åƒè·¯å¾„</td><td></td></tr><tr><td>create_time</td><td>datetime</td><td>æ³¨å†Œæ—¶é—´</td></tr></tbody></table></div><div class="note warning no-icon flat"><p><strong>è¯´æ˜ï¼š</strong> æ‰‹æœºå·å­—æ®µæ¯”è¾ƒç‰¹æ®Šï¼Œä¸ªäººèº«ä»½æ³¨å†Œçš„å°ç¨‹åºæ²¡æœ‰æƒé™è·å–åˆ°å¾®ä¿¡ç”¨æˆ·çš„æ‰‹æœºå·ã€‚å¦‚æœæ˜¯ä»¥ä¼ä¸šçš„èµ„è´¨<br>æ³¨å†Œçš„å°ç¨‹åºå°±èƒ½å¤Ÿæ‹¿åˆ°å¾®ä¿¡ç”¨æˆ·çš„æ‰‹æœºå·ã€‚</p></div><h3 id="ä»£ç å¼€å‘-10"><a href="#ä»£ç å¼€å‘-10" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="æ·»åŠ ç›¸å…³é…ç½®"><a href="#æ·»åŠ ç›¸å…³é…ç½®" class="headerlink" title="æ·»åŠ ç›¸å…³é…ç½®"></a>æ·»åŠ ç›¸å…³é…ç½®</h4><ul><li>æ·»åŠ å¾®ä¿¡ç™»å½•æ‰€éœ€çš„é…ç½®é¡¹<div class="tabs" id="å¾®ä¿¡ç™»å½•-ä»£ç å¼€å‘"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¾®ä¿¡ç™»å½•-ä»£ç å¼€å‘-1">application-dev.yml</button></li><li class="tab"><button type="button" data-href="#å¾®ä¿¡ç™»å½•-ä»£ç å¼€å‘-2">application.yml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¾®ä¿¡ç™»å½•-ä»£ç å¼€å‘-1"><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">wxffb3637a228223b8</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">84311df9199ecacdf4f12d27b6b9522d</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¾®ä¿¡ç™»å½•-ä»£ç å¼€å‘-2"><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">$&#123;sky.wechat.appid&#125;</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">$&#123;sky.wechat.secret&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li></ul><p>åœ¨<code>application.yml</code>ä¸­é…ç½®ä¸ºç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œæ—¶éœ€è¦çš„é…ç½®é¡¹:<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="comment"># è®¾ç½®jwtç­¾ååŠ å¯†æ—¶ä½¿ç”¨çš„ç§˜é’¥</span></span><br><span class="line">    <span class="attr">admin-secret-key:</span> <span class="string">itcast</span></span><br><span class="line">    <span class="comment"># è®¾ç½®jwtè¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="attr">admin-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="comment"># è®¾ç½®å‰ç«¯ä¼ é€’è¿‡æ¥çš„ä»¤ç‰Œåç§°</span></span><br><span class="line">    <span class="attr">admin-token-name:</span> <span class="string">token</span></span><br><span class="line">    <span class="attr">user-secret-key:</span> <span class="string">itheima</span></span><br><span class="line">    <span class="attr">user-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="attr">user-token-name:</span> <span class="string">authentication</span></span><br></pre></td></tr></table></figure><p></p><h4 id="DTOè®¾è®¡"><a href="#DTOè®¾è®¡" class="headerlink" title="DTOè®¾è®¡"></a>DTOè®¾è®¡</h4><p><strong>æ ¹æ®ä¼ å…¥å‚æ•°è®¾è®¡DTOç±»ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205183625049.png"></div></div><br>åœ¨sky-pojoæ¨¡å—ä¸­å·²ç»ç»™å‡ºäº†UserLoginDTOç±»<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cç«¯ç”¨æˆ·ç™»å½•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="VOè®¾è®¡"><a href="#VOè®¾è®¡" class="headerlink" title="VOè®¾è®¡"></a>VOè®¾è®¡</h4><p><strong>æ ¹æ®è¿”å›æ•°æ®è®¾è®¡VOç±»ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205183923272.png"></div></div><br>åœ¨sky-pojoæ¨¡å—ä¸­å·²ç»ç»™å‡ºäº†UserLoginVOç±»<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String openid;</span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-9"><a href="#Controllerå±‚-9" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºUserControllerçš„loginæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯ç”¨æˆ·ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å¾®ä¿¡ç™»å½•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;UserLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginDTO userLoginDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¾®ä¿¡ç”¨æˆ·ç™»å½•ï¼š&#123;&#125;&quot;</span>,userLoginDTO.getCode());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾®ä¿¡ç™»å½•</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.wxLogin(userLoginDTO);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œ</span></span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claims.put(JwtClaimsConstant.USER_ID,user.getId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(jwtProperties.getUserSecretKey(), jwtProperties.getUserTtl(), claims);</span><br><span class="line"></span><br><span class="line">        <span class="type">UserLoginVO</span> <span class="variable">userLoginVO</span> <span class="operator">=</span> UserLoginVO.builder()</span><br><span class="line">                .id(user.getId())</span><br><span class="line">                .openid(user.getOpenid())</span><br><span class="line">                .token(token)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> Result.success(userLoginVO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-6"><a href="#Serviceå±‚-6" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åˆ›å»ºUserServiceæ¥å£ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">wxLogin</span><span class="params">(UserLoginDTO userLoginDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºUserServiceImplå®ç°ç±»ï¼š</strong> å®ç°è·å–å¾®ä¿¡ç”¨æˆ·çš„openidå’Œå¾®ä¿¡ç™»å½•åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¾®ä¿¡æœåŠ¡æ¥å£åœ°å€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WX_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/sns/jscode2session&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WeChatProperties weChatProperties;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">wxLogin</span><span class="params">(UserLoginDTO userLoginDTO)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> getOpenid(userLoginDTO.getCode());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­openidæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºç™»å½•å¤±è´¥ï¼ŒæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(openid == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LoginFailedException</span>(MessageConstant.LOGIN_FAILED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºæ–°ç”¨æˆ·</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getByOpenid(openid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼Œè‡ªåŠ¨å®Œæˆæ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            user = User.builder()</span><br><span class="line">                    .openid(openid)</span><br><span class="line">                    .createTime(LocalDateTime.now())</span><br><span class="line">                    .build();</span><br><span class="line">            userMapper.insert(user);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿”å›è¿™ä¸ªç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨å¾®ä¿¡æ¥å£æœåŠ¡ï¼Œè·å–å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getOpenid</span><span class="params">(String code)</span>&#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨å¾®ä¿¡æ¥å£æœåŠ¡ï¼Œè·å¾—å½“å‰å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;appid&quot;</span>,weChatProperties.getAppid());</span><br><span class="line">        map.put(<span class="string">&quot;secret&quot;</span>,weChatProperties.getSecret());</span><br><span class="line">        map.put(<span class="string">&quot;js_code&quot;</span>,code);</span><br><span class="line">        map.put(<span class="string">&quot;grant_type&quot;</span>,<span class="string">&quot;authorization_code&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> HttpClientUtil.doGet(WX_LOGIN, map);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(json);</span><br><span class="line">        <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> openid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-9"><a href="#Mapperå±‚-9" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åˆ›å»ºUserMapperæ¥å£ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®openidæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user where openid = #&#123;openid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getByOpenid</span><span class="params">(String openid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºUserMapper.xmlæ˜ å°„æ–‡ä»¶ï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into user (openid, name, phone, sex, id_number, avatar, create_time)</span><br><span class="line">        values (#&#123;openid&#125;, #&#123;name&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;idNumber&#125;, #&#123;avatar&#125;, #&#123;createTime&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™æ‹¦æˆªå™¨"><a href="#ç¼–å†™æ‹¦æˆªå™¨" class="headerlink" title="ç¼–å†™æ‹¦æˆªå™¨"></a>ç¼–å†™æ‹¦æˆªå™¨</h4><p><strong>ç¼–å†™æ‹¦æˆªå™¨JwtTokenUserInterceptorï¼š</strong> ç»Ÿä¸€æ‹¦æˆªç”¨æˆ·ç«¯å‘é€çš„è¯·æ±‚å¹¶è¿›è¡Œjwtæ ¡éªŒ</p><div class="note danger no-icon flat"><p>æ³¨æ„æ­¤å¤„<code>handler instanceof HandlerMethod</code>ä¸­çš„HandlerMethodå¯¼å…¥çš„æ˜¯<code>org.springframework.web.method</code>åŒ…ä¸‹çš„ï¼Œä¹‹å‰å¼•å…¥çš„<code>org.springframework.Message.handler</code>åŒ…ä¸‹çš„HandlerMethodç±»ï¼Œå¯¼è‡´æ­¤å¤„åˆ¤æ–­æ¡ä»¶ä¸æˆç«‹ï¼Œä»è€Œå¯¼è‡´æ‹¦æˆªå™¨æ— æ³•ç”Ÿæ•ˆã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116123356.png"></div></div></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jwtä»¤ç‰Œæ ¡éªŒçš„æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenUserInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒjwt</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰æ‹¦æˆªåˆ°çš„æ˜¯Controllerçš„æ–¹æ³•è¿˜æ˜¯å…¶ä»–èµ„æº</span></span><br><span class="line">        <span class="keyword">if</span> (!(handler <span class="keyword">instanceof</span> HandlerMethod)) &#123;</span><br><span class="line">            <span class="comment">//å½“å‰æ‹¦æˆªåˆ°çš„ä¸æ˜¯åŠ¨æ€æ–¹æ³•ï¼Œç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€ä»è¯·æ±‚å¤´ä¸­è·å–ä»¤ç‰Œ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(jwtProperties.getUserTokenName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€æ ¡éªŒä»¤ç‰Œ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;jwtæ ¡éªŒ:&#123;&#125;&quot;</span>, token);</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(jwtProperties.getUserSecretKey(), token);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.USER_ID).toString());</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰ç”¨æˆ·çš„idï¼š&quot;</span>, userId);</span><br><span class="line">            BaseContext.setCurrentId(userId);</span><br><span class="line">            <span class="comment">//3ã€é€šè¿‡ï¼Œæ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">//4ã€ä¸é€šè¿‡ï¼Œå“åº”401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨WebMvcConfigurationé…ç½®ç±»ä¸­æ³¨å†Œæ‹¦æˆªå™¨ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> JwtTokenUserInterceptor jwtTokenUserInterceptor;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;å¼€å§‹æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨...&quot;</span>);</span><br><span class="line">       <span class="comment">//.........</span></span><br><span class="line"></span><br><span class="line">       registry.addInterceptor(jwtTokenUserInterceptor)</span><br><span class="line">               .addPathPatterns(<span class="string">&quot;/user/**&quot;</span>)</span><br><span class="line">               .excludePathPatterns(<span class="string">&quot;/user/user/login&quot;</span>)</span><br><span class="line">               .excludePathPatterns(<span class="string">&quot;/user/shop/status&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-13"><a href="#åŠŸèƒ½æµ‹è¯•-13" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>é‡æ–°ç¼–è¯‘å¹¶ç™»å½•ï¼Œèƒ½æˆåŠŸè·å–åˆ°openidå’Œtokenå³å¯<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205192506490.png"></div></div><br>æ­¤æ—¶æŸ¥çœ‹æ•°æ®åº“çš„userè¡¨ï¼Œå°±èƒ½çœ‹åˆ°æˆåŠŸå°†ç¬¬ä¸€æ¬¡ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯æ³¨å†Œåˆ°è¡¨é‡Œäº†<p></p><h2 id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç "><a href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç " class="headerlink" title="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç "></a>å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç </h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-16"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-16" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç”¨æˆ·ç™»å½•æˆåŠŸåè·³è½¬åˆ°ç³»ç»Ÿé¦–é¡µï¼Œåœ¨é¦–é¡µéœ€è¦æ ¹æ®åˆ†ç±»æ¥å±•ç¤ºèœå“å’Œå¥—é¤ã€‚å¦‚æœèœå“è®¾ç½®äº†å£å‘³ä¿¡æ¯ï¼Œéœ€è¦å±•ç¤º<code>é€‰æ‹©è§„æ ¼</code>æŒ‰é’®ï¼Œå¦åˆ™æ˜¾ç¤º<code>+</code>æŒ‰é’®ã€‚<br></p><div class="tabs" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-1">èœå“åˆ—è¡¨æ•ˆæœå›¾</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-2">èœå“å£å‘³æ•ˆæœå›¾</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-3">å¥—é¤åˆ—è¡¨æ•ˆæœå›¾</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-4">å¥—é¤è¯¦æƒ…æ•ˆæœå›¾</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205193821129.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205193846867.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205193859016.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç åŸå‹å›¾-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205193911476.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p></p><p><strong>æ¥å£è®¾è®¡</strong></p><ul><li>æŸ¥è¯¢åˆ†ç±»</li><li>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</li><li>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤</li><li>æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“</li></ul><p>æ˜ç¡®æ¯ä¸ªæ¥å£çš„è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼ã€‚</p><div class="tabs" id="å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-1">æŸ¥è¯¢åˆ†ç±»</button></li><li class="tab"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-2">æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</button></li><li class="tab"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-3">æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤</button></li><li class="tab"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-4">æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200235328.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200246588.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200319686.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200425607.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200415135.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200425607.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å“æµè§ˆåŠŸèƒ½æ¥å£è®¾è®¡-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205200537591.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="ä»£ç å¯¼å…¥-1"><a href="#ä»£ç å¯¼å…¥-1" class="headerlink" title="ä»£ç å¯¼å…¥"></a>ä»£ç å¯¼å…¥</h3><p>å¯¼å…¥èµ„æ–™ä¸­çš„å•†å“æµè§ˆåŠŸèƒ½ä»£ç å³å¯<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221205201043358.png"></div></div><p></p><h4 id="Mapperå±‚-10"><a href="#Mapperå±‚-10" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p>åœ¨SetmealMapper.javaä¸­æ·»åŠ <code>list</code>å’Œ<code>getDishItemBySetmealId</code>ä¸¤ä¸ªæ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢å¥—é¤</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Setmeal&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å¥—é¤idæŸ¥è¯¢èœå“é€‰é¡¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select sd.name, sd.copies, d.image, d.description &quot; +</span></span><br><span class="line"><span class="meta">        &quot;from setmeal_dish sd left join dish d on sd.dish_id = d.id &quot; +</span></span><br><span class="line"><span class="meta">        &quot;where sd.setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line">List&lt;DishItemVO&gt; <span class="title function_">getDishItemBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><br><strong>åˆ›å»ºSetmealMapper.xmlæ–‡ä»¶</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.SetmealMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Setmeal&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Setmeal&quot;</span>&gt;</span></span><br><span class="line">        select * from setmeal</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">                and category_id = #&#123;categoryId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                and status = #&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h4 id="Serviceå±‚-7"><a href="#Serviceå±‚-7" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><div class="tabs" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-1">SetmealService</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-2">SetmealServiceImpl</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-3">DishService</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-4">DishServiceImpl</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Setmeal&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢èœå“é€‰é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;DishItemVO&gt; <span class="title function_">getDishItemById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤ä¸šåŠ¡å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Setmeal&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span> &#123;</span><br><span class="line">        List&lt;Setmeal&gt; list = setmealMapper.list(setmeal);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢èœå“é€‰é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DishItemVO&gt; <span class="title function_">getDishItemById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> setmealMapper.getDishItemBySetmealId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¡ä»¶æŸ¥è¯¢èœå“å’Œå£å‘³</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   List&lt;DishVO&gt; <span class="title function_">listWithFlavor</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½serviceå±‚-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¡ä»¶æŸ¥è¯¢èœå“å’Œå£å‘³</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;DishVO&gt; <span class="title function_">listWithFlavor</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line">       List&lt;Dish&gt; dishList = dishMapper.list(dish);</span><br><span class="line"></span><br><span class="line">       List&lt;DishVO&gt; dishVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (Dish d : dishList) &#123;</span><br><span class="line">           <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishVO</span>();</span><br><span class="line">           BeanUtils.copyProperties(d,dishVO);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//æ ¹æ®èœå“idæŸ¥è¯¢å¯¹åº”çš„å£å‘³</span></span><br><span class="line">           List&lt;DishFlavor&gt; flavors = dishFlavorMapper.getByDishId(d.getId());</span><br><span class="line"></span><br><span class="line">           dishVO.setFlavors(flavors);</span><br><span class="line">           dishVOList.add(dishVO);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> dishVOList;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="Controllerå±‚-10"><a href="#Controllerå±‚-10" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><div class="tabs" id="å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚-1">DishController</button></li><li class="tab"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚-2">CategoryController</button></li><li class="tab"><button type="button" data-href="#å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚-3">SetmealController</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userDishController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯-èœå“æµè§ˆæ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        dish.setCategoryId(categoryId);</span><br><span class="line">        dish.setStatus(StatusConstant.ENABLE);<span class="comment">//æŸ¥è¯¢èµ·å”®ä¸­çš„èœå“</span></span><br><span class="line"></span><br><span class="line">        List&lt;DishVO&gt; list = dishService.listWithFlavor(dish);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userCategoryController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/category&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯-åˆ†ç±»æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Integer type)</span> &#123;</span><br><span class="line">        List&lt;Category&gt; list = categoryService.list(type);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å•†å“æµè§ˆåŠŸèƒ½-controllerå±‚-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userSetmealController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/setmeal&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯-å¥—é¤æµè§ˆæ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">        setmeal.setCategoryId(categoryId);</span><br><span class="line">        setmeal.setStatus(StatusConstant.ENABLE);</span><br><span class="line"></span><br><span class="line">        List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dish/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“åˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;DishItemVO&gt;&gt; <span class="title function_">dishList</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        List&lt;DishItemVO&gt; list = setmealService.getDishItemById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1 id="day07"><a href="#day07" class="headerlink" title="day07"></a>day07</h1><h2 id="è¯¾ç¨‹å†…å®¹-3"><a href="#è¯¾ç¨‹å†…å®¹-3" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>ç¼“å­˜èœå“</li><li>ç¼“å­˜å¥—é¤</li><li>æ·»åŠ è´­ç‰©è½¦</li><li>æŸ¥çœ‹è´­ç‰©è½¦</li><li>æ¸…ç©ºè´­ç‰©è½¦</li></ul><p>åŠŸèƒ½å®ç°ï¼š<strong>ç¼“å­˜å•†å“</strong>ã€<strong>è´­ç‰©è½¦</strong><br>æ•ˆæœå›¾ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251115145936.png"></div></div><p></p><h2 id="ç¼“å­˜èœå“"><a href="#ç¼“å­˜èœå“" class="headerlink" title="ç¼“å­˜èœå“"></a>ç¼“å­˜èœå“</h2><h3 id="é—®é¢˜è¯´æ˜"><a href="#é—®é¢˜è¯´æ˜" class="headerlink" title="é—®é¢˜è¯´æ˜"></a>é—®é¢˜è¯´æ˜</h3><p>ç”¨æˆ·ç«¯å°ç¨‹åºå±•ç¤ºçš„èœå“æ•°æ®éƒ½æ˜¯é€šè¿‡æŸ¥è¯¢æ•°æ®åº“è·å¾—ï¼Œå¦‚æœç”¨æˆ·ç«¯è®¿é—®é‡æ¯”è¾ƒå¤§ï¼Œæ•°æ®åº“è®¿é—®å‹åŠ›éšä¹‹å¢å¤§ã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208180228667.png"></div></div><p></p><div class="note info no-icon flat"><p><strong>ç»“æœï¼š</strong> ç³»ç»Ÿå“åº”æ…¢ã€ç”¨æˆ·ä½“éªŒå·®</p></div><h3 id="ä¼˜åŒ–æ€è·¯"><a href="#ä¼˜åŒ–æ€è·¯" class="headerlink" title="ä¼˜åŒ–æ€è·¯"></a>ä¼˜åŒ–æ€è·¯</h3><p>é€šè¿‡Redisæ¥ç¼“å­˜èœå“æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208180818572.png"></div></div><br><div class="note danger no-icon flat"><p><strong>ç¼“å­˜é€»è¾‘ï¼š</strong></p><ul><li>æ¯ä¸ªåˆ†ç±»ä¸‹çš„èœå“ä¿å­˜ä¸€ä»½ç¼“å­˜æ•°æ®</li><li>æ•°æ®åº“ä¸­èœå“æ•°æ®æœ‰å˜æ›´æ—¶æ¸…ç†ç¼“å­˜æ•°æ®</li></ul></div><p></p><h3 id="ä»£ç å¼€å‘-11"><a href="#ä»£ç å¼€å‘-11" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><p>ä¿®æ”¹ç”¨æˆ·ç«¯çš„DishCOntrollerçš„listæ–¹æ³•ï¼Œåœ¨å±•ç¤ºæ—¶åŠ å…¥ç¼“å­˜å¤„ç†é€»è¾‘ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ„é€ redisä¸­çš„keyï¼Œè§„åˆ™ï¼šdish_åˆ†ç±»id</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + categoryId;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æŸ¥è¯¢redisä¸­æ˜¯å¦å­˜åœ¨èœå“æ•°æ®</span></span><br><span class="line">       List&lt;DishVO&gt; list = (List&lt;DishVO&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">       <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">           <span class="comment">//å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œæ— é¡»æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">           <span class="keyword">return</span> Result.success(list);</span><br><span class="line">       &#125;</span><br><span class="line">	<span class="comment">////////////////////////////////////////////////////////</span></span><br><span class="line">       <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">       dish.setCategoryId(categoryId);</span><br><span class="line">       dish.setStatus(StatusConstant.ENABLE);<span class="comment">//æŸ¥è¯¢èµ·å”®ä¸­çš„èœå“</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//å¦‚æœä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ”¾å…¥redisä¸­</span></span><br><span class="line">       list = dishService.listWithFlavor(dish);</span><br><span class="line">       <span class="comment">////////////////////////////////////////////////////////</span></span><br><span class="line">       redisTemplate.opsForValue().set(key, list);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> Result.success(list);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><br>ä¸ºäº†ä¿è¯ <strong>æ•°æ®åº“</strong> å’Œ <strong>Redis</strong> ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œä¿®æ”¹<strong>ç®¡ç†ç«¯æ¥å£DishController</strong> çš„ç›¸å…³æ–¹æ³•ï¼ŒåŠ å…¥æ¸…ç†ç¼“å­˜é€»è¾‘,åœ¨æ›´æ–°æˆ–åˆ é™¤èœå“æ—¶åŒæ—¶æ¸…é™¤ç¼“å­˜ã€‚<p></p><p>éœ€è¦æ”¹é€ çš„æ–¹æ³•ï¼š</p><ul><li>æ–°å¢èœå“</li><li>ä¿®æ”¹èœå“</li><li>æ‰¹é‡åˆ é™¤èœå“</li><li>èµ·å”®ã€åœå”®èœå“<br>åœ¨ç®¡ç†ç«¯DishControllerä¸­æ·»åŠ <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¸…ç†ç¼“å­˜æ•°æ®</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pattern</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cleanCache</span><span class="params">(String pattern)</span>&#123;</span><br><span class="line">       <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> redisTemplate.keys(pattern);</span><br><span class="line">       redisTemplate.delete(keys);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ul><p>ä¼˜åŒ–DishControllerä¸­çš„ç›¸å…³æ–¹æ³•ï¼š</p><div class="tabs" id="ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-1">æ–°å¢èœå“</button></li><li class="tab"><button type="button" data-href="#ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-2">èœå“æ‰¹é‡åˆ é™¤</button></li><li class="tab"><button type="button" data-href="#ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-3">ä¿®æ”¹èœå“</button></li><li class="tab"><button type="button" data-href="#ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-4">èœå“èµ·å”®åœå”®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ–°å¢èœå“</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æ–°å¢èœå“&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;æ–°å¢èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);</span><br><span class="line">       dishService.saveWithFlavor(dishDTO);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ¸…ç†ç¼“å­˜æ•°æ®</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDTO.getCategoryId();</span><br><span class="line">       cleanCache(key);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“æ‰¹é‡åˆ é™¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@DeleteMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;èœå“æ‰¹é‡åˆ é™¤&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;èœå“æ‰¹é‡åˆ é™¤ï¼š&#123;&#125;&quot;</span>, ids);</span><br><span class="line">       dishService.deleteBatch(ids);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//å°†æ‰€æœ‰çš„èœå“ç¼“å­˜æ•°æ®æ¸…ç†æ‰ï¼Œæ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span></span><br><span class="line">       cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¿®æ”¹èœå“</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;ä¿®æ”¹èœå“&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;ä¿®æ”¹èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);</span><br><span class="line">       dishService.updateWithFlavor(dishDTO);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//å°†æ‰€æœ‰çš„èœå“ç¼“å­˜æ•°æ®æ¸…ç†æ‰ï¼Œæ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span></span><br><span class="line">       cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç¼“å­˜èœå“ä»£ç å¼€å‘-dishcontroller-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * èœå“èµ·å”®åœå”®</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;èœå“èµ·å”®åœå”®&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line">       dishService.startOrStop(status, id);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//å°†æ‰€æœ‰çš„èœå“ç¼“å­˜æ•°æ®æ¸…ç†æ‰ï¼Œæ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span></span><br><span class="line">       cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="ç¼“å­˜å¥—é¤"><a href="#ç¼“å­˜å¥—é¤" class="headerlink" title="ç¼“å­˜å¥—é¤"></a>ç¼“å­˜å¥—é¤</h2><h3 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h3><h4 id="ä»‹ç»-3"><a href="#ä»‹ç»-3" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p><code>Spring Cache</code>æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ç°äº†åŸºäºæ³¨è§£çš„ç¼“å­˜åŠŸèƒ½ï¼Œåªéœ€è¦ç®€å•åœ°åŠ ä¸€ä¸ªæ³¨è§£ï¼Œå°±èƒ½å®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p><p>Spring Cacheæä¾›äº†ä¸€å±‚æŠ½è±¡ï¼Œåº•å±‚å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç¼“å­˜å®ç°ï¼Œä¾‹å¦‚ï¼š</p><ul><li>EHCache</li><li>Caffeine</li><li>Redis(å¸¸ç”¨)</li></ul><p><strong>èµ·æ­¥ä¾èµ–ï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  		            		     </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨æ³¨è§£-1"><a href="#å¸¸ç”¨æ³¨è§£-1" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><p>åœ¨SpringCacheä¸­æä¾›äº†å¾ˆå¤šç¼“å­˜æ“ä½œçš„æ³¨è§£ï¼Œå¸¸è§çš„æ˜¯ä»¥ä¸‹çš„å‡ ä¸ªï¼š</p><div class="table-container"><table><thead><tr><th><strong>æ³¨è§£</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><code>@EnableCaching</code></td><td>å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½ï¼Œé€šå¸¸åŠ åœ¨å¯åŠ¨ç±»ä¸Š</td></tr><tr><td><code>@Cacheable</code></td><td>åœ¨æ–¹æ³•æ‰§è¡Œå‰å…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›å¦‚æœæ²¡æœ‰ç¼“å­˜æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td></tr><tr><td><code>@CachePut</code></td><td>å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td></tr><tr><td><code>@CacheEvict</code></td><td>å°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤</td></tr></tbody></table></div><p>åœ¨spring booté¡¹ç›®ä¸­ï¼Œä½¿ç”¨ç¼“å­˜æŠ€æœ¯åªéœ€åœ¨é¡¹ç›®ä¸­å¯¼å…¥ç›¸å…³ç¼“å­˜æŠ€æœ¯çš„ä¾èµ–åŒ…ï¼Œå¹¶åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨<code>@EnableCaching</code>å¼€å¯ç¼“å­˜æ”¯æŒå³å¯ã€‚</p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨Redisä½œä¸ºç¼“å­˜æŠ€æœ¯ï¼Œåªéœ€è¦å¯¼å…¥Spring data Redisçš„mavenåæ ‡å³å¯ã€‚</p><h4 id="å…¥é—¨æ¡ˆä¾‹-1"><a href="#å…¥é—¨æ¡ˆä¾‹-1" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h4><ol><li><strong>ç¯å¢ƒå‡†å¤‡</strong></li></ol><p><strong>å¯¼å…¥åŸºç¡€å·¥ç¨‹:</strong>åº•å±‚å·²ä½¿ç”¨Redisç¼“å­˜å®ç°</p><p>èµ„æ–™ä¸­æä¾›äº†å…¥é—¨æ¡ˆä¾‹çš„åŸºæœ¬ç¯å¢ƒä»£ç ï¼Œç›´æ¥å¯¼å…¥è¿›æ¥å³å¯ã€‚å¯¼å…¥è¿›æ¥çš„å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221210183942040.png"></div></div><p></p><p><strong>æ•°æ®åº“å‡†å¤‡:</strong></p><p>åˆ›å»ºåä¸ºspring_cache_demoæ•°æ®åº“ï¼Œå°†<code>springcachedemo.sql</code>è„šæœ¬ç›´æ¥å¯¼å…¥æ•°æ®åº“ä¸­ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221210184346304.png"></div></div><p><strong>å¼•å¯¼ç±»ä¸ŠåŠ @EnableCaching:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span><span class="comment">//å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheDemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(CacheDemoApplication.class,args);</span><br><span class="line">        log.info(<span class="string">&quot;é¡¹ç›®å¯åŠ¨æˆåŠŸ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>@CachePutæ³¨è§£</strong></li></ol><p><strong>@CachePut è¯´æ˜ï¼š</strong></p><ul><li>ä½œç”¨: å°†æ–¹æ³•è¿”å›å€¼ï¼Œæ”¾å…¥ç¼“å­˜</li><li>value: ç¼“å­˜çš„åç§°, æ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¾ˆå¤škey</li><li>key: ç¼“å­˜çš„key -&gt; æ”¯æŒSpringçš„è¡¨è¾¾å¼è¯­è¨€SPELè¯­æ³•</li></ul><p><strong>åœ¨saveæ–¹æ³•ä¸Šæ·»åŠ @CachePutæ³¨è§£</strong></p><p>å½“å‰UserControllerçš„saveæ–¹æ³•æ˜¯ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¯¥ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œä¹Ÿå¾€ç¼“å­˜ä¸­ç¼“å­˜ä¸€ä»½æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨saveæ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£ <code>@CachePut</code>ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* CachePutï¼šå°†æ–¹æ³•è¿”å›å€¼æ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</span></span><br><span class="line"><span class="comment">* keyï¼šç¼“å­˜çš„key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">   <span class="meta">@CachePut(value = &quot;userCache&quot;, key = &quot;#user.id&quot;)</span><span class="comment">//keyçš„ç”Ÿæˆï¼šuserCache::1</span></span><br><span class="line">   <span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">       userMapper.insert(user);</span><br><span class="line">       <span class="keyword">return</span> user;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong> keyçš„å†™æ³•å¦‚ä¸‹</p><h1 id="user-id-useræŒ‡çš„æ˜¯æ–¹æ³•å½¢å‚çš„åç§°-idæŒ‡çš„æ˜¯userçš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨userçš„idå±æ€§ä½œä¸ºkey"><a href="#user-id-useræŒ‡çš„æ˜¯æ–¹æ³•å½¢å‚çš„åç§°-idæŒ‡çš„æ˜¯userçš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨userçš„idå±æ€§ä½œä¸ºkey" class="headerlink" title="user.id : #useræŒ‡çš„æ˜¯æ–¹æ³•å½¢å‚çš„åç§°, idæŒ‡çš„æ˜¯userçš„idå±æ€§ , ä¹Ÿå°±æ˜¯ä½¿ç”¨userçš„idå±æ€§ä½œä¸ºkey ;"></a>user.id : #useræŒ‡çš„æ˜¯æ–¹æ³•å½¢å‚çš„åç§°, idæŒ‡çš„æ˜¯userçš„idå±æ€§ , ä¹Ÿå°±æ˜¯ä½¿ç”¨userçš„idå±æ€§ä½œä¸ºkey ;</h1><h1 id="result-id-resultä»£è¡¨æ–¹æ³•è¿”å›å€¼ï¼Œè¯¥è¡¨è¾¾å¼-ä»£è¡¨ä»¥è¿”å›å¯¹è±¡çš„idå±æ€§ä½œä¸ºkey-ï¼›"><a href="#result-id-resultä»£è¡¨æ–¹æ³•è¿”å›å€¼ï¼Œè¯¥è¡¨è¾¾å¼-ä»£è¡¨ä»¥è¿”å›å¯¹è±¡çš„idå±æ€§ä½œä¸ºkey-ï¼›" class="headerlink" title="result.id : #resultä»£è¡¨æ–¹æ³•è¿”å›å€¼ï¼Œè¯¥è¡¨è¾¾å¼ ä»£è¡¨ä»¥è¿”å›å¯¹è±¡çš„idå±æ€§ä½œä¸ºkey ï¼›"></a>result.id : #resultä»£è¡¨æ–¹æ³•è¿”å›å€¼ï¼Œè¯¥è¡¨è¾¾å¼ ä»£è¡¨ä»¥è¿”å›å¯¹è±¡çš„idå±æ€§ä½œä¸ºkey ï¼›</h1><h1 id="p0-idï¼š-p0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey"><a href="#p0-idï¼š-p0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey" class="headerlink" title="p0.idï¼š#p0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey ;"></a>p0.idï¼š#p0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey ;</h1><h1 id="a0-idï¼š-a0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey"><a href="#a0-idï¼š-a0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey" class="headerlink" title="a0.idï¼š#a0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey ;"></a>a0.idï¼š#a0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey ;</h1><h1 id="root-args-0-id-root-args-0-æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°"><a href="#root-args-0-id-root-args-0-æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§-ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°" class="headerlink" title="root.args[0].id:#root.args[0]æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°"></a>root.args[0].id:#root.args[0]æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°</h1><p>çš„idå±æ€§ä½œä¸ºkey ;</p><p><strong>å¯åŠ¨æœåŠ¡,é€šè¿‡swaggeræ¥å£æ–‡æ¡£æµ‹è¯•ï¼Œè®¿é—®UserControllerçš„save()æ–¹æ³•</strong></p><p>å› ä¸ºidæ˜¯è‡ªå¢ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®idå±æ€§</p><p><img src="assets/image-20221210191702887.png" alt="image-20221210191702887" style="zoom:50%"></p><p><strong>æŸ¥çœ‹userè¡¨ä¸­çš„æ•°æ®</strong></p><p><img src="assets/image-20221210192325931.png" alt="image-20221210192325931" style="zoom:67%"></p><p><strong>æŸ¥çœ‹Redisä¸­çš„æ•°æ®</strong></p><p><img src="assets/image-20221210192418204.png" alt="image-20221210192418204" style="zoom:50%"></p><p><strong>3. @Cacheableæ³¨è§£</strong></p><p><strong>@Cacheable è¯´æ˜:</strong></p><p>â€‹ ä½œç”¨: åœ¨æ–¹æ³•æ‰§è¡Œå‰ï¼Œspringå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</p><p>â€‹ value: ç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</p><p>â€‹ key: ç¼“å­˜çš„key â€”â€”â€”â€”â€”&gt; æ”¯æŒSpringçš„è¡¨è¾¾å¼è¯­è¨€SPELè¯­æ³•</p><p><strong>åœ¨getByIdä¸ŠåŠ æ³¨è§£@Cacheable</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Cacheableï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œ	  *è°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line"><span class="comment">* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</span></span><br><span class="line"><span class="comment">* keyï¼šç¼“å­˜çš„key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line">   <span class="meta">@Cacheable(cacheNames = &quot;userCache&quot;,key=&quot;#id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(id);</span><br><span class="line">       <span class="keyword">return</span> user;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>é‡å¯æœåŠ¡,é€šè¿‡swaggeræ¥å£æ–‡æ¡£æµ‹è¯•ï¼Œè®¿é—®UserControllerçš„getById()æ–¹æ³•</strong></p><p>ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œä¼šè¯·æ±‚æˆ‘ä»¬controllerçš„æ–¹æ³•ï¼ŒæŸ¥è¯¢æ•°æ®åº“ã€‚åé¢å†æŸ¥è¯¢ç›¸åŒçš„idï¼Œå°±ç›´æ¥ä»Redisä¸­æŸ¥è¯¢æ•°æ®ï¼Œä¸ç”¨å†æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œå°±è¯´æ˜ç¼“å­˜ç”Ÿæ•ˆäº†ã€‚</p><p>æå‰åœ¨redisä¸­æ‰‹åŠ¨åˆ é™¤æ‰id=1çš„ç”¨æˆ·æ•°æ®</p><p><img src="assets/image-20221210193834150.png" alt="image-20221210193834150" style="zoom:50%"></p><p><strong>æŸ¥çœ‹æ§åˆ¶å°sqlè¯­å¥ï¼š</strong>è¯´æ˜ä»æ•°æ®åº“æŸ¥è¯¢çš„ç”¨æˆ·æ•°æ®</p><p><img src="assets/image-20221210193948896.png" alt="image-20221210193948896" style="zoom:67%"></p><p><strong>æŸ¥çœ‹Redisä¸­çš„ç¼“å­˜æ•°æ®ï¼š</strong>è¯´æ˜å·²æˆåŠŸç¼“å­˜</p><p><img src="assets/image-20221210194112334.png" alt="image-20221210194112334" style="zoom:50%"></p><p>å†æ¬¡æŸ¥è¯¢ç›¸åŒidçš„æ•°æ®æ—¶ï¼Œç›´æ¥ä»redisä¸­ç›´æ¥è·å–ï¼Œä¸å†æŸ¥è¯¢æ•°æ®åº“ã€‚</p><p><strong>4). @CacheEvictæ³¨è§£</strong></p><p><strong>@CacheEvict è¯´æ˜ï¼š</strong></p><p>â€‹ ä½œç”¨: æ¸…ç†æŒ‡å®šç¼“å­˜</p><p>â€‹ value: ç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</p><p>â€‹ key: ç¼“å­˜çš„key â€”â€”â€”â€”â€”&gt; æ”¯æŒSpringçš„è¡¨è¾¾å¼è¯­è¨€SPELè¯­æ³•</p><p><strong>åœ¨ delete æ–¹æ³•ä¸ŠåŠ æ³¨è§£@CacheEvict</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line">   <span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;,key = &quot;#id&quot;)</span><span class="comment">//åˆ é™¤æŸä¸ªkeyå¯¹åº”çš„ç¼“å­˜æ•°æ®</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">       userMapper.deleteById(id);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/delAll&quot;)</span></span><br><span class="line">   <span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;,allEntries = true)</span><span class="comment">//åˆ é™¤userCacheä¸‹æ‰€æœ‰çš„ç¼“å­˜æ•°æ®</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">()</span>&#123;</span><br><span class="line">       userMapper.deleteAll();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>é‡å¯æœåŠ¡,é€šè¿‡swaggeræ¥å£æ–‡æ¡£æµ‹è¯•ï¼Œè®¿é—®UserControllerçš„deleteAll()æ–¹æ³•</strong></p><p><img src="assets/image-20221210195254874.png" alt="image-20221210195254874" style="zoom:50%"></p><p><strong>æŸ¥çœ‹userè¡¨ï¼š</strong>æ•°æ®æ¸…ç©º</p><p><img src="assets/image-20221210195332101.png" alt="image-20221210195332101" style="zoom:80%"></p><p><strong>æŸ¥è¯¢Redisç¼“å­˜æ•°æ®</strong></p><p><img src="assets/image-20221210195500014.png" alt="image-20221210195500014" style="zoom:50%"></p><h3 id="å®ç°æ€è·¯-1"><a href="#å®ç°æ€è·¯-1" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><p>1). å¯¼å…¥Spring Cacheå’ŒRedisç›¸å…³mavenåæ ‡</p><p>2). åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</p><p>3). åœ¨ç”¨æˆ·ç«¯æ¥å£SetmealControllerçš„ list æ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£</p><p>4). åœ¨ç®¡ç†ç«¯æ¥å£SetmealControllerçš„ saveã€deleteã€updateã€startOrStopç­‰æ–¹æ³•ä¸ŠåŠ å…¥CacheEvictæ³¨è§£</p><h3 id="ä»£ç å¼€å‘-12"><a href="#ä»£ç å¼€å‘-12" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><p>æŒ‰ç…§ä¸Šè¿°å®ç°æ­¥éª¤ï¼š</p><p><strong>1). å¯¼å…¥Spring Cacheå’ŒRedisç›¸å…³mavenåæ ‡(å·²å®ç°)</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2). åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//å¼€å¯æ³¨è§£æ–¹å¼çš„äº‹åŠ¡ç®¡ç†</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SkyApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;server started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). åœ¨ç”¨æˆ·ç«¯æ¥å£SetmealControllerçš„ list æ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤&quot;)</span></span><br><span class="line">   <span class="meta">@Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;)</span> <span class="comment">//key: setmealCache::100</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">       <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">       setmeal.setCategoryId(categoryId);</span><br><span class="line">       setmeal.setStatus(StatusConstant.ENABLE);</span><br><span class="line"></span><br><span class="line">       List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br><span class="line">       <span class="keyword">return</span> Result.success(list);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>4). åœ¨ç®¡ç†ç«¯æ¥å£SetmealControllerçš„ saveã€deleteã€updateã€startOrStopç­‰æ–¹æ³•ä¸ŠåŠ å…¥CacheEvictæ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ–°å¢å¥—é¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æ–°å¢å¥—é¤&quot;)</span></span><br><span class="line">   <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,key = &quot;#setmealDTO.categoryId&quot;)</span><span class="comment">//key: setmealCache::100</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">       setmealService.saveWithDish(setmealDTO);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ‰¹é‡åˆ é™¤å¥—é¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@DeleteMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤å¥—é¤&quot;)</span></span><br><span class="line">   <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">       setmealService.deleteBatch(ids);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¿®æ”¹å¥—é¤</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;ä¿®æ”¹å¥—é¤&quot;)</span></span><br><span class="line">   <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">       setmealService.update(setmealDTO);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¥—é¤èµ·å”®åœå”®</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;å¥—é¤èµ·å”®åœå”®&quot;)</span></span><br><span class="line">   <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line">       setmealService.startOrStop(status, id);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-åŠŸèƒ½æµ‹è¯•"><a href="#2-4-åŠŸèƒ½æµ‹è¯•" class="headerlink" title="2.4 åŠŸèƒ½æµ‹è¯•"></a>2.4 åŠŸèƒ½æµ‹è¯•</h3><p>é€šè¿‡å‰åç«¯è”è°ƒæ–¹å¼æ¥è¿›è¡Œæµ‹è¯•ï¼ŒåŒæ—¶è§‚å¯Ÿredisä¸­ç¼“å­˜çš„å¥—é¤æ•°æ®ã€‚å’Œ<strong>ç¼“å­˜èœå“</strong>åŠŸèƒ½æµ‹è¯•åŸºæœ¬ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚</p><h3 id="2-5-ä»£ç æäº¤"><a href="#2-5-ä»£ç æäº¤" class="headerlink" title="2.5 ä»£ç æäº¤"></a>2.5 ä»£ç æäº¤</h3><p><img src="assets/image-20221210203035708.png" alt="image-20221210203035708" style="zoom:50%"></p><p>åç»­æ­¥éª¤å’Œå…¶å®ƒåŠŸèƒ½ä»£ç æäº¤ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚</p><h2 id="æ·»åŠ è´­ç‰©è½¦"><a href="#æ·»åŠ è´­ç‰©è½¦" class="headerlink" title="æ·»åŠ è´­ç‰©è½¦"></a>æ·»åŠ è´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-17"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-17" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-1"><a href="#äº§å“åŸå‹-1" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>ç”¨æˆ·å¯ä»¥å°†èœå“æˆ–è€…å¥—é¤æ·»åŠ åˆ°è´­ç‰©è½¦ã€‚å¯¹äºèœå“æ¥è¯´ï¼Œå¦‚æœè®¾ç½®äº†å£å‘³ä¿¡æ¯ï¼Œåˆ™éœ€è¦é€‰æ‹©è§„æ ¼åæ‰èƒ½åŠ å…¥è´­ç‰©è½¦;å¯¹äºå¥—é¤æ¥è¯´ï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡»<code>+</code>å°†å½“å‰å¥—é¤åŠ å…¥è´­ç‰©è½¦ã€‚åœ¨è´­ç‰©è½¦ä¸­å¯ä»¥ä¿®æ”¹èœå“å’Œå¥—é¤çš„æ•°é‡ï¼Œä¹Ÿå¯ä»¥æ¸…ç©ºè´­ç‰©è½¦ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221210203822817.png"></div></div><h4 id="æ¥å£è®¾è®¡-4"><a href="#æ¥å£è®¾è®¡-4" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>è®¾è®¡å‡ºå¯¹åº”çš„æ·»åŠ è´­ç‰©è½¦æ¥å£ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208184342490.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208184354291.png"></div></div><div class="note info no-icon flat"><p><strong>è¯´æ˜ï¼š</strong> æ·»åŠ è´­ç‰©è½¦æ—¶ï¼Œæœ‰å¯èƒ½æ·»åŠ èœå“ï¼Œä¹Ÿæœ‰å¯èƒ½æ·»åŠ å¥—é¤ã€‚æ•…ä¼ å…¥å‚æ•°è¦ä¹ˆæ˜¯èœå“idï¼Œè¦ä¹ˆæ˜¯å¥—é¤idã€‚</p></div><h4 id="è¡¨è®¾è®¡-4"><a href="#è¡¨è®¾è®¡-4" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><p>è´­ç‰©è½¦å¯¹åº”çš„æ•°æ®è¡¨ä¸ºshopping_cartè¡¨ï¼Œå…·ä½“è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th><strong>å­—æ®µå</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>name</td><td>varchar(32)</td><td>å•†å“åç§°</td><td>å†—ä½™å­—æ®µ</td></tr><tr><td>image</td><td>varchar(255)</td><td>å•†å“å›¾ç‰‡è·¯å¾„</td><td>å†—ä½™å­—æ®µ</td></tr><tr><td>user_id</td><td>bigint</td><td>ç”¨æˆ·id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>dish_id</td><td>bigint</td><td>èœå“id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>setmeal_id</td><td>bigint</td><td>å¥—é¤id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>dish_flavor</td><td>varchar(50)</td><td>èœå“å£å‘³</td><td></td></tr><tr><td>number</td><td>int</td><td>å•†å“æ•°é‡</td><td></td></tr><tr><td>amount</td><td>decimal(10,2)</td><td>å•†å“å•ä»·</td><td>å†—ä½™å­—æ®µ</td></tr><tr><td>create_time</td><td>datetime</td><td>åˆ›å»ºæ—¶é—´</td></tr></tbody></table></div><div class="note info no-icon flat"><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>è´­ç‰©è½¦æ•°æ®æ˜¯å…³è”ç”¨æˆ·çš„ï¼Œåœ¨è¡¨ç»“æ„ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®æ˜¯å“ªäº›</li><li>èœå“åˆ—è¡¨å±•ç¤ºå‡ºæ¥çš„æ—¢æœ‰å¥—é¤ï¼Œåˆæœ‰èœå“ï¼Œå¦‚æœç”¨æˆ·é€‰æ‹©çš„æ˜¯å¥—é¤ï¼Œå°±ä¿å­˜å¥—é¤ID(setmeal_id)ï¼Œå¦‚æœç”¨æˆ·é€‰æ‹©çš„æ˜¯èœå“ï¼Œå°±ä¿å­˜èœå“ID(dish_id)</li><li>å¯¹åŒä¸€ä¸ªèœå“/å¥—é¤ï¼Œå¦‚æœé€‰æ‹©å¤šä»½ä¸éœ€è¦æ·»åŠ å¤šæ¡è®°å½•ï¼Œå¢åŠ æ•°é‡numberå³å¯</li></ul></div><h3 id="ä»£ç å¼€å‘-13"><a href="#ä»£ç å¼€å‘-13" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="DTOè®¾è®¡-1"><a href="#DTOè®¾è®¡-1" class="headerlink" title="DTOè®¾è®¡"></a>DTOè®¾è®¡</h4><p><strong>æ ¹æ®æ·»åŠ è´­ç‰©è½¦æ¥å£çš„å‚æ•°è®¾è®¡DTOï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208184938195.png"></div></div><p>åœ¨sky-pojoæ¨¡å—ä¸­å·²ç»æä¾›äº†ShoppingCartDTO</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line">    <span class="keyword">private</span> Long setmealId;</span><br><span class="line">    <span class="keyword">private</span> String dishFlavor;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-11"><a href="#Controllerå±‚-11" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®æ·»åŠ è´­ç‰©è½¦æ¥å£åˆ›å»ºShoppingCartControllerï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shoppingCart&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯-è´­ç‰©è½¦æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ·»åŠ è´­ç‰©è½¦&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ·»åŠ è´­ç‰©è½¦ï¼š&#123;&#125;&quot;</span>, shoppingCartDTO);</span><br><span class="line">        shoppingCartService.addShoppingCart(shoppingCartDTO);<span class="comment">//åç»ªæ­¥éª¤å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-8"><a href="#Serviceå±‚-8" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åˆ›å»ºShoppingCartServiceæ¥å£ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºShoppingCartServiceImplå®ç°ç±»ï¼Œå¹¶å®ç°addæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartMapper shoppingCartMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);</span><br><span class="line">        <span class="comment">//åªèƒ½æŸ¥è¯¢è‡ªå·±çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">        shoppingCart.setUserId(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰å•†å“æ˜¯å¦åœ¨è´­ç‰©è½¦ä¸­</span></span><br><span class="line">        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shoppingCartList != <span class="literal">null</span> &amp;&amp; shoppingCartList.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±æ›´æ–°æ•°é‡ï¼Œæ•°é‡åŠ 1</span></span><br><span class="line">            shoppingCart = shoppingCartList.get(<span class="number">0</span>);</span><br><span class="line">            shoppingCart.setNumber(shoppingCart.getNumber() + <span class="number">1</span>);</span><br><span class="line">            shoppingCartMapper.updateNumberById(shoppingCart);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥æ•°æ®ï¼Œæ•°é‡å°±æ˜¯1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ¤æ–­å½“å‰æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCartDTO.getDishId();</span><br><span class="line">            <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“</span></span><br><span class="line">                <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(dishId);</span><br><span class="line">                shoppingCart.setName(dish.getName());</span><br><span class="line">                shoppingCart.setImage(dish.getImage());</span><br><span class="line">                shoppingCart.setAmount(dish.getPrice());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯å¥—é¤</span></span><br><span class="line">                <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(shoppingCartDTO.getSetmealId());</span><br><span class="line">                shoppingCart.setName(setmeal.getName());</span><br><span class="line">                shoppingCart.setImage(setmeal.getImage());</span><br><span class="line">                shoppingCart.setAmount(setmeal.getPrice());</span><br><span class="line">            &#125;</span><br><span class="line">            shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">            shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">            shoppingCartMapper.insert(shoppingCart);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-11"><a href="#Mapperå±‚-11" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åˆ›å»ºShoppingCartMapperæ¥å£:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;ShoppingCart&gt; <span class="title function_">list</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°å•†å“æ•°é‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;update shopping_cart set number = #&#123;number&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateNumberById</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into shopping_cart (name, user_id, dish_id, setmeal_id, dish_flavor, number, amount, image, create_time) &quot; +</span></span><br><span class="line"><span class="meta">            &quot; values (#&#123;name&#125;,#&#123;userId&#125;,#&#123;dishId&#125;,#&#123;setmealId&#125;,#&#123;dishFlavor&#125;,#&#123;number&#125;,#&#123;amount&#125;,#&#123;image&#125;,#&#123;createTime&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºShoppingCartMapper.xmlï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.ShoppingCartMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;ShoppingCart&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;ShoppingCart&quot;</span>&gt;</span></span><br><span class="line">        select * from shopping_cart</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userId != null&quot;</span>&gt;</span></span><br><span class="line">                and user_id = #&#123;userId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;dishId != null&quot;</span>&gt;</span></span><br><span class="line">                and dish_id = #&#123;dishId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;setmealId != null&quot;</span>&gt;</span></span><br><span class="line">                and setmeal_id = #&#123;setmealId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;dishFlavor != null&quot;</span>&gt;</span></span><br><span class="line">                and dish_flavor = #&#123;dishFlavor&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by create_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-14"><a href="#åŠŸèƒ½æµ‹è¯•-14" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>åœ¨å°ç¨‹åºç«¯ç‚¹å‡»æ·»åŠ èœå“ï¼Œæ·»åŠ èœå“åï¼Œå› ä¸ºå½“å‰è¿˜æ²¡æœ‰å®ç°æŸ¥çœ‹è´­ç‰©è½¦åŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥å»æ•°æ®åº“çš„è´­ç‰©è½¦è¡¨æŸ¥çœ‹æ–°å¡«çš„æ•°æ®<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116145208.png"></div></div><p></p><div class="note warning no-icon flat"><p>å¦‚æœjavaç¨‹åºæ˜¾ç¤ºæ’å…¥ä¸€æ¡è¯­å¥ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨ä¸­æ²¡æœ‰æ•°æ®ï¼Œå¯èƒ½æ˜¯å› ä¸ºå‰é¢å¾®ä¿¡ç™»å½•å¤„æ‹¦æˆªå™¨åŒ…å¯¼å…¥é”™è¯¯ï¼Œå¯¼è‡´æ‹¦æˆªå™¨ä¸ç”Ÿæ•ˆè€Œæ²¡æœ‰è§£æå‡ºuser_id,æ’å…¥å­—æ®µä¸ºnullå¯¼è‡´çš„æ’å…¥å¤±è´¥</p></div><h2 id="æŸ¥çœ‹è´­ç‰©è½¦"><a href="#æŸ¥çœ‹è´­ç‰©è½¦" class="headerlink" title="æŸ¥çœ‹è´­ç‰©è½¦"></a>æŸ¥çœ‹è´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-18"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-18" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-2"><a href="#äº§å“åŸå‹-2" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>å½“ç”¨æˆ·æ·»åŠ å®Œèœå“å’Œå¥—é¤åï¼Œå¯è¿›å…¥åˆ°è´­ç‰©è½¦ä¸­ï¼ŒæŸ¥çœ‹è´­ç‰©ä¸­çš„èœå“å’Œå¥—é¤ã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208190038058.png"></div></div><p></p><h4 id="æ¥å£è®¾è®¡-5"><a href="#æ¥å£è®¾è®¡-5" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208190102904.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208190052467.png"></div></div><h3 id="ä»£ç å¼€å‘-14"><a href="#ä»£ç å¼€å‘-14" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="Controllerå±‚-12"><a href="#Controllerå±‚-12" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>åœ¨ShoppingCartControllerä¸­åˆ›å»ºæŸ¥çœ‹è´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŸ¥çœ‹è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æŸ¥çœ‹è´­ç‰©è½¦&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> Result.success(shoppingCartService.showShoppingCart());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-9"><a href="#Serviceå±‚-9" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åœ¨ShoppingCartServiceæ¥å£ä¸­å£°æ˜æŸ¥çœ‹è´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŸ¥çœ‹è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   List&lt;ShoppingCart&gt; <span class="title function_">showShoppingCart</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ShoppingCartServiceImplä¸­å®ç°æŸ¥çœ‹è´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŸ¥çœ‹è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;ShoppingCart&gt; <span class="title function_">showShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> shoppingCartMapper.list(ShoppingCart.</span><br><span class="line">                   builder().</span><br><span class="line">                   userId(BaseContext.getCurrentId()).</span><br><span class="line">                   build());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="æ¸…ç©ºè´­ç‰©è½¦"><a href="#æ¸…ç©ºè´­ç‰©è½¦" class="headerlink" title="æ¸…ç©ºè´­ç‰©è½¦"></a>æ¸…ç©ºè´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-19"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-19" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç‚¹å‡»æ¸…ç©ºæŒ‰é’®æ—¶ï¼Œä¼šæŠŠè´­ç‰©è½¦ä¸­çš„æ•°æ®å…¨éƒ¨æ¸…ç©ºã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221210213703715.png"></div></div><p><strong>æ¥å£è®¾è®¡</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221208191606894.png"></div></div><h3 id="ä»£ç å¼€å‘-15"><a href="#ä»£ç å¼€å‘-15" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="Controllerå±‚-13"><a href="#Controllerå±‚-13" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>åœ¨ShoppingCartControllerä¸­åˆ›å»ºæ¸…ç©ºè´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¸…ç©ºè´­ç‰©è½¦å•†å“</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;æ¸…ç©ºè´­ç‰©è½¦å•†å“&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">clean</span><span class="params">()</span>&#123;</span><br><span class="line">       shoppingCartService.cleanShoppingCart();</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-10"><a href="#Serviceå±‚-10" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åœ¨ShoppingCartServiceæ¥å£ä¸­å£°æ˜æ¸…ç©ºè´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¸…ç©ºè´­ç‰©è½¦å•†å“</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">cleanShoppingCart</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ShoppingCartServiceImplä¸­å®ç°æ¸…ç©ºè´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ¸…ç©ºè´­ç‰©è½¦å•†å“</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">       shoppingCartMapper.deleteByUserId(BaseContext.getCurrentId());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-12"><a href="#Mapperå±‚-12" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨ShoppingCartMapperæ¥å£ä¸­åˆ›å»ºåˆ é™¤è´­ç‰©è½¦æ•°æ®çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®ç”¨æˆ·idåˆ é™¤è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Delete(&quot;delete from shopping_cart where user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">deleteByUserId</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-15"><a href="#åŠŸèƒ½æµ‹è¯•-15" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>ç‚¹å‡»æ¸…ç©º</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221210214914092.png"></div></div><p>æŸ¥çœ‹æ•°æ®åº“ä¸­çš„æ•°æ®</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221210214950261.png"></div></div><p>è¯´æ˜å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®å·²å…¨éƒ¨åˆ é™¤ã€‚</p><h1 id="day08"><a href="#day08" class="headerlink" title="day08"></a>day08</h1><h2 id="è¯¾ç¨‹å†…å®¹-4"><a href="#è¯¾ç¨‹å†…å®¹-4" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç </li><li>ç”¨æˆ·ä¸‹å•</li><li>è®¢å•æ”¯ä»˜</li></ul><p>åŠŸèƒ½å®ç°ï¼š<strong>ç”¨æˆ·ä¸‹å•</strong>ã€<strong>è®¢å•æ”¯ä»˜</strong><br><strong>ç”¨æˆ·ä¸‹å•æ•ˆæœå›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116154416.png"></div></div><h2 id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç "><a href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç " class="headerlink" title="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç "></a>å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç </h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-20"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-20" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-3"><a href="#äº§å“åŸå‹-3" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>åœ°å€ç°¿ï¼ŒæŒ‡çš„æ˜¯æ¶ˆè´¹è€…ç”¨æˆ·çš„åœ°å€ä¿¡æ¯ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåå¯ä»¥ç»´æŠ¤è‡ªå·±çš„åœ°å€ä¿¡æ¯ã€‚åŒä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªåœ°å€ä¿¡æ¯ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ª<strong>é»˜è®¤åœ°å€</strong>ã€‚</p><p><strong>æ•ˆæœå›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116154625.png"></div></div><p>å¯¹äºåœ°å€ç°¿ç®¡ç†ï¼Œéœ€è¦å®ç°ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š</p><ul><li>æŸ¥è¯¢åœ°å€åˆ—è¡¨</li><li>æ–°å¢åœ°å€</li><li>ä¿®æ”¹åœ°å€</li><li>åˆ é™¤åœ°å€</li><li>è®¾ç½®é»˜è®¤åœ°å€</li><li>æŸ¥è¯¢é»˜è®¤åœ°å€</li></ul><h4 id="æ¥å£è®¾è®¡-6"><a href="#æ¥å£è®¾è®¡-6" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>æ ¹æ®ä¸Šè¿°åŸå‹å›¾å…ˆ <strong>ç²—ç²’åº¦</strong> è®¾è®¡æ¥å£ï¼Œå…±åŒ…å«7ä¸ªæ¥å£ã€‚</p><p><strong>æ¥å£è®¾è®¡ï¼š</strong></p><ul><li>æ–°å¢åœ°å€</li><li>æŸ¥è¯¢ç™»å½•ç”¨æˆ·æ‰€æœ‰åœ°å€</li><li>æŸ¥è¯¢é»˜è®¤åœ°å€</li><li>æ ¹æ®idä¿®æ”¹åœ°å€</li><li>æ ¹æ®idåˆ é™¤åœ°å€</li><li>æ ¹æ®idæŸ¥è¯¢åœ°å€</li><li>è®¾ç½®é»˜è®¤åœ°å€</li></ul><p>æ¥ä¸‹æ¥<strong>ç»†ç²’åº¦</strong> åˆ†ææ¯ä¸ªæ¥å£ï¼Œæ˜ç¡®æ¯ä¸ªæ¥å£çš„è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼ã€‚</p><div class="tabs" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-1">æ–°å¢åœ°å€</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-2">æŸ¥è¯¢ç™»å½•ç”¨æˆ·æ‰€æœ‰åœ°å€</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-3">æŸ¥è¯¢é»˜è®¤åœ°å€</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-4">ä¿®æ”¹åœ°å€</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-5">æ ¹æ®idåˆ é™¤åœ°å€</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-6">æ ¹æ®idæŸ¥è¯¢åœ°å€</button></li><li class="tab"><button type="button" data-href="#å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-7">è®¾ç½®é»˜è®¤åœ°å€</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185000982.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185013172.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185028575.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185112802.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185124296.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185209235.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185221421.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185309798.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185321203.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185334356.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-5"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185443519.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-6"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185534450.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185545692.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç -æ¥å£è®¾è®¡-7"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185631755.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214185622092.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="è¡¨è®¾è®¡-5"><a href="#è¡¨è®¾è®¡-5" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><p>ç”¨æˆ·çš„åœ°å€ä¿¡æ¯ä¼šå­˜å‚¨åœ¨address_bookè¡¨ï¼Œå³åœ°å€ç°¿è¡¨ä¸­ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th><strong>å­—æ®µå</strong></th><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>ä¸»é”®</td><td>è‡ªå¢</td></tr><tr><td>user_id</td><td>bigint</td><td>ç”¨æˆ·id</td><td>é€»è¾‘å¤–é”®</td></tr><tr><td>consignee</td><td>varchar(50)</td><td>æ”¶è´§äºº</td><td></td></tr><tr><td>sex</td><td>varchar(2)</td><td>æ€§åˆ«</td><td></td></tr><tr><td>phone</td><td>varchar(11)</td><td>æ‰‹æœºå·</td><td></td></tr><tr><td>province_code</td><td>varchar(12)</td><td>çœä»½ç¼–ç </td><td></td></tr><tr><td>province_name</td><td>varchar(32)</td><td>çœä»½åç§°</td><td></td></tr><tr><td>city_code</td><td>varchar(12)</td><td>åŸå¸‚ç¼–ç </td><td></td></tr><tr><td>city_name</td><td>varchar(32)</td><td>åŸå¸‚åç§°</td><td></td></tr><tr><td>district_code</td><td>varchar(12)</td><td>åŒºå¿ç¼–ç </td><td></td></tr><tr><td>district_name</td><td>varchar(32)</td><td>åŒºå¿åç§°</td><td></td></tr><tr><td>detail</td><td>varchar(200)</td><td>è¯¦ç»†åœ°å€ä¿¡æ¯</td><td>å…·ä½“åˆ°é—¨ç‰Œå·</td></tr><tr><td>label</td><td>varchar(100)</td><td>æ ‡ç­¾</td><td>å…¬å¸ã€å®¶ã€å­¦æ ¡</td></tr><tr><td>is_default</td><td>tinyint(1)</td><td>æ˜¯å¦é»˜è®¤åœ°å€</td><td>1æ˜¯ 0å¦</td></tr></tbody></table></div><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªå­—æ®µ<code>is_default</code>ï¼Œå®é™…ä¸Šåœ¨è®¾ç½®é»˜è®¤åœ°å€æ—¶ï¼Œåªéœ€è¦æ›´æ–°è¿™ä¸ªå­—æ®µå°±å¯ä»¥äº†ã€‚</p><h3 id="ä»£ç å¯¼å…¥-2"><a href="#ä»£ç å¯¼å…¥-2" class="headerlink" title="ä»£ç å¯¼å…¥"></a>ä»£ç å¯¼å…¥</h3><p>å¯¹äºè¿™ä¸€ç±»çš„å•è¡¨å¢åˆ æ”¹æŸ¥ï¼ŒåŸºæœ¬çš„å¼€å‘æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ¬å°èŠ‚çš„ç”¨æˆ·åœ°å€ç°¿ç®¡ç†çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½å°±ä¸å†ä¸€ä¸€å®ç°äº†ï¼Œç›´æ¥å¯¼å…¥èµ„æ–™ä¸­æä¾›çš„ä»£ç å³å¯<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214190135741.png"></div></div><p></p><h4 id="Mapperå±‚-13"><a href="#Mapperå±‚-13" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åˆ›å»ºAddressBookMapper.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressBookMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into address_book&quot; +</span></span><br><span class="line"><span class="meta">            &quot;        (user_id, consignee, phone, sex, province_code, province_name, city_code, city_name, district_code,&quot; +</span></span><br><span class="line"><span class="meta">            &quot;         district_name, detail, label, is_default)&quot; +</span></span><br><span class="line"><span class="meta">            &quot;        values (#&#123;userId&#125;, #&#123;consignee&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;provinceCode&#125;, #&#123;provinceName&#125;, #&#123;cityCode&#125;, #&#123;cityName&#125;,&quot; +</span></span><br><span class="line"><span class="meta">            &quot;                #&#123;districtCode&#125;, #&#123;districtName&#125;, #&#123;detail&#125;, #&#123;label&#125;, #&#123;isDefault&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from address_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    AddressBook <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idä¿®æ”¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ® ç”¨æˆ·idä¿®æ”¹ æ˜¯å¦é»˜è®¤åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;update address_book set is_default = #&#123;isDefault&#125; where user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateIsDefaultByUserId</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from address_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºAddressBookMapper.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.AddressBookMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;AddressBook&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;AddressBook&quot;</span>&gt;</span></span><br><span class="line">        select * from address_book</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userId != null&quot;</span>&gt;</span></span><br><span class="line">                and user_id = #&#123;userId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span></span><br><span class="line">                and phone = #&#123;phone&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;isDefault != null&quot;</span>&gt;</span></span><br><span class="line">                and is_default = #&#123;isDefault&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;addressBook&quot;</span>&gt;</span></span><br><span class="line">        update address_book</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;consignee != null&quot;</span>&gt;</span></span><br><span class="line">                consignee = #&#123;consignee&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span></span><br><span class="line">                sex = #&#123;sex&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span></span><br><span class="line">                phone = #&#123;phone&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;detail != null&quot;</span>&gt;</span></span><br><span class="line">                detail = #&#123;detail&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;label != null&quot;</span>&gt;</span></span><br><span class="line">                label = #&#123;label&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;isDefault != null&quot;</span>&gt;</span></span><br><span class="line">                is_default = #&#123;isDefault&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-11"><a href="#Serviceå±‚-11" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åˆ›å»ºAddressBookService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressBookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    AddressBook <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(AddressBook addressBook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºAddressBookServiceImpl.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressBookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AddressBookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressBookMapper addressBookMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addressBookMapper.list(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        addressBook.setIsDefault(<span class="number">0</span>);</span><br><span class="line">        addressBookMapper.insert(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> AddressBook <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookMapper.getById(id);</span><br><span class="line">        <span class="keyword">return</span> addressBook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idä¿®æ”¹åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBookMapper.update(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é»˜è®¤åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">        <span class="comment">//1ã€å°†å½“å‰ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿®æ”¹ä¸ºéé»˜è®¤åœ°å€ update address_book set is_default = ? where user_id = ?</span></span><br><span class="line">        addressBook.setIsDefault(<span class="number">0</span>);</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        addressBookMapper.updateIsDefaultByUserId(addressBook);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€å°†å½“å‰åœ°å€æ”¹ä¸ºé»˜è®¤åœ°å€ update address_book set is_default = ? where id = ?</span></span><br><span class="line">        addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">        addressBookMapper.update(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        addressBookMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-14"><a href="#Controllerå±‚-14" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/addressBook&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯åœ°å€ç°¿æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressBookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressBookService addressBookService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddressBook</span>();</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        List&lt;AddressBook&gt; list = addressBookService.list(addressBook);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢åœ°å€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBookService.save(addressBook);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢åœ°å€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;AddressBook&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idä¿®æ”¹åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®idä¿®æ”¹åœ°å€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBookService.update(addressBook);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é»˜è®¤åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/default&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¾ç½®é»˜è®¤åœ°å€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBookService.setDefault(addressBook);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®idåˆ é™¤åœ°å€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        addressBookService.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢é»˜è®¤åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;default&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢é»˜è®¤åœ°å€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;AddressBook&gt; <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//SQL:select * from address_book where user_id = ? and is_default = 1</span></span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddressBook</span>();</span><br><span class="line">        addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        List&lt;AddressBook&gt; list = addressBookService.list(addressBook);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; list.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.success(list.get(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;æ²¡æœ‰æŸ¥è¯¢åˆ°é»˜è®¤åœ°å€&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-16"><a href="#åŠŸèƒ½æµ‹è¯•-16" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æŸ¥çœ‹æ§åˆ¶å°sqlå’Œæ•°æ®åº“ä¸­çš„æ•°æ®å˜åŒ–</li><li>Swaggeræ¥å£æ–‡æ¡£æµ‹è¯•</li><li>å‰åç«¯è”è°ƒ</li></ul><p>è¿™é‡Œç›´æ¥ä½¿ç”¨<strong>å‰åç«¯è”è°ƒ</strong>æµ‹è¯•ï¼š</p><p>å¯åŠ¨åå°æœåŠ¡ï¼Œç¼–è¯‘å°ç¨‹åº</p><p>ç™»å½•è¿›å…¥é¦–é¡µâ€”&gt;è¿›å…¥ä¸ªäººä¸­å¿ƒâ€”&gt;è¿›å…¥åœ°å€ç®¡ç†<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116155837.png"></div></div><p></p><h2 id="ç”¨æˆ·ä¸‹å•"><a href="#ç”¨æˆ·ä¸‹å•" class="headerlink" title="ç”¨æˆ·ä¸‹å•"></a>ç”¨æˆ·ä¸‹å•</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-21"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-21" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-4"><a href="#äº§å“åŸå‹-4" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p><strong>ç”¨æˆ·ä¸‹å•ä¸šåŠ¡è¯´æ˜ï¼š</strong><br>åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·é€šè¿‡ä¸‹å•çš„æ–¹å¼é€šçŸ¥å•†å®¶ï¼Œç”¨æˆ·å·²ç»è´­ä¹°äº†å•†å“ï¼Œéœ€è¦å•†å®¶è¿›è¡Œå¤‡è´§å’Œå‘è´§ã€‚<br>ç”¨æˆ·ä¸‹å•åä¼šäº§ç”Ÿè®¢å•ç›¸å…³æ•°æ®ï¼Œè®¢å•æ•°æ®éœ€è¦èƒ½å¤Ÿä½“ç°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214195633802.png"></div></div><p>ç”¨æˆ·å°†èœå“æˆ–è€…å¥—é¤åŠ å…¥è´­ç‰©è½¦åï¼Œå¯ä»¥ç‚¹å‡»è´­ç‰©è½¦ä¸­çš„ â€œå»ç»“ç®—â€ æŒ‰é’®ï¼Œé¡µé¢è·³è½¬åˆ°è®¢å•ç¡®è®¤é¡µé¢ï¼Œç‚¹å‡» â€œå»æ”¯ä»˜â€ æŒ‰é’®åˆ™å®Œæˆä¸‹å•æ“ä½œã€‚</p><p><strong>ç”¨æˆ·ç‚¹é¤ä¸šåŠ¡æµç¨‹(æ•ˆæœå›¾)ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214195913467.png"></div></div><h4 id="æ¥å£è®¾è®¡-7"><a href="#æ¥å£è®¾è®¡-7" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p><strong>æ¥å£åˆ†æï¼š</strong></p><div class="tabs" id="ç”¨æˆ·ä¸‹å•-æ¥å£åˆ†æ"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•-æ¥å£åˆ†æ-1">å‘é€è¯·æ±‚</button></li><li class="tab"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•-æ¥å£åˆ†æ-2">è¿”å›æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ç”¨æˆ·ä¸‹å•-æ¥å£åˆ†æ-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214200913654.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç”¨æˆ·ä¸‹å•-æ¥å£åˆ†æ-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214200959943.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>æ¥å£è®¾è®¡ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214201211364.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214201220993.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214201236107.png"></div></div><h4 id="è¡¨è®¾è®¡-6"><a href="#è¡¨è®¾è®¡-6" class="headerlink" title="è¡¨è®¾è®¡"></a>è¡¨è®¾è®¡</h4><p>ç”¨æˆ·ä¸‹å•ä¸šåŠ¡å¯¹åº”çš„æ•°æ®è¡¨ä¸ºordersè¡¨å’Œorder_detailè¡¨(ä¸€å¯¹å¤šå…³ç³»,ä¸€ä¸ªè®¢å•å…³è”å¤šä¸ªè®¢å•æ˜ç»†)ï¼š</p><div class="table-container"><table><thead><tr><th>è¡¨å</th><th>å«ä¹‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>orders</td><td>è®¢å•è¡¨</td><td>ä¸»è¦å­˜å‚¨è®¢å•çš„åŸºæœ¬ä¿¡æ¯(å¦‚: è®¢å•å·ã€çŠ¶æ€ã€é‡‘é¢ã€æ”¯ä»˜æ–¹å¼ã€ä¸‹å•ç”¨æˆ·ã€æ”¶ä»¶åœ°å€ç­‰)</td></tr><tr><td>order_detail</td><td>è®¢å•æ˜ç»†è¡¨</td><td>ä¸»è¦å­˜å‚¨è®¢å•è¯¦æƒ…ä¿¡æ¯(å¦‚: è¯¥è®¢å•å…³è”çš„å¥—é¤åŠèœå“çš„ä¿¡æ¯)</td></tr></tbody></table></div><p>å…·ä½“çš„è¡¨ç»“æ„å¦‚ä¸‹:</p><div class="tabs" id="ç”¨æˆ·ä¸‹å•-è¡¨è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•-è¡¨è®¾è®¡-1">orders</button></li><li class="tab"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•-è¡¨è®¾è®¡-2">order_detail</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ç”¨æˆ·ä¸‹å•-è¡¨è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116161830.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç”¨æˆ·ä¸‹å•-è¡¨è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116161936.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note warning no-icon flat"><p><strong>è¯´æ˜ï¼š</strong> ç”¨æˆ·æäº¤è®¢å•æ—¶ï¼Œéœ€è¦å¾€è®¢å•è¡¨ordersä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œéœ€è¦å¾€order_detailä¸­æ’å…¥ä¸€æ¡æˆ–å¤šæ¡è®°å½•ã€‚</p></div><h3 id="ä»£ç å¼€å‘-16"><a href="#ä»£ç å¼€å‘-16" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="DTOè®¾è®¡-2"><a href="#DTOè®¾è®¡-2" class="headerlink" title="DTOè®¾è®¡"></a>DTOè®¾è®¡</h4><p><strong>æ ¹æ®ç”¨æˆ·ä¸‹å•æ¥å£çš„å‚æ•°è®¾è®¡DTOï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214203913803.png"></div></div><p>åœ¨sky-pojoæ¨¡å—ï¼ŒOrdersSubmitDTO.javaå·²å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrdersSubmitDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//åœ°å€ç°¿id</span></span><br><span class="line">    <span class="keyword">private</span> Long addressBookId;</span><br><span class="line">    <span class="comment">//ä»˜æ¬¾æ–¹å¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> payMethod;</span><br><span class="line">    <span class="comment">//å¤‡æ³¨</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">    <span class="comment">//é¢„è®¡é€è¾¾æ—¶é—´</span></span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime estimatedDeliveryTime;</span><br><span class="line">    <span class="comment">//é…é€çŠ¶æ€  1ç«‹å³é€å‡º  0é€‰æ‹©å…·ä½“æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> Integer deliveryStatus;</span><br><span class="line">    <span class="comment">//é¤å…·æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer tablewareNumber;</span><br><span class="line">    <span class="comment">//é¤å…·æ•°é‡çŠ¶æ€  1æŒ‰é¤é‡æä¾›  0é€‰æ‹©å…·ä½“æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer tablewareStatus;</span><br><span class="line">    <span class="comment">//æ‰“åŒ…è´¹</span></span><br><span class="line">    <span class="keyword">private</span> Integer packAmount;</span><br><span class="line">    <span class="comment">//æ€»é‡‘é¢</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="VOè®¾è®¡-1"><a href="#VOè®¾è®¡-1" class="headerlink" title="VOè®¾è®¡"></a>VOè®¾è®¡</h4><p><strong>æ ¹æ®ç”¨æˆ·ä¸‹å•æ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214204113316.png"></div></div><p></p><p>åœ¨sky-pojoæ¨¡å—ï¼ŒOrderSubmitVO.javaå·²å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderSubmitVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//è®¢å•id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//è®¢å•å·</span></span><br><span class="line">    <span class="keyword">private</span> String orderNumber;</span><br><span class="line">    <span class="comment">//è®¢å•é‡‘é¢</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal orderAmount;</span><br><span class="line">    <span class="comment">//ä¸‹å•æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime orderTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-15"><a href="#Controllerå±‚-15" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>åˆ›å»ºOrderControllerå¹¶æä¾›ç”¨æˆ·ä¸‹å•æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;userOrderController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/order&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯-è®¢å•æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/submit&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ç”¨æˆ·ä¸‹å•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;OrderSubmitVO&gt; <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·ä¸‹å•ï¼š&#123;&#125;&quot;</span>, ordersSubmitDTO);</span><br><span class="line">        <span class="type">OrderSubmitVO</span> <span class="variable">orderSubmitVO</span> <span class="operator">=</span> orderService.submitOrder(ordersSubmitDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success(orderSubmitVO);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-12"><a href="#Serviceå±‚-12" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åˆ›å»ºOrderServiceæ¥å£ï¼Œå¹¶å£°æ˜ç”¨æˆ·ä¸‹å•æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OrderSubmitVO <span class="title function_">submitOrder</span><span class="params">(OrdersSubmitDTO ordersSubmitDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºOrderServiceImplå®ç°OrderServiceæ¥å£ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderDetailMapper orderDetailMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartMapper shoppingCartMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressBookMapper addressBookMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> OrderSubmitVO <span class="title function_">submitOrder</span><span class="params">(OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line">        <span class="comment">//å¼‚å¸¸æƒ…å†µçš„å¤„ç†ï¼ˆæ”¶è´§åœ°å€ä¸ºç©ºã€è¶…å‡ºé…é€èŒƒå›´ã€è´­ç‰©è½¦ä¸ºç©ºï¼‰</span></span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());</span><br><span class="line">        <span class="keyword">if</span> (addressBook == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressBookBusinessException</span>(MessageConstant.ADDRESS_BOOK_IS_NULL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">        <span class="keyword">if</span> (shoppingCartList == <span class="literal">null</span> || shoppingCartList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShoppingCartBusinessException</span>(MessageConstant.SHOPPING_CART_IS_NULL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ è®¢å•æ•°æ®</span></span><br><span class="line">        <span class="type">Orders</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">        BeanUtils.copyProperties(ordersSubmitDTO,order);</span><br><span class="line">        order.setPhone(addressBook.getPhone());</span><br><span class="line">        order.setAddress(addressBook.getDetail());</span><br><span class="line">        order.setConsignee(addressBook.getConsignee());</span><br><span class="line">        order.setNumber(String.valueOf(System.currentTimeMillis()));</span><br><span class="line">        order.setUserId(userId);</span><br><span class="line">        order.setStatus(Orders.PENDING_PAYMENT);</span><br><span class="line">        order.setPayStatus(Orders.UN_PAID);</span><br><span class="line">        order.setOrderTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘è®¢å•è¡¨æ’å…¥1æ¡æ•°æ®</span></span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¢å•æ˜ç»†æ•°æ®</span></span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ShoppingCart cart : shoppingCartList) &#123;</span><br><span class="line">            <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">            BeanUtils.copyProperties(cart, orderDetail);</span><br><span class="line">            orderDetail.setOrderId(order.getId());</span><br><span class="line">            orderDetailList.add(orderDetail);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘æ˜ç»†è¡¨æ’å…¥næ¡æ•°æ®</span></span><br><span class="line">        orderDetailMapper.insertBatch(orderDetailList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¸…ç†è´­ç‰©è½¦ä¸­çš„æ•°æ®</span></span><br><span class="line">        shoppingCartMapper.deleteByUserId(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°è£…è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">OrderSubmitVO</span> <span class="variable">orderSubmitVO</span> <span class="operator">=</span> OrderSubmitVO.builder()</span><br><span class="line">                .id(order.getId())</span><br><span class="line">                .orderNumber(order.getNumber())</span><br><span class="line">                .orderAmount(order.getAmount())</span><br><span class="line">                .orderTime(order.getOrderTime())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderSubmitVO;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-14"><a href="#Mapperå±‚-14" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åˆ›å»ºOrderMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶ï¼š</strong></p><div class="tabs" id="ç”¨æˆ·ä¸‹å•mapperå±‚"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•mapperå±‚-1">OrderMapper.java</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ç”¨æˆ·ä¸‹å•mapperå±‚-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥è®¢å•æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> order</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Orders order)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>åˆ›å»ºOrderDetailMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶ï¼š</strong></p><div class="tabs" id="orderdetailmapper"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#orderdetailmapper-1">OrderDetailMapper.java</button></li><li class="tab"><button type="button" data-href="#orderdetailmapper-2">OrderDetailMapper.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="orderdetailmapper-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDetailMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥è®¢å•æ˜ç»†æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderDetails</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(List&lt;OrderDetail&gt; orderDetails)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="orderdetailmapper-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.OrderDetailMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        insert into order_detail</span><br><span class="line">        (name, order_id, dish_id, setmeal_id, dish_flavor, number, amount, image)</span><br><span class="line">        values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;orderDetails&quot;</span> <span class="attr">item</span>=<span class="string">&quot;od&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;od.name&#125;,#&#123;od.orderId&#125;,#&#123;od.dishId&#125;,#&#123;od.setmealId&#125;,#&#123;od.dishFlavor&#125;,</span><br><span class="line">             #&#123;od.number&#125;,#&#123;od.amount&#125;,#&#123;od.image&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="åŠŸèƒ½æµ‹è¯•-17"><a href="#åŠŸèƒ½æµ‹è¯•-17" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>ç™»å½•å°ç¨‹åºï¼Œå®Œæˆä¸‹å•æ“ä½œ</p><p>ä¸‹å•æ“ä½œæ—¶ï¼ŒåŒæ—¶ä¼šåˆ é™¤è´­ç‰©è½¦ä¸­çš„æ•°æ®</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214214128415.png"></div></div><p><strong>å»ç»“ç®—â€”&gt;å»æ”¯ä»˜</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116162707.png"></div></div><div class="tabs" id="ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•-1">ordersè¡¨</button></li><li class="tab"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•-2">order_detailè¡¨</button></li><li class="tab"><button type="button" data-href="#ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•-3">shopping_cartè¡¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214215116451.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214215250553.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç”¨æˆ·ä¸‹å•åŠŸèƒ½æµ‹è¯•-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221214215428516.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="è®¢å•æ”¯ä»˜"><a href="#è®¢å•æ”¯ä»˜" class="headerlink" title="è®¢å•æ”¯ä»˜"></a>è®¢å•æ”¯ä»˜</h2><h3 id="å¾®ä¿¡æ”¯ä»˜ä»‹ç»"><a href="#å¾®ä¿¡æ”¯ä»˜ä»‹ç»" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜ä»‹ç»"></a>å¾®ä¿¡æ”¯ä»˜ä»‹ç»</h3><p>å‰é¢å·²ç»å®ç°äº†ç”¨æˆ·ä¸‹å•ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å¯¹è®¢å•è¿›è¡Œæ”¯ä»˜ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ç»å¸¸è´­ä¹°å•†å“å¹¶ä¸”ä½¿ç”¨æ”¯ä»˜åŠŸèƒ½æ¥ä»˜æ¬¾ï¼Œåœ¨ä»˜æ¬¾çš„æ—¶å€™å¯èƒ½ä½¿ç”¨æ¯”è¾ƒå¤šçš„å°±æ˜¯<code>å¾®ä¿¡æ”¯ä»˜</code>å’Œ<code>æ”¯ä»˜å®æ”¯ä»˜</code>äº†ã€‚åœ¨è‹ç©¹å¤–å–é¡¹ç›®ä¸­ï¼Œé€‰æ‹©çš„å°±æ˜¯<strong>å¾®ä¿¡æ”¯ä»˜</strong>è¿™ç§æ”¯ä»˜æ–¹å¼ã€‚</p><p>è¦å®ç°å¾®ä¿¡æ”¯ä»˜å°±éœ€è¦æ³¨å†Œå¾®ä¿¡æ”¯ä»˜çš„ä¸€ä¸ªå•†æˆ·å·ï¼Œè¿™ä¸ªå•†æˆ·å·æ˜¯<strong>å¿…é¡»è¦æœ‰ä¸€å®¶ä¼ä¸šå¹¶ä¸”æœ‰æ­£è§„çš„è¥ä¸šæ‰§ç…§</strong>ã€‚åªæœ‰å…·å¤‡äº†è¿™äº›èµ„è´¨ä¹‹åï¼Œæ‰å¯ä»¥å»æ³¨å†Œå•†æˆ·å·ï¼Œæ‰èƒ½å¼€é€šæ”¯ä»˜æƒé™ã€‚</p><div class="note danger no-icon flat"><p>ä¸ªäººä¸å…·å¤‡è¿™ç§èµ„è´¨ï¼Œæ— æ³•æ³¨å†Œå•†æˆ·å·ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œ</p></div><p><strong>å¾®ä¿¡æ”¯ä»˜äº§å“ï¼š</strong></p><p><img src="assets/image-20221214223302651.png" alt="image-20221214223302651" style="zoom:50%"></p><p>æœ¬é¡¹ç›®é€‰æ‹©<strong>å°ç¨‹åºæ”¯ä»˜</strong></p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/static/product/product_index.shtml">https://pay.weixin.qq.com/static/product/product_index.shtml</a></p><p><strong>å¾®ä¿¡æ”¯ä»˜æ¥å…¥æµç¨‹ï¼š</strong></p><p><img src="assets/image-20221214223509246.png" alt="image-20221214223509246" style="zoom:50%"></p><p><strong>å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜æ—¶åºå›¾ï¼š</strong></p><p><img src="assets/image-20221214223910840.png" alt="image-20221214223910840" style="zoom:50%"></p><p><strong>å¾®ä¿¡æ”¯ä»˜ç›¸å…³æ¥å£ï¼š</strong></p><p><strong>JSAPIä¸‹å•ï¼š</strong>å•†æˆ·ç³»ç»Ÿè°ƒç”¨è¯¥æ¥å£åœ¨å¾®ä¿¡æ”¯ä»˜æœåŠ¡åå°ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•(å¯¹åº”æ—¶åºå›¾çš„ç¬¬5æ­¥)</p><p><img src="assets/image-20221214224409174.png" alt="image-20221214224409174"></p><p><strong>å¾®ä¿¡å°ç¨‹åºè°ƒèµ·æ”¯ä»˜ï¼š</strong>é€šè¿‡JSAPIä¸‹å•æ¥å£è·å–åˆ°å‘èµ·æ”¯ä»˜çš„å¿…è¦å‚æ•°prepay_idï¼Œç„¶åä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æä¾›çš„å°ç¨‹åºæ–¹æ³•è°ƒèµ·å°ç¨‹åºæ”¯ä»˜(å¯¹åº”æ—¶åºå›¾çš„ç¬¬10æ­¥)</p><p><img src="assets/image-20221214224551220.png" alt="image-20221214224551220" style="zoom:50%"></p><h3 id="3-2-å¾®ä¿¡æ”¯ä»˜å‡†å¤‡å·¥ä½œ"><a href="#3-2-å¾®ä¿¡æ”¯ä»˜å‡†å¤‡å·¥ä½œ" class="headerlink" title="3.2 å¾®ä¿¡æ”¯ä»˜å‡†å¤‡å·¥ä½œ"></a>3.2 å¾®ä¿¡æ”¯ä»˜å‡†å¤‡å·¥ä½œ</h3><h4 id="3-2-1-å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ"><a href="#3-2-1-å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ" class="headerlink" title="3.2.1 å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ"></a>3.2.1 å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ</h4><p>å®Œæˆå¾®ä¿¡æ”¯ä»˜æœ‰ä¸¤ä¸ªå…³é”®çš„æ­¥éª¤ï¼š</p><p><strong>ç¬¬ä¸€ä¸ª</strong>å°±æ˜¯éœ€è¦åœ¨å•†æˆ·ç³»ç»Ÿå½“ä¸­è°ƒç”¨å¾®ä¿¡åå°çš„ä¸€ä¸ªä¸‹å•æ¥å£ï¼Œå°±æ˜¯ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ã€‚</p><p><strong>ç¬¬äºŒä¸ª</strong>å°±æ˜¯æ”¯ä»˜æˆåŠŸä¹‹åå¾®ä¿¡åå°ä¼šç»™æ¨é€æ¶ˆæ¯ã€‚</p><p>è¿™ä¸¤ä¸ªæ¥å£æ•°æ®çš„å®‰å…¨æ€§ï¼Œè¦æ±‚å…¶å®æ˜¯éå¸¸é«˜çš„ã€‚</p><p><strong>è§£å†³ï¼š</strong>å¾®ä¿¡æä¾›çš„æ–¹å¼å°±æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€ç­¾åå¤šç§æ–¹å¼ã€‚è¦å®Œæˆæ•°æ®åŠ å¯†è§£å¯†ï¼Œéœ€è¦æå‰å‡†å¤‡ç›¸åº”çš„ä¸€äº›æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€äº›è¯ä¹¦ã€‚</p><p><strong>è·å–å¾®ä¿¡æ”¯ä»˜å¹³å°è¯ä¹¦ã€å•†æˆ·ç§é’¥æ–‡ä»¶ï¼š</strong></p><p><img src="assets/image-20221214234038395.png" alt="image-20221214234038395" style="zoom:50%"></p><p>åœ¨åç»ªç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šä½¿ç”¨åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œéœ€è¦æå‰æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å‡†å¤‡å¥½ã€‚</p><h4 id="3-2-2-å¦‚ä½•è°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿï¼Ÿ"><a href="#3-2-2-å¦‚ä½•è°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿï¼Ÿ" class="headerlink" title="3.2.2 å¦‚ä½•è°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿï¼Ÿ"></a>3.2.2 å¦‚ä½•è°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿï¼Ÿ</h4><p>å¾®ä¿¡åå°ä¼šè°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿç»™æ¨é€æ”¯ä»˜çš„ç»“æœï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¾®ä¿¡åå°æ€ä¹ˆå°±èƒ½è°ƒç”¨åˆ°æˆ‘ä»¬è¿™ä¸ªå•†æˆ·ç³»ç»Ÿå‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªè°ƒç”¨è¿‡ç¨‹ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ã€‚</p><p>ç›®å‰ï¼Œå•†æˆ·ç³»ç»Ÿå®ƒçš„ipåœ°å€å°±æ˜¯å½“å‰è‡ªå·±ç”µè„‘çš„ipåœ°å€ï¼Œåªæ˜¯ä¸€ä¸ªå±€åŸŸç½‘å†…çš„ipåœ°å€ï¼Œå¾®ä¿¡åå°æ— æ³•è°ƒç”¨åˆ°ã€‚</p><p><strong>è§£å†³ï¼š</strong>å†…ç½‘ç©¿é€ã€‚é€šè¿‡<strong>cpolarè½¯ä»¶</strong>å¯ä»¥è·å¾—ä¸€ä¸ªä¸´æ—¶åŸŸåï¼Œè€Œè¿™ä¸ªä¸´æ—¶åŸŸåæ˜¯ä¸€ä¸ªå…¬ç½‘ipï¼Œè¿™æ ·ï¼Œå¾®ä¿¡åå°å°±å¯ä»¥è¯·æ±‚åˆ°å•†æˆ·ç³»ç»Ÿäº†ã€‚</p><p><strong>cpolarè½¯ä»¶çš„ä½¿ç”¨ï¼š</strong></p><p><strong>1). ä¸‹è½½ä¸å®‰è£…</strong></p><p>ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://dashboard.cpolar.com/get-started">https://dashboard.cpolar.com/get-started</a></p><p><img src="assets/image-20221215184407217.png" alt="image-20221215184407217" style="zoom:50%"></p><p>åœ¨èµ„æ–™ä¸­å·²æä¾›ï¼Œå¯æ— éœ€ä¸‹è½½ã€‚</p><p><img src="assets/image-20221215184446260.png" alt="image-20221215184446260" style="zoom:80%"></p><p>å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥å³å¯ï¼Œä¸å†æ¼”ç¤ºã€‚</p><p><strong>2). cpolaræŒ‡å®šauthtoken</strong></p><p>å¤åˆ¶authtokenï¼š</p><p><img src="assets/image-20221215184746092.png" alt="image-20221215184746092" style="zoom:50%"></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="assets/image-20221215185152869.png" alt="image-20221215185152869" style="zoom:50%"></p><p><strong>3). è·å–ä¸´æ—¶åŸŸå</strong></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="assets/image-20221215185749163.png" alt="image-20221215185749163" style="zoom:50%"></p><p>è·å–åŸŸåï¼š</p><p><img src="assets/image-20221215185833157.png" alt="image-20221215185833157" style="zoom:50%"></p><p><strong>4). éªŒè¯ä¸´æ—¶åŸŸåæœ‰æ•ˆæ€§</strong></p><p><strong>è®¿é—®æ¥å£æ–‡æ¡£</strong></p><p>ä½¿ç”¨localhost:8080è®¿é—®</p><p><img src="assets/image-20221215190440717.png" alt="image-20221215190440717" style="zoom:50%"></p><p>ä½¿ç”¨ä¸´æ—¶åŸŸåè®¿é—®</p><p><img src="assets/image-20221215190525166.png" alt="image-20221215190525166" style="zoom:50%"></p><p>è¯æ˜ä¸´æ—¶åŸŸåç”Ÿæ•ˆã€‚</p><h3 id="3-3-ä»£ç å¯¼å…¥"><a href="#3-3-ä»£ç å¯¼å…¥" class="headerlink" title="3.3 ä»£ç å¯¼å…¥"></a>3.3 ä»£ç å¯¼å…¥</h3><p>å¯¼å…¥èµ„æ–™ä¸­çš„å¾®ä¿¡æ”¯ä»˜åŠŸèƒ½ä»£ç å³å¯</p><p><img src="assets/image-20221215192120424.png" alt="image-20221215192120424" style="zoom:50%"></p><h4 id="3-3-1-å¾®ä¿¡æ”¯ä»˜ç›¸å…³é…ç½®"><a href="#3-3-1-å¾®ä¿¡æ”¯ä»˜ç›¸å…³é…ç½®" class="headerlink" title="3.3.1 å¾®ä¿¡æ”¯ä»˜ç›¸å…³é…ç½®"></a>3.3.1 å¾®ä¿¡æ”¯ä»˜ç›¸å…³é…ç½®</h4><p>application-dev.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">wxcd2e39f677fd30ba</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">84fbfdf5ea288f0c432d829599083637</span></span><br><span class="line">    <span class="attr">mchid :</span> <span class="number">1561414331</span></span><br><span class="line">    <span class="attr">mchSerialNo:</span> <span class="string">4B3B3DC35414AD50B1B755BAF8DE9CC7CF407606</span></span><br><span class="line">    <span class="attr">privateKeyFilePath:</span> <span class="string">D:\apiclient_key.pem</span></span><br><span class="line">    <span class="attr">apiV3Key:</span> <span class="string">CZBK51236435wxpay435434323FFDuv3</span></span><br><span class="line">    <span class="attr">weChatPayCertFilePath:</span> <span class="string">D:\wechatpay_166D96F876F45C7D07CE98952A96EC980368ACFC.pem</span></span><br><span class="line">    <span class="attr">notifyUrl:</span> <span class="string">https://www.weixin.qq.com/wxpay/pay.php</span></span><br><span class="line">    <span class="attr">refundNotifyUrl:</span> <span class="string">https://www.weixin.qq.com/wxpay/pay.php</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">$&#123;sky.wechat.appid&#125;</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">$&#123;sky.wechat.secret&#125;</span></span><br><span class="line">    <span class="attr">mchid :</span> <span class="string">$&#123;sky.wechat.mchid&#125;</span></span><br><span class="line">    <span class="attr">mchSerialNo:</span> <span class="string">$&#123;sky.wechat.mchSerialNo&#125;</span></span><br><span class="line">    <span class="attr">privateKeyFilePath:</span> <span class="string">$&#123;sky.wechat.privateKeyFilePath&#125;</span></span><br><span class="line">    <span class="attr">apiV3Key:</span> <span class="string">$&#123;sky.wechat.apiV3Key&#125;</span></span><br><span class="line">    <span class="attr">weChatPayCertFilePath:</span> <span class="string">$&#123;sky.wechat.weChatPayCertFilePath&#125;</span></span><br><span class="line">    <span class="attr">notifyUrl:</span> <span class="string">$&#123;sky.wechat.notifyUrl&#125;</span></span><br><span class="line">    <span class="attr">refundNotifyUrl:</span> <span class="string">$&#123;sky.wechat.refundNotifyUrl&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>WeChatProperties.javaï¼šè¯»å–é…ç½®(å·²å®šä¹‰)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sky.wechat&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeChatProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String appid; <span class="comment">//å°ç¨‹åºçš„appid</span></span><br><span class="line">    <span class="keyword">private</span> String secret; <span class="comment">//å°ç¨‹åºçš„ç§˜é’¥</span></span><br><span class="line">    <span class="keyword">private</span> String mchid; <span class="comment">//å•†æˆ·å·</span></span><br><span class="line">    <span class="keyword">private</span> String mchSerialNo; <span class="comment">//å•†æˆ·APIè¯ä¹¦çš„è¯ä¹¦åºåˆ—å·</span></span><br><span class="line">    <span class="keyword">private</span> String privateKeyFilePath; <span class="comment">//å•†æˆ·ç§é’¥æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> String apiV3Key; <span class="comment">//è¯ä¹¦è§£å¯†çš„å¯†é’¥</span></span><br><span class="line">    <span class="keyword">private</span> String weChatPayCertFilePath; <span class="comment">//å¹³å°è¯ä¹¦</span></span><br><span class="line">    <span class="keyword">private</span> String notifyUrl; <span class="comment">//æ”¯ä»˜æˆåŠŸçš„å›è°ƒåœ°å€</span></span><br><span class="line">    <span class="keyword">private</span> String refundNotifyUrl; <span class="comment">//é€€æ¬¾æˆåŠŸçš„å›è°ƒåœ°å€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-2-Mapperå±‚"><a href="#3-3-2-Mapperå±‚" class="headerlink" title="3.3.2 Mapperå±‚"></a>3.3.2 Mapperå±‚</h4><p><strong>åœ¨OrderMapper.javaä¸­æ·»åŠ getByNumberAndUserIdå’Œupdateä¸¤ä¸ªæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®è®¢å•å·å’Œç”¨æˆ·idæŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> orderNumber</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from orders where number = #&#123;orderNumber&#125; and user_id= #&#123;userId&#125;&quot;)</span></span><br><span class="line">   Orders <span class="title function_">getByNumberAndUserId</span><span class="params">(String orderNumber, Long userId)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¿®æ”¹è®¢å•ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Orders orders)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨OrderMapper.xmlä¸­æ·»åŠ </strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Orders&quot;</span>&gt;</span></span><br><span class="line">        update orders</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cancelReason != null and cancelReason!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                cancel_reason=#&#123;cancelReason&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;rejectionReason != null and rejectionReason!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                rejection_reason=#&#123;rejectionReason&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cancelTime != null&quot;</span>&gt;</span></span><br><span class="line">                cancel_time=#&#123;cancelTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;payStatus != null&quot;</span>&gt;</span></span><br><span class="line">                pay_status=#&#123;payStatus&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;payMethod != null&quot;</span>&gt;</span></span><br><span class="line">                pay_method=#&#123;payMethod&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;checkoutTime != null&quot;</span>&gt;</span></span><br><span class="line">                checkout_time=#&#123;checkoutTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deliveryTime != null&quot;</span>&gt;</span></span><br><span class="line">                delivery_time = #&#123;deliveryTime&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-3-3-Serviceå±‚"><a href="#3-3-3-Serviceå±‚" class="headerlink" title="3.3.3 Serviceå±‚"></a>3.3.3 Serviceå±‚</h4><p><strong>åœ¨OrderService.javaä¸­æ·»åŠ paymentå’ŒpaySuccessä¸¤ä¸ªæ–¹æ³•å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è®¢å•æ”¯ä»˜</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   OrderPaymentVO <span class="title function_">payment</span><span class="params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> outTradeNo</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String outTradeNo)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨OrderServiceImpl.javaä¸­å®ç°paymentå’ŒpaySuccessä¸¤ä¸ªæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> WeChatPayUtil weChatPayUtil;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è®¢å•æ”¯ä»˜</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> OrderPaymentVO <span class="title function_">payment</span><span class="params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(userId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•</span></span><br><span class="line">       <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> weChatPayUtil.pay(</span><br><span class="line">               ordersPaymentDTO.getOrderNumber(), <span class="comment">//å•†æˆ·è®¢å•å·</span></span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>), <span class="comment">//æ”¯ä»˜é‡‘é¢ï¼Œå•ä½ å…ƒ</span></span><br><span class="line">               <span class="string">&quot;è‹ç©¹å¤–å–è®¢å•&quot;</span>, <span class="comment">//å•†å“æè¿°</span></span><br><span class="line">               user.getOpenid() <span class="comment">//å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (jsonObject.getString(<span class="string">&quot;code&quot;</span>) != <span class="literal">null</span> &amp;&amp; jsonObject.getString(<span class="string">&quot;code&quot;</span>).equals(<span class="string">&quot;ORDERPAID&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è¯¥è®¢å•å·²æ”¯ä»˜&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">OrderPaymentVO</span> <span class="variable">vo</span> <span class="operator">=</span> jsonObject.toJavaObject(OrderPaymentVO.class);</span><br><span class="line">       vo.setPackageStr(jsonObject.getString(<span class="string">&quot;package&quot;</span>));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> vo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> outTradeNo</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String outTradeNo)</span> &#123;</span><br><span class="line">       <span class="comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getByNumberAndUserId(outTradeNo, userId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">               .id(ordersDB.getId())</span><br><span class="line">               .status(Orders.TO_BE_CONFIRMED)</span><br><span class="line">               .payStatus(Orders.PAID)</span><br><span class="line">               .checkoutTime(LocalDateTime.now())</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       orderMapper.update(orders);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-4-Controllerå±‚"><a href="#3-3-4-Controllerå±‚" class="headerlink" title="3.3.4 Controllerå±‚"></a>3.3.4 Controllerå±‚</h4><p><strong>åœ¨OrderController.javaä¸­æ·»åŠ paymentæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è®¢å•æ”¯ä»˜</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@PutMapping(&quot;/payment&quot;)</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;è®¢å•æ”¯ä»˜&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Result&lt;OrderPaymentVO&gt; <span class="title function_">payment</span><span class="params">(<span class="meta">@RequestBody</span> OrdersPaymentDTO ordersPaymentDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      log.info(<span class="string">&quot;è®¢å•æ”¯ä»˜ï¼š&#123;&#125;&quot;</span>, ordersPaymentDTO);</span><br><span class="line">      <span class="type">OrderPaymentVO</span> <span class="variable">orderPaymentVO</span> <span class="operator">=</span> orderService.payment(ordersPaymentDTO);</span><br><span class="line">      log.info(<span class="string">&quot;ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼š&#123;&#125;&quot;</span>, orderPaymentVO);</span><br><span class="line">      <span class="keyword">return</span> Result.success(orderPaymentVO);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>PayNotifyController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.notify;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.json.JSONUtils;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.IgnoreToken;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.WeChatProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.wechat.pay.contrib.apache.httpclient.util.AesUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ContentType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ”¯ä»˜å›è°ƒç›¸å…³æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/notify&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayNotifyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WeChatProperties weChatProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¯ä»˜æˆåŠŸå›è°ƒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/paySuccess&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccessNotify</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//è¯»å–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> readData(request);</span><br><span class="line">        log.info(<span class="string">&quot;æ”¯ä»˜æˆåŠŸå›è°ƒï¼š&#123;&#125;&quot;</span>, body);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®è§£å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">plainText</span> <span class="operator">=</span> decryptData(body);</span><br><span class="line">        log.info(<span class="string">&quot;è§£å¯†åçš„æ–‡æœ¬ï¼š&#123;&#125;&quot;</span>, plainText);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(plainText);</span><br><span class="line">        <span class="type">String</span> <span class="variable">outTradeNo</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;out_trade_no&quot;</span>);<span class="comment">//å•†æˆ·å¹³å°è®¢å•å·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">transactionId</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;transaction_id&quot;</span>);<span class="comment">//å¾®ä¿¡æ”¯ä»˜äº¤æ˜“å·</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;å•†æˆ·å¹³å°è®¢å•å·ï¼š&#123;&#125;&quot;</span>, outTradeNo);</span><br><span class="line">        log.info(<span class="string">&quot;å¾®ä¿¡æ”¯ä»˜äº¤æ˜“å·ï¼š&#123;&#125;&quot;</span>, transactionId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸šåŠ¡å¤„ç†ï¼Œä¿®æ”¹è®¢å•çŠ¶æ€ã€æ¥å•æé†’</span></span><br><span class="line">        orderService.paySuccess(outTradeNo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»™å¾®ä¿¡å“åº”</span></span><br><span class="line">        responseToWeixin(response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">readData</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> request.getReader();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                result.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            result.append(line);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è§£å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">decryptData</span><span class="params">(String body)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">resultObject</span> <span class="operator">=</span> JSON.parseObject(body);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">resource</span> <span class="operator">=</span> resultObject.getJSONObject(<span class="string">&quot;resource&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ciphertext</span> <span class="operator">=</span> resource.getString(<span class="string">&quot;ciphertext&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">nonce</span> <span class="operator">=</span> resource.getString(<span class="string">&quot;nonce&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">associatedData</span> <span class="operator">=</span> resource.getString(<span class="string">&quot;associated_data&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">AesUtil</span> <span class="variable">aesUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesUtil</span>(weChatProperties.getApiV3Key().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="comment">//å¯†æ–‡è§£å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">plainText</span> <span class="operator">=</span> aesUtil.decryptToString(associatedData.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">                nonce.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">                ciphertext);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> plainText;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™å¾®ä¿¡å“åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">responseToWeixin</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        response.setStatus(<span class="number">200</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-type&quot;</span>, ContentType.APPLICATION_JSON.toString());</span><br><span class="line">        response.getOutputStream().write(JSONUtils.toJSONString(map).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        response.flushBuffer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-åŠŸèƒ½æµ‹è¯•"><a href="#3-4-åŠŸèƒ½æµ‹è¯•" class="headerlink" title="3.4 åŠŸèƒ½æµ‹è¯•"></a>3.4 åŠŸèƒ½æµ‹è¯•</h3><p>æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¯é€šè¿‡æ–­ç‚¹æ–¹å¼æŸ¥çœ‹åå°æ¯ä¸€æ­¥æ‰§è¡Œæƒ…å†µã€‚</p><p><strong>ä¸‹å•ï¼š</strong></p><p><img src="assets/image-20221215205122716.png" alt="image-20221215205122716" style="zoom:80%"></p><p><strong>å»æ”¯ä»˜ï¼š</strong></p><p><img src="assets/image-20221215205308701.png" alt="image-20221215205308701" style="zoom:80%"></p><p><strong>ç¡®è®¤æ”¯ä»˜ï¼š</strong></p><p><img src="assets/image-20221215205434552.png" alt="image-20221215205434552" style="zoom:80%"></p><p>è¿›è¡Œæ‰«ç æ”¯ä»˜å³å¯ã€‚</p><h3 id="3-5-ä»£ç æäº¤"><a href="#3-5-ä»£ç æäº¤" class="headerlink" title="3.5 ä»£ç æäº¤"></a>3.5 ä»£ç æäº¤</h3><p><img src="assets/image-20221215205746248.png" alt="image-20221215205746248" style="zoom:50%"></p><p>åç»­æ­¥éª¤å’Œå…¶å®ƒåŠŸèƒ½ä»£ç æäº¤ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚</p><h1 id="day09"><a href="#day09" class="headerlink" title="day09"></a>day09</h1><h2 id="ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—"><a href="#ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—" class="headerlink" title="ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—"></a>ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</h2><h3 id="æŸ¥è¯¢å†å²è®¢å•"><a href="#æŸ¥è¯¢å†å²è®¢å•" class="headerlink" title="æŸ¥è¯¢å†å²è®¢å•"></a>æŸ¥è¯¢å†å²è®¢å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-22"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-22" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128092537535.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™</p><ul><li>åˆ†é¡µæŸ¥è¯¢å†å²è®¢å•</li><li>å¯ä»¥æ ¹æ®è®¢å•çŠ¶æ€æŸ¥è¯¢</li><li>å±•ç¤ºè®¢å•æ•°æ®æ—¶ï¼Œéœ€è¦å±•ç¤ºçš„æ•°æ®åŒ…æ‹¬ï¼šä¸‹å•æ—¶é—´ã€è®¢å•çŠ¶æ€ã€è®¢å•é‡‘é¢ã€è®¢å•æ˜ç»†ï¼ˆå•†å“åç§°ã€å›¾ç‰‡ï¼‰</li></ul></div><p>æ¥å£è®¾è®¡ï¼šè¯¦è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128103222657.png"></div></div><p></p><h4 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ pageæ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†å²è®¢å•æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status   è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/historyOrders&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å†å²è®¢å•æŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, Integer status)</span> &#123;</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> orderService.pageQuery4User(page, pageSize, status);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageResult <span class="title function_">pageQuery4User</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, Integer status)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨OrderServiceImplä¸­å®ç°è¯¥æ–¹æ³•<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery4User</span><span class="params">(<span class="type">int</span> pageNum, <span class="type">int</span> pageSize, Integer status)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®åˆ†é¡µ</span></span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="type">OrdersPageQueryDTO</span> <span class="variable">ordersPageQueryDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersPageQueryDTO</span>();</span><br><span class="line">        ordersPageQueryDTO.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        ordersPageQueryDTO.setStatus(status);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†é¡µæ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line">        Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);</span><br><span class="line"></span><br><span class="line">        List&lt;OrderVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å‡ºè®¢å•æ˜ç»†ï¼Œå¹¶å°è£…å…¥OrderVOè¿›è¡Œå“åº”</span></span><br><span class="line">        <span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.getTotal() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders orders : page) &#123;</span><br><span class="line">                <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> orders.getId();<span class="comment">// è®¢å•id</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// æŸ¥è¯¢è®¢å•æ˜ç»†</span></span><br><span class="line">                List&lt;OrderDetail&gt; orderDetails = orderDetailMapper.getByOrderId(orderId);</span><br><span class="line"></span><br><span class="line">                <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">                BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">                orderVO.setOrderDetailList(orderDetails);</span><br><span class="line"></span><br><span class="line">                list.add(orderVO);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>Mapperå±‚</strong></p><p>åœ¨OrderMapperä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæ¡ä»¶æŸ¥è¯¢å¹¶æŒ‰ä¸‹å•æ—¶é—´æ’åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Page&lt;Orders&gt; <span class="title function_">pageQuery</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ SQLè¯­å¥<p></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Orders&quot;</span>&gt;</span></span><br><span class="line">       select * from orders</span><br><span class="line">       <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;number != null and number!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and number like concat(&#x27;%&#x27;,#&#123;number&#125;,&#x27;%&#x27;)</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null and phone!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and phone like concat(&#x27;%&#x27;,#&#123;phone&#125;,&#x27;%&#x27;)</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userId != null&quot;</span>&gt;</span></span><br><span class="line">               and user_id = #&#123;userId&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">               and status = #&#123;status&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;beginTime != null&quot;</span>&gt;</span></span><br><span class="line">               and order_time <span class="symbol">&amp;gt;</span>= #&#123;beginTime&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endTime != null&quot;</span>&gt;</span></span><br><span class="line">               and order_time <span class="symbol">&amp;lt;</span>= #&#123;endTime&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">       order by order_time desc</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨OrderDetailMapperä¸­æ·»åŠ æ–¹æ³•ï¼š<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•æ˜ç»†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from order_detail where order_id = #&#123;orderId&#125;&quot;)</span></span><br><span class="line">List&lt;OrderDetail&gt; <span class="title function_">getByOrderId</span><span class="params">(Long orderId)</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="æŸ¥è¯¢è®¢å•è¯¦æƒ…"><a href="#æŸ¥è¯¢è®¢å•è¯¦æƒ…" class="headerlink" title="æŸ¥è¯¢è®¢å•è¯¦æƒ…"></a>æŸ¥è¯¢è®¢å•è¯¦æƒ…</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-23"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-23" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128102144294.png"></div></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128142142811.png"></div></div><p></p><h4 id="ä»£ç å®ç°-6"><a href="#ä»£ç å®ç°-6" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/orderDetail/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderVO&gt; <span class="title function_">details</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderService.details(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">OrderVO <span class="title function_">details</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨OrderServiceImplä¸­å®ç°è¯¥æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> OrderVO <span class="title function_">details</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è¯¥è®¢å•å¯¹åº”çš„èœå“/å¥—é¤æ˜ç»†</span></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è¯¥è®¢å•åŠå…¶è¯¦æƒ…å°è£…åˆ°OrderVOå¹¶è¿”å›</span></span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">    orderVO.setOrderDetailList(orderDetailList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orderVO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br><strong>Mapperå±‚</strong><br>åœ¨OrderMapperä¸­æ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from orders where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">Orders <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="å–æ¶ˆè®¢å•"><a href="#å–æ¶ˆè®¢å•" class="headerlink" title="å–æ¶ˆè®¢å•"></a>å–æ¶ˆè®¢å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-24"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-24" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128145444268.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å¾…æ”¯ä»˜å’Œå¾…æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å¯ç›´æ¥å–æ¶ˆè®¢å•</li><li>å•†å®¶å·²æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å–æ¶ˆè®¢å•éœ€ç”µè¯æ²Ÿé€šå•†å®¶</li><li>æ´¾é€ä¸­çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å–æ¶ˆè®¢å•éœ€ç”µè¯æ²Ÿé€šå•†å®¶</li><li>å¦‚æœåœ¨å¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆè®¢å•ï¼Œéœ€è¦ç»™ç”¨æˆ·é€€æ¬¾</li><li>å–æ¶ˆè®¢å•åéœ€è¦å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128164410852.png"></div></div><p></p><h4 id="ä»£ç å®ç°-7"><a href="#ä»£ç å®ç°-7" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/cancel/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cancel</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    orderService.userCancelById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚</strong></p><p>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">userCancelById</span><span class="params">(Long id)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨OrderServiceImplä¸­å®ç°è¯¥æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç”¨æˆ·å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userCancelById</span><span class="params">(Long id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">       <span class="keyword">if</span> (ordersDB == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</span></span><br><span class="line">       <span class="keyword">if</span> (ordersDB.getStatus() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">       orders.setId(ordersDB.getId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// è®¢å•å¤„äºå¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆï¼Œéœ€è¦è¿›è¡Œé€€æ¬¾</span></span><br><span class="line">       <span class="keyword">if</span> (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;</span><br><span class="line">           <span class="comment">// //è°ƒç”¨å¾®ä¿¡æ”¯ä»˜é€€æ¬¾æ¥å£</span></span><br><span class="line">           <span class="comment">// weChatPayUtil.refund(</span></span><br><span class="line">           <span class="comment">//         ordersDB.getNumber(), //å•†æˆ·è®¢å•å·</span></span><br><span class="line">           <span class="comment">//         ordersDB.getNumber(), //å•†æˆ·é€€æ¬¾å•å·</span></span><br><span class="line">           <span class="comment">//         new BigDecimal(0.01),//é€€æ¬¾é‡‘é¢ï¼Œå•ä½ å…ƒ</span></span><br><span class="line">           <span class="comment">//         new BigDecimal(0.01));//åŸè®¢å•é‡‘é¢</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">//æ”¯ä»˜çŠ¶æ€ä¿®æ”¹ä¸º é€€æ¬¾</span></span><br><span class="line">           orders.setPayStatus(Orders.REFUND);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´</span></span><br><span class="line">       orders.setStatus(Orders.CANCELLED);</span><br><span class="line">       orders.setCancelReason(<span class="string">&quot;ç”¨æˆ·å–æ¶ˆ&quot;</span>);</span><br><span class="line">       orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">       orderMapper.update(orders);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="å†æ¥ä¸€å•"><a href="#å†æ¥ä¸€å•" class="headerlink" title="å†æ¥ä¸€å•"></a>å†æ¥ä¸€å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-25"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-25" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><p>åœ¨å†å²è®¢å•è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»å†æ¥ä¸€å•åä¼šå°†è®¢å•æ•°æ®æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ï¼Œå¹¶è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢ã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128173238656.png"></div></div><p></p><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221128173350467.png"></div></div><p></p><h4 id="ä»£ç å®ç°-8"><a href="#ä»£ç å®ç°-8" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†æ¥ä¸€å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/repetition/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å†æ¥ä¸€å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">repetition</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    orderService.repetition(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†æ¥ä¸€å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">repetition</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å†æ¥ä¸€å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">repetition</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">       <span class="comment">// æŸ¥è¯¢å½“å‰ç”¨æˆ·id</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•idæŸ¥è¯¢å½“å‰è®¢å•è¯¦æƒ…</span></span><br><span class="line">       List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(id);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å°†è®¢å•è¯¦æƒ…å¯¹è±¡è½¬æ¢ä¸ºè´­ç‰©è½¦å¯¹è±¡</span></span><br><span class="line">       List&lt;ShoppingCart&gt; shoppingCartList = orderDetailList.stream().map(x -&gt; &#123;</span><br><span class="line">           <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line"></span><br><span class="line">           <span class="comment">// å°†åŸè®¢å•è¯¦æƒ…é‡Œé¢çš„èœå“ä¿¡æ¯é‡æ–°å¤åˆ¶åˆ°è´­ç‰©è½¦å¯¹è±¡ä¸­</span></span><br><span class="line">           BeanUtils.copyProperties(x, shoppingCart, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">           shoppingCart.setUserId(userId);</span><br><span class="line">           shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> shoppingCart;</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å°†è´­ç‰©è½¦å¯¹è±¡æ‰¹é‡æ·»åŠ åˆ°æ•°æ®åº“</span></span><br><span class="line">       shoppingCartMapper.insertBatch(shoppingCartList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><br><strong>Mapperå±‚</strong><br>åœ¨ShoppingCartMapperä¸­æ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡æ’å…¥è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shoppingCartList</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(List&lt;ShoppingCart&gt; shoppingCartList)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨ShoppingCartMapperçš„æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„SQLè¯­å¥<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        insert into shopping_cart</span><br><span class="line">        (name, image, user_id, dish_id, setmeal_id, dish_flavor, number, amount, create_time)</span><br><span class="line">        values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;shoppingCartList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;sc&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;sc.name&#125;,#&#123;sc.image&#125;,#&#123;sc.userId&#125;,#&#123;sc.dishId&#125;,#&#123;sc.setmealId&#125;,#&#123;sc.dishFlavor&#125;,#&#123;sc.number&#125;,#&#123;sc.amount&#125;,#&#123;sc.createTime&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h2 id="å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—"><a href="#å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—" class="headerlink" title="å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—"></a>å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—</h2><h3 id="è®¢å•æœç´¢"><a href="#è®¢å•æœç´¢" class="headerlink" title="è®¢å•æœç´¢"></a>è®¢å•æœç´¢</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-26"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-26" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="tabs" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#è®¢å•æœç´¢éœ€æ±‚åˆ†æ-1">å…¨éƒ¨è®¢å•</button></li><li class="tab"><button type="button" data-href="#è®¢å•æœç´¢éœ€æ±‚åˆ†æ-2">å¾…æ¥å•</button></li><li class="tab"><button type="button" data-href="#è®¢å•æœç´¢éœ€æ±‚åˆ†æ-3">å¾…æ´¾é€</button></li><li class="tab"><button type="button" data-href="#è®¢å•æœç´¢éœ€æ±‚åˆ†æ-4">æ´¾é€ä¸­</button></li><li class="tab"><button type="button" data-href="#è®¢å•æœç´¢éœ€æ±‚åˆ†æ-5">å·²å®Œæˆ</button></li><li class="tab"><button type="button" data-href="#è®¢å•æœç´¢éœ€æ±‚åˆ†æ-6">å·²å–æ¶ˆ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129092023177.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129114035570.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129114054664.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129114116492.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ-5"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129114132956.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è®¢å•æœç´¢éœ€æ±‚åˆ†æ-6"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129114151055.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>è¾“å…¥è®¢å•å·/æ‰‹æœºå·è¿›è¡Œæœç´¢ï¼Œæ”¯æŒæ¨¡ç³Šæœç´¢</li><li>æ ¹æ®è®¢å•çŠ¶æ€è¿›è¡Œç­›é€‰</li><li>ä¸‹å•æ—¶é—´è¿›è¡Œæ—¶é—´ç­›é€‰</li><li>æœç´¢å†…å®¹ä¸ºç©ºï¼Œæç¤ºæœªæ‰¾åˆ°ç›¸å…³è®¢å•</li><li>æœç´¢ç»“æœé¡µï¼Œå±•ç¤ºåŒ…å«æœç´¢å…³é”®è¯çš„å†…å®¹</li><li>åˆ†é¡µå±•ç¤ºæœç´¢åˆ°çš„è®¢å•æ•°æ®</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129092552620.png"></div></div><p></p><h4 id="ä»£ç å®ç°-9"><a href="#ä»£ç å®ç°-9" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨adminåŒ…ä¸‹åˆ›å»ºOrderController<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•ç®¡ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;adminOrderController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/order&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;è®¢å•ç®¡ç†æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•æœç´¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/conditionSearch&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¢å•æœç´¢&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">conditionSearch</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> orderService.conditionSearch(ordersPageQueryDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¡ä»¶æœç´¢è®¢å•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageResult <span class="title function_">conditionSearch</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><br>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æœç´¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">conditionSearch</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">    PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">    Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éƒ¨åˆ†è®¢å•çŠ¶æ€ï¼Œéœ€è¦é¢å¤–è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œå°†Ordersè½¬åŒ–ä¸ºOrderVO</span></span><br><span class="line">    List&lt;OrderVO&gt; orderVOList = getOrderVOList(page);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), orderVOList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;OrderVO&gt; <span class="title function_">getOrderVOList</span><span class="params">(Page&lt;Orders&gt; page)</span> &#123;</span><br><span class="line">    <span class="comment">// éœ€è¦è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œè‡ªå®šä¹‰OrderVOå“åº”ç»“æœ</span></span><br><span class="line">    List&lt;OrderVO&gt; orderVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    List&lt;Orders&gt; ordersList = page.getResult();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(ordersList)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Orders orders : ordersList) &#123;</span><br><span class="line">            <span class="comment">// å°†å…±åŒå­—æ®µå¤åˆ¶åˆ°OrderVO</span></span><br><span class="line">            <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">            BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">            <span class="type">String</span> <span class="variable">orderDishes</span> <span class="operator">=</span> getOrderDishesStr(orders);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†è®¢å•èœå“ä¿¡æ¯å°è£…åˆ°orderVOä¸­ï¼Œå¹¶æ·»åŠ åˆ°orderVOList</span></span><br><span class="line">            orderVO.setOrderDishes(orderDishes);</span><br><span class="line">            orderVOList.add(orderVO);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> orderVOList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è®¢å•idè·å–èœå“ä¿¡æ¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getOrderDishesStr</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è®¢å•èœå“è¯¦æƒ…ä¿¡æ¯ï¼ˆè®¢å•ä¸­çš„èœå“å’Œæ•°é‡ï¼‰</span></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ¯ä¸€æ¡è®¢å•èœå“ä¿¡æ¯æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼ˆæ ¼å¼ï¼šå®«ä¿é¸¡ä¸*3ï¼›ï¼‰</span></span><br><span class="line">    List&lt;String&gt; orderDishList = orderDetailList.stream().map(x -&gt; &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderDish</span> <span class="operator">=</span> x.getName() + <span class="string">&quot;*&quot;</span> + x.getNumber() + <span class="string">&quot;;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> orderDish;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è¯¥è®¢å•å¯¹åº”çš„æ‰€æœ‰èœå“ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="keyword">return</span> String.join(<span class="string">&quot;&quot;</span>, orderDishList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡"><a href="#å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡" class="headerlink" title="å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡"></a>å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-27"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-27" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129095804419.png"></div></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129095912896.png"></div></div><p></p><h4 id="ä»£ç å®ç°-10"><a href="#ä»£ç å®ç°-10" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨adminåŒ…ä¸‹çš„OrderControllerç±»ä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/statistics&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderStatisticsVO&gt; <span class="title function_">statistics</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">OrderStatisticsVO</span> <span class="variable">orderStatisticsVO</span> <span class="operator">=</span> orderService.statistics();</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderStatisticsVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚</strong></p><p>åœ¨OrderServiceä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">OrderStatisticsVO <span class="title function_">statistics</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> OrderStatisticsVO <span class="title function_">statistics</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®çŠ¶æ€ï¼Œåˆ†åˆ«æŸ¥è¯¢å‡ºå¾…æ¥å•ã€å¾…æ´¾é€ã€æ´¾é€ä¸­çš„è®¢å•æ•°é‡</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">toBeConfirmed</span> <span class="operator">=</span> orderMapper.countStatus(Orders.TO_BE_CONFIRMED);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">confirmed</span> <span class="operator">=</span> orderMapper.countStatus(Orders.CONFIRMED);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">deliveryInProgress</span> <span class="operator">=</span> orderMapper.countStatus(Orders.DELIVERY_IN_PROGRESS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æŸ¥è¯¢å‡ºçš„æ•°æ®å°è£…åˆ°orderStatisticsVOä¸­å“åº”</span></span><br><span class="line">    <span class="type">OrderStatisticsVO</span> <span class="variable">orderStatisticsVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderStatisticsVO</span>();</span><br><span class="line">    orderStatisticsVO.setToBeConfirmed(toBeConfirmed);</span><br><span class="line">    orderStatisticsVO.setConfirmed(confirmed);</span><br><span class="line">    orderStatisticsVO.setDeliveryInProgress(deliveryInProgress);</span><br><span class="line">    <span class="keyword">return</span> orderStatisticsVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Mapperå±‚</strong></p><p>åœ¨OrderMapperä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®çŠ¶æ€ç»Ÿè®¡è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select count(id) from orders where status = #&#123;status&#125;&quot;)</span></span><br><span class="line">Integer <span class="title function_">countStatus</span><span class="params">(Integer status)</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="æŸ¥è¯¢è®¢å•è¯¦æƒ…-1"><a href="#æŸ¥è¯¢è®¢å•è¯¦æƒ…-1" class="headerlink" title="æŸ¥è¯¢è®¢å•è¯¦æƒ…"></a>æŸ¥è¯¢è®¢å•è¯¦æƒ…</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-28"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-28" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><p>äº§å“åŸå‹ï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129101712084.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•åŸºæœ¬ä¿¡æ¯ï¼ˆçŠ¶æ€ã€è®¢å•å·ã€ä¸‹å•æ—¶é—´ã€æ”¶è´§äººã€ç”µè¯ã€æ”¶è´§åœ°å€ã€é‡‘é¢ç­‰ï¼‰</li><li>è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•æ˜ç»†æ•°æ®ï¼ˆå•†å“åç§°ã€æ•°é‡ã€å•ä»·ï¼‰</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129101035374.png"></div></div><p></p><h4 id="ä»£ç å®ç°-11"><a href="#ä»£ç å®ç°-11" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/details/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderVO&gt; <span class="title function_">details</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderService.details(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">OrderVO <span class="title function_">details</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> OrderVO <span class="title function_">details</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è¯¥è®¢å•å¯¹åº”çš„èœå“/å¥—é¤æ˜ç»†</span></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è¯¥è®¢å•åŠå…¶è¯¦æƒ…å°è£…åˆ°OrderVOå¹¶è¿”å›</span></span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">    orderVO.setOrderDetailList(orderDetailList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orderVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>Mapperå±‚</strong><br>åœ¨OrderMapperä¸­æ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from orders where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">Orders <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="æ¥å•"><a href="#æ¥å•" class="headerlink" title="æ¥å•"></a>æ¥å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-29"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-29" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="tabs" id="æ¥å•-éœ€æ±‚åˆ†æ"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ¥å•-éœ€æ±‚åˆ†æ-1">è®¢å•ç®¡ç†</button></li><li class="tab"><button type="button" data-href="#æ¥å•-éœ€æ±‚åˆ†æ-2">é¡µé¢è¯¦æƒ…</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ¥å•-éœ€æ±‚åˆ†æ-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129105142623.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ¥å•-éœ€æ±‚åˆ†æ-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129105116285.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å•†å®¶æ¥å•å…¶å®å°±æ˜¯å°†è®¢å•çš„çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²æ¥å•â€</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129105313172.png"></div></div><p></p><h4 id="ä»£ç å®ç°-12"><a href="#ä»£ç å®ç°-12" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ¥å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">confirm</span><span class="params">(<span class="meta">@RequestBody</span> OrdersConfirmDTO ordersConfirmDTO)</span> &#123;</span><br><span class="line">    orderService.confirm(ordersConfirmDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersConfirmDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(OrdersConfirmDTO ordersConfirmDTO)</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersConfirmDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(OrdersConfirmDTO ordersConfirmDTO)</span> &#123;</span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">            .id(ordersConfirmDTO.getId())</span><br><span class="line">            .status(Orders.CONFIRMED)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="æ‹’å•"><a href="#æ‹’å•" class="headerlink" title="æ‹’å•"></a>æ‹’å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-30"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-30" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="tabs" id="æ‹’å•éœ€æ±‚åˆ†æ"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ‹’å•éœ€æ±‚åˆ†æ-1">è®¢å•ç®¡ç†</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ‹’å•éœ€æ±‚åˆ†æ-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129110358976.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å•†å®¶æ‹’å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€</li><li>åªæœ‰è®¢å•å¤„äºâ€œå¾…æ¥å•â€çŠ¶æ€æ—¶å¯ä»¥æ‰§è¡Œæ‹’å•æ“ä½œ</li><li>å•†å®¶æ‹’å•æ—¶éœ€è¦æŒ‡å®šæ‹’å•åŸå› </li><li>å•†å®¶æ‹’å•æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®Œæˆäº†æ”¯ä»˜ï¼Œéœ€è¦ä¸ºç”¨æˆ·é€€æ¬¾</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129110725031.png"></div></div><p></p><h4 id="ä»£ç å®ç°-13"><a href="#ä»£ç å®ç°-13" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨DishControllerä¸­åˆ›å»ºæ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹’å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/rejection&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ‹’å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">rejection</span><span class="params">(<span class="meta">@RequestBody</span> OrdersRejectionDTO ordersRejectionDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    orderService.rejection(ordersRejectionDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹’å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersRejectionDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">rejection</span><span class="params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure><p>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ‹’å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ordersRejectionDTO</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejection</span><span class="params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(ordersRejectionDTO.getId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// è®¢å•åªæœ‰å­˜åœ¨ä¸”çŠ¶æ€ä¸º2ï¼ˆå¾…æ¥å•ï¼‰æ‰å¯ä»¥æ‹’å•</span></span><br><span class="line">       <span class="keyword">if</span> (ordersDB == <span class="literal">null</span> || !ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ”¯ä»˜çŠ¶æ€</span></span><br><span class="line">       <span class="type">Integer</span> <span class="variable">payStatus</span> <span class="operator">=</span> ordersDB.getPayStatus();</span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">       <span class="keyword">if</span> (payStatus == Orders.PAID) &#123;</span><br><span class="line">           <span class="comment">//ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾</span></span><br><span class="line">           <span class="comment">// String refund = weChatPayUtil.refund(</span></span><br><span class="line">           <span class="comment">//         ordersDB.getNumber(),</span></span><br><span class="line">           <span class="comment">//         ordersDB.getNumber(),</span></span><br><span class="line">           <span class="comment">//         new BigDecimal(0.01),</span></span><br><span class="line">           <span class="comment">//         new BigDecimal(0.01));</span></span><br><span class="line">           <span class="comment">// log.info(&quot;ç”³è¯·é€€æ¬¾ï¼š&#123;&#125;&quot;, refund);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           <span class="comment">// æ‹’å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€æ‹’å•åŸå› ã€å–æ¶ˆæ—¶é—´</span></span><br><span class="line">       </span><br><span class="line">       orders.setId(ordersDB.getId());</span><br><span class="line">       orders.setStatus(Orders.CANCELLED);</span><br><span class="line">       orders.setRejectionReason(ordersRejectionDTO.getRejectionReason());</span><br><span class="line">       orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">       orderMapper.update(orders);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="å–æ¶ˆè®¢å•-1"><a href="#å–æ¶ˆè®¢å•-1" class="headerlink" title="å–æ¶ˆè®¢å•"></a>å–æ¶ˆè®¢å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-31"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-31" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><p>äº§å“åŸå‹ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129111402099.png"></div></div><p></p><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å–æ¶ˆè®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€</li><li>å•†å®¶å–æ¶ˆè®¢å•æ—¶éœ€è¦æŒ‡å®šå–æ¶ˆåŸå› </li><li>å•†å®¶å–æ¶ˆè®¢å•æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®Œæˆäº†æ”¯ä»˜ï¼Œéœ€è¦ä¸ºç”¨æˆ·é€€æ¬¾</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129112201836.png"></div></div><p></p><h4 id="ä»£ç å®ç°-14"><a href="#ä»£ç å®ç°-14" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/cancel&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cancel</span><span class="params">(<span class="meta">@RequestBody</span> OrdersCancelDTO ordersCancelDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    orderService.cancel(ordersCancelDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•†å®¶å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersCancelDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure><br>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ordersCancelDTO</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(ordersCancelDTO.getId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// ç®¡ç†ç«¯å–æ¶ˆè®¢å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">       <span class="comment">//æ”¯ä»˜çŠ¶æ€</span></span><br><span class="line">       <span class="type">Integer</span> <span class="variable">payStatus</span> <span class="operator">=</span> ordersDB.getPayStatus();</span><br><span class="line">       <span class="keyword">if</span> (payStatus == <span class="number">1</span>) &#123;</span><br><span class="line">           <span class="comment">//ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾</span></span><br><span class="line">           <span class="comment">// String refund = weChatPayUtil.refund(</span></span><br><span class="line">           <span class="comment">//         ordersDB.getNumber(),</span></span><br><span class="line">           <span class="comment">//         ordersDB.getNumber(),</span></span><br><span class="line">           <span class="comment">//         new BigDecimal(0.01),</span></span><br><span class="line">           <span class="comment">//         new BigDecimal(0.01));</span></span><br><span class="line">           <span class="comment">// log.info(&quot;ç”³è¯·é€€æ¬¾ï¼š&#123;&#125;&quot;, refund);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           orders.setId(ordersCancelDTO.getId());</span><br><span class="line">           orders.setStatus(Orders.CANCELLED);</span><br><span class="line">           orders.setCancelReason(ordersCancelDTO.getCancelReason());</span><br><span class="line">           orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       orderMapper.update(orders);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ´¾é€è®¢å•"><a href="#æ´¾é€è®¢å•" class="headerlink" title="æ´¾é€è®¢å•"></a>æ´¾é€è®¢å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-32"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-32" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><p>äº§å“åŸå‹ï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129113257201.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>æ´¾é€è®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œæ´¾é€ä¸­â€</li><li>åªæœ‰çŠ¶æ€ä¸ºâ€œå¾…æ´¾é€â€çš„è®¢å•å¯ä»¥æ‰§è¡Œæ´¾é€è®¢å•æ“ä½œ</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129113449124.png"></div></div><p></p><h4 id="ä»£ç å®ç°-15"><a href="#ä»£ç å®ç°-15" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ´¾é€è®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/delivery/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ´¾é€è®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delivery</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    orderService.delivery(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ´¾é€è®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">delivery</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ´¾é€è®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delivery</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º3</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span> || !ordersDB.getStatus().equals(Orders.CONFIRMED)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    orders.setId(ordersDB.getId());</span><br><span class="line">    <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºæ´¾é€ä¸­</span></span><br><span class="line">    orders.setStatus(Orders.DELIVERY_IN_PROGRESS);</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="å®Œæˆè®¢å•"><a href="#å®Œæˆè®¢å•" class="headerlink" title="å®Œæˆè®¢å•"></a>å®Œæˆè®¢å•</h3><h4 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-33"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-33" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129112554051.png"></div></div><div class="note info no-icon flat"><p>ä¸šåŠ¡è§„åˆ™ï¼š</p><ul><li>å®Œæˆè®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å®Œæˆâ€</li><li>åªæœ‰çŠ¶æ€ä¸ºâ€œæ´¾é€ä¸­â€çš„è®¢å•å¯ä»¥æ‰§è¡Œè®¢å•å®Œæˆæ“ä½œ</li></ul></div><p>æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221129113622784.png"></div></div><p></p><h4 id="ä»£ç å®ç°-16"><a href="#ä»£ç å®ç°-16" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>Controllerå±‚</strong><br>åœ¨OrderControllerä¸­æ·»åŠ æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®Œæˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/complete/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å®Œæˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">complete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    orderService.complete(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>Serviceå±‚</strong><br>åœ¨OrderServiceä¸­æ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®Œæˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">complete</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨OrderServiceImplä¸­å®ç°æ–¹æ³•<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®Œæˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">complete</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º4</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span> || !ordersDB.getStatus().equals(Orders.DELIVERY_IN_PROGRESS)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    orders.setId(ordersDB.getId());</span><br><span class="line">    <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºå®Œæˆ</span></span><br><span class="line">    orders.setStatus(Orders.COMPLETED);</span><br><span class="line">    orders.setDeliveryTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="æ ¡éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´"><a href="#æ ¡éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´" class="headerlink" title="æ ¡éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´"></a>æ ¡éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</h2><h2 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h2><p>æ³¨å†Œè´¦å·ï¼š<a target="_blank" rel="noopener" href="https://passport.baidu.com/v2/?reg&amp;tt=1671699340600&amp;overseas=&amp;gid=CF954C2-A3D2-417F-9FE6-B0F249ED7E33&amp;tpl=pp&amp;u=https%3A%2F%2Flbsyun.baidu.com%2Findex.php%3Ftitle%3D%E9%A6%96%E9%A1%B5">https://passport.baidu.com/v2/?reg&amp;tt=1671699340600&amp;overseas=&amp;gid=CF954C2-A3D2-417F-9FE6-B0F249ED7E33&amp;tpl=pp&amp;u=https%3A%2F%2Flbsyun.baidu.com%2Findex.php%3Ftitle%3D%E9%A6%96%E9%A1%B5</a></p><p>ç™»å½•ç™¾åº¦åœ°å›¾å¼€æ”¾å¹³å°ï¼š<a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/">https://lbsyun.baidu.com/</a></p><p>è¿›å…¥æ§åˆ¶å°ï¼Œåˆ›å»ºåº”ç”¨ï¼Œè·å–AKï¼š</p><p><img src="assets/image-20221222170049729.png" alt="image-20221222170049729"></p><p><img src="assets/image-20221222170256927.png" alt="image-20221222170256927"></p><p>ç›¸å…³æ¥å£:</p><p><a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding">https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding</a></p><p><a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/index.php?title=webapi/directionlite-v1">https://lbsyun.baidu.com/index.php?title=webapi/directionlite-v1</a></p><h2 id="2-ä»£ç å¼€å‘"><a href="#2-ä»£ç å¼€å‘" class="headerlink" title="2. ä»£ç å¼€å‘"></a>2. ä»£ç å¼€å‘</h2><h3 id="2-1-application-yml"><a href="#2-1-application-yml" class="headerlink" title="2.1 application.yml"></a>2.1 application.yml</h3><p>é…ç½®å¤–å–å•†å®¶åº—é“ºåœ°å€å’Œç™¾åº¦åœ°å›¾çš„AKï¼š</p><p><img src="assets/image-20221222170819582.png" alt="image-20221222170819582"></p><h3 id="2-2-OrderServiceImpl"><a href="#2-2-OrderServiceImpl" class="headerlink" title="2.2 OrderServiceImpl"></a>2.2 OrderServiceImpl</h3><p>æ”¹é€ OrderServiceImplï¼Œæ³¨å…¥ä¸Šé¢çš„é…ç½®é¡¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;sky.shop.address&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String shopAddress;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;sky.baidu.ak&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String ak;</span><br></pre></td></tr></table></figure><p>åœ¨OrderServiceImplä¸­æä¾›æ ¡éªŒæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥å®¢æˆ·çš„æ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkOutOfRange</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;address&quot;</span>,shopAddress);</span><br><span class="line">        map.put(<span class="string">&quot;output&quot;</span>,<span class="string">&quot;json&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;ak&quot;</span>,ak);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–åº—é“ºçš„ç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopCoordinate</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/geocoding/v3&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(shopCoordinate);</span><br><span class="line">        <span class="keyword">if</span>(!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;åº—é“ºåœ°å€è§£æå¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®è§£æ</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">location</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>).getJSONObject(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lat</span> <span class="operator">=</span> location.getString(<span class="string">&quot;lat&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lng</span> <span class="operator">=</span> location.getString(<span class="string">&quot;lng&quot;</span>);</span><br><span class="line">        <span class="comment">//åº—é“ºç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopLngLat</span> <span class="operator">=</span> lat + <span class="string">&quot;,&quot;</span> + lng;</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;address&quot;</span>,address);</span><br><span class="line">        <span class="comment">//è·å–ç”¨æˆ·æ”¶è´§åœ°å€çš„ç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userCoordinate</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/geocoding/v3&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">        jsonObject = JSON.parseObject(userCoordinate);</span><br><span class="line">        <span class="keyword">if</span>(!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;æ”¶è´§åœ°å€è§£æå¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®è§£æ</span></span><br><span class="line">        location = jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>).getJSONObject(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">        lat = location.getString(<span class="string">&quot;lat&quot;</span>);</span><br><span class="line">        lng = location.getString(<span class="string">&quot;lng&quot;</span>);</span><br><span class="line">        <span class="comment">//ç”¨æˆ·æ”¶è´§åœ°å€ç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userLngLat</span> <span class="operator">=</span> lat + <span class="string">&quot;,&quot;</span> + lng;</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;origin&quot;</span>,shopLngLat);</span><br><span class="line">        map.put(<span class="string">&quot;destination&quot;</span>,userLngLat);</span><br><span class="line">        map.put(<span class="string">&quot;steps_info&quot;</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·¯çº¿è§„åˆ’</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/directionlite/v1/driving&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">        jsonObject = JSON.parseObject(json);</span><br><span class="line">        <span class="keyword">if</span>(!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;é…é€è·¯çº¿è§„åˆ’å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®è§£æ</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">result</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> (JSONArray) result.get(<span class="string">&quot;routes&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">distance</span> <span class="operator">=</span> (Integer) ((JSONObject) jsonArray.get(<span class="number">0</span>)).get(<span class="string">&quot;distance&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(distance &gt; <span class="number">5000</span>)&#123;</span><br><span class="line">            <span class="comment">//é…é€è·ç¦»è¶…è¿‡5000ç±³</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è¶…å‡ºé…é€èŒƒå›´&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨OrderServiceImplçš„submitOrderæ–¹æ³•ä¸­è°ƒç”¨ä¸Šé¢çš„æ ¡éªŒæ–¹æ³•ï¼š</p><p><img src="assets/image-20221222171444981.png" alt="image-20221222171444981"></p><h1 id="day10"><a href="#day10" class="headerlink" title="day10"></a>day10</h1><h2 id="è¯¾ç¨‹å†…å®¹-5"><a href="#è¯¾ç¨‹å†…å®¹-5" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>Spring Task</li><li>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</li><li>WebSocket</li><li>æ¥å•æé†’</li><li>å®¢æˆ·å‚¬å•</li></ul><p>åŠŸèƒ½å®ç°ï¼š<strong>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</strong>ã€<strong>æ¥å•æé†’</strong>å’Œ<strong>å®¢æˆ·å‚¬å•</strong></p><p><strong>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218204021760.png"></div></div><p></p><p><strong>æ¥å•æé†’</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218204119663.png"></div></div><p></p><p><strong>å®¢æˆ·å‚¬å•ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218204202847.png"></div></div><p></p><h2 id="Spring-Task"><a href="#Spring-Task" class="headerlink" title="Spring Task"></a>Spring Task</h2><h3 id="ä»‹ç»-4"><a href="#ä»‹ç»-4" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>Spring Task</code> æ˜¯Springæ¡†æ¶æä¾›çš„<code>ä»»åŠ¡è°ƒåº¦å·¥å…·</code>ï¼Œå¯ä»¥æŒ‰ç…§çº¦å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŸä¸ªä»£ç é€»è¾‘ã€‚</p><p><strong>å®šä½ï¼š</strong> å®šæ—¶ä»»åŠ¡æ¡†æ¶<br><strong>ä½œç”¨ï¼š</strong> å®šæ—¶è‡ªåŠ¨æ‰§è¡ŒæŸæ®µJavaä»£ç </p><p>Javaç¨‹åºä¸­ä½¿ç”¨SpringTaskçš„å‡ ä¸ªåº”ç”¨åœºæ™¯ï¼š<br></p><div class="tabs" id="springtask"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#springtask-1">ä¿¡ç”¨å¡æ¯æœˆè¿˜æ¬¾æé†’</button></li><li class="tab"><button type="button" data-href="#springtask-2">é“¶è¡Œè´·æ¬¾æ¯æœˆè¿˜æ¬¾æé†’</button></li><li class="tab"><button type="button" data-href="#springtask-3">ç«è½¦ç¥¨å”®ç¥¨ç³»ç»Ÿå¤„ç†æœªæ”¯ä»˜è®¢å•</button></li><li class="tab"><button type="button" data-href="#springtask-4">å…¥èŒçºªå¿µæ—¥ä¸ºç”¨æˆ·å‘é€é€šçŸ¥</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="springtask-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218183213088.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springtask-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218183410430.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springtask-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218183614351.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="springtask-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218183655186.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p></p><div class="note warning no-icon flat"><p><strong>åªè¦æ˜¯ä»»ä½•éœ€è¦å®šæ—¶å¤„ç†çš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨SpringTask</strong></p></div><h3 id="cronè¡¨è¾¾å¼"><a href="#cronè¡¨è¾¾å¼" class="headerlink" title="cronè¡¨è¾¾å¼"></a>cronè¡¨è¾¾å¼</h3><p><strong>cronè¡¨è¾¾å¼</strong> å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡cronè¡¨è¾¾å¼å¯ä»¥<strong>å®šä¹‰ä»»åŠ¡è§¦å‘çš„æ—¶é—´</strong></p><p><strong>æ„æˆè§„åˆ™ï¼š</strong> åˆ†ä¸º6æˆ–7ä¸ªåŸŸï¼Œç”±ç©ºæ ¼åˆ†éš”å¼€ï¼Œæ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰</p><p>æ¯ä¸ªåŸŸçš„å«ä¹‰åˆ†åˆ«ä¸ºï¼šç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€å‘¨ã€å¹´(å¯é€‰)</p><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>2022å¹´10æœˆ12æ—¥ä¸Šåˆ9ç‚¹æ•´ å¯¹åº”çš„cronè¡¨è¾¾å¼ä¸ºï¼š<strong>0 0 9 12 10 ? 2022</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218184412491.png"></div></div><div class="note warning no-icon flat"><p><strong>è¯´æ˜ï¼š</strong> ä¸€èˆ¬<strong>æ—¥</strong>å’Œ<strong>å‘¨</strong>çš„å€¼ä¸åŒæ—¶è®¾ç½®ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾ç½®ï¼Œå¦ä¸€ä¸ªç”¨ï¼Ÿè¡¨ç¤ºã€‚</p></div><p><strong>æ¯”å¦‚ï¼š</strong> æè¿°2æœˆä»½çš„æœ€åä¸€å¤©ï¼Œæœ€åä¸€å¤©å…·ä½“æ˜¯å‡ å·å‘¢ï¼Ÿå¯èƒ½æ˜¯28å·ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯29å·ï¼Œæ­¤æ—¶å°±ä¸èƒ½å†™å…·ä½“æ•°å­—ã€‚å¯ä»¥é€šè¿‡ä¸€äº›ç‰¹æ®Šå­—ç¬¦æ¥æè¿°è¿™äº›ä¿¡æ¯ã€‚è¿™äº›å…·ä½“çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å°±ä¸ç”¨è‡ªå·±å»æ‰‹å†™ï¼Œå› ä¸ºcronè¡¨è¾¾å¼æœ‰è®¸å¤šåœ¨çº¿ç”Ÿæˆå™¨ã€‚</p><p>cronè¡¨è¾¾å¼åœ¨çº¿ç”Ÿæˆå™¨ï¼š<a target="_blank" rel="noopener" href="https://cron.qqe2.com/">https://cron.qqe2.com/</a></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218184959888.png"></div></div><div class="note info no-icon flat"><p>ç›´æ¥è¾“å…¥è‡ªå·±çš„éœ€æ±‚å°±èƒ½å¤Ÿç”Ÿæˆç›¸åº”çš„cronè¡¨è¾¾å¼ï¼Œå› æ­¤ä¸€èˆ¬ä¸ç”¨è‡ªå·±å»å†™cronè¡¨è¾¾å¼ï¼Œç®€å•äº†è§£å³å¯ã€‚</p></div><p><strong>é€šé…ç¬¦ï¼š</strong></p><ul><li><p><code>\*</code> è¡¨ç¤ºæ‰€æœ‰å€¼ï¼›</p></li><li><p><code>?</code> è¡¨ç¤ºæœªè¯´æ˜çš„å€¼ï¼Œå³ä¸å…³å¿ƒå®ƒä¸ºä½•å€¼ï¼›</p></li><li><p><code>-</code> è¡¨ç¤ºä¸€ä¸ªæŒ‡å®šçš„èŒƒå›´ï¼›</p></li><li><p><code>,</code> è¡¨ç¤ºé™„åŠ ä¸€ä¸ªå¯èƒ½å€¼ï¼›</p></li><li><p><code>/</code> ç¬¦å·å‰è¡¨ç¤ºå¼€å§‹æ—¶é—´ï¼Œç¬¦å·åè¡¨ç¤ºæ¯æ¬¡é€’å¢çš„å€¼ï¼›</p></li></ul><p><strong>cronè¡¨è¾¾å¼æ¡ˆä¾‹ï¼š</strong></p><ul><li><p><em>/5</em><em></em> * ? æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡</p></li><li><p>0 <em>/1</em><em></em> ? æ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</p></li><li><p>0 0 5-15<em></em> ? æ¯å¤©5-15ç‚¹æ•´ç‚¹è§¦å‘</p></li><li><p>0 0/3<em></em> * ? æ¯ä¸‰åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</p></li><li><p>0 0-5 14<em></em> ? åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:05æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘</p></li><li><p>0 0/5 14<em></em> ? åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘</p></li><li><p>0 0/5 14,18<em></em> ? åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:55æœŸé—´å’Œä¸‹åˆ6ç‚¹åˆ°6:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘</p></li><li><p>0 0/30 9-17<em></em> ? æœä¹æ™šäº”å·¥ä½œæ—¶é—´å†…æ¯åŠå°æ—¶</p></li><li><p>0 0 10,14,16<em></em> ? æ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œä¸‹åˆ2ç‚¹ï¼Œ4ç‚¹</p></li></ul><h3 id="å…¥é—¨æ¡ˆä¾‹-2"><a href="#å…¥é—¨æ¡ˆä¾‹-2" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><h4 id="Spring-Taskä½¿ç”¨æ­¥éª¤"><a href="#Spring-Taskä½¿ç”¨æ­¥éª¤" class="headerlink" title="Spring Taskä½¿ç”¨æ­¥éª¤"></a>Spring Taskä½¿ç”¨æ­¥éª¤</h4><ol><li>å¯¼å…¥mavenåæ ‡ spring-contextï¼ˆå·²å­˜åœ¨ï¼‰</li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218193251182.png"></div></div><ol><li><p>å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ <code>@EnableScheduling</code> å¼€å¯ä»»åŠ¡è°ƒåº¦</p></li><li><p>è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</p></li></ol><h4 id="ä»£ç å¼€å‘-17"><a href="#ä»£ç å¼€å‘-17" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h4><p><strong>ç¼–å†™å®šæ—¶ä»»åŠ¡ç±»ï¼š</strong></p><p>è¿›å…¥sky-serveræ¨¡å—ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šæ—¶ä»»åŠ¡ æ¯éš”5ç§’è§¦å‘ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeTask</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼š&#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¼€å¯ä»»åŠ¡è°ƒåº¦ï¼š</strong></p><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ <code>@EnableScheduling</code>æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//å¼€å¯æ³¨è§£æ–¹å¼çš„äº‹åŠ¡ç®¡ç†</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SkyApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;server started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½æµ‹è¯•-18"><a href="#åŠŸèƒ½æµ‹è¯•-18" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h4><p>å¯åŠ¨æœåŠ¡ï¼ŒæŸ¥çœ‹æ—¥å¿—</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116201714.png"></div></div><p>ä»»åŠ¡æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ã€‚</p><h2 id="è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"><a href="#è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†" class="headerlink" title="è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"></a>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</h2><h3 id="éœ€æ±‚åˆ†æ-3"><a href="#éœ€æ±‚åˆ†æ-3" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ç”¨æˆ·ä¸‹å•åå¯èƒ½å­˜åœ¨çš„æƒ…å†µï¼š</p><ul><li>ä¸‹å•åæœªæ”¯ä»˜ï¼Œè®¢å•ä¸€ç›´å¤„äº<code>å¾…æ”¯ä»˜</code>çŠ¶æ€</li><li>ç”¨æˆ·æ”¶è´§åç®¡ç†ç«¯æœªç‚¹å‡»å®ŒæˆæŒ‰é’®ï¼Œè®¢å•ä¸€ç›´å¤„äº<code>æ´¾é€ä¸­</code>çŠ¶æ€<div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116202523.png"></div></div></li></ul><p>ä¸Šé¢ä¸¤ç§æƒ…å†µéƒ½éœ€è¦é€šè¿‡<strong>å®šæ—¶ä»»åŠ¡</strong>æ¥ä¿®æ”¹è®¢å•çŠ¶æ€ï¼Œå…·ä½“é€»è¾‘ä¸ºï¼š</p><ul><li>é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨æ”¯ä»˜è¶…æ—¶è®¢å•ï¼ˆä¸‹å•åè¶…è¿‡15åˆ†é’Ÿä»æœªæ”¯ä»˜åˆ™åˆ¤å®šä¸ºæ”¯ä»˜è¶…æ—¶è®¢å•ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸º<code>å·²å–æ¶ˆ</code></li><li>é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨<code>æ´¾é€ä¸­</code>çš„è®¢å•ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸º<code>å·²å®Œæˆ</code></li></ul><h3 id="ä»£ç å¼€å‘-18"><a href="#ä»£ç å¼€å‘-18" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><ol><li>è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTaskï¼ˆå¾…å®Œå–„ï¼‰ï¼š<br>æ–°å»ºTaskåŒ…ï¼Œå¹¶åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»<code>OrderTask</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œå®ç°è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processTimeoutOrder</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDeliveryOrder</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li>åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•:</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®çŠ¶æ€å’Œä¸‹å•æ—¶é—´æŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> orderTime</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from orders where status = #&#123;status&#125; and order_time &lt; #&#123;orderTime&#125;&quot;)</span></span><br><span class="line">   List&lt;Orders&gt; <span class="title function_">getByStatusAndOrdertimeLT</span><span class="params">(Integer status, LocalDateTime orderTime)</span>;</span><br></pre></td></tr></table></figure><ol><li>å®Œå–„å®šæ—¶ä»»åŠ¡ç±»çš„<code>processTimeoutOrder</code>æ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processTimeoutOrder</span><span class="params">()</span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">       <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(-<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// select * from orders where status = 1 and order_time &lt; å½“å‰æ—¶é—´-15åˆ†é’Ÿ</span></span><br><span class="line">       List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.PENDING_PAYMENT, time);</span><br><span class="line">       <span class="keyword">if</span>(ordersList != <span class="literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">           ordersList.forEach(order -&gt; &#123;</span><br><span class="line">               order.setStatus(Orders.CANCELLED);</span><br><span class="line">               order.setCancelReason(<span class="string">&quot;æ”¯ä»˜è¶…æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆ&quot;</span>);</span><br><span class="line">               order.setCancelTime(LocalDateTime.now());</span><br><span class="line">               orderMapper.update(order);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol><li>å®Œå–„å®šæ—¶ä»»åŠ¡ç±»çš„processDeliveryOrderæ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDeliveryOrder</span><span class="params">()</span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       <span class="comment">// select * from orders where status = 4 and order_time &lt; å½“å‰æ—¶é—´-1å°æ—¶</span></span><br><span class="line">       <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(-<span class="number">60</span>);</span><br><span class="line">       List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.DELIVERY_IN_PROGRESS, time);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(ordersList != <span class="literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">           ordersList.forEach(order -&gt; &#123;</span><br><span class="line">               order.setStatus(Orders.COMPLETED);</span><br><span class="line">               orderMapper.update(order);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-19"><a href="#åŠŸèƒ½æµ‹è¯•-19" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æŸ¥çœ‹æ§åˆ¶å°sql</li><li>æŸ¥çœ‹æ•°æ®åº“ä¸­æ•°æ®å˜åŒ–</li></ul><p><strong>æ”¯ä»˜è¶…æ—¶çš„è®¢å•æµ‹è¯•ï¼š</strong></p><p><strong>1. æŸ¥çœ‹è®¢å•è¡¨</strong></p><p>æœ‰ä¸€æ¡è®¢å•ï¼ŒçŠ¶æ€ä¸º1ã€‚è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218202334773.png"></div></div><p><strong>2. å¼€å¯å®šæ—¶ä»»åŠ¡</strong></p><p>å¯åŠ¨æœåŠ¡ï¼Œè§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ã€‚å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ä»»åŠ¡æ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218203045089.png"></div></div><p></p><p><strong>3. å†æ¬¡æŸ¥çœ‹è®¢å•è¡¨</strong></p><p>çŠ¶æ€å·²æ›´æ”¹ä¸º6ï¼Œå·²å–æ¶ˆã€‚<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221218203146535.png"></div></div><p></p><p>è¯æ˜å®šæ—¶ä»»åŠ¡å·²ç”Ÿæ•ˆã€‚</p><div class="note warning no-icon flat"><p><strong>å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•ä»»åŠ¡</strong>çš„æµ‹è¯•æ­¥éª¤å’Œä¸Šè¿°ä¸€è‡´ã€‚å¯é€‚å½“ä¿®æ”¹cronè¡¨è¾¾å¼ï¼Œæ”¹å˜ä»»åŠ¡æ‰§è¡Œé¢‘ç‡ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚</p></div><h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><h3 id="ä»‹ç»-5"><a href="#ä»‹ç»-5" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>WebSocket</code> æ˜¯åŸºäº <code>TCP</code> çš„ä¸€ç§æ–°çš„<code>ç½‘ç»œåè®®</code>ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡â€”â€”æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»º<strong>æŒä¹…æ€§</strong>çš„è¿æ¥ï¼Œ å¹¶è¿›è¡Œ<strong>åŒå‘</strong>æ•°æ®ä¼ è¾“ã€‚</p><p><strong>HTTPåè®®å’ŒWebSocketåè®®å¯¹æ¯”ï¼š</strong></p><ul><li>HTTPæ˜¯<strong>çŸ­è¿æ¥</strong></li><li>WebSocketæ˜¯<strong>é•¿è¿æ¥</strong></li><li>HTTPé€šä¿¡æ˜¯<strong>å•å‘</strong>çš„ï¼ŒåŸºäºè¯·æ±‚å“åº”æ¨¡å¼</li><li>WebSocketæ”¯æŒ<strong>åŒå‘</strong>é€šä¿¡</li><li>HTTPå’ŒWebSocketåº•å±‚éƒ½æ˜¯TCPè¿æ¥</li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/20251116203134.png"></div></div><div class="note info no-icon flat"><p><strong>æ€è€ƒï¼š</strong> æ—¢ç„¶WebSocketæ”¯æŒåŒå‘é€šä¿¡ï¼ŒåŠŸèƒ½çœ‹ä¼¼æ¯”HTTPå¼ºå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åŸºäºWebSocketå¼€å‘æ‰€æœ‰çš„ä¸šåŠ¡åŠŸèƒ½ï¼Ÿ</p></div><p><strong>WebSocketç¼ºç‚¹ï¼š</strong></p><ul><li>æœåŠ¡å™¨é•¿æœŸç»´æŠ¤é•¿è¿æ¥éœ€è¦ä¸€å®šçš„æˆæœ¬</li><li>å„ä¸ªæµè§ˆå™¨æ”¯æŒç¨‹åº¦ä¸ä¸€</li><li>WebSocket æ˜¯é•¿è¿æ¥ï¼Œå—ç½‘ç»œé™åˆ¶æ¯”è¾ƒå¤§ï¼Œéœ€è¦å¤„ç†å¥½é‡è¿</li></ul><p><strong>ç»“è®ºï¼š</strong> WebSocketå¹¶ä¸èƒ½å®Œå…¨å–ä»£HTTPï¼Œå®ƒåªé€‚åˆåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ä½¿ç”¨</p><p><strong>WebSocketåº”ç”¨åœºæ™¯ï¼š</strong></p><div class="tabs" id="websocketåº”ç”¨åœºæ™¯"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#websocketåº”ç”¨åœºæ™¯-1">è§†é¢‘å¼¹å¹•</button></li><li class="tab"><button type="button" data-href="#websocketåº”ç”¨åœºæ™¯-2">ç½‘é¡µèŠå¤©</button></li><li class="tab"><button type="button" data-href="#websocketåº”ç”¨åœºæ™¯-3">ä½“è‚²å®å†µæ›´æ–°</button></li><li class="tab"><button type="button" data-href="#websocketåº”ç”¨åœºæ™¯-4">è‚¡ç¥¨åŸºé‡‘æŠ¥ä»·å®æ—¶æ›´æ–°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="websocketåº”ç”¨åœºæ™¯-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222184616570.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="websocketåº”ç”¨åœºæ™¯-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222184641675.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="websocketåº”ç”¨åœºæ™¯-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222184641675.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="websocketåº”ç”¨åœºæ™¯-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222184714092.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="å…¥é—¨æ¡ˆä¾‹-3"><a href="#å…¥é—¨æ¡ˆä¾‹-3" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><h4 id="æ¡ˆä¾‹åˆ†æ"><a href="#æ¡ˆä¾‹åˆ†æ" class="headerlink" title="æ¡ˆä¾‹åˆ†æ"></a>æ¡ˆä¾‹åˆ†æ</h4><p><strong>éœ€æ±‚ï¼š</strong> å®ç°æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ã€‚æµè§ˆå™¨æ—¢å¯ä»¥å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯ã€‚</p><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222190401414.png"></div></div><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><ol><li><p>ç›´æ¥ä½¿ç”¨websocket.htmlé¡µé¢ä½œä¸ºWebSocketå®¢æˆ·ç«¯</p></li><li><p>å¯¼å…¥WebSocketçš„mavenåæ ‡</p></li><li><p>å¯¼å…¥WebSocketæœåŠ¡ç«¯ç»„ä»¶WebSocketServerï¼Œç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡</p></li><li><p>å¯¼å…¥é…ç½®ç±»WebSocketConfigurationï¼Œæ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶</p></li><li><p>å¯¼å…¥å®šæ—¶ä»»åŠ¡ç±»WebSocketTaskï¼Œå®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®</p></li></ol><h4 id="ä»£ç å¼€å‘-19"><a href="#ä»£ç å¼€å‘-19" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h4><ol><li>å®šä¹‰websocket.htmlé¡µé¢(èµ„æ–™ä¸­å·²æä¾›)</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;send()&quot;</span>&gt;</span>å‘é€æ¶ˆæ¯<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;closeWebSocket()&quot;</span>&gt;</span>å…³é—­è¿æ¥<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> websocket = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> clientId = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(<span class="string">&#x27;WebSocket&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//è¿æ¥WebSocketèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">        websocket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080/ws/&quot;</span>+clientId);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&#x27;Not support websocket&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(<span class="string">&quot;error&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(<span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onclose</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(<span class="string">&quot;close&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onbeforeunload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        websocket.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">setMessageInnerHTML</span>(<span class="params">innerHTML</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>).<span class="property">innerHTML</span> += innerHTML + <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> message = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;text&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        websocket.<span class="title function_">send</span>(message);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">	</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//å…³é—­è¿æ¥</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">closeWebSocket</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        websocket.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>å¯¼å…¥mavenåæ ‡</li></ol><p>åœ¨sky-serveræ¨¡å—pom.xmlä¸­å·²å®šä¹‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>å®šä¹‰WebSocketæœåŠ¡ç«¯ç»„ä»¶(èµ„æ–™ä¸­å·²æä¾›)</li></ol><p>ç›´æ¥å¯¼å…¥åˆ°sky-serveræ¨¡å—å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebSocketæœåŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/ws/&#123;sid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜æ”¾ä¼šè¯å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; sessionMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;å»ºç«‹è¿æ¥&quot;</span>);</span><br><span class="line">        sessionMap.put(sid, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;çš„ä¿¡æ¯:&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(<span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥æ–­å¼€:&quot;</span> + sid);</span><br><span class="line">        sessionMap.remove(sid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¾¤å‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToAllClient</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        Collection&lt;Session&gt; sessions = sessionMap.values();</span><br><span class="line">        <span class="keyword">for</span> (Session session : sessions) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">                session.getBasicRemote().sendText(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å®šä¹‰é…ç½®ç±»ï¼Œæ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶(ä»èµ„æ–™ä¸­ç›´æ¥å¯¼å…¥å³å¯)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebSocketé…ç½®ç±»ï¼Œç”¨äºæ³¨å†ŒWebSocketçš„Bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å®šä¹‰å®šæ—¶ä»»åŠ¡ç±»ï¼Œå®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®(ä»èµ„æ–™ä¸­ç›´æ¥å¯¼å…¥å³å¯)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketTask</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebSocketServer webSocketServer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡WebSocketæ¯éš”5ç§’å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessageToClient</span><span class="params">()</span> &#123;</span><br><span class="line">        webSocketServer.sendToAllClient(<span class="string">&quot;è¿™æ˜¯æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼š&quot;</span> + DateTimeFormatter.ofPattern(<span class="string">&quot;HH:mm:ss&quot;</span>).format(LocalDateTime.now()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½æµ‹è¯•-20"><a href="#åŠŸèƒ½æµ‹è¯•-20" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h4><p>å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€websocket.htmlé¡µé¢</p><p><strong>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼š</strong></p><p><img src="assets/image-20221222192759049.png" alt="image-20221222192759049" style="zoom:50%"></p><p><strong>æœåŠ¡å™¨å‘æµè§ˆå™¨é—´éš”5ç§’æ¨é€æ•°æ®ï¼š</strong></p><p><img src="assets/image-20221222192926954.png" alt="image-20221222192926954" style="zoom:50%"></p><h2 id="æ¥å•æé†’"><a href="#æ¥å•æé†’" class="headerlink" title="æ¥å•æé†’"></a>æ¥å•æé†’</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-34"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-34" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç”¨æˆ·ä¸‹å•å¹¶ä¸”æ”¯ä»˜æˆåŠŸåï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><ul><li>è¯­éŸ³æ’­æŠ¥</li><li>å¼¹å‡ºæç¤ºæ¡†</li></ul><div class="note info no-icon flat"><p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p><ul><li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li><li>å½“å®¢æˆ·æ”¯ä»˜åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥</li><li>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent<ul><li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li><li>orderId ä¸ºè®¢å•id</li><li>content ä¸ºæ¶ˆæ¯å†…å®¹</li></ul></li></ul></div><h3 id="ä»£ç å¼€å‘-20"><a href="#ä»£ç å¼€å‘-20" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><p><strong>åœ¨OrderServiceImplä¸­æ³¨å…¥WebSocketServerå¯¹è±¡ï¼Œä¿®æ”¹paySuccessæ–¹æ³•ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> WebSocketServer webSocketServer;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> outTradeNo</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String outTradeNo)</span> &#123;</span><br><span class="line">       <span class="comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getByNumberAndUserId(outTradeNo, userId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">               .id(ordersDB.getId())</span><br><span class="line">               .status(Orders.TO_BE_CONFIRMED)</span><br><span class="line">               .payStatus(Orders.PAID)</span><br><span class="line">               .checkoutTime(LocalDateTime.now())</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       orderMapper.update(orders);</span><br><span class="line">	<span class="comment">//////////////////////////////////////////////</span></span><br><span class="line">       <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">       map.put(<span class="string">&quot;type&quot;</span>, <span class="number">1</span>);<span class="comment">//æ¶ˆæ¯ç±»å‹ï¼Œ1è¡¨ç¤ºæ¥å•æé†’</span></span><br><span class="line">       map.put(<span class="string">&quot;orderId&quot;</span>, orders.getId());</span><br><span class="line">       map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;è®¢å•å·ï¼š&quot;</span> + outTradeNo);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//é€šè¿‡WebSocketå®ç°æ¥å•æé†’ï¼Œå‘å®¢æˆ·ç«¯æµè§ˆå™¨æ¨é€æ¶ˆæ¯</span></span><br><span class="line">       webSocketServer.sendToAllClient(JSON.toJSONString(map));</span><br><span class="line">       <span class="comment">///////////////////////////////////////////////////</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-21"><a href="#åŠŸèƒ½æµ‹è¯•-21" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æŸ¥çœ‹æµè§ˆå™¨è°ƒè¯•å·¥å…·æ•°æ®äº¤äº’è¿‡ç¨‹</li><li>å‰åç«¯è”è°ƒ</li></ul><p><strong>1. ç™»å½•ç®¡ç†ç«¯åå°</strong></p><p>ç™»å½•æˆåŠŸåï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹é•¿è¿æ¥</p><p><img src="assets/image-20221222200842731.png" alt="image-20221222200842731" style="zoom:50%"></p><p>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</p><p><img src="assets/image-20221222200941497.png" alt="image-20221222200941497" style="zoom:50%"></p><p><strong>2. å°ç¨‹åºç«¯ä¸‹å•æ”¯ä»˜</strong></p><p>ä¿®æ”¹å›è°ƒåœ°å€ï¼Œåˆ©ç”¨å†…ç½‘ç©¿é€è·å–åŸŸå</p><p><img src="assets/image-20221222201350616.png" alt="image-20221222201350616" style="zoom:50%"></p><p>ä¸‹å•æ”¯ä»˜</p><p><img src="assets/image-20221222201718622.png" alt="image-20221222201718622" style="zoom:50%"> <img src="assets/image-20221222201754866.png" alt="image-20221222201754866" style="zoom:50%"> <img src="assets/image-20221222201826173.png" alt="image-20221222201826173" style="zoom:50%"> <img src="assets/image-20221222202101677.png" alt="image-20221222202101677" style="zoom:50%"></p><p><strong>3. æŸ¥çœ‹æ¥å•æé†’</strong></p><p>æ”¯ä»˜æˆåŠŸåï¼Œåå°æ”¶åˆ°æ¥å•æé†’ï¼Œå¹¶æœ‰è¯­éŸ³æ’­æŠ¥</p><p><img src="assets/image-20221222202310953.png" alt="image-20221222202310953" style="zoom:50%"></p><h2 id="å®¢æˆ·å‚¬å•"><a href="#å®¢æˆ·å‚¬å•" class="headerlink" title="å®¢æˆ·å‚¬å•"></a>å®¢æˆ·å‚¬å•</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-35"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-35" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><p>ç”¨æˆ·åœ¨å°ç¨‹åºä¸­ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><ul><li>è¯­éŸ³æ’­æŠ¥</li><li>å¼¹å‡ºæç¤ºæ¡†</li></ul><div class="note info no-icon flat"><p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p><ul><li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li><li>å½“ç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥<br>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent<ul><li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li><li>orderId ä¸ºè®¢å•id</li><li>content ä¸ºæ¶ˆæ¯å†…å®¹</li></ul></li></ul></div><p>å½“ç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®æ—¶ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ã€‚</p><p><strong>æ¥å£è®¾è®¡(å‚¬å•)ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222204415339.png"></div></div><p></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222204434174.png"></div></div><h3 id="ä»£ç å¼€å‘-21"><a href="#ä»£ç å¼€å‘-21" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="Controllerå±‚-16"><a href="#Controllerå±‚-16" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®ç”¨æˆ·å‚¬å•çš„æ¥å£å®šä¹‰ï¼Œåœ¨useråŒ…ä¸‹çš„OrderControllerä¸­åˆ›å»ºå‚¬å•æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç”¨æˆ·å‚¬å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/reminder/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;ç”¨æˆ·å‚¬å•&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">reminder</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">       orderService.reminder(id);</span><br><span class="line">       <span class="keyword">return</span> Result.success();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-13"><a href="#Serviceå±‚-13" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åœ¨OrderServiceæ¥å£ä¸­å£°æ˜reminderæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç”¨æˆ·å‚¬å•</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">reminder</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨OrderServiceImplä¸­å®ç°reminderæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç”¨æˆ·å‚¬å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reminder</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">       <span class="comment">// æŸ¥è¯¢è®¢å•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line">       <span class="keyword">if</span> (orders == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//åŸºäºWebSocketå®ç°å‚¬å•</span></span><br><span class="line">       <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">       map.put(<span class="string">&quot;type&quot;</span>, <span class="number">2</span>);<span class="comment">//2ä»£è¡¨ç”¨æˆ·å‚¬å•</span></span><br><span class="line">       map.put(<span class="string">&quot;orderId&quot;</span>, id);</span><br><span class="line">       map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;è®¢å•å·ï¼š&quot;</span> + orders.getNumber());</span><br><span class="line">       webSocketServer.sendToAllClient(JSON.toJSONString(map));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-15"><a href="#Mapperå±‚-15" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨OrderMapperä¸­æ·»åŠ getByIdï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from orders where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">   Orders <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-22"><a href="#åŠŸèƒ½æµ‹è¯•-22" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æŸ¥çœ‹æµè§ˆå™¨è°ƒè¯•å·¥å…·æ•°æ®äº¤äº’è¿‡ç¨‹</li><li>å‰åç«¯è”è°ƒ</li></ul><p><strong>1. ç™»å½•ç®¡ç†ç«¯åå°</strong></p><p>ç™»å½•æˆåŠŸåï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹é•¿è¿æ¥</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222200842731.png"></div></div><p>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222200941497.png"></div></div><p><strong>2. ç”¨æˆ·è¿›è¡Œå‚¬å•</strong></p><p>ç”¨æˆ·å¯åœ¨è®¢å•åˆ—è¡¨æˆ–è€…è®¢å•è¯¦æƒ…ï¼Œè¿›è¡Œå‚¬å•<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222210932942.png"></div></div><p></p><p><strong>3. æŸ¥çœ‹å‚¬å•æé†’</strong></p><p>æ—¢æœ‰å‚¬å•å¼¹çª—ï¼ŒåŒæ—¶è¯­éŸ³æ’­æŠ¥<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20221222211238000.png"></div></div><p></p><h1 id="day11"><a href="#day11" class="headerlink" title="day11"></a>day11</h1><h2 id="è¯¾ç¨‹å†…å®¹-6"><a href="#è¯¾ç¨‹å†…å®¹-6" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>Apache ECharts</li><li>è¥ä¸šé¢ç»Ÿè®¡</li><li>ç”¨æˆ·ç»Ÿè®¡</li><li>è®¢å•ç»Ÿè®¡</li><li>é”€é‡æ’åTop10</li></ul><p>åŠŸèƒ½å®ç°ï¼š<strong>æ•°æ®ç»Ÿè®¡</strong></p><p><strong>æ•°æ®ç»Ÿè®¡æ•ˆæœå›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101152725417.png"></div></div><h2 id="Apache-ECharts"><a href="#Apache-ECharts" class="headerlink" title="Apache ECharts"></a>Apache ECharts</h2><h3 id="ä»‹ç»-6"><a href="#ä»‹ç»-6" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>Apache ECharts</code> æ˜¯ä¸€æ¬¾åŸºäº <code>Javascript</code> çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“ï¼Œæä¾›ç›´è§‚ï¼Œç”ŸåŠ¨ï¼Œå¯äº¤äº’ï¼Œå¯ä¸ªæ€§åŒ–å®šåˆ¶çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨ã€‚<br>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/index.html">https://echarts.apache.org/zh/index.html</a></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101153041348.png"></div></div><p><strong>å¸¸è§æ•ˆæœå±•ç¤ºï¼š</strong></p><div class="tabs" id="apacheecharts"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#apacheecharts-1">æŸ±å½¢å›¾</button></li><li class="tab"><button type="button" data-href="#apacheecharts-2">é¥¼å½¢å›¾</button></li><li class="tab"><button type="button" data-href="#apacheecharts-3">æŠ˜çº¿å›¾</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="apacheecharts-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101153748714.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="apacheecharts-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101153230868.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="apacheecharts-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101153824086.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>æ€»ç»“ï¼š</strong> ä¸ç®¡æ˜¯å“ªç§å½¢å¼çš„å›¾å½¢ï¼Œæœ€æœ¬è´¨çš„ä¸œè¥¿å®é™…ä¸Šæ˜¯æ•°æ®ï¼Œè¿™åªæ˜¯å¯¹æ•°æ®çš„ä¸€ç§å¯è§†åŒ–å±•ç¤ºã€‚</p><h3 id="å…¥é—¨æ¡ˆä¾‹-4"><a href="#å…¥é—¨æ¡ˆä¾‹-4" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><p>Apache Echartså®˜æ–¹æä¾›çš„å¿«é€Ÿå…¥é—¨ï¼š<a target="_blank" rel="noopener" href="https://echarts.apache.org/handbook/zh/get-started/">https://echarts.apache.org/handbook/zh/get-started/</a></p><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101155524477.png"></div></div><p></p><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><ol><li><p>å¼•å…¥echarts.js æ–‡ä»¶(å½“å¤©èµ„æ–™å·²æä¾›)</p></li><li><p>ä¸º ECharts å‡†å¤‡ä¸€ä¸ªè®¾ç½®å®½é«˜çš„ DOM</p></li><li><p>åˆå§‹åŒ–echartså®ä¾‹</p></li><li><p>æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®</p></li><li><p>ä½¿ç”¨æŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨</p></li></ol><p><strong>ä»£ç å¼€å‘ï¼š</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ECharts<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥åˆšåˆšä¸‹è½½çš„ ECharts æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;echarts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸º ECharts å‡†å¤‡ä¸€ä¸ªå®šä¹‰äº†å®½é«˜çš„ DOM --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 600px;height:400px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> option = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">text</span>: <span class="string">&#x27;ECharts å…¥é—¨ç¤ºä¾‹&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">tooltip</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>: [<span class="string">&#x27;é”€é‡&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>: [<span class="string">&#x27;è¡¬è¡«&#x27;</span>, <span class="string">&#x27;ç¾Šæ¯›è¡«&#x27;</span>, <span class="string">&#x27;é›ªçººè¡«&#x27;</span>, <span class="string">&#x27;è£¤å­&#x27;</span>, <span class="string">&#x27;é«˜è·Ÿé‹&#x27;</span>, <span class="string">&#x27;è¢œå­&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">yAxis</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&#x27;é”€é‡&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚</span></span></span><br><span class="line"><span class="language-javascript">      myChart.<span class="title function_">setOption</span>(option);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼š</strong>(å½“å¤©èµ„æ–™ä¸­å·²æä¾›)<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101160244104.png"></div></div><p></p><p>ä½¿ç”¨æµè§ˆå™¨æ–¹å¼æ‰“å¼€å³å¯ã€‚</p><p><strong>æ€»ç»“ï¼š</strong> ä½¿ç”¨Echartsï¼Œé‡ç‚¹åœ¨äºç ”ç©¶å½“å‰å›¾è¡¨æ‰€éœ€çš„æ•°æ®æ ¼å¼ã€‚é€šå¸¸æ˜¯éœ€è¦åç«¯æä¾›ç¬¦åˆæ ¼å¼è¦æ±‚çš„åŠ¨æ€æ•°æ®ï¼Œç„¶åå“åº”ç»™å‰ç«¯æ¥å±•ç¤ºå›¾è¡¨ã€‚</p><h2 id="è¥ä¸šé¢ç»Ÿè®¡"><a href="#è¥ä¸šé¢ç»Ÿè®¡" class="headerlink" title="è¥ä¸šé¢ç»Ÿè®¡"></a>è¥ä¸šé¢ç»Ÿè®¡</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-36"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-36" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-5"><a href="#äº§å“åŸå‹-5" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>è¥ä¸šé¢ç»Ÿè®¡æ˜¯åŸºäº<code>æŠ˜ç°å›¾</code>æ¥å±•ç°ï¼Œå¹¶ä¸”æŒ‰ç…§å¤©æ¥å±•ç¤ºçš„ã€‚å®é™…ä¸Šï¼Œå°±æ˜¯æŸä¸€ä¸ªæ—¶é—´èŒƒå›´ä¹‹å†…çš„æ¯ä¸€å¤©çš„è¥ä¸šé¢ã€‚åŒæ—¶ï¼Œä¸ç®¡å…‰æ ‡æ”¾åœ¨å“ªä¸ªç‚¹ä¸Šï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæŠŠå…·ä½“çš„æ•°å€¼å±•ç¤ºå‡ºæ¥ã€‚å¹¶ä¸”è¿˜éœ€è¦æ³¨æ„æ—¥æœŸå¹¶ä¸æ˜¯å›ºå®šå†™æ­»çš„ï¼Œæ˜¯ç”±ä¸Šè¾¹æ—¶é—´é€‰æ‹©å™¨æ¥å†³å®šã€‚æ¯”å¦‚é€‰æ‹©æ˜¯è¿‘7å¤©ã€æˆ–è€…æ˜¯è¿‘30æ—¥ï¼Œæˆ–è€…æ˜¯æœ¬å‘¨ï¼Œå°±ä¼šæŠŠç›¸åº”è¿™ä¸ªæ—¶é—´æ®µä¹‹å†…çš„æ¯ä¸€å¤©æ—¥æœŸé€šè¿‡æ¨ªåæ ‡å±•ç¤ºã€‚</p><p><strong>åŸå‹å›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101160747433.png"></div></div><div class="note info no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>è¥ä¸šé¢æŒ‡è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆçš„è®¢å•é‡‘é¢åˆè®¡</li><li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè¥ä¸šé¢æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºè¥ä¸šé¢</li><li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„è¥ä¸šé¢æ•°æ®</li></ul></div><h4 id="æ¥å£è®¾è®¡-8"><a href="#æ¥å£è®¾è®¡-8" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>é€šè¿‡ä¸Šè¿°åŸå‹å›¾ï¼Œè®¾è®¡å‡ºå¯¹åº”çš„æ¥å£ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101160801758.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101160812029.png"></div></div><div class="note warning no-icon flat"><p><strong>æ³¨æ„ï¼š</strong> å…·ä½“è¿”å›æ•°æ®ä¸€èˆ¬ç”±å‰ç«¯æ¥å†³å®šï¼Œå‰ç«¯å±•ç¤ºå›¾è¡¨ï¼Œå…·ä½“æŠ˜ç°å›¾å¯¹åº”æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œæ˜¯æœ‰å›ºå®šçš„è¦æ±‚çš„ã€‚æ‰€ä»¥è¯´ï¼Œåç«¯éœ€è¦å»é€‚åº”å‰ç«¯ï¼Œå®ƒéœ€è¦ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±ç»™å®ƒè¿”å›ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ã€‚</p></div><h3 id="ä»£ç å¼€å‘-22"><a href="#ä»£ç å¼€å‘-22" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="VOè®¾è®¡-2"><a href="#VOè®¾è®¡-2" class="headerlink" title="VOè®¾è®¡"></a>VOè®¾è®¡</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰è®¾è®¡å¯¹åº”çš„VOï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230101164058056.png"></div></div><p>åœ¨sky-pojoæ¨¡å—ï¼ŒTurnoverReportVO.javaå·²å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TurnoverReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ—¥æœŸï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2022-10-01,2022-10-02,2022-10-03</span></span><br><span class="line">    <span class="keyword">private</span> String dateList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¥ä¸šé¢ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š406.0,1520.0,75.0</span></span><br><span class="line">    <span class="keyword">private</span> String turnoverList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-17"><a href="#Controllerå±‚-17" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºReportControllerï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ¥è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/report&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;ç»Ÿè®¡æŠ¥è¡¨ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ReportService reportService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¥ä¸šé¢æ•°æ®ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/turnoverStatistics&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è¥ä¸šé¢æ•°æ®ç»Ÿè®¡&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;TurnoverReportVO&gt; <span class="title function_">turnoverStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span></span><br><span class="line"><span class="params">                    LocalDate begin,</span></span><br><span class="line"><span class="params">            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span></span><br><span class="line"><span class="params">                    LocalDate end)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(reportService.getTurnover(begin, end));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-14"><a href="#Serviceå±‚-14" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åˆ›å»ºReportServiceæ¥å£ï¼Œå£°æ˜getTurnoveræ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è¥ä¸šé¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beginTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TurnoverReportVO <span class="title function_">getTurnover</span><span class="params">(LocalDate beginTime, LocalDate endTime)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºReportServiceImplå®ç°ç±»ï¼Œå®ç°getTurnoveræ–¹æ³•:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è¥ä¸šé¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> TurnoverReportVO <span class="title function_">getTurnover</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">        List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        dateList.add(begin);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!begin.equals(end))&#123;</span><br><span class="line">            begin = begin.plusDays(<span class="number">1</span>);<span class="comment">//æ—¥æœŸè®¡ç®—ï¼Œè·å¾—æŒ‡å®šæ—¥æœŸå1å¤©çš„æ—¥æœŸ</span></span><br><span class="line">            dateList.add(begin);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">       List&lt;Double&gt; turnoverList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (LocalDate date : dateList) &#123;</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MIN);</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MAX);</span><br><span class="line">            <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        	map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">        	map.put(<span class="string">&quot;begin&quot;</span>,beginTime);</span><br><span class="line">        	map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">            <span class="type">Double</span> <span class="variable">turnover</span> <span class="operator">=</span> orderMapper.sumByMap(map); </span><br><span class="line">            turnover = turnover == <span class="literal">null</span> ? <span class="number">0.0</span> : turnover;</span><br><span class="line">            turnoverList.add(turnover);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®å°è£…</span></span><br><span class="line">        <span class="keyword">return</span> TurnoverReportVO.builder()</span><br><span class="line">                .dateList(StringUtils.join(dateList,<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .turnoverList(StringUtils.join(turnoverList,<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-16"><a href="#Mapperå±‚-16" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨OrderMapperæ¥å£å£°æ˜sumByMapæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®åŠ¨æ€æ¡ä»¶ç»Ÿè®¡è¥ä¸šé¢</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   Double <span class="title function_">sumByMap</span><span class="params">(Map map)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨OrderMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;sumByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Double&quot;</span>&gt;</span></span><br><span class="line">        select sum(amount) from orders</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                and status = #&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null&quot;</span>&gt;</span></span><br><span class="line">                and order_time <span class="symbol">&amp;gt;</span>= #&#123;begin&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;end != null&quot;</span>&gt;</span></span><br><span class="line">                and order_time <span class="symbol">&amp;lt;</span>= #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-23"><a href="#åŠŸèƒ½æµ‹è¯•-23" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æ¥å£æ–‡æ¡£æµ‹è¯•</li><li>å‰åç«¯è”è°ƒæµ‹è¯•</li></ul><p>å¯åŠ¨æœåŠ¡å™¨ï¼Œå¯åŠ¨nginxï¼Œç›´æ¥é‡‡ç”¨å‰åç«¯è”è°ƒæµ‹è¯•ã€‚</p><p>è¿›å…¥æ•°æ®ç»Ÿè®¡æ¨¡å—</p><p><strong>1. æŸ¥çœ‹è¿‘7æ—¥è¥ä¸šé¢ç»Ÿè®¡</strong></p><p><img src="assets/image-20230101172807757.png" alt="image-20230101172807757" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230101173031357.png" alt="image-20230101173031357" style="zoom:80%"></p><p><strong>2. æŸ¥çœ‹è¿‘30æ—¥è¥ä¸šé¢ç»Ÿè®¡</strong></p><p><img src="assets/image-20230101173201667.png" alt="image-20230101173201667" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230101173304127.png" alt="image-20230101173304127" style="zoom:80%"></p><p>ä¹Ÿå¯é€šè¿‡æ–­ç‚¹æ–¹å¼å¯åŠ¨ï¼ŒæŸ¥çœ‹æ¯æ­¥æ‰§è¡Œæƒ…å†µã€‚</p><h2 id="ç”¨æˆ·ç»Ÿè®¡"><a href="#ç”¨æˆ·ç»Ÿè®¡" class="headerlink" title="ç”¨æˆ·ç»Ÿè®¡"></a>ç”¨æˆ·ç»Ÿè®¡</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-37"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-37" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-6"><a href="#äº§å“åŸå‹-6" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>æ‰€è°“ç”¨æˆ·ç»Ÿè®¡ï¼Œå®é™…ä¸Šç»Ÿè®¡çš„æ˜¯ç”¨æˆ·çš„æ•°é‡ã€‚é€šè¿‡æŠ˜çº¿å›¾æ¥å±•ç¤ºï¼Œä¸Šé¢è¿™æ ¹è“è‰²çº¿ä»£è¡¨çš„æ˜¯ç”¨æˆ·æ€»é‡ï¼Œä¸‹è¾¹è¿™æ ¹ç»¿è‰²çº¿ä»£è¡¨çš„æ˜¯æ–°å¢ç”¨æˆ·æ•°é‡ï¼Œæ˜¯å…·ä½“åˆ°æ¯ä¸€å¤©ã€‚æ‰€ä»¥è¯´ç”¨æˆ·ç»Ÿè®¡ä¸»è¦ç»Ÿè®¡<strong>ä¸¤ä¸ªæ•°æ®</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>æ€»çš„ç”¨æˆ·æ•°é‡</strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯<strong>æ–°å¢ç”¨æˆ·æ•°é‡</strong>ã€‚</p><p><strong>åŸå‹å›¾ï¼š</strong></p><p><img src="assets/image-20230102213727736.png" alt="image-20230102213727736" style="zoom:50%"></p><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºç”¨æˆ·æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºç”¨æˆ·æ•°</li><li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„ç”¨æˆ·æ€»é‡å’Œæ–°å¢ç”¨æˆ·é‡æ•°æ®</li></ul><h4 id="æ¥å£è®¾è®¡-9"><a href="#æ¥å£è®¾è®¡-9" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>æ ¹æ®ä¸Šè¿°åŸå‹å›¾è®¾è®¡æ¥å£ã€‚</p><p><img src="assets/image-20230102213809414.png" alt="image-20230102213809414" style="zoom:50%"> <img src="assets/image-20230102213818334.png" alt="image-20230102213818334" style="zoom:50%"></p><h3 id="ä»£ç å¼€å‘-23"><a href="#ä»£ç å¼€å‘-23" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="VOè®¾è®¡-3"><a href="#VOè®¾è®¡-3" class="headerlink" title="VOè®¾è®¡"></a>VOè®¾è®¡</h4><p><strong>æ ¹æ®ç”¨æˆ·ç»Ÿè®¡æ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š</strong></p><p><img src="assets/image-20230102211004237.png" alt="image-20230102211004237" style="zoom:50%"></p><p>åœ¨sky-pojoæ¨¡å—ï¼ŒUserReportVO.javaå·²å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ—¥æœŸï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2022-10-01,2022-10-02,2022-10-03</span></span><br><span class="line">    <span class="keyword">private</span> String dateList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”¨æˆ·æ€»é‡ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š200,210,220</span></span><br><span class="line">    <span class="keyword">private</span> String totalUserList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–°å¢ç”¨æˆ·ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š20,21,10</span></span><br><span class="line">    <span class="keyword">private</span> String newUserList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-18"><a href="#Controllerå±‚-18" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰ï¼Œåœ¨ReportControllerä¸­åˆ›å»ºuserStatisticsæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ•°æ®ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userStatistics&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ç”¨æˆ·æ•°æ®ç»Ÿè®¡&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;UserReportVO&gt; <span class="title function_">userStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(reportService.getUserStatistics(begin,end));            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-15"><a href="#Serviceå±‚-15" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜getUserStatisticsæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡ç”¨æˆ·æ•°é‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   UserReportVO <span class="title function_">getUserStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°getUserStatisticsæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> UserReportVO <span class="title function_">getUserStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">       List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       dateList.add(begin);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span> (!begin.equals(end))&#123;</span><br><span class="line">           begin = begin.plusDays(<span class="number">1</span>);</span><br><span class="line">           dateList.add(begin);</span><br><span class="line">       &#125;</span><br><span class="line">       List&lt;Integer&gt; newUserList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">//æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line">       List&lt;Integer&gt; totalUserList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">//æ€»ç”¨æˆ·æ•°</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (LocalDate date : dateList) &#123;</span><br><span class="line">           <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MIN);</span><br><span class="line">           <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MAX);</span><br><span class="line">           <span class="comment">//æ–°å¢ç”¨æˆ·æ•°é‡ select count(id) from user where create_time &gt; ? and create_time &lt; ?</span></span><br><span class="line">           <span class="type">Integer</span> <span class="variable">newUser</span> <span class="operator">=</span> getUserCount(beginTime, endTime);</span><br><span class="line">           <span class="comment">//æ€»ç”¨æˆ·æ•°é‡ select count(id) from user where  create_time &lt; ?</span></span><br><span class="line">           <span class="type">Integer</span> <span class="variable">totalUser</span> <span class="operator">=</span> getUserCount(<span class="literal">null</span>, endTime);</span><br><span class="line"></span><br><span class="line">           newUserList.add(newUser);</span><br><span class="line">           totalUserList.add(totalUser);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> UserReportVO.builder()</span><br><span class="line">               .dateList(StringUtils.join(dateList,<span class="string">&quot;,&quot;</span>))</span><br><span class="line">               .newUserList(StringUtils.join(newUserList,<span class="string">&quot;,&quot;</span>))</span><br><span class="line">               .totalUserList(StringUtils.join(totalUserList,<span class="string">&quot;,&quot;</span>))</span><br><span class="line">               .build();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­åˆ›å»ºç§æœ‰æ–¹æ³•getUserCountï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡ç”¨æˆ·æ•°é‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> beginTime</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> endTime</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> Integer <span class="title function_">getUserCount</span><span class="params">(LocalDateTime beginTime, LocalDateTime endTime)</span> &#123;</span><br><span class="line">       <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">       map.put(<span class="string">&quot;begin&quot;</span>,beginTime);</span><br><span class="line">       map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">       <span class="keyword">return</span> userMapper.countByMap(map);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-17"><a href="#Mapperå±‚-17" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨UserMapperæ¥å£ä¸­å£°æ˜countByMapæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®åŠ¨æ€æ¡ä»¶ç»Ÿè®¡ç”¨æˆ·æ•°é‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   Integer <span class="title function_">countByMap</span><span class="params">(Map map)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨UserMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;countByMap&quot;</span> resultType=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span><br><span class="line">        select <span class="title function_">count</span><span class="params">(id)</span> from user</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;begin != null&quot;</span>&gt;</span><br><span class="line">                and create_time &amp;gt;= #&#123;begin&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;end != null&quot;</span>&gt;</span><br><span class="line">                and create_time &amp;lt;= #&#123;end&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-24"><a href="#åŠŸèƒ½æµ‹è¯•-24" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æ¥å£æ–‡æ¡£æµ‹è¯•</li><li>å‰åç«¯è”è°ƒæµ‹è¯•</li></ul><p>è¿›å…¥æ•°æ®ç»Ÿè®¡æ¨¡å—</p><p><strong>1. æŸ¥çœ‹è¿‘7æ—¥ç”¨æˆ·ç»Ÿè®¡</strong></p><p><img src="assets/image-20230107191339668.png" alt="image-20230107191339668" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230107191532175.png" alt="image-20230107191532175" style="zoom:50%"></p><p><strong>2. æŸ¥çœ‹è¿‘30æ—¥ç”¨æˆ·ç»Ÿè®¡</strong></p><p><img src="assets/image-20230107191613369.png" alt="image-20230107191613369" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230107191707568.png" alt="image-20230107191707568" style="zoom:50%"></p><p>ä¹Ÿå¯é€šè¿‡æ–­ç‚¹æ–¹å¼å¯åŠ¨ï¼ŒæŸ¥çœ‹æ¯æ­¥æ‰§è¡Œæƒ…å†µã€‚</p><h2 id="è®¢å•ç»Ÿè®¡"><a href="#è®¢å•ç»Ÿè®¡" class="headerlink" title="è®¢å•ç»Ÿè®¡"></a>è®¢å•ç»Ÿè®¡</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-38"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-38" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-7"><a href="#äº§å“åŸå‹-7" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>è®¢å•ç»Ÿè®¡é€šè¿‡ä¸€ä¸ªæŠ˜ç°å›¾æ¥å±•ç°ï¼ŒæŠ˜çº¿å›¾ä¸Šæœ‰ä¸¤æ ¹çº¿ï¼Œè¿™æ ¹è“è‰²çš„çº¿ä»£è¡¨çš„æ˜¯è®¢å•æ€»æ•°ï¼Œè€Œä¸‹è¾¹è¿™æ ¹ç»¿è‰²çš„çº¿ä»£è¡¨çš„æ˜¯æœ‰æ•ˆè®¢å•æ•°ï¼ŒæŒ‡çš„å°±æ˜¯çŠ¶æ€æ˜¯å·²å®Œæˆçš„è®¢å•å°±å±äºæœ‰æ•ˆè®¢å•ï¼Œåˆ†åˆ«åæ˜ çš„æ˜¯æ¯ä¸€å¤©çš„æ•°æ®ã€‚ä¸Šé¢è¿˜æœ‰3ä¸ªæ•°å­—ï¼Œåˆ†åˆ«æ˜¯è®¢å•æ€»æ•°ã€æœ‰æ•ˆè®¢å•ã€è®¢å•å®Œæˆç‡ï¼Œå®ƒæŒ‡çš„æ˜¯æ•´ä¸ªæ—¶é—´åŒºé—´ä¹‹å†…æ€»çš„æ•°æ®ã€‚</p><p><strong>åŸå‹å›¾ï¼š</strong></p><p><img src="assets/image-20230107192859270.png" alt="image-20230107192859270" style="zoom:50%"></p><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>æœ‰æ•ˆè®¢å•æŒ‡çŠ¶æ€ä¸º â€œå·²å®Œæˆâ€ çš„è®¢å•</li><li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè®¢å•æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºè®¢å•æ•°é‡</li><li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„è®¢å•æ€»æ•°å’Œæœ‰æ•ˆè®¢å•æ•°</li><li>å±•ç¤ºæ‰€é€‰æ—¶é—´åŒºé—´å†…çš„æœ‰æ•ˆè®¢å•æ•°ã€æ€»è®¢å•æ•°ã€è®¢å•å®Œæˆç‡ï¼Œè®¢å•å®Œæˆç‡ = æœ‰æ•ˆè®¢å•æ•° / æ€»è®¢å•æ•° * 100%</li></ul><h4 id="æ¥å£è®¾è®¡-10"><a href="#æ¥å£è®¾è®¡-10" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>æ ¹æ®ä¸Šè¿°åŸå‹å›¾è®¾è®¡æ¥å£ã€‚</p><p><img src="assets/image-20230107192942872.png" alt="image-20230107192942872" style="zoom:50%"> <img src="assets/image-20230107192952958.png" alt="image-20230107192952958" style="zoom:50%"></p><h3 id="ä»£ç å¼€å‘-24"><a href="#ä»£ç å¼€å‘-24" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="VOè®¾è®¡-4"><a href="#VOè®¾è®¡-4" class="headerlink" title="VOè®¾è®¡"></a>VOè®¾è®¡</h4><p><strong>æ ¹æ®è®¢å•ç»Ÿè®¡æ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š</strong></p><p><img src="assets/image-20230107195325915.png" alt="image-20230107195325915" style="zoom:50%"></p><p>åœ¨sky-pojoæ¨¡å—ï¼ŒOrderReportVO.javaå·²å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ—¥æœŸï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2022-10-01,2022-10-02,2022-10-03</span></span><br><span class="line">    <span class="keyword">private</span> String dateList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¯æ—¥è®¢å•æ•°ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š260,210,215</span></span><br><span class="line">    <span class="keyword">private</span> String orderCountList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¯æ—¥æœ‰æ•ˆè®¢å•æ•°ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š20,21,10</span></span><br><span class="line">    <span class="keyword">private</span> String validOrderCountList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¢å•æ€»æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalOrderCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer validOrderCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¢å•å®Œæˆç‡</span></span><br><span class="line">    <span class="keyword">private</span> Double orderCompletionRate;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-19"><a href="#Controllerå±‚-19" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>åœ¨ReportControllerä¸­æ ¹æ®è®¢å•ç»Ÿè®¡æ¥å£åˆ›å»ºorderStatisticsæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•æ•°æ®ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ordersStatistics&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ç”¨æˆ·æ•°æ®ç»Ÿè®¡&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;OrderReportVO&gt; <span class="title function_">orderStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span></span><br><span class="line"><span class="params">                    LocalDate begin,</span></span><br><span class="line"><span class="params">            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span></span><br><span class="line"><span class="params">                    LocalDate end)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(reportService.getOrderStatistics(begin,end));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-16"><a href="#Serviceå±‚-16" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜getOrderStatisticsæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> begin </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">OrderReportVO <span class="title function_">getOrderStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°getOrderStatisticsæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> begin </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> OrderReportVO <span class="title function_">getOrderStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span>&#123;</span><br><span class="line">	List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    dateList.add(begin);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!begin.equals(end))&#123;</span><br><span class="line">          begin = begin.plusDays(<span class="number">1</span>);</span><br><span class="line">          dateList.add(begin);</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="comment">//æ¯å¤©è®¢å•æ€»æ•°é›†åˆ</span></span><br><span class="line">     List&lt;Integer&gt; orderCountList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//æ¯å¤©æœ‰æ•ˆè®¢å•æ•°é›†åˆ</span></span><br><span class="line">    List&lt;Integer&gt; validOrderCountList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (LocalDate date : dateList) &#123;</span><br><span class="line">         <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MIN);</span><br><span class="line">         <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MAX);</span><br><span class="line">   <span class="comment">//æŸ¥è¯¢æ¯å¤©çš„æ€»è®¢å•æ•° select count(id) from orders where order_time &gt; ? and order_time &lt; ?</span></span><br><span class="line">         <span class="type">Integer</span> <span class="variable">orderCount</span> <span class="operator">=</span> getOrderCount(beginTime, endTime, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æŸ¥è¯¢æ¯å¤©çš„æœ‰æ•ˆè®¢å•æ•° select count(id) from orders where order_time &gt; ? and order_time &lt; ? and status = ?</span></span><br><span class="line">         <span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> getOrderCount(beginTime, endTime, Orders.COMPLETED);</span><br><span class="line"></span><br><span class="line">         orderCountList.add(orderCount);</span><br><span class="line">         validOrderCountList.add(validOrderCount);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ—¶é—´åŒºé—´å†…çš„æ€»è®¢å•æ•°</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">totalOrderCount</span> <span class="operator">=</span> orderCountList.stream().reduce(Integer::sum).get();</span><br><span class="line">    <span class="comment">//æ—¶é—´åŒºé—´å†…çš„æ€»æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> validOrderCountList.stream().reduce(Integer::sum).get();</span><br><span class="line">    <span class="comment">//è®¢å•å®Œæˆç‡</span></span><br><span class="line">    <span class="type">Double</span> <span class="variable">orderCompletionRate</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">if</span>(totalOrderCount != <span class="number">0</span>)&#123;</span><br><span class="line">         orderCompletionRate = validOrderCount.doubleValue() / totalOrderCount;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">return</span> OrderReportVO.builder()</span><br><span class="line">                .dateList(StringUtils.join(dateList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .orderCountList(StringUtils.join(orderCountList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .validOrderCountList(StringUtils.join(validOrderCountList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .totalOrderCount(totalOrderCount)</span><br><span class="line">                .validOrderCount(validOrderCount)</span><br><span class="line">                .orderCompletionRate(orderCompletionRate)</span><br><span class="line">                .build();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­æä¾›ç§æœ‰æ–¹æ³•getOrderCountï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡æŒ‡å®šçŠ¶æ€çš„è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> beginTime</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> endTime</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> Integer <span class="title function_">getOrderCount</span><span class="params">(LocalDateTime beginTime, LocalDateTime endTime, Integer status)</span> &#123;</span><br><span class="line">	<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">	map.put(<span class="string">&quot;status&quot;</span>, status);</span><br><span class="line">	map.put(<span class="string">&quot;begin&quot;</span>,beginTime);</span><br><span class="line">	map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">	<span class="keyword">return</span> orderMapper.countByMap(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-18"><a href="#Mapperå±‚-18" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨OrderMapperæ¥å£ä¸­å£°æ˜countByMapæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*æ ¹æ®åŠ¨æ€æ¡ä»¶ç»Ÿè®¡è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Integer <span class="title function_">countByMap</span><span class="params">(Map map)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨OrderMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;countByMap&quot;</span> resultType=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span><br><span class="line">        select <span class="title function_">count</span><span class="params">(id)</span> from orders</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;begin != null&quot;</span>&gt;</span><br><span class="line">                and order_time &amp;gt;= #&#123;begin&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;end != null&quot;</span>&gt;</span><br><span class="line">                and order_time &amp;lt;= #&#123;end&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-25"><a href="#åŠŸèƒ½æµ‹è¯•-25" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æ¥å£æ–‡æ¡£æµ‹è¯•</li><li>å‰åç«¯è”è°ƒ</li></ul><p>é‡å¯æœåŠ¡ï¼Œç›´æ¥é‡‡ç”¨å‰åç«¯è”è°ƒæµ‹è¯•ã€‚</p><p>è¿›å…¥æ•°æ®ç»Ÿè®¡æ¨¡å—</p><p><strong>1). æŸ¥çœ‹è¿‘7æ—¥è®¢å•ç»Ÿè®¡</strong></p><p><img src="assets/image-20230107202854533.png" alt="image-20230107202854533" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230107202953128.png" alt="image-20230107202953128" style="zoom:50%"></p><p><strong>2). æŸ¥çœ‹è¿‘30æ—¥è®¢å•ç»Ÿè®¡</strong></p><p><img src="assets/image-20230107203025165.png" alt="image-20230107203025165" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230107203127308.png" alt="image-20230107203127308" style="zoom:50%"></p><p>ä¹Ÿå¯é€šè¿‡æ–­ç‚¹æ–¹å¼å¯åŠ¨ï¼ŒæŸ¥çœ‹æ¯æ­¥æ‰§è¡Œæƒ…å†µã€‚</p><h2 id="é”€é‡æ’åTop10"><a href="#é”€é‡æ’åTop10" class="headerlink" title="é”€é‡æ’åTop10"></a>é”€é‡æ’åTop10</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-39"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-39" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-8"><a href="#äº§å“åŸå‹-8" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>æ‰€è°“é”€é‡æ’åï¼Œé”€é‡æŒ‡çš„æ˜¯å•†å“é”€å”®çš„æ•°é‡ã€‚é¡¹ç›®å½“ä¸­çš„å•†å“ä¸»è¦åŒ…å«ä¸¤ç±»ï¼šä¸€ä¸ªæ˜¯<strong>å¥—é¤</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>èœå“</strong>ï¼Œæ‰€ä»¥é”€é‡æ’åå…¶å®æŒ‡çš„å°±æ˜¯èœå“å’Œå¥—é¤é”€å”®çš„æ•°é‡æ’åã€‚é€šè¿‡æŸ±å½¢å›¾æ¥å±•ç¤ºé”€é‡æ’åï¼Œè¿™äº›é”€é‡æ˜¯æŒ‰ç…§é™åºæ¥æ’åˆ—ï¼Œå¹¶ä¸”åªéœ€è¦ç»Ÿè®¡é”€é‡æ’åå‰åçš„å•†å“ã€‚</p><p><strong>åŸå‹å›¾ï¼š</strong></p><p><img src="assets/image-20230107203622747.png" alt="image-20230107203622747" style="zoom:50%"></p><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºé”€é‡å‰10çš„å•†å“ï¼ˆåŒ…æ‹¬èœå“å’Œå¥—é¤ï¼‰</li><li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŸ±çŠ¶å›¾é™åºå±•ç¤ºå•†å“é”€é‡</li><li>æ­¤å¤„çš„é”€é‡ä¸ºå•†å“é”€å”®çš„ä»½æ•°</li></ul><h4 id="æ¥å£è®¾è®¡-11"><a href="#æ¥å£è®¾è®¡-11" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>æ ¹æ®ä¸Šè¿°åŸå‹å›¾è®¾è®¡æ¥å£ã€‚</p><p><img src="assets/image-20230107203720606.png" alt="image-20230107203720606" style="zoom:50%"> <img src="assets/image-20230107203730681.png" alt="image-20230107203730681" style="zoom:50%"></p><h3 id="ä»£ç å¼€å‘-25"><a href="#ä»£ç å¼€å‘-25" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="VOè®¾è®¡-5"><a href="#VOè®¾è®¡-5" class="headerlink" title="VOè®¾è®¡"></a>VOè®¾è®¡</h4><p><strong>æ ¹æ®é”€é‡æ’åæ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š</strong></p><p><img src="assets/image-20230107204028895.png" alt="image-20230107204028895" style="zoom:50%"></p><p>åœ¨sky-pojoæ¨¡å—ï¼ŒSalesTop10ReportVO.javaå·²å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SalesTop10ReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å•†å“åç§°åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šé±¼é¦™è‚‰ä¸,å®«ä¿é¸¡ä¸,æ°´ç…®é±¼</span></span><br><span class="line">    <span class="keyword">private</span> String nameList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é”€é‡åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š260,215,200</span></span><br><span class="line">    <span class="keyword">private</span> String numberList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚-20"><a href="#Controllerå±‚-20" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>åœ¨ReportControllerä¸­æ ¹æ®é”€é‡æ’åæ¥å£åˆ›å»ºtop10æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* é”€é‡æ’åç»Ÿè®¡</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/top10&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;é”€é‡æ’åç»Ÿè®¡&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SalesTop10ReportVO&gt; <span class="title function_">top10</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> Result.success(reportService.getSalesTop10(begin,end));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-2-3-Serviceå±‚æ¥å£"><a href="#5-2-3-Serviceå±‚æ¥å£" class="headerlink" title="5.2.3 Serviceå±‚æ¥å£"></a>5.2.3 Serviceå±‚æ¥å£</h4><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜getSalesTop10æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æŸ¥è¯¢æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„é”€é‡æ’åtop10 </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SalesTop10ReportVO <span class="title function_">getSalesTop10</span><span class="params">(LocalDate begin, LocalDate end)</span>;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚å®ç°ç±»-2"><a href="#Serviceå±‚å®ç°ç±»-2" class="headerlink" title="Serviceå±‚å®ç°ç±»"></a>Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°getSalesTop10æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„é”€é‡æ’åtop10</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> SalesTop10ReportVO <span class="title function_">getSalesTop10</span><span class="params">(LocalDate begin, LocalDate end)</span>&#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(begin, LocalTime.MIN);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(end, LocalTime.MAX);</span><br><span class="line">        List&lt;GoodsSalesDTO&gt; goodsSalesDTOList = orderMapper.getSalesTop10(beginTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">nameList</span> <span class="operator">=</span> StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList()),<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">numberList</span> <span class="operator">=</span> StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList()),<span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SalesTop10ReportVO.builder()</span><br><span class="line">                .nameList(nameList)</span><br><span class="line">                .numberList(numberList)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-19"><a href="#Mapperå±‚-19" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨OrderMapperæ¥å£ä¸­å£°æ˜getSalesTop10æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æŸ¥è¯¢å•†å“é”€é‡æ’å</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;GoodsSalesDTO&gt; <span class="title function_">getSalesTop10</span><span class="params">(LocalDateTime begin, LocalDateTime end)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨OrderMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSalesTop10&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.dto.GoodsSalesDTO&quot;</span>&gt;</span></span><br><span class="line">        select od.name name,sum(od.number) number from order_detail od ,orders o</span><br><span class="line">        where od.order_id = o.id</span><br><span class="line">            and o.status = 5</span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null&quot;</span>&gt;</span></span><br><span class="line">                and order_time <span class="symbol">&amp;gt;</span>= #&#123;begin&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;end != null&quot;</span>&gt;</span></span><br><span class="line">                and order_time <span class="symbol">&amp;lt;</span>= #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        group by name</span><br><span class="line">        order by number desc</span><br><span class="line">        limit 0, 10</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-26"><a href="#åŠŸèƒ½æµ‹è¯•-26" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>æ¥å£æ–‡æ¡£æµ‹è¯•</li><li>å‰åç«¯è”è°ƒ</li></ul><p>é‡å¯æœåŠ¡ï¼Œç›´æ¥é‡‡ç”¨å‰åç«¯è”è°ƒæµ‹è¯•ã€‚</p><p><strong>æŸ¥çœ‹è¿‘30æ—¥é”€é‡æ’åTop10ç»Ÿè®¡</strong></p><p>è‹¥æŸ¥è¯¢çš„æŸä¸€æ®µæ—¶é—´æ²¡æœ‰é”€é‡æ•°æ®ï¼Œåˆ™æ˜¾ç¤ºä¸å‡ºæ•ˆæœã€‚</p><p><img src="assets/image-20230107210518821.png" alt="image-20230107210518821" style="zoom:50%"></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹è¿”å›æ•°æ®</p><p><img src="assets/image-20230107210711326.png" alt="image-20230107210711326" style="zoom:50%"></p><p>ä¹Ÿå¯é€šè¿‡æ–­ç‚¹æ–¹å¼å¯åŠ¨ï¼ŒæŸ¥çœ‹æ¯æ­¥æ‰§è¡Œæƒ…å†µã€‚</p><h1 id="day12"><a href="#day12" class="headerlink" title="day12"></a>day12</h1><h2 id="è¯¾ç¨‹å†…å®¹-7"><a href="#è¯¾ç¨‹å†…å®¹-7" class="headerlink" title="è¯¾ç¨‹å†…å®¹"></a>è¯¾ç¨‹å†…å®¹</h2><ul><li>å·¥ä½œå°</li><li>Apache POI</li><li>å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</li></ul><p>åŠŸèƒ½å®ç°ï¼š<strong>å·¥ä½œå°</strong>ã€<strong>æ•°æ®å¯¼å‡º</strong></p><p><strong>å·¥ä½œå°æ•ˆæœå›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130190031553.png"></div></div><p><strong>æ•°æ®å¯¼å‡ºæ•ˆæœå›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130190124725.png"></div></div><p>åœ¨æ•°æ®ç»Ÿè®¡é¡µé¢ç‚¹å‡»<strong>æ•°æ®å¯¼å‡º</strong>ï¼šç”ŸæˆExcelæŠ¥è¡¨<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130190243865.png"></div></div><p></p><h2 id="å·¥ä½œå°"><a href="#å·¥ä½œå°" class="headerlink" title="å·¥ä½œå°"></a>å·¥ä½œå°</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-40"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-40" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-9"><a href="#äº§å“åŸå‹-9" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>å·¥ä½œå°æ˜¯ç³»ç»Ÿè¿è¥çš„æ•°æ®çœ‹æ¿ï¼Œå¹¶æä¾›å¿«æ·æ“ä½œå…¥å£ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜å•†å®¶çš„å·¥ä½œæ•ˆç‡ã€‚</p><p><strong>å·¥ä½œå°å±•ç¤ºçš„æ•°æ®ï¼š</strong></p><ul><li>ä»Šæ—¥æ•°æ®</li><li>è®¢å•ç®¡ç†</li><li>èœå“æ€»è§ˆ</li><li>å¥—é¤æ€»è§ˆ</li><li>è®¢å•ä¿¡æ¯</li></ul><p><strong>åŸå‹å›¾ï¼š</strong><br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130191051003.png"></div></div><p></p><div class="note info no-icon flat"><p><strong>åè¯è§£é‡Šï¼š</strong></p><ul><li>è¥ä¸šé¢ï¼šå·²å®Œæˆè®¢å•çš„æ€»é‡‘é¢</li><li>æœ‰æ•ˆè®¢å•ï¼šå·²å®Œæˆè®¢å•çš„æ•°é‡</li><li>è®¢å•å®Œæˆç‡ï¼šæœ‰æ•ˆè®¢å•æ•° / æ€»è®¢å•æ•° * 100%</li><li>å¹³å‡å®¢å•ä»·ï¼šè¥ä¸šé¢ / æœ‰æ•ˆè®¢å•æ•°</li><li>æ–°å¢ç”¨æˆ·ï¼šæ–°å¢ç”¨æˆ·çš„æ•°é‡</li></ul></div><h4 id="æ¥å£è®¾è®¡-12"><a href="#æ¥å£è®¾è®¡-12" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>é€šè¿‡ä¸Šè¿°åŸå‹å›¾åˆ†æï¼Œå…±åŒ…å«6ä¸ªæ¥å£ã€‚</p><p><strong>æ¥å£è®¾è®¡ï¼š</strong></p><ul><li>ä»Šæ—¥æ•°æ®æ¥å£</li><li>è®¢å•ç®¡ç†æ¥å£</li><li>èœå“æ€»è§ˆæ¥å£</li><li>å¥—é¤æ€»è§ˆæ¥å£</li><li>è®¢å•æœç´¢ï¼ˆå·²å®Œæˆï¼‰</li><li>å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ï¼ˆå·²å®Œæˆï¼‰</li></ul><div class="tabs" id="å·¥ä½œå°æ¥å£è®¾è®¡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å·¥ä½œå°æ¥å£è®¾è®¡-1">ä»Šæ—¥æ•°æ®</button></li><li class="tab"><button type="button" data-href="#å·¥ä½œå°æ¥å£è®¾è®¡-2">è®¢å•ç®¡ç†</button></li><li class="tab"><button type="button" data-href="#å·¥ä½œå°æ¥å£è®¾è®¡-3">èœå“æ€»è§ˆ</button></li><li class="tab"><button type="button" data-href="#å·¥ä½œå°æ¥å£è®¾è®¡-4">å¥—é¤æ€»è§ˆ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å·¥ä½œå°æ¥å£è®¾è®¡-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130191820764.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130191837090.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å·¥ä½œå°æ¥å£è®¾è®¡-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130192105373.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å·¥ä½œå°æ¥å£è®¾è®¡-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130192225168.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å·¥ä½œå°æ¥å£è®¾è®¡-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130195425389.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="ä»£ç å¯¼å…¥-3"><a href="#ä»£ç å¯¼å…¥-3" class="headerlink" title="ä»£ç å¯¼å…¥"></a>ä»£ç å¯¼å…¥</h3><p>ç›´æ¥å¯¼å…¥è¯¾ç¨‹èµ„æ–™ä¸­çš„å·¥ä½œå°æ¨¡å—åŠŸèƒ½ä»£ç å³å¯ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130195535421.png"></div></div><p></p><h4 id="Controllerå±‚-21"><a href="#Controllerå±‚-21" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ·»åŠ WorkSpaceController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥ä½œå°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/workspace&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å·¥ä½œå°ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkSpaceController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WorkspaceService workspaceService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·¥ä½œå°ä»Šæ—¥æ•°æ®æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/businessData&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å·¥ä½œå°ä»Šæ—¥æ•°æ®æŸ¥è¯¢&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;BusinessDataVO&gt; <span class="title function_">businessData</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è·å¾—å½“å¤©çš„å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDateTime.now().with(LocalTime.MIN);</span><br><span class="line">        <span class="comment">//è·å¾—å½“å¤©çš„ç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">end</span> <span class="operator">=</span> LocalDateTime.now().with(LocalTime.MAX);</span><br><span class="line"></span><br><span class="line">        <span class="type">BusinessDataVO</span> <span class="variable">businessDataVO</span> <span class="operator">=</span> workspaceService.getBusinessData(begin, end);</span><br><span class="line">        <span class="keyword">return</span> Result.success(businessDataVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/overviewOrders&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;OrderOverViewVO&gt; <span class="title function_">orderOverView</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(workspaceService.getOrderOverView());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/overviewDishes&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢èœå“æ€»è§ˆ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;DishOverViewVO&gt; <span class="title function_">dishOverView</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(workspaceService.getDishOverView());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/overviewSetmeals&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢å¥—é¤æ€»è§ˆ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;SetmealOverViewVO&gt; <span class="title function_">setmealOverView</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(workspaceService.getSetmealOverView());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-17"><a href="#Serviceå±‚-17" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>æ·»åŠ WorkspaceService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WorkspaceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ—¶é—´æ®µç»Ÿè®¡è¥ä¸šæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BusinessDataVO <span class="title function_">getBusinessData</span><span class="params">(LocalDateTime begin, LocalDateTime end)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OrderOverViewVO <span class="title function_">getOrderOverView</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DishOverViewVO <span class="title function_">getDishOverView</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SetmealOverViewVO <span class="title function_">getSetmealOverView</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ WorkspaceServiceImpl.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkspaceServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">WorkspaceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ—¶é—´æ®µç»Ÿè®¡è¥ä¸šæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> BusinessDataVO <span class="title function_">getBusinessData</span><span class="params">(LocalDateTime begin, LocalDateTime end)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è¥ä¸šé¢ï¼šå½“æ—¥å·²å®Œæˆè®¢å•çš„æ€»é‡‘é¢</span></span><br><span class="line"><span class="comment">         * æœ‰æ•ˆè®¢å•ï¼šå½“æ—¥å·²å®Œæˆè®¢å•çš„æ•°é‡</span></span><br><span class="line"><span class="comment">         * è®¢å•å®Œæˆç‡ï¼šæœ‰æ•ˆè®¢å•æ•° / æ€»è®¢å•æ•°</span></span><br><span class="line"><span class="comment">         * å¹³å‡å®¢å•ä»·ï¼šè¥ä¸šé¢ / æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line"><span class="comment">         * æ–°å¢ç”¨æˆ·ï¼šå½“æ—¥æ–°å¢ç”¨æˆ·çš„æ•°é‡</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;begin&quot;</span>,begin);</span><br><span class="line">        map.put(<span class="string">&quot;end&quot;</span>,end);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ€»è®¢å•æ•°</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalOrderCount</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">        <span class="comment">//è¥ä¸šé¢</span></span><br><span class="line">        <span class="type">Double</span> <span class="variable">turnover</span> <span class="operator">=</span> orderMapper.sumByMap(map);</span><br><span class="line">        turnover = turnover == <span class="literal">null</span>? <span class="number">0.0</span> : turnover;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="type">Double</span> <span class="variable">unitPrice</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Double</span> <span class="variable">orderCompletionRate</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">if</span>(totalOrderCount != <span class="number">0</span> &amp;&amp; validOrderCount != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//è®¢å•å®Œæˆç‡</span></span><br><span class="line">            orderCompletionRate = validOrderCount.doubleValue() / totalOrderCount;</span><br><span class="line">            <span class="comment">//å¹³å‡å®¢å•ä»·</span></span><br><span class="line">            unitPrice = turnover / validOrderCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">newUsers</span> <span class="operator">=</span> userMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BusinessDataVO.builder()</span><br><span class="line">                .turnover(turnover)</span><br><span class="line">                .validOrderCount(validOrderCount)</span><br><span class="line">                .orderCompletionRate(orderCompletionRate)</span><br><span class="line">                .unitPrice(unitPrice)</span><br><span class="line">                .newUsers(newUsers)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> OrderOverViewVO <span class="title function_">getOrderOverView</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;begin&quot;</span>, LocalDateTime.now().with(LocalTime.MIN));</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.TO_BE_CONFIRMED);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾…æ¥å•</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">waitingOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾…æ´¾é€</span></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.CONFIRMED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">deliveredOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·²å®Œæˆ</span></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">completedOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·²å–æ¶ˆ</span></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.CANCELLED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">cancelledOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…¨éƒ¨è®¢å•</span></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">allOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OrderOverViewVO.builder()</span><br><span class="line">                .waitingOrders(waitingOrders)</span><br><span class="line">                .deliveredOrders(deliveredOrders)</span><br><span class="line">                .completedOrders(completedOrders)</span><br><span class="line">                .cancelledOrders(cancelledOrders)</span><br><span class="line">                .allOrders(allOrders)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> DishOverViewVO <span class="title function_">getDishOverView</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.ENABLE);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">sold</span> <span class="operator">=</span> dishMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.DISABLE);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">discontinued</span> <span class="operator">=</span> dishMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> DishOverViewVO.builder()</span><br><span class="line">                .sold(sold)</span><br><span class="line">                .discontinued(discontinued)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> SetmealOverViewVO <span class="title function_">getSetmealOverView</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.ENABLE);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">sold</span> <span class="operator">=</span> setmealMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.DISABLE);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">discontinued</span> <span class="operator">=</span> setmealMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SetmealOverViewVO.builder()</span><br><span class="line">                .sold(sold)</span><br><span class="line">                .discontinued(discontinued)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapperå±‚-20"><a href="#Mapperå±‚-20" class="headerlink" title="Mapperå±‚"></a>Mapperå±‚</h4><p><strong>åœ¨SetmealMapperä¸­æ·»åŠ countByMapæ–¹æ³•å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®æ¡ä»¶ç»Ÿè®¡å¥—é¤æ•°é‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   Integer <span class="title function_">countByMap</span><span class="params">(Map map)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨SetmealMapper.xmlä¸­æ·»åŠ å¯¹åº”SQLå®ç°</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;countByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from setmeal</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                and status = #&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">                and category_id = #&#123;categoryId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>åœ¨DishMapperä¸­æ·»åŠ countByMapæ–¹æ³•å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®æ¡ä»¶ç»Ÿè®¡èœå“æ•°é‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   Integer <span class="title function_">countByMap</span><span class="params">(Map map)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨DishMapper.xmlä¸­æ·»åŠ å¯¹åº”SQLå®ç°</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;countByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from dish</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                and status = #&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">                and category_id = #&#123;categoryId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-27"><a href="#åŠŸèƒ½æµ‹è¯•-27" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p><ul><li>é€šè¿‡æ¥å£æ–‡æ¡£æµ‹è¯•</li><li>å‰åç«¯è”è°ƒæµ‹è¯•</li></ul><h4 id="æ¥å£æ–‡æ¡£æµ‹è¯•-4"><a href="#æ¥å£æ–‡æ¡£æµ‹è¯•-4" class="headerlink" title="æ¥å£æ–‡æ¡£æµ‹è¯•"></a>æ¥å£æ–‡æ¡£æµ‹è¯•</h4><p><strong>å¯åŠ¨æœåŠ¡</strong>ï¼Œè®¿é—®<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a>ï¼Œè¿›å…¥å·¥ä½œå°ç›¸å…³æ¥å£</p><div class="tabs" id="æ¥å£æ–‡æ¡£æµ‹è¯•"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ¥å£æ–‡æ¡£æµ‹è¯•-1">ä»Šæ—¥æ•°æ®æŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#æ¥å£æ–‡æ¡£æµ‹è¯•-2">èœå“æ€»è§ˆæŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#æ¥å£æ–‡æ¡£æµ‹è¯•-3">è®¢å•ç®¡ç†æ•°æ®æŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#æ¥å£æ–‡æ¡£æµ‹è¯•-4">å¥—é¤æ€»è§ˆæŸ¥è¯¢</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ¥å£æ–‡æ¡£æµ‹è¯•-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131103600918.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ¥å£æ–‡æ¡£æµ‹è¯•-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131103714898.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ¥å£æ–‡æ¡£æµ‹è¯•-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131103808342.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ¥å£æ–‡æ¡£æµ‹è¯•-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131103903802.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="å‰åç«¯è”è°ƒæµ‹è¯•-4"><a href="#å‰åç«¯è”è°ƒæµ‹è¯•-4" class="headerlink" title="å‰åç«¯è”è°ƒæµ‹è¯•"></a>å‰åç«¯è”è°ƒæµ‹è¯•</h4><p><strong>å¯åŠ¨nginx</strong>,è®¿é—® <a target="_blank" rel="noopener" href="http://localhost">http://localhost</a>ï¼Œè¿›å…¥å·¥ä½œå°<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131104243713.png"></div></div><p></p><p>è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œåˆ†åˆ«æŸ¥çœ‹ä»Šæ—¥æ•°æ®ã€è®¢å•ç®¡ç†ã€èœå“æ€»è§ˆã€å¥—é¤æ€»è§ˆ</p><div class="tabs" id="å‰åç«¯è”è°ƒæµ‹è¯•"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å‰åç«¯è”è°ƒæµ‹è¯•-1">ä»Šæ—¥æ•°æ®æŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#å‰åç«¯è”è°ƒæµ‹è¯•-2">èœå“æ€»è§ˆæŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#å‰åç«¯è”è°ƒæµ‹è¯•-3">è®¢å•ç®¡ç†æ•°æ®æŸ¥è¯¢</button></li><li class="tab"><button type="button" data-href="#å‰åç«¯è”è°ƒæµ‹è¯•-4">å¥—é¤æ€»è§ˆæŸ¥è¯¢</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å‰åç«¯è”è°ƒæµ‹è¯•-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131104849876.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å‰åç«¯è”è°ƒæµ‹è¯•-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131104939694.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å‰åç«¯è”è°ƒæµ‹è¯•-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131105023109.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å‰åç«¯è”è°ƒæµ‹è¯•-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131105123610.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="Apache-POI"><a href="#Apache-POI" class="headerlink" title="Apache POI"></a>Apache POI</h2><h3 id="ä»‹ç»-7"><a href="#ä»‹ç»-7" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>Apache POI</code> æ˜¯ä¸€ä¸ªå¤„ç†<code>Miscrosoft Office</code>å„ç§æ–‡ä»¶æ ¼å¼çš„å¼€æºé¡¹ç›®ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>POI</code> åœ¨ Java ç¨‹åºä¸­å¯¹Miscrosoft Officeå„ç§æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPOI éƒ½æ˜¯ç”¨äºæ“ä½œ Excel æ–‡ä»¶ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131110631081.png"></div></div><p><strong>Apache POI çš„åº”ç”¨åœºæ™¯ï¼š</strong></p><div class="tabs" id="apachepoi"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#apachepoi-1">é“¶è¡Œç½‘é“¶ç³»ç»Ÿå¯¼å‡ºäº¤æ˜“æ˜ç»†</button></li><li class="tab"><button type="button" data-href="#apachepoi-2">å„ç§ä¸šåŠ¡ç³»ç»Ÿå¯¼å‡ºExcelæŠ¥è¡¨</button></li><li class="tab"><button type="button" data-href="#apachepoi-3">æ‰¹é‡å¯¼å…¥ä¸šåŠ¡æ•°æ®</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="apachepoi-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131110810568.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="apachepoi-2"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131110839959.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="apachepoi-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131110856903.png"></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="å…¥é—¨æ¡ˆä¾‹-5"><a href="#å…¥é—¨æ¡ˆä¾‹-5" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><p>Apache POIæ—¢å¯ä»¥å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ¥ä¸‹æ¥åˆ†åˆ«è¿›è¡Œå®ç°ã€‚</p><p><strong>Apache POIçš„mavenåæ ‡ï¼š</strong>(é¡¹ç›®ä¸­å·²å¯¼å…¥)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶"><a href="#å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶" class="headerlink" title="å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶"></a>å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶</h4><p><strong>1. ä»£ç å¼€å‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POITest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºPOIå‘Excelæ–‡ä»¶å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">        <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºSheeté¡µ</span></span><br><span class="line">        <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.createSheet(<span class="string">&quot;itcast&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨Sheeté¡µä¸­åˆ›å»ºè¡Œï¼Œ0è¡¨ç¤ºç¬¬1è¡Œ</span></span><br><span class="line">        <span class="type">XSSFRow</span> <span class="variable">row1</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå•å…ƒæ ¼å¹¶åœ¨å•å…ƒæ ¼ä¸­è®¾ç½®å€¼ï¼Œå•å…ƒæ ¼ç¼–å·ä¹Ÿæ˜¯ä»0å¼€å§‹ï¼Œ1è¡¨ç¤ºç¬¬2ä¸ªå•å…ƒæ ¼</span></span><br><span class="line">        row1.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;å§“å&quot;</span>);</span><br><span class="line">        row1.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŸå¸‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">XSSFRow</span> <span class="variable">row2</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        row2.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">        row2.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŒ—äº¬&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">XSSFRow</span> <span class="variable">row3</span> <span class="operator">=</span> sheet.createRow(<span class="number">2</span>);</span><br><span class="line">        row3.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;æå››&quot;</span>);</span><br><span class="line">        row3.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;ä¸Šæµ·&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\itcast.xlsx&quot;</span>));</span><br><span class="line">        <span class="comment">//é€šè¿‡è¾“å‡ºæµå°†å†…å­˜ä¸­çš„Excelæ–‡ä»¶å†™å…¥åˆ°ç£ç›˜ä¸Š</span></span><br><span class="line">        excel.write(out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">        excel.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        write();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. å®ç°æ•ˆæœ</strong></p><p>åœ¨Dç›˜ä¸­ç”Ÿæˆitcast.xlsxæ–‡ä»¶ï¼Œåˆ›å»ºåç§°ä¸ºitcastçš„Sheeté¡µï¼ŒåŒæ—¶å°†å†…å®¹æˆåŠŸå†™å…¥ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131112905034.png"></div></div><h4 id="è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®"><a href="#è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®" class="headerlink" title="è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®"></a>è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®</h4><p><strong>1. ä»£ç å¼€å‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POITest</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºPOIè¯»å–Excelæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\itcast.xlsx&quot;</span>));</span><br><span class="line">        <span class="comment">//é€šè¿‡è¾“å…¥æµè¯»å–æŒ‡å®šçš„Excelæ–‡ä»¶</span></span><br><span class="line">        <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(in);</span><br><span class="line">        <span class="comment">//è·å–Excelæ–‡ä»¶çš„ç¬¬1ä¸ªSheeté¡µ</span></span><br><span class="line">        <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheetAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–Sheeté¡µä¸­çš„æœ€åä¸€è¡Œçš„è¡Œå·</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">lastRowNum</span> <span class="operator">=</span> sheet.getLastRowNum();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= lastRowNum; i++) &#123;</span><br><span class="line">            <span class="comment">//è·å–Sheeté¡µä¸­çš„è¡Œ</span></span><br><span class="line">            <span class="type">XSSFRow</span> <span class="variable">titleRow</span> <span class="operator">=</span> sheet.getRow(i);</span><br><span class="line">            <span class="comment">//è·å–è¡Œçš„ç¬¬2ä¸ªå•å…ƒæ ¼</span></span><br><span class="line">            <span class="type">XSSFCell</span> <span class="variable">cell1</span> <span class="operator">=</span> titleRow.getCell(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//è·å–å•å…ƒæ ¼ä¸­çš„æ–‡æœ¬å†…å®¹</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">cellValue1</span> <span class="operator">=</span> cell1.getStringCellValue();</span><br><span class="line">            <span class="comment">//è·å–è¡Œçš„ç¬¬3ä¸ªå•å…ƒæ ¼</span></span><br><span class="line">            <span class="type">XSSFCell</span> <span class="variable">cell2</span> <span class="operator">=</span> titleRow.getCell(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">//è·å–å•å…ƒæ ¼ä¸­çš„æ–‡æœ¬å†…å®¹</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">cellValue2</span> <span class="operator">=</span> cell2.getStringCellValue();</span><br><span class="line"></span><br><span class="line">            System.out.println(cellValue1 + <span class="string">&quot; &quot;</span> +cellValue2);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">        in.close();</span><br><span class="line">        excel.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>2. å®ç°æ•ˆæœ</strong></p><p>å°†itcast.xlsxæ–‡ä»¶ä¸­çš„æ•°æ®è¿›è¡Œè¯»å–<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131113255962.png"></div></div><p></p><h2 id="å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨"><a href="#å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨" class="headerlink" title="å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨"></a>å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</h2><h3 id="éœ€æ±‚åˆ†æå’Œè®¾è®¡-41"><a href="#éœ€æ±‚åˆ†æå’Œè®¾è®¡-41" class="headerlink" title="éœ€æ±‚åˆ†æå’Œè®¾è®¡"></a>éœ€æ±‚åˆ†æå’Œè®¾è®¡</h3><h4 id="äº§å“åŸå‹-10"><a href="#äº§å“åŸå‹-10" class="headerlink" title="äº§å“åŸå‹"></a>äº§å“åŸå‹</h4><p>åœ¨æ•°æ®ç»Ÿè®¡é¡µé¢ï¼Œæœ‰ä¸€ä¸ªæ•°æ®å¯¼å‡ºçš„æŒ‰é’®ï¼Œç‚¹å‡»è¯¥æŒ‰é’®æ—¶ï¼Œå…¶å®å°±ä¼šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªExcelå½¢å¼çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­ä¸»è¦åŒ…å«æœ€è¿‘30æ—¥è¿è¥ç›¸å…³çš„æ•°æ®ã€‚è¡¨æ ¼çš„å½¢å¼å·²ç»å›ºå®šï¼Œä¸»è¦ç”±æ¦‚è§ˆæ•°æ®å’Œæ˜ç»†æ•°æ®ä¸¤éƒ¨åˆ†ç»„æˆã€‚çœŸæ­£å¯¼å‡ºè¿™ä¸ªæŠ¥è¡¨ä¹‹åï¼Œç›¸å¯¹åº”çš„æ•°å­—å°±ä¼šå¡«å……åœ¨è¡¨æ ¼ä¸­ï¼Œå°±å¯ä»¥è¿›è¡Œå­˜æ¡£ã€‚</p><p><strong>åŸå‹å›¾ï¼š</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131151132672.png"></div></div><p>å¯¼å‡ºçš„ExcelæŠ¥è¡¨æ ¼å¼ï¼š<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130201026785.png"></div></div><p></p><div class="note info no-icon flat"><p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p><ul><li>å¯¼å‡ºExcelå½¢å¼çš„æŠ¥è¡¨æ–‡ä»¶</li><li>å¯¼å‡ºæœ€è¿‘30å¤©çš„è¿è¥æ•°æ®</li></ul></div><h4 id="æ¥å£è®¾è®¡-13"><a href="#æ¥å£è®¾è®¡-13" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h4><p>é€šè¿‡ä¸Šè¿°åŸå‹å›¾è®¾è®¡å¯¹åº”çš„æ¥å£ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230130201109280.png"></div></div><div class="note warning no-icon flat"><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>å½“å‰æ¥å£æ²¡æœ‰ä¼ é€’å‚æ•°ï¼Œå› ä¸ºå¯¼å‡ºçš„æ˜¯æœ€è¿‘30å¤©çš„è¿è¥æ•°æ®ï¼Œåç«¯è®¡ç®—å³å¯ï¼Œæ‰€ä»¥ä¸éœ€è¦ä»»ä½•å‚æ•°</li><li>å½“å‰æ¥å£æ²¡æœ‰è¿”å›æ•°æ®ï¼Œå› ä¸ºæŠ¥è¡¨å¯¼å‡ºåŠŸèƒ½æœ¬è´¨ä¸Šæ˜¯æ–‡ä»¶ä¸‹è½½ï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</li></ul></div><h3 id="ä»£ç å¼€å‘-26"><a href="#ä»£ç å¼€å‘-26" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h3><h4 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h4><ol><li><p>è®¾è®¡Excelæ¨¡æ¿æ–‡ä»¶</p></li><li><p>æŸ¥è¯¢è¿‘30å¤©çš„è¿è¥æ•°æ®</p></li><li><p>å°†æŸ¥è¯¢åˆ°çš„è¿è¥æ•°æ®å†™å…¥æ¨¡æ¿æ–‡ä»¶</p></li><li><p>é€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</p></li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131152610559.png"></div></div><h4 id="Controllerå±‚-22"><a href="#Controllerå±‚-22" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p><strong>æ ¹æ®æ¥å£å®šä¹‰ï¼Œåœ¨ReportControllerä¸­åˆ›å»ºexportæ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">       reportService.exportBusinessData(response);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Serviceå±‚-18"><a href="#Serviceå±‚-18" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯¼å‡ºè¿‘30å¤©çš„è¿è¥æ•°æ®æŠ¥è¡¨</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">exportBusinessData</span><span class="params">(HttpServletResponse response)</span>;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨çš„æ–¹æ³•:</strong></p><p>æå‰å°†èµ„æ–™ä¸­çš„<strong>è¿è¥æ•°æ®æŠ¥è¡¨æ¨¡æ¿.xlsx</strong>æ‹·è´åˆ°é¡¹ç›®çš„resources/templateç›®å½•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**å¯¼å‡ºè¿‘30å¤©çš„è¿è¥æ•°æ®æŠ¥è¡¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportBusinessData</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">30</span>);</span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">end</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢æ¦‚è§ˆè¿è¥æ•°æ®ï¼Œæä¾›ç»™Excelæ¨¡æ¿æ–‡ä»¶</span></span><br><span class="line">    <span class="type">BusinessDataVO</span> <span class="variable">businessData</span> <span class="operator">=</span> workspaceService.getBusinessData(LocalDateTime.of(begin,LocalTime.MIN), LocalDateTime.of(end, LocalTime.MAX));</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;template/è¿è¥æ•°æ®æŠ¥è¡¨æ¨¡æ¿.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//åŸºäºæä¾›å¥½çš„æ¨¡æ¿æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„Excelè¡¨æ ¼å¯¹è±¡</span></span><br><span class="line">        <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(inputStream);</span><br><span class="line">        <span class="comment">//è·å¾—Excelæ–‡ä»¶ä¸­çš„ä¸€ä¸ªSheeté¡µ</span></span><br><span class="line">        <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        sheet.getRow(<span class="number">1</span>).getCell(<span class="number">1</span>).setCellValue(begin + <span class="string">&quot;è‡³&quot;</span> + end);</span><br><span class="line">        <span class="comment">//è·å¾—ç¬¬4è¡Œ</span></span><br><span class="line">        <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//è·å–å•å…ƒæ ¼</span></span><br><span class="line">        row.getCell(<span class="number">2</span>).setCellValue(businessData.getTurnover());</span><br><span class="line">        row.getCell(<span class="number">4</span>).setCellValue(businessData.getOrderCompletionRate());</span><br><span class="line">        row.getCell(<span class="number">6</span>).setCellValue(businessData.getNewUsers());</span><br><span class="line">        row = sheet.getRow(<span class="number">4</span>);</span><br><span class="line">        row.getCell(<span class="number">2</span>).setCellValue(businessData.getValidOrderCount());</span><br><span class="line">        row.getCell(<span class="number">4</span>).setCellValue(businessData.getUnitPrice());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> begin.plusDays(i);</span><br><span class="line">           <span class="comment">//å‡†å¤‡æ˜ç»†æ•°æ®</span></span><br><span class="line">            businessData = workspaceService.getBusinessData(LocalDateTime.of(date,LocalTime.MIN), LocalDateTime.of(date, LocalTime.MAX));</span><br><span class="line">            row = sheet.getRow(<span class="number">7</span> + i);</span><br><span class="line">            row.getCell(<span class="number">1</span>).setCellValue(date.toString());</span><br><span class="line">            row.getCell(<span class="number">2</span>).setCellValue(businessData.getTurnover());</span><br><span class="line">            row.getCell(<span class="number">3</span>).setCellValue(businessData.getValidOrderCount());</span><br><span class="line">            row.getCell(<span class="number">4</span>).setCellValue(businessData.getOrderCompletionRate());</span><br><span class="line">            row.getCell(<span class="number">5</span>).setCellValue(businessData.getUnitPrice());</span><br><span class="line">            row.getCell(<span class="number">6</span>).setCellValue(businessData.getNewUsers());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        excel.write(out);</span><br><span class="line">        <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">        excel.close();</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•-28"><a href="#åŠŸèƒ½æµ‹è¯•-28" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>ç›´æ¥ä½¿ç”¨å‰åç«¯è”è°ƒæµ‹è¯•ã€‚</p><p><strong>è¿›å…¥æ•°æ®ç»Ÿè®¡</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131155111294.png"></div></div><p><strong>ç‚¹å‡»æ•°æ®å¯¼å‡º</strong>ï¼šExcelæŠ¥è¡¨ä¸‹è½½æˆåŠŸ</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://raw.githubusercontent.com/silvan2077/markdown_pic1/main/Picgo/image-20230131160647328.png"></div></div></article><div class="tag_share"><div class="post-meta__tag-list"></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2025/11/07/reggie/"><img class="next-cover" src="https://raw.githubusercontent.com/silvan2077/markdown_pic/main/Picgo/084442-1747701882d529.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ç‘å‰å¤–å–</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:700">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#day01"><span class="toc-text">day01</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">å‰ç«¯ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">åç«¯ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%86%9F%E6%82%89%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-text">ç†Ÿæ‚‰é¡¹ç›®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">æ•°æ®åº“ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-text">å‰åç«¯è”è°ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">nginxåå‘ä»£ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">nginxè´Ÿè½½å‡è¡¡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-text">å®Œå–„ç™»å½•åŠŸèƒ½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-text">å¯¼å…¥æ¥å£æ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">å‰åç«¯åˆ†ç¦»å¼€å‘æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-text">æ“ä½œæ­¥éª¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swagger"><span class="toc-text">Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-text">ä½¿ç”¨æ­¥éª¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-text">å¸¸ç”¨æ³¨è§£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day02"><span class="toc-text">day02</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5"><span class="toc-text">æ–°å¢å‘˜å·¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEDTO%E7%B1%BB"><span class="toc-text">è®¾ç½®DTOç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">åˆ›å»ºæ¥å£å’Œå®ç°ç±»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95"><span class="toc-text">æ¥å£æ–‡æ¡£æµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95"><span class="toc-text">å‰åç«¯è”è°ƒæµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%8C%E5%96%84"><span class="toc-text">ä»£ç å®Œå–„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80"><span class="toc-text">é—®é¢˜ä¸€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%BA%8C"><span class="toc-text">é—®é¢˜äºŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ThreadLocal"><span class="toc-text">ThreadLocal</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-1"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEDTO%E7%B1%BB-1"><span class="toc-text">è®¾ç½®DTOç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%88%86%E9%A1%B5%E7%BB%93%E6%9E%9C%E7%B1%BB"><span class="toc-text">å°è£…åˆ†é¡µç»“æœç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="toc-text">åˆ›å»ºæ¥å£å’Œå®ç°ç±»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95-1"><span class="toc-text">æ¥å£æ–‡æ¡£æµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95-1"><span class="toc-text">å‰åç«¯è”è°ƒæµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%8C%E5%96%84-1"><span class="toc-text">ä»£ç å®Œå–„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-%E7%A6%81%E7%94%A8%E5%91%98%E5%B7%A5%E8%B4%A6%E5%8F%B7"><span class="toc-text">å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-2"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-2"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82%E6%8E%A5%E5%8F%A3"><span class="toc-text">Serviceå±‚æ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">Serviceå±‚å®ç°ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-2"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95-2"><span class="toc-text">æ¥å£æ–‡æ¡£æµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95-2"><span class="toc-text">å‰åç«¯è”è°ƒæµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%91%98%E5%B7%A5"><span class="toc-text">ç¼–è¾‘å‘˜å·¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-3"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-3"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E6%98%BE%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-text">å›æ˜¾å‘˜å·¥ä¿¡æ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="toc-text">ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-3"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95-3"><span class="toc-text">æ¥å£æ–‡æ¡£æµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95-3"><span class="toc-text">å‰åç«¯è”è°ƒæµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="toc-text">å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-4"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AF%BC%E5%85%A5"><span class="toc-text">ä»£ç å¯¼å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-1"><span class="toc-text">Mapperå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-1"><span class="toc-text">Controllerå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-4"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day03"><span class="toc-text">day03</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-1"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-text">å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-text">å®ç°æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-4"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-text">è‡ªå®šä¹‰æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%87%E9%9D%A2"><span class="toc-text">è‡ªå®šä¹‰åˆ‡é¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3"><span class="toc-text">æ·»åŠ æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-5"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81"><span class="toc-text">æ–°å¢èœå“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-5"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-1"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1-1"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-5"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD"><span class="toc-text">æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">æ–°å¢èœå“å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-6"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8F%9C%E5%93%81%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">èœå“åˆ†é¡µæŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-6"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-6"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1DTO%E7%B1%BB"><span class="toc-text">è®¾è®¡DTOç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1VO%E7%B1%BB"><span class="toc-text">è®¾è®¡VOç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-2"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82%E6%8E%A5%E5%8F%A3-1"><span class="toc-text">Serviceå±‚æ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="toc-text">Serviceå±‚å®ç°ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-2"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-7"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%8F%9C%E5%93%81"><span class="toc-text">åˆ é™¤èœå“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-7"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-2"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1-2"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-7"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-3"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82%E6%8E%A5%E5%8F%A3-2"><span class="toc-text">Serviceå±‚æ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-Service%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">4.2.3 Serviceå±‚å®ç°ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-3"><span class="toc-text">Mapperå±‚</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81"><span class="toc-text">ä¿®æ”¹èœå“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-8"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-8"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%93%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">æ ¹æ®idæŸ¥è¯¢èœå“å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">ä¿®æ”¹èœå“å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8F%9C%E5%93%81%E7%9A%84%E8%B5%B7%E5%94%AE-%E5%81%9C%E5%94%AE"><span class="toc-text">èœå“çš„èµ·å”®&#x2F;åœå”®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day04"><span class="toc-text">day04</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%86%85%E5%AE%B9"><span class="toc-text">å®Œæˆå†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="toc-text">æ–°å¢å¥—é¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-9"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">ä»£ç å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-4"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-1"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-4"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-8"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E9%A4%90%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">å¥—é¤åˆ†é¡µæŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-10"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-text">ä»£ç å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-5"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-2"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-5"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-9"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90"><span class="toc-text">åˆ é™¤å¥—é¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-11"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-2"><span class="toc-text">ä»£ç å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-6"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-3"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-6"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-10"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A5%97%E9%A4%90"><span class="toc-text">ä¿®æ”¹å¥—é¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-12"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-3"><span class="toc-text">ä»£ç å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-7"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-4"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-7"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-11"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%B7%E5%94%AE-%E5%81%9C%E5%94%AE%E5%A5%97%E9%A4%90"><span class="toc-text">èµ·å”®&#x2F;åœå”®å¥—é¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-13"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-4"><span class="toc-text">ä»£ç å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-8"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-5"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-8"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-12"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day05"><span class="toc-text">day05</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%85%A5%E9%97%A8"><span class="toc-text">è¯¾ç¨‹å…¥é—¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E4%B8%AD%E6%93%8D%E4%BD%9CRedis"><span class="toc-text">Javaä¸­æ“ä½œRedis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E7%9A%84Java%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">Redisçš„Javaå®¢æˆ·ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Data-Redis%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">Spring Data Redisä½¿ç”¨æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">å¸¸è§æ•°æ®ç±»å‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%97%E9%93%BA%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81%E8%AE%BE%E7%BD%AE"><span class="toc-text">åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-14"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-9"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81"><span class="toc-text">è®¾ç½®è¥ä¸šçŠ¶æ€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%AB%AF%E6%9F%A5%E8%AF%A2%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81"><span class="toc-text">ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AB%AF%E6%9F%A5%E8%AF%A2%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81"><span class="toc-text">ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day06"><span class="toc-text">day06</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-2"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91"><span class="toc-text">å¾®ä¿¡å°ç¨‹åºå¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">å°ç¨‹åºç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%92%8C%E7%BC%96%E8%AF%91%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="toc-text">ç¼–å†™å’Œç¼–è¯‘å°ç¨‹åº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="toc-text">å‘å¸ƒå°ç¨‹åº</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95"><span class="toc-text">å¾®ä¿¡ç™»å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81"><span class="toc-text">å¯¼å…¥å°ç¨‹åºä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-text">å¾®ä¿¡ç™»å½•æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-15"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-3"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1-3"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-10"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-text">æ·»åŠ ç›¸å…³é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DTO%E8%AE%BE%E8%AE%A1"><span class="toc-text">DTOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VO%E8%AE%BE%E8%AE%A1"><span class="toc-text">VOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-9"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-6"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-9"><span class="toc-text">Mapperå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">ç¼–å†™æ‹¦æˆªå™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-13"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%95%86%E5%93%81%E6%B5%8F%E8%A7%88%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="toc-text">å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-16"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AF%BC%E5%85%A5-1"><span class="toc-text">ä»£ç å¯¼å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-10"><span class="toc-text">Mapperå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-7"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-10"><span class="toc-text">Controllerå±‚</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day07"><span class="toc-text">day07</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-3"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%8F%9C%E5%93%81"><span class="toc-text">ç¼“å­˜èœå“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%AF%B4%E6%98%8E"><span class="toc-text">é—®é¢˜è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF"><span class="toc-text">ä¼˜åŒ–æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-11"><span class="toc-text">ä»£ç å¼€å‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%A5%97%E9%A4%90"><span class="toc-text">ç¼“å­˜å¥—é¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cache"><span class="toc-text">Spring Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3-1"><span class="toc-text">å¸¸ç”¨æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#user-id-user%E6%8C%87%E7%9A%84%E6%98%AF%E6%96%B9%E6%B3%95%E5%BD%A2%E5%8F%82%E7%9A%84%E5%90%8D%E7%A7%B0-id%E6%8C%87%E7%9A%84%E6%98%AFuser%E7%9A%84id%E5%B1%9E%E6%80%A7-%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8user%E7%9A%84id%E5%B1%9E%E6%80%A7%E4%BD%9C%E4%B8%BAkey"><span class="toc-text">user.id : #useræŒ‡çš„æ˜¯æ–¹æ³•å½¢å‚çš„åç§°, idæŒ‡çš„æ˜¯userçš„idå±æ€§ , ä¹Ÿå°±æ˜¯ä½¿ç”¨userçš„idå±æ€§ä½œä¸ºkey ;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#result-id-result%E4%BB%A3%E8%A1%A8%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%8C%E8%AF%A5%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E4%BB%A3%E8%A1%A8%E4%BB%A5%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E7%9A%84id%E5%B1%9E%E6%80%A7%E4%BD%9C%E4%B8%BAkey-%EF%BC%9B"><span class="toc-text">result.id : #resultä»£è¡¨æ–¹æ³•è¿”å›å€¼ï¼Œè¯¥è¡¨è¾¾å¼ ä»£è¡¨ä»¥è¿”å›å¯¹è±¡çš„idå±æ€§ä½œä¸ºkey ï¼›</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#p0-id%EF%BC%9A-p0%E6%8C%87%E7%9A%84%E6%98%AF%E6%96%B9%E6%B3%95%E4%B8%AD%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8Cid%E6%8C%87%E7%9A%84%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84id%E5%B1%9E%E6%80%A7-%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84id%E5%B1%9E%E6%80%A7%E4%BD%9C%E4%B8%BAkey"><span class="toc-text">p0.idï¼š#p0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey ;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a0-id%EF%BC%9A-a0%E6%8C%87%E7%9A%84%E6%98%AF%E6%96%B9%E6%B3%95%E4%B8%AD%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8Cid%E6%8C%87%E7%9A%84%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84id%E5%B1%9E%E6%80%A7-%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84id%E5%B1%9E%E6%80%A7%E4%BD%9C%E4%B8%BAkey"><span class="toc-text">a0.idï¼š#a0æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§ä½œä¸ºkey ;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#root-args-0-id-root-args-0-%E6%8C%87%E7%9A%84%E6%98%AF%E6%96%B9%E6%B3%95%E4%B8%AD%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8Cid%E6%8C%87%E7%9A%84%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84id%E5%B1%9E%E6%80%A7-%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-text">root.args[0].id:#root.args[0]æŒ‡çš„æ˜¯æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒidæŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„idå±æ€§,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-1"><span class="toc-text">å®ç°æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-12"><span class="toc-text">ä»£ç å¼€å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-text">2.4 åŠŸèƒ½æµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4"><span class="toc-text">2.5 ä»£ç æäº¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">æ·»åŠ è´­ç‰©è½¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-17"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-1"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-4"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1-4"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-13"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DTO%E8%AE%BE%E8%AE%A1-1"><span class="toc-text">DTOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-11"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-8"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-11"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-14"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">æŸ¥çœ‹è´­ç‰©è½¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-18"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-2"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-5"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-14"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-12"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-9"><span class="toc-text">Serviceå±‚</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">æ¸…ç©ºè´­ç‰©è½¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-19"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-15"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-13"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-10"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-12"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-15"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#day08"><span class="toc-text">day08</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-4"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%9C%B0%E5%9D%80%E7%B0%BF%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="toc-text">å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-20"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-3"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-6"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1-5"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AF%BC%E5%85%A5-2"><span class="toc-text">ä»£ç å¯¼å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-13"><span class="toc-text">Mapperå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-11"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-14"><span class="toc-text">Controllerå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-16"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95"><span class="toc-text">ç”¨æˆ·ä¸‹å•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-21"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-4"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-7"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%AE%BE%E8%AE%A1-6"><span class="toc-text">è¡¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-16"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DTO%E8%AE%BE%E8%AE%A1-2"><span class="toc-text">DTOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VO%E8%AE%BE%E8%AE%A1-1"><span class="toc-text">VOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-15"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-12"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-14"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-17"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98"><span class="toc-text">è®¢å•æ”¯ä»˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BB%8B%E7%BB%8D"><span class="toc-text">å¾®ä¿¡æ”¯ä»˜ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">3.2 å¾®ä¿¡æ”¯ä»˜å‡†å¤‡å·¥ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%EF%BC%9F"><span class="toc-text">3.2.1 å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%A6%82%E4%BD%95%E8%B0%83%E7%94%A8%E5%88%B0%E5%95%86%E6%88%B7%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="toc-text">3.2.2 å¦‚ä½•è°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E4%BB%A3%E7%A0%81%E5%AF%BC%E5%85%A5"><span class="toc-text">3.3 ä»£ç å¯¼å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-text">3.3.1 å¾®ä¿¡æ”¯ä»˜ç›¸å…³é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-Mapper%E5%B1%82"><span class="toc-text">3.3.2 Mapperå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-Service%E5%B1%82"><span class="toc-text">3.3.3 Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-Controller%E5%B1%82"><span class="toc-text">3.3.4 Controllerå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-text">3.4 åŠŸèƒ½æµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4"><span class="toc-text">3.5 ä»£ç æäº¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day09"><span class="toc-text">day09</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AB%AF%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-text">ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95"><span class="toc-text">æŸ¥è¯¢å†å²è®¢å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-22"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-5"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85"><span class="toc-text">æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-23"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-6"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E8%AE%A2%E5%8D%95"><span class="toc-text">å–æ¶ˆè®¢å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-24"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-7"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E6%9D%A5%E4%B8%80%E5%8D%95"><span class="toc-text">å†æ¥ä¸€å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-25"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-8"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%AE%B6%E7%AB%AF%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-text">å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%90%9C%E7%B4%A2"><span class="toc-text">è®¢å•æœç´¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-26"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-9"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E4%B8%AA%E7%8A%B6%E6%80%81%E7%9A%84%E8%AE%A2%E5%8D%95%E6%95%B0%E9%87%8F%E7%BB%9F%E8%AE%A1"><span class="toc-text">å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-27"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-10"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85-1"><span class="toc-text">æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-28"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-11"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8D%95"><span class="toc-text">æ¥å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-29"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-12"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%92%E5%8D%95"><span class="toc-text">æ‹’å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-30"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-13"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E8%AE%A2%E5%8D%95-1"><span class="toc-text">å–æ¶ˆè®¢å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-31"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-14"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%BE%E9%80%81%E8%AE%A2%E5%8D%95"><span class="toc-text">æ´¾é€è®¢å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-32"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-15"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E8%AE%A2%E5%8D%95"><span class="toc-text">å®Œæˆè®¢å•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-33"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-16"><span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E6%98%AF%E5%90%A6%E8%B6%85%E5%87%BA%E9%85%8D%E9%80%81%E8%8C%83%E5%9B%B4"><span class="toc-text">æ ¡éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">1. ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-text">2. ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-application-yml"><span class="toc-text">2.1 application.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-OrderServiceImpl"><span class="toc-text">2.2 OrderServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day10"><span class="toc-text">day10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-5"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Task"><span class="toc-text">Spring Task</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">cronè¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-2"><span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Task%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-text">Spring Taskä½¿ç”¨æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-17"><span class="toc-text">ä»£ç å¼€å‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-18"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E5%AE%9A%E6%97%B6%E5%A4%84%E7%90%86"><span class="toc-text">è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-18"><span class="toc-text">ä»£ç å¼€å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-19"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebSocket"><span class="toc-text">WebSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-5"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-3"><span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-text">æ¡ˆä¾‹åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-19"><span class="toc-text">ä»£ç å¼€å‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-20"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A5%E5%8D%95%E6%8F%90%E9%86%92"><span class="toc-text">æ¥å•æé†’</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-34"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-20"><span class="toc-text">ä»£ç å¼€å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-21"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E5%82%AC%E5%8D%95"><span class="toc-text">å®¢æˆ·å‚¬å•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-35"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-21"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-16"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-13"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-15"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-22"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day11"><span class="toc-text">day11</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-6"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-ECharts"><span class="toc-text">Apache ECharts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-6"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-4"><span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1"><span class="toc-text">è¥ä¸šé¢ç»Ÿè®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-36"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-5"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-8"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-22"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VO%E8%AE%BE%E8%AE%A1-2"><span class="toc-text">VOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-17"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-14"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-16"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-23"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1"><span class="toc-text">ç”¨æˆ·ç»Ÿè®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-37"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-6"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-9"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-23"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VO%E8%AE%BE%E8%AE%A1-3"><span class="toc-text">VOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-18"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-15"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-17"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-24"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1"><span class="toc-text">è®¢å•ç»Ÿè®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-38"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-7"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-10"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-24"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VO%E8%AE%BE%E8%AE%A1-4"><span class="toc-text">VOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-19"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-16"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-18"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-25"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%80%E9%87%8F%E6%8E%92%E5%90%8DTop10"><span class="toc-text">é”€é‡æ’åTop10</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-39"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-8"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-11"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-25"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VO%E8%AE%BE%E8%AE%A1-5"><span class="toc-text">VOè®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-20"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-Service%E5%B1%82%E6%8E%A5%E5%8F%A3"><span class="toc-text">5.2.3 Serviceå±‚æ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB-2"><span class="toc-text">Serviceå±‚å®ç°ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-19"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-26"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day12"><span class="toc-text">day12</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-7"><span class="toc-text">è¯¾ç¨‹å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8F%B0"><span class="toc-text">å·¥ä½œå°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-40"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-9"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-12"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AF%BC%E5%85%A5-3"><span class="toc-text">ä»£ç å¯¼å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-21"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-17"><span class="toc-text">Serviceå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E5%B1%82-20"><span class="toc-text">Mapperå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-27"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95-4"><span class="toc-text">æ¥å£æ–‡æ¡£æµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95-4"><span class="toc-text">å‰åç«¯è”è°ƒæµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-POI"><span class="toc-text">Apache POI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-7"><span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-5"><span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5Excel%E6%96%87%E4%BB%B6"><span class="toc-text">å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96Excel%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E8%BF%90%E8%90%A5%E6%95%B0%E6%8D%AEExcel%E6%8A%A5%E8%A1%A8"><span class="toc-text">å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-41"><span class="toc-text">éœ€æ±‚åˆ†æå’Œè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-10"><span class="toc-text">äº§å“åŸå‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-13"><span class="toc-text">æ¥å£è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-26"><span class="toc-text">ä»£ç å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">å®ç°æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E5%B1%82-22"><span class="toc-text">Controllerå±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E5%B1%82-18"><span class="toc-text">Serviceå±‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-28"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li></div></div></div></div></main><footer id="footer" style="background-color:transparent"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>å†çœ‹çœ‹é‚£ä¸ªå…‰ç‚¹ï¼Œå®ƒå°±åœ¨è¿™é‡Œï¼Œè¿™æ˜¯å®¶å›­ï¼Œè¿™æ˜¯æˆ‘ä»¬ â€”â€” ä½ æ‰€çˆ±çš„æ¯ä¸€ä¸ªäººï¼Œä½ è®¤è¯†çš„ä¸€ä¸ªäººï¼Œä½ å¬è¯´è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œæ›¾ç»æœ‰è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œéƒ½åœ¨å®ƒä¸Šé¢åº¦è¿‡ä»–ä»¬çš„ä¸€ç”Ÿâœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-linksf"><li><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a><a href="/box/nav/">ç½‘å€å¯¼èˆª</a></li><li><a href="/personal/about/">å…³äºä½œè€…</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li><li><a href="/site/time/">å»ºè®¾è¿›ç¨‹</a><a href="/site/census/">ç½‘ç«™ç»Ÿè®¡</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"><a target="_blank" rel="noopener" href="https://www.fomal.cc/" title="FomalhautğŸ¥"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/60e5d4e39da7c077.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div></div></div></div><div class="copyright"><span><b>&copy;2025</b></span><span><b>&nbsp;&nbsp;By SilvanğŸ³</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.3.1"><img src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯æ‰˜ç®¡äºVercel"><img src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="æœ¬ç«™æ•°æ®åˆ†æå¾—ç›Šäº51laæŠ€æœ¯æ”¯æŒ"><img src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20226665å·"><img src="https://sourcebucket.s3.ladydaily.com/badge/èŒICPå¤‡-20226665-fe1384.svg" alt=""></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="æœ¬ç½‘ç«™ç»Service Workeråˆ†æµè‡³ç¼¤çº·äº‘å¯¹è±¡å­˜å‚¨"><img src="https://sourcebucket.s3.ladydaily.com/badge/Bucket-ç¼¤çº·äº‘-9c62da.svg" alt=""></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="æœ¬ç«™ä½¿ç”¨ç½‘ç›¾æ˜Ÿçƒæä¾›CDNåŠ é€Ÿä¸é˜²æŠ¤"><img src="https://sourcebucket.s3.ladydaily.com/badge/CDN-ç½‘ç›¾æ˜Ÿçƒ-fff2cc.svg" alt=""></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="æœ¬ç½‘ç«™æºç ç”±Githubæä¾›å­˜å‚¨ä»“åº“"><img src="https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><span class="icon-text">â‡„</span></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><span class="icon-text">ğŸ–±ï¸</span></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><span class="icon-text">âš™</span></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><span class="icon-text">ğŸ”—</span></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="icon-text">â†‘</span><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><span class="icon-text">â†“</span></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><svg class="icon"><use xlink:href="#icon-mulu1"></use></svg></a><a class="rightMenu-item" href="javascript:window.history.forward();"><svg class="icon"><use xlink:href="#icon-eye"></use></svg></a><a class="rightMenu-item" href="javascript:window.location.reload();"><svg class="icon"><use xlink:href="#icon-gengxin1"></use></svg></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><svg class="icon"><use xlink:href="#icon-tuding"></use></svg></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><svg class="icon"><use xlink:href="#icon-charuword"></use></svg><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><svg class="icon"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><svg class="icon"><use xlink:href="#icon-tongxunlu"></use></svg><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><svg class="icon"><use xlink:href="#icon-charuword"></use></svg><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><svg class="icon"><use xlink:href="#icon-pinglun1"></use></svg><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><svg class="icon"><use xlink:href="#icon-charuword"></use></svg><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><svg class="icon"><use xlink:href="#icon-eye"></use></svg><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><svg class="icon"><use xlink:href="#icon-tongxunlu"></use></svg><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><svg class="icon"><use xlink:href="#icon-charuword"></use></svg><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><svg class="icon"><use xlink:href="#icon-tupian1"></use></svg><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><svg class="icon"><use xlink:href="#icon-eye"></use></svg><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><svg class="icon"><use xlink:href="#icon-charuword"></use></svg><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><svg class="icon"><use xlink:href="#icon-fenlei"></use></svg><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><svg t="1758265847868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5939" width="15.5" height="15.6"><path d="M932.608 68.928l22.656 22.656a16 16 0 0 1 0 22.592L488.064 581.248a382.464 382.464 0 0 0 247.936 90.752 383.296 383.296 0 0 0 143.936-27.904c26.688-10.816 57.408 11.904 46.4 38.528-1.92 4.608-3.84 9.216-5.952 13.76a448.064 448.064 0 0 1-701.696 154.24L113.92 955.52a16 16 0 0 1-22.592 0l-22.656-22.656a16 16 0 0 1 0-22.656l114.304-114.24.512-.64 91.008-91.008 1.088-1.024 80-80A192 192 0 0 1 623.36 355.52l80-80a16.768 16.768 0 0 1 1.088-1.088l90.496-90.56 1.088-.96 113.92-113.92a16 16 0 0 1 22.656 0zM442.752 626.688l-178.56 178.56A382.464 382.464 0 0 0 512 896a383.68 383.68 0 0 0 318.976-170.112 449.28 449.28 0 0 1-388.288-99.2zM512.064 384a128 128 0 0 0-110.272 193.088l175.36-175.36A127.36 127.36 0 0 0 512.064 384zM208 480a16 16 0 0 1 16 16v32a16 16 0 0 1-16 16h-128A16 16 0 0 1 64 528v-32a16 16 0 0 1 16-16h128zm21.12-296.128 90.56 90.56a16 16 0 0 1 0 22.592l-22.656 22.656a16 16 0 0 1-22.592 0L184 229.12a16 16 0 0 1 0-22.656l22.592-22.656a16 16 0 0 1 22.656 0zM528.128 64a16 16 0 0 1 16 16v128a16 16 0 0 1-16 16h-32a16 16 0 0 1-16-16v-128A16 16 0 0 1 496 64h32z" p-id="5940"></path></svg><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><svg class="icon"><use xlink:href="#icon-rili"></use></svg><span>é˜…è¯»æ¨¡å¼</span></a><a class="rightMenu-item" href="/personal/about/"><svg class="icon"><use xlink:href="#icon-gonggao"></use></svg><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><svg class="icon"><use xlink:href="#icon-shezhi"></use></svg><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><svg class="icon"><use xlink:href="#icon-eye"></use></svg><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><svg class="icon"><use xlink:href="#icon-shujutongji2"></use></svg><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="/js/copy-code.js"></script><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.js"></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="//at.alicdn.com/t/c/font_5002734_s5p2h2ns8bq.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="snow"></canvas><canvas id="sakura"></canvas><script defer src="/js/fomal.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer data-pjax src="/js/tabs-rebind.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script defer data-pjax src="/js/anti-shake.js"></script><script src="/js/share.js"></script><script defer src="/js/runtime.js"></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><script async src="/js/console.js"></script><script async src="/js/title.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div><script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://silvan.chat/categories/java/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ Silvanã®JavaåŸºç¡€ç¬”è®° (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://silvan.chat/categories/Spring/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ Silvanã®SpringåŸºç¡€ç¬”è®° (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://silvan.chat/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style><style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2025/10/29/ç½‘ç«™/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://konachan.net/data/preview/2f/6c/2f6c5f754d00deb887adc4525151582c.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2025/10/29/ç½‘ç«™/&quot;);" href="javascript:void(0);" alt="">å°ç ´ç«™æ¦‚è¿°</a><div class="blog-slider__text">è¿™åªæ˜¯ä¸€ä¸ªåˆæ­¥æ¥è§¦è®¡ç®—æœºçš„æ‡µæ‡‚å¤§å­¦ç”Ÿçš„å°ç«™ï¼Œç®€å•è®°å½•ä¸€ä¸‹è‡ªå·±çš„å­¦ä¹ ç¬”è®°~~~</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2025/10/29/ç½‘ç«™/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2025/10/12/Springboot-SpringBoot2-é»‘é©¬/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://konachan.net/data/preview/2f/6c/2f6c5f754d00deb887adc4525151582c.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-12</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2025/10/12/Springboot-SpringBoot2-é»‘é©¬/&quot;);" href="javascript:void(0);" alt="">SpringBoot2</a><div class="blog-slider__text">SpringBoot2é»‘é©¬è¯¾ç¨‹ä»‹ç»</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2025/10/12/Springboot-SpringBoot2-é»‘é©¬/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2025/08/22/markdownä¸å¤–æŒ‚æ ‡ç­¾-markdownä¸å¤–æŒ‚æ ‡ç­¾/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://konachan.net/data/preview/50/d1/50d198aae2061ff0c46331b3a253565d.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-22</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2025/08/22/markdownä¸å¤–æŒ‚æ ‡ç­¾-markdownä¸å¤–æŒ‚æ ‡ç­¾/&quot;);" href="javascript:void(0);" alt="">Markdownä¸å¤–æŒ‚æ ‡ç­¾</a><div class="blog-slider__text">ğŸ¥§æ±‡æ€»äº†Markdownå’Œå¤–æŒ‚æ ‡ç­¾çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä½œä¸ºæŸ¥è¯¢æ–‡æ¡£ä½¿ç”¨</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2025/08/22/markdownä¸å¤–æŒ‚æ ‡ç­¾-markdownä¸å¤–æŒ‚æ ‡ç­¾/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2025/10/28/å¿«é€Ÿå…¥é—¨/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://konachan.net/data/preview/2f/6c/2f6c5f754d00deb887adc4525151582c.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-28</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2025/10/28/å¿«é€Ÿå…¥é—¨/&quot;);" href="javascript:void(0);" alt="">hexoå¿«é€Ÿå…¥é—¨</a><div class="blog-slider__text">å¿«é€Ÿå…¥é—¨</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2025/10/28/å¿«é€Ÿå…¥é—¨/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>